/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/modeler/ui/utils/optionsValueModelBuilder","sap/apf/modeler/ui/utils/staticValuesBuilder","sap/apf/modeler/ui/utils/constants","sap/apf/modeler/ui/utils/textManipulator","sap/apf/modeler/ui/utils/nullObjectChecker","sap/apf/utils/utils","sap/ui/Device","sap/ui/core/Item","sap/ui/core/mvc/Controller"],function(e,t,r,o,i,a,n,d,s){"use strict";var u="idSortProperty";var p="idSortDirection";var e=sap.apf.modeler.ui.utils.optionsValueModelBuilder;var l=sap.apf.modeler.ui.utils.textManipulator;var f=sap.apf.modeler.ui.utils.CONSTANTS.events;function c(e){e.byId("idSortLabel").setText(e.oTextReader("sortingField"));e.byId("idSortLabel").setTooltip(e.oTextReader("sortingField"));e.byId("idSortDirectionLabel").setText(e.oTextReader("direction"));e.byId("idSortDirectionLabel").setTooltip(e.oTextReader("direction"));e.byId("idAddPropertyIcon").setTooltip(e.oTextReader("addButton"));e.byId("idRemovePropertyIcon").setTooltip(e.oTextReader("deleteButton"))}function y(e){if(n.browser.msie&&n.browser.version>=11){e.byId("idAriaPropertyForSortGroup").setText(e.oTextReader("sorting"))}e.byId("idAriaPropertyForAdd").setText(e.oTextReader("ariaTextForAddIcon"));e.byId("idAriaPropertyForDelete").setText(e.oTextReader("ariaTextForDeleteIcon"))}function v(t){var r=t.byId(u);t.getAllPropertiesAsPromise().done(function(t){var o=e.convert(t.aAllProperties);r.setModel(o);r.setSelectedKey(t.sSelectedKey)})}function g(t){var r=t.byId(p);var o=new sap.apf.modeler.ui.utils.StaticValuesBuilder(t.oTextReader,e);var i=o.getSortDirections();r.setModel(i);r.setSelectedKey(t.getView().getViewData().oPropertyTypeData.sContext)}function P(e){var t=true,r=true;var o=e.getView().getViewData().oPropertyTypeState;var i=o.indexOfPropertyTypeViewId(e.getView().getId());if(o.indexOfPropertyTypeViewId(e.getView().getId())===0){r=false}e.byId("idAddPropertyIcon").setVisible(t);e.byId("idRemovePropertyIcon").setVisible(r);if(i>0&&o.aProperties!==undefined){var a=o.getViewAt(i-1);a.oController.byId("idAddPropertyIcon").setVisible(false)}}function I(e,t){var r=e.getView().getViewData().oPropertyTypeState;if(r!==undefined){var o=r.aProperties.length;var i=r.getViewAt(t-1);var a=e.oConfigurationEditor.isSaved();if(t>1&&t==o&&a==false){i.oController.byId("idAddPropertyIcon").setVisible(true);i.oController.byId("idRemovePropertyIcon").setVisible(true)}if(t===1&&t==o&&a==false){i.oController.byId("idAddPropertyIcon").setVisible(true)}}}function T(e){e.byId("idAddPropertyIcon").attachEvent(f.SETFOCUSONADDICON,e.setFocusOnAddRemoveIcons.bind(e))}var V=s.extend("sap.apf.modeler.ui.controller.sortPropertyType",{oConfigurationEditor:{},oParentObject:{},oStepPropertyMetadataHandler:{},oTextReader:{},onInit:function(){var e=this;e.oConfigurationEditor=e.getView().getViewData().oConfigurationEditor;e.oParentObject=e.getView().getViewData().oParentObject;e.oStepPropertyMetadataHandler=e.getView().getViewData().oStepPropertyMetadataHandler;e.oTextReader=e.getView().getViewData().oCoreApi.getText;e.setDetailData()},onAfterRendering:function(){var e=this;e.byId("idAddPropertyIcon").fireEvent(f.SETFOCUSONADDICON)},setDetailData:function(){var e=this;c(e);y(e);v(e);g(e);P(e);e.disableView()},handleChangeForSortProperty:function(e){var t=this;var r=l.removePrefixText(t.byId(u).getSelectedKey(),t.oTextReader(sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE));var o=t.getView().getViewData().oPropertyOrchestration;var i=t.getView().getId();return new Promise(function(e){t.getView().fireEvent(f.UPDATEPROPERTYVALUESTATE,{sProperty:r});o.updatePropertyTypeRow(i,r);o.updateAllSelectControlsForPropertyType().then(function(){t.updateOfConfigurationObject();t.oConfigurationEditor.setIsUnsaved();e()})})},handleChangeForSortDirection:function(){var e=this;e.updateOfConfigurationObject();e.oConfigurationEditor.setIsUnsaved()},setFocusOnAddRemoveIcons:function(){var e=this;e.byId("idAddPropertyIcon").focus()},handlePressOfAddPropertyIcon:function(){var e=this;T(e);e.addPropertyAsPromise()},handlePressOfRemovePropertyIcon:function(){var e=this;var t=e.getView().getViewData();var r=e.getView().getViewData().oPropertyTypeState;if(r!==undefined){var o=r.indexOfPropertyTypeViewId(e.getView().getId())}return new Promise(function(r){e.getView().fireEvent(f.FOCUSONREMOVE);var i=t.oPropertyOrchestration;i.removePropertyTypeReference(e.getView().getId());i.updateAllSelectControlsForPropertyType().then(function(){e.updateOfConfigurationObject();t.oPropertyTypeHandlerBackLink.handlePressOfRemove({oSourceView:e.getView()});I(e,o);e.oConfigurationEditor.setIsUnsaved();e.getView().destroy();r()})})},updateOfConfigurationObject:function(){var e=this;var t=e.getView().getViewData().oPropertyOrchestration;var r=t.getSortPropertyInformationList(p);e.updateOfConfigurationObjectOfSubclass(r)},getSelectedSortProperty:function(){var e=this;var t=e.getView().getViewData().oPropertyTypeState;var r=t.getPropertyValueState();var o=t.indexOfPropertyTypeViewId(e.getView().getId());return r[o]},removeAllItemsFromDropDownList:function(){var e=this;var t=e.byId(u);t.getItems().forEach(function(e){t.removeItem(e)})},setItemsOfDropDownList:function(e,t,r){function o(e,t){return e.indexOf(t)!==-1}var i=this;var a=i.byId(u);var n=r===i.oTextReader("none");var s=JSON.parse(JSON.stringify(e));a.addItem(new d({key:i.oTextReader("none"),text:i.oTextReader("none")}));if(!o(s,r)&&!n){s.unshift(r)}s=s.filter(function(e){return e!==i.oTextReader("none")});s.forEach(function(e){var s=e;if(!o(t,e)&&!n){e=l.addPrefixText([e],i.oTextReader)[0]}var u=new d({key:e,text:e});a.addItem(u);if(s===r){r=e}});a.setSelectedKey(r)},updateOfConfigurationObjectOfSubclass:function(e){},getOrderBy:function(){},setNextPropertyInParentObject:function(){},removePropertyFromParentObject:function(){},disableView:function(){},addPropertyAsPromise:function(){return a.createPromise()}});return V},true);
//# sourceMappingURL=sortPropertyType.js.map