/*!
* SAP APF Analysis Path Framework
*
* (c) Copyright 2012-2018 SAP SE. All rights reserved
*/
sap.ui.define(["sap/m/Label","sap/m/Text","sap/ui/core/Fragment","sap/ui/core/Popup","sap/ui/core/UIComponent","sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/apf/modeler/ui/utils/constants","sap/ui/core/syncStyleClass"],function(e,t,i,n,o,a,s,r,g,d,f){"use strict";return a.extend("sap.apf.modeler.ui.controller.toolbar",{onInit:function(){this.oCoreApi=this.getView().getViewData().oConfigListInstance.oCoreApi;this.oConfigListInstance=this.getView().getViewData().oConfigListInstance;this._setDisplayText()},_setDisplayText:function(){this.byId("idAddButton").setText(this.oCoreApi.getText("addButton"));this.byId("idCopyButton").setText(this.oCoreApi.getText("copyButton"));this.byId("idDeleteButton").setText(this.oCoreApi.getText("deleteButton"));this.byId("idMoveUp").setTooltip(this.oCoreApi.getText("moveUp"));this.byId("idMoveDown").setTooltip(this.oCoreApi.getText("moveDown"))},enableCopyDeleteButton:function(){if(!this.byId("idCopyButton").getEnabled()){this.byId("idCopyButton").setEnabled(true)}if(!this.byId("idDeleteButton").getEnabled()){this.byId("idDeleteButton").setEnabled(true)}},disableCopyDeleteButton:function(){if(this.byId("idCopyButton").getEnabled()){this.byId("idCopyButton").setEnabled(false)}if(this.byId("idDeleteButton").getEnabled()){this.byId("idDeleteButton").setEnabled(false)}},_setAddMenuText:function(){i.byId("idAddMenuFragment","idNewConfig").setText(this.oCoreApi.getText("newConfiguration"));i.byId("idAddMenuFragment","idNewFacetFilter").setText(this.oCoreApi.getText("newFacetFilter"));i.byId("idAddMenuFragment","idNewCategory").setText(this.oCoreApi.getText("newCategory"));i.byId("idAddMenuFragment","idNewNavigationTarget").setText(this.oCoreApi.getText("newNavigationTarget"));i.byId("idAddMenuFragment","idStep").setText(this.oCoreApi.getText("step"));i.byId("idAddMenuFragment","idNewStep").setText(this.oCoreApi.getText("newStep"));i.byId("idAddMenuFragment","idExistingStep").setText(this.oCoreApi.getText("existingStep"));i.byId("idAddMenuFragment","idHierarchicalStep").setText(this.oCoreApi.getText("hierarchicalStep"));i.byId("idAddMenuFragment","idNewRepresentation").setText(this.oCoreApi.getText("newRepresentation"))},_setExistingStepDialogText:function(){i.byId("idExistingStepDialogFragment","idExistingStepDialog").setTitle(this.oCoreApi.getText("existingStepDialogTitle"))},_enableDisableAddMenuItems:function(e,t){var i;var n=t.getItems();var o,a={};if(this.oConfigListInstance.configEditor){i=Object.keys(this.oConfigListInstance.configEditor.getFilterOption())[0]}if(this.oConfigListInstance.configurationHandler.getList().length===0||e===null){o="default"}else{o=e.nodeObjectType}a["default"]=1;a[d.configurationObjectTypes.CONFIGURATION]=4;a[d.configurationObjectTypes.FACETFILTER]=4;a[d.configurationObjectTypes.SMARTFILTERBAR]=4;a[d.configurationObjectTypes.CATEGORY]=5;a[d.configurationObjectTypes.STEP]=6;a[d.configurationObjectTypes.REPRESENTATION]=6;a[d.configurationObjectTypes.NAVIGATIONTARGET]=4;n.forEach(function(e,t){if(t<a[o]){e.setEnabled(true);if(i!==d.configurationObjectTypes.FACETFILTER&&t===1){e.setEnabled(false)}}else{e.setEnabled(false)}})},_handlePressAddButton:function(e){var t;var i=this,o=true;if(this.oConfigListInstance.getView().byId("idConfigDetailData").getContent().length>=1){t=typeof this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function"?this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined}e.getSource().$().blur();var a=sap.apf.modeler.ui.utils.navigationHandler.getInstance();if(t!==undefined){o=typeof t.getValidationState==="function"?t.getValidationState.call(t):true}var s=this.oConfigListInstance.configEditor?jQuery.extend(true,{},this.oConfigListInstance.configEditor):undefined;this.oConfigListInstance.bIsSaved=s?s.isSaved():undefined;var r=false;var g=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelectedItem());var d=e.getSource();var f=function(){if(!this.addMenu){this.addMenu=new sap.ui.xmlfragment("idAddMenuFragment","sap.apf.modeler.ui.fragment.addMenu",this);this.getView().addDependent(this.addMenu);this._setAddMenuText()}var e=n.Dock;this._enableDisableAddMenuItems(g,this.addMenu);this.addMenu.open(false,d,e.BeginTop,e.BeginBottom,d)};if(!o){a.throwMandatoryPopup(i.oConfigListInstance,{yes:function(){var e=i.oConfigListInstance.oTreeInstance.getParentNodeContext(g);i.oConfigListInstance.configEditor=i.oConfigListInstance.configurationHandler.restoreMemorizedConfiguration(e.configId);if(i.oConfigListInstance.bIsSaved===false&&i.oConfigListInstance.configEditor){i.oConfigListInstance.configEditor.setIsUnsaved()}var t=i.oConfigListInstance._navMandatoryResetState(i.oConfigListInstance);if(!t.isNewView){f.call(i)}}});r=true}if(!r){f.call(i)}},_handleAddMenuItemPress:function(e){var t=this.addMenu.getItems();var i=e.getParameters("item");var n;var o={"idAddMenuFragment--idNewFacetFilter":d.configurationObjectTypes.FACETFILTER,"idAddMenuFragment--idNewCategory":d.configurationObjectTypes.CATEGORY,"idAddMenuFragment--idNewStep":d.configurationObjectTypes.STEP,"idAddMenuFragment--idHierarchicalStep":d.configurationObjectTypes.STEP,"idAddMenuFragment--idNewRepresentation":d.configurationObjectTypes.REPRESENTATION,"idAddMenuFragment--idNewConfig":d.configurationObjectTypes.CONFIGURATION,"idAddMenuFragment--idNewNavigationTarget":d.configurationObjectTypes.NAVIGATIONTARGET,default:d.configurationObjectTypes.CONFIGURATION};t.forEach(function(e){if(e.getId()===i.id){n=o[e.getId()]}else if(e.getSubmenu()){e.getSubmenu().getItems().forEach(function(e){if(e.getId()===i.id){n=o[e.getId()]}})}});var a=false;if(i.id==="idAddMenuFragment--idExistingStep"){this._handleAddExistingStepPress()}else if(i.id!=="idAddMenuFragment--idStep"&&n!==undefined){if(i.id==="idAddMenuFragment--idHierarchicalStep"){a=true}this.oConfigListInstance.oTreeInstance.addNodeInTree(n,undefined,a)}},_copyConfiguration:function(e,t){var i=this.oConfigListInstance.configurationHandler.getConfiguration(e);var n={},a;n.AnalyticalConfiguration=i.AnalyticalConfiguration;n.name="< "+i.AnalyticalConfigurationName+" >";n.Application=i.Application;n.type=d.configurationObjectTypes.CONFIGURATION;n.bIsLoaded=false;n.bToggleState=false;n.isSelected=true;n.expanded=true;n.selectable=true;n.hasExpander=true;this.oConfigListInstance.oModel.getData().aConfigDetails.push(n);this.oConfigListInstance.oModel.updateBindings();a=this.oConfigListInstance.oTreeInstance.getModel().getContext(t);this.oConfigListInstance.selectedNode=this.oConfigListInstance.oTreeInstance.getItemNodeByContextWithoutExpand(a.sPath);this.oConfigListInstance.modelUpdateDeferred[this.oConfigListInstance.oModel.getData().aConfigDetails.length-1]=new jQuery.Deferred;var s={appId:this.oConfigListInstance.appId,configId:e};o.getRouterFor(this.oConfigListInstance).navTo(n.type,s,true)},_handlePressCopyButton:function(t){var i=jQuery.Deferred();var n,o;var a=this,s=true;if(this.oConfigListInstance.getView().byId("idConfigDetailData").getContent().length>=1){n=typeof this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function"?this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined}t.getSource().$().blur();var r=sap.apf.modeler.ui.utils.navigationHandler.getInstance();if(n!==undefined){s=typeof n.getValidationState==="function"?n.getValidationState.call(n):true}var g=this.oConfigListInstance.configEditor?jQuery.extend(true,{},this.oConfigListInstance.configEditor):undefined;this.oConfigListInstance.bIsSaved=g?g.isSaved():undefined;var f=false;var c=function(){var e=this;var t;var n=this.oTreeInstance.getAPFTreeNodeContext(this.oTreeInstance.getSelectedItem()||this.selectedNode);this.selectedNode=this.oTreeInstance.getSelectedItem()||this.selectedNode;var s,r,g,f,c,l,p,I,C,u;g=n.nodeContext;switch(n.nodeObjectType){case d.configurationObjectTypes.FACETFILTER:var h=this.oCoreApi.getText("copyOf")+"  "+n.nodeTitle;var T=this.configEditor.copyFacetFilter(n.nodeAPFId);var v=this.configEditor.getFacetFilter(T);var D=sap.apf.modeler.ui.utils.TranslationFormatMap.FACETFILTER_LABEL;this.oTextPool.setTextAsPromise(h,D).done(function(e){v.setLabelKey(e);c=g.split("/");o=c[2];l=c[6];var t=this.oModel.getData().aConfigDetails[o].configData[0].filters[l];t.isSelected=false;var i=jQuery.extend(true,{},t);i.id=T;i.name="< "+h+" >";i.isSelected=true;f=this.oModel.getData().aConfigDetails[o].configData[0].filters.length;this.oModel.getData().aConfigDetails[o].configData[0].filters.push(i);c[6]=f;r=c.join("/");K()}.bind(this));break;case d.configurationObjectTypes.CATEGORY:var m=this.oCoreApi.getText("copyOf")+"  "+n.nodeTitle;var y=this.configEditor.copyCategory(n.nodeAPFId);var L=sap.apf.modeler.ui.utils.TranslationFormatMap.CATEGORY_TITLE;this.oTextPool.setTextAsPromise(m,L).done(function(i){var n={labelKey:i};this.configEditor.setCategory(n,y);c=g.split("/");o=c[2];p=c[6];var a=[];var s=this.configEditor.getSteps();s.forEach(function(t){if(e.configEditor.getCategoriesForStep(t.getId())[0]===y){a.push(t.getId())}});var d=this.oModel.getData().aConfigDetails[o].configData[1].categories[p];d.isSelected=false;var l=jQuery.extend(true,{},d);if(l.steps){for(var I=0;I<l.steps.length;I++){l.steps[I].id=a[I];var C=e.configEditor.getStep(a[I]);t=C.getRepresentations();if(l.steps[I].representations){for(var u=0;u<l.steps[I].representations.length;u++){l.steps[I].representations[u].id=t[u].getId()}}}}l.id=y;l.name="< "+m+" >";l.isSelected=true;f=this.oModel.getData().aConfigDetails[o].configData[1].categories.length;this.oModel.getData().aConfigDetails[o].configData[1].categories.push(l);c[6]=f;r=c.join("/");K()}.bind(this));break;case d.configurationObjectTypes.NAVIGATIONTARGET:var b=this.oCoreApi.getText("copyOf")+"  "+n.nodeTitle;var A=this.configEditor.copyNavigationTarget(n.nodeAPFId);c=g.split("/");o=c[2];I=c[6];var x=this.oModel.getData().aConfigDetails[o].configData[2].navTargets[I];x.isSelected=false;var E=jQuery.extend(true,{},x);E.id=A;E.name="< "+b+" >";E.isSelected=true;f=this.oModel.getData().aConfigDetails[o].configData[2].navTargets.length;this.oModel.getData().aConfigDetails[o].configData[2].navTargets.push(E);c[6]=f;r=c.join("/");K();a.oConfigListInstance._setNavigationTargetName({configIndexInTree:o});break;case d.configurationObjectTypes.STEP:var S=this.oCoreApi.getText("copyOf")+"  "+n.nodeTitle;var F=this.configEditor.copyStep(n.nodeAPFId);var O=this.configEditor.getCategoriesForStep(F);var N=this.configEditor.getStep(F);var M=sap.apf.modeler.ui.utils.TranslationFormatMap.STEP_TITLE;this.oTextPool.setTextAsPromise(S,M).done(function(e){var i;N.setTitleId(e);c=g.split("/");o=c[2];p=c[6];C=c[8];var n=this.oModel.getData().aConfigDetails[o].configData[1].categories[p].steps[C];n.isSelected=false;var s=jQuery.extend(true,{},n);t=N.getRepresentations();s.id=F;s.name="< "+S+" >";if(s.representations){for(i=0;i<s.representations.length;i++){s.representations[i].id=t[i].getId()}}f=this.oModel.getData().aConfigDetails[o].configData[1].categories[p].steps.length;c[8]=f;r=c.join("/");for(var d=0;d<O.length;d++){var l=jQuery.extend(true,{},s);var I={arguments:{configId:a.oConfigListInstance.configId,categoryId:O[d]}};var u=a.oConfigListInstance.getSPathFromURL(I).sPath.split("/");var h=u[6];this.oModel.getData().aConfigDetails[o].configData[1].categories[h].steps.push(l)}this.oModel.getData().aConfigDetails[o].configData[1].categories[p].steps[f].isSelected=true;K()}.bind(this));break;case d.configurationObjectTypes.REPRESENTATION:c=g.split("/");o=c[2];p=c[6];C=c[8];u=c[10];var w=this.oModel.getData().aConfigDetails[o].configData[1].categories[p].steps[C].id;var P=this.configEditor.getStep(w);var j=this.configEditor.getCategoriesForStep(w);this.oModel.getData().aConfigDetails[o].configData[1].categories[p].steps[C].representations[u].isSelected=false;var R=this.oModel.getData().aConfigDetails[o].configData[1].categories[p].steps[C].representations[u];var _=jQuery.extend(true,{},R);var B=P.copyRepresentation(_.id);_.id=B;f=this.oModel.getData().aConfigDetails[o].configData[1].categories[p].steps[C].representations.length;c[10]=f;r=c.join("/");for(var V=0;V<j.length;V++){var U=jQuery.extend(true,{},_);var G={arguments:{configId:a.oConfigListInstance.configId,categoryId:j[V],stepId:w}};var k=a.oConfigListInstance.getSPathFromURL(G).sPath.split("/");var H=k[6];var Q=k[8];this.oModel.getData().aConfigDetails[o].configData[1].categories[H].steps[Q].representations.push(U)}this.oModel.getData().aConfigDetails[o].configData[1].categories[p].steps[C].representations[f].isSelected=true;K();break;case d.configurationObjectTypes.CONFIGURATION:var Y=this.oCoreApi.getText("copyOf")+"  "+n.nodeTitle;c=g.split("/");o=c[2];var z=this.oModel.getData().aConfigDetails[o];z.isSelected=false;c[2]=this.oModel.getData().aConfigDetails.length;r=c.join("/");this.configurationHandler.copyConfiguration(n.nodeAPFId,function(t){var i={AnalyticalConfigurationName:Y};var n=e.configurationHandler.setConfiguration(i,t);e.configTitle=Y;e.configurationHandler.loadConfiguration(n,function(t){var i=e.configTitle;var n=sap.apf.modeler.ui.utils.TranslationFormatMap.APPLICATION_TITLE;e.configurationHandler.getTextPool().setTextAsPromise(i,n).done(function(e){t.setApplicationTitle(e)})});a._copyConfiguration(t,r)});break;default:break}function K(){e.oModel.updateBindings();s=e.oTreeInstance.getModel().getContext(r);e.selectedNode=e.oTreeInstance.getItemNodeByContextWithoutExpand(s.sPath);var t=e.oTreeInstance.getAPFTreeNodeContext(e.selectedNode);var n=e.oTreeInstance.getParentNodeContext(t);e.navigateToDifferntView(n,t);e.configEditor.setIsUnsaved();i.resolve()}};var l=function(){var t=(new e).addStyleClass("noConfigSelected");t.setText(a.oConfigListInstance.oCoreApi.getText("noConfigSelected"));t.placeAt(a.oConfigListInstance.byId("idConfigDetailData"));a.oConfigListInstance.toolbarController.disableCopyDeleteButton();a.oConfigListInstance._enableDisableExportAndExecuteButton()};var p;if(!s){r.throwMandatoryPopup(a.oConfigListInstance,{yes:function(){var e=a.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(a.oConfigListInstance.oTreeInstance.getSelectedItem());var t=a.oConfigListInstance.oTreeInstance.getParentNodeContext(e);a.oConfigListInstance.bIsDifferntConfig=a.oConfigListInstance.oTreeInstance.isConfigurationSwitched(a.oConfigListInstance.oPreviousSelectedNode,a.oConfigListInstance.selectedNode);a.oConfigListInstance.configEditor=a.oConfigListInstance.configurationHandler.restoreMemorizedConfiguration(t.configId);if(a.oConfigListInstance.bIsSaved===false&&a.oConfigListInstance.configEditor){a.oConfigListInstance.configEditor.setIsUnsaved()}if(a.oConfigListInstance.bIsDifferntConfig===false){var i=typeof a.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function"?a.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;var n=a.oConfigListInstance._isNewSubView(i.getView().getViewData().oParams);if(!n){c.call(a.oConfigListInstance);a.oConfigListInstance._navHandleExpandDelete.call(a.oConfigListInstance,a.oConfigListInstance.oSelectedNodeDetails,t)}else{a.oConfigListInstance.handleConfirmDeletion()}}else{var o=a.oConfigListInstance._navMandatoryResetState(a.oConfigListInstance);if(!o.isNewView){if(o.bIsSaved===false){p(a.oConfigListInstance)}else{c.call(a.oConfigListInstance)}}}}});f=true}var I;if(n.getView().getViewData().oParams.name==="configuration"){I=true}p=function(e){r.throwLossOfDataPopup(e,{yes:function(e){a.oConfigListInstance._navSaveState(function(){e(function(e){if(a.oConfigListInstance.selectedNode){var t=a.oConfigListInstance.selectedNode._getBindingContext().sPath;var i=t.split("/");var n=i[2]}a.oConfigListInstance.oModel.getData().aConfigDetails[n].AnalyticalConfiguration=a.oConfigListInstance.configId;a.oConfigListInstance.oModel.updateBindings();c.call(a.oConfigListInstance)})})},no:function(){var e={appId:a.oConfigListInstance.appId,configId:a.oConfigListInstance.configId};var t=typeof a.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function"?a.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;var i=t.getView().getViewData().oParams.name==="configuration"?true:false;if(a.oConfigListInstance.configId.indexOf(d.configurationObjectTypes.ISNEWCONFIG)===0){a.oConfigListInstance._navHandleExpandDelete.call(a.oConfigListInstance,{},e,i);a.oConfigListInstance.clearTitleAndBreadCrumb();a.oConfigListInstance.byId("idConfigDetailData").removeAllContent();l()}else{a.oConfigListInstance._navConfigResetState(a.oConfigListInstance,function(){c.call(a.oConfigListInstance)})}}})};if(a.oConfigListInstance.bIsSaved===false&&s&&I){p(a.oConfigListInstance);f=true}if(!f){c.call(a.oConfigListInstance)}return i.promise()},_handlePressDeleteButton:function(e){var t;var i=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelectedItem());var n=this.oCoreApi.getText(i.nodeObjectType);e.getSource().$().blur();if(i.nodeObjectType===d.configurationObjectTypes.STEP){t=this.oCoreApi.getText("confirmStepDeletion",[i.nodeTitle])}else{t=this.oCoreApi.getText("confirmDeletion",[n,i.nodeTitle])}this._openDeleteConfirmationDialog(t)},_openDeleteConfirmationDialog:function(e){var i=this;var n=jQuery.extend(i.oConfigListInstance,{closeDialog:i.closeDialog.bind(i)});if(!this.confirmationDialog){this.confirmationDialog=sap.ui.xmlfragment("idConfigConfirmationDialogFragment","sap.apf.modeler.ui.fragment.deleteConfirmationDialog",n);this.getView().addDependent(this.confirmationDialog);this._setConfirmationDialogText()}var o=new t;o.setText(e);this.confirmationDialog.removeAllContent();this.confirmationDialog.addContent(o);this.confirmationDialog.addAriaDescribedBy(o);f("sapUiSizeCompact",this.getView(),this.confirmationDialog);this.confirmationDialog.open()},closeDialog:function(){if(this.confirmationDialog&&this.confirmationDialog.isOpen()){this.confirmationDialog.close()}},_setConfirmationDialogText:function(){i.byId("idConfigConfirmationDialogFragment","idDeleteConfirmation").setTitle(this.oCoreApi.getText("confirmation"));i.byId("idConfigConfirmationDialogFragment","idDeleteButton").setText(this.oCoreApi.getText("deleteButton"));i.byId("idConfigConfirmationDialogFragment","idCancelButtonDialog").setText(this.oCoreApi.getText("cancel"))},_handlePressMoveUpButton:function(){this.bIsDown=false;var e=this.oConfigListInstance.oTreeInstance.getSelectedItem();if(e!==null){var t=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(e);if(t!==undefined){this._moveUpOrDown(t,this.bIsDown)}}},_handlePressMoveDownButton:function(){this.bIsDown=true;var e=this.oConfigListInstance.oTreeInstance.getSelectedItem();if(e!==null){var t=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(e);if(t!==undefined){this._moveUpOrDown(t,this.bIsDown)}}},_moveUpOrDown:function(e,t){var i=e.nodeObjectType;var n=e.nodeAPFId;var o=e.nodeContext;var a=o.split("/")[2];var s,r,g,f,c;var l=false;var p=o.split("/")[o.split("/").length-1];switch(i){case d.configurationObjectTypes.FACETFILTER:s=this.oConfigListInstance.oModel.getData().aConfigDetails[a].configData[0].filters;c=s.length;if(t){if(parseInt(p,10)!==c-1){this.oConfigListInstance.configEditor.moveFacetFilterUpOrDown(n,1);r=parseInt(p,10)+1;l=true}}else{if(parseInt(p,10)!==0){this.oConfigListInstance.configEditor.moveFacetFilterUpOrDown(n,-1);r=parseInt(p,10)-1;l=true}}break;case d.configurationObjectTypes.CATEGORY:s=this.oConfigListInstance.oModel.getData().aConfigDetails[a].configData[1].categories;c=s.length;if(t){if(parseInt(p,10)!==c-1){this.oConfigListInstance.configEditor.moveCategoryUpOrDown(n,1);r=parseInt(p,10)+1;l=true}}else{if(parseInt(p,10)!==0){this.oConfigListInstance.configEditor.moveCategoryUpOrDown(n,-1);r=parseInt(p,10)-1;l=true}}break;case d.configurationObjectTypes.NAVIGATIONTARGET:s=this.oConfigListInstance.oModel.getData().aConfigDetails[a].configData[2].navTargets;c=s.length;if(t){if(parseInt(p,10)!==c-1){this.oConfigListInstance.configEditor.moveNavigationTargetUpOrDown(n,1);r=parseInt(p,10)+1;l=true}}else{if(parseInt(p,10)!==0){this.oConfigListInstance.configEditor.moveNavigationTargetUpOrDown(n,-1);r=parseInt(p,10)-1;l=true}}break;case d.configurationObjectTypes.STEP:var I=o.split("/")[6];var C=this.oConfigListInstance.oModel.getData().aConfigDetails[a].configData[1].categories[I];s=C.steps;c=s.length;if(t){if(parseInt(p,10)!==c-1){this.oConfigListInstance.configEditor.moveCategoryStepAssignmentUpOrDown(C.id,n,1);r=parseInt(p,10)+1;l=true}}else{if(parseInt(p,10)!==0){this.oConfigListInstance.configEditor.moveCategoryStepAssignmentUpOrDown(C.id,n,-1);r=parseInt(p,10)-1;l=true}}break;case d.configurationObjectTypes.REPRESENTATION:var u=this.oConfigListInstance.oTreeInstance.getSelectedItem();var h=u.getParentNode();var T=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(h).nodeAPFId;var v=this.oConfigListInstance.configEditor.getStep(T);I=o.split("/")[6];var D=o.split("/")[8];s=this.oConfigListInstance.oModel.getData().aConfigDetails[a].configData[1].categories[I].steps[D].representations;c=s.length;if(t){if(parseInt(p,10)!==c-1){v.moveRepresentationUpOrDown(n,1);r=parseInt(p,10)+1;l=true}}else{if(parseInt(p,10)!==0){v.moveRepresentationUpOrDown(n,-1);r=parseInt(p,10)-1;l=true}}break;default:break}if(l){g=s[p];f=s[r];s[r]=g;s[p]=f;this.oConfigListInstance.oModel.updateBindings();this.oConfigListInstance.configEditor.setIsUnsaved()}},_handleAddExistingStepPress:function(){var e=this;var t=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelectedItem());var i=this.oConfigListInstance.oTreeInstance.getParentNodeContext(t).categoryId;var n=this.oConfigListInstance.configEditor.getStepsNotAssignedToCategory(i);var o;var a=[];n.forEach(function(t){var i={};var n=e.oConfigListInstance.configEditor.getStep(t);o=e.oConfigListInstance.oTextPool.get(n.getTitleId()).TextElementDescription;i.id=t;i.name=o;a.push(i)});var s=new g({existingStepData:a});if(!this.addExistingStepDialog){this.addExistingStepDialog=sap.ui.xmlfragment("idExistingStepDialogFragment","sap.apf.modeler.ui.fragment.existingStepDialog",this);this._setExistingStepDialogText()}this.getView().addDependent(this.addExistingStepDialog);this.addExistingStepDialog.setModel(s);this.addExistingStepDialog.open()},_handleExistingStepDialogOK:function(e){var t=d.configurationObjectTypes.STEP;var i=e.getParameters("listItem").selectedItems;var n=i.length;var o=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelectedItem());var a=this.oConfigListInstance.oTreeInstance.getParentNodeContext(o).categoryId;var s=[];for(var r=0;r<n;r++){var g=e.getParameters("selectedItems").selectedContexts[r].sPath.split("/")[2];var f=e.getSource().getModel().getData().existingStepData[g];var c=this.oConfigListInstance.configEditor.getStep(f.id);this.oConfigListInstance.configEditor.addCategoryStepAssignment(a,f.id);var l=c.getRepresentations();var p=l.length;var I=[];for(var C=0;C<p;C++){var u={};u.id=l[C].getId();u.name=l[C].getRepresentationType();u.icon=this._getRepresentationIcon(u.name);I.push(u)}var h={};h.step=f;h.representations=I;h.noOfReps=p;s.push(h)}if(n!==0){var T={noOfSteps:n,aExistingStepsToBeAdded:s};this.oConfigListInstance.oTreeInstance.addNodeInTree(t,T)}},_getRepresentationIcon:function(e){var t;var i=this.oCoreApi.getRepresentationTypes();for(var n=0;n<i.length;n++){if(e===i[n].id){t=i[n].picture;break}}return t},_handleExistingStepDialogSearch:function(e){var t=e.getParameter("value");var i=new s("name",r.Contains,t);var n=e.getSource().getBinding("items");n.filter([i])},_handleExistingStepDialogClose:function(e){if(this.addExistingStepDialog){e.getSource().getBinding("items").filter([])}}})},true);
//# sourceMappingURL=toolbar.controller.js.map