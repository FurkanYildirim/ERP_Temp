sap.ui.define(["sap/apf/modeler/ui/utils/textPoolHelper","sap/apf/modeler/ui/utils/nullObjectChecker","sap/apf/modeler/ui/utils/viewValidator","sap/apf/modeler/ui/utils/staticValuesBuilder","sap/m/MessageBox","sap/apf/modeler/ui/utils/optionsValueModelBuilder","sap/ui/core/mvc/ViewType","sap/ui/thirdparty/jquery","sap/ui/core/mvc/Controller"],function(e,t,i,a,n,o,r,jQuery){"use strict";var s,d,l,c,g,u,p,f;var v;var t=sap.apf.modeler.ui.utils.nullObjectChecker;var o=sap.apf.modeler.ui.utils.optionsValueModelBuilder;var m=sap.apf.modeler.ui.utils.TranslationFormatMap.NAVTARGET_TITLE;function b(e){e.byId("idNavigationTargetHeaderLabel").setText(d("basicData"));e.byId("idSemanticObjectLabel").setText(d("semanticObject"));e.byId("idActionLabel").setText(d("action"));e.byId("idDescriptionLabel").setText(d("navigationTargetTitle"));e.byId("idNavigationParametersHeaderLabel").setText(d("navigationParametersHeader"));e.byId("idNavigationTargetTypeHeaderLabel").setText(d("navigationTargetType"));e.byId("idNavigationTargetTypeLabel").setText(d("assignmentType"));e.byId("idAssignedStepsLabel").setText(d("assignedSteps"));e.byId("idContextMapping").setText(d("contextMapping"))}function T(e){var i;if(s&&s.arguments&&s.arguments.navTargetId){u=g.getNavigationTarget(s.arguments.navTargetId)}if(!t.checkIsNotUndefined(u)){i=g.createNavigationTarget();u=g.getNavigationTarget(i);w(e)}}function I(e){var t=u.getTitleKey()?d("navigationTargetTitle"):d("navigationTargetTitle")+" ("+d("default")+")";e.byId("idDescriptionLabel").setText(t);e.byId("idDescriptionLabel").setTooltip(t);e.byId("idUseDynamicParametersCheckBoxLabel").setText(d("useDynamicParametersLabel"))}function y(e){var t,i;var a={oTextReader:d,oConfigurationHandler:c,oConfigurationEditor:g,oParentObject:u,getCalatogServiceUri:e.getView().getViewData().getCalatogServiceUri,oCoreApi:e.getView().getViewData().oCoreApi};t=new sap.ui.controller("sap.apf.modeler.ui.controller.navTargetContextMapping");i=new sap.ui.view({viewName:"sap.apf.modeler.ui.view.requestOptions",type:r.XML,id:e.createId("idContextMappingView"),viewData:a,controller:t});e.getView().attachEvent(sap.apf.modeler.ui.utils.CONSTANTS.events.UPDATESUBVIEWINSTANCESONRESET,i.getController().updateSubViewInstancesOnReset.bind(i.getController()));i.addStyleClass("formTopPadding");e.byId("idContextMappingVBox").insertItem(i);v=0;var n=u.getAllNavigationParameters();if(n.length>0){n.forEach(function(t){S(e,t)})}else{S(e)}}function S(e,t){var i=new sap.ui.controller("sap.apf.modeler.ui.controller.navigationTargetParameter");var a=new sap.ui.view({viewName:"sap.apf.modeler.ui.view.navigationTargetParameter",type:r.XML,id:e.createId("idNavigationTargetParameter"+v),viewData:{oTextReader:d,oParentController:e,oNavigationTarget:u,parameter:t,oConfigurationEditor:g},controller:i});e.byId("idNavigationParameterBox").addItem(a);v++;h(e)}function h(e){e.byId("idNavigationParameterBox").getItems().forEach(function(e){e.getController().checkVisibilityOfPlusMinus()})}function N(e){var i=jQuery.Deferred();f.getAllAvailableSemanticObjects(function(a,n){if(n===undefined){var r=o.prepareModel(a,a.length);e.byId("idSemanticObjectField").setModel(r);if(t.checkIsNotNullOrUndefinedOrBlank(u.getSemanticObject())){e.byId("idSemanticObjectField").setValue(u.getSemanticObject())}i.resolve()}else{E(e,n,"11504")}});return i.promise()}function V(e){var t,i;i=jQuery.Deferred();t=o.prepareModel([],0);e.byId("idActionField").setModel(t);C(undefined,e);A(e).then(function(e){i.resolve(e)});e.byId("idActionField").setValue(u.getAction());return i.promise()}function A(e){var i,a,n,r;r=new jQuery.Deferred;a=u.getSemanticObject();if(t.checkIsNotUndefined(a)){n=f.getSemanticActions(a);n.then(function(t){i=o.prepareModel(t.semanticActions,t.semanticActions.length);e.byId("idActionField").setModel(i);r.resolve(t)},function(t){E(e,t,"11505")})}return r.promise()}function C(e,i){var a,n,o;var r=u.getTitleKey();if(t.checkIsNotUndefined(r)){n=i.getView().getViewData().oConfigurationHandler.getTextPool().get(r).TextElementDescription;i.byId("idDescription").setValue(n)}else{var s=e?e:i.byId("idActionField").getModel().getData().Objects;if(s&&t.checkIsNotNullOrBlank(u.getAction())){for(o=0;o<s.length;o++){if(s[o].id===u.getAction()){a=s[o].text;break}}}n=a?a:u.getSemanticObject();i.byId("idDescription").setValue(n)}}function x(e){var t=new sap.apf.modeler.ui.utils.StaticValuesBuilder(d,o);var i=t.getNavTargetTypeData();e.byId("idNavigationTargetTypeField").setModel(i);var a=u.isStepSpecific()?d("stepSpecific"):d("globalNavTargets");e.byId("idNavigationTargetTypeField").setSelectedKey(a)}function D(e){var t=u.isStepSpecific()?d("stepSpecific"):d("globalNavTargets");if(t===d("stepSpecific")){M(e,true);var i=[];var a=g.getSteps();var n,r;for(n=0;n<a.length;n++){r={};r.stepKey=a[n].getId();r.stepName=l.get(a[n].getTitleId()).TextElementDescription;i.push(r)}var s=o.prepareModel(i,i.length);e.byId("idAssignedStepsCombo").setModel(s);var c=g.getStepsAssignedToNavigationTarget(u.getId());e.byId("idAssignedStepsCombo").setSelectedKeys(c)}}function w(e){var t={id:u.getId(),icon:u.isGlobal()?"sap-icon://overview-chart":"sap-icon://pushpin-off"};if(e.byId("idDescription").getValue()){t.name=e.byId("idDescription").getValue()}f.updateSelectedNode(t)}function O(e){var t=d("navigationTarget")+": "+e.byId("idDescription").getValue();f.updateTitleAndBreadCrumb(t)}function P(e){var t={key:u.getId(),value:e.byId("idDescription").getValue()};f.setNavigationTargetName(t)}function M(e,t){e.byId("idAssignedStepsLabel").setVisible(t);e.byId("idAssignedStepsCombo").setVisible(t)}function E(e,t,i){var a=f.createMessageObject({code:i});a.setPrevious(t);f.putMessage(a)}function U(){var e=g.getStepsAssignedToNavigationTarget(u.getId());var t,i;for(t=0;t<e.length;t++){i=g.getStep(e[t]);i.removeNavigationTarget(u.getId())}}sap.ui.controller("sap.apf.modeler.ui.controller.navigationTarget",{onInit:function(){var e=this;f=e.getView().getViewData();c=f.oConfigurationHandler;g=f.oConfigurationEditor;l=c.getTextPool();d=f.getText;s=f.oParams;if(!g){c.loadConfiguration(s.arguments.configId,function(e){g=e})}b(e);p=new sap.apf.modeler.ui.utils.ViewValidator(e.getView());p.addFields(["idSemanticObjectField","idActionField"]);T(e);y(e);e.setDetailData()},onAfterRendering:function(){var e=this;if(e.getView().byId("idSemanticObjectField").getValue().length===0){e.getView().byId("idSemanticObjectField").focus()}},setDetailData:function(){var e=this;N(e).then(function(){V(e).then(function(t){C(t.semanticActions,e)})});I(e);x(e);D(e);var t=u.getUseDynamicParameters();if(t){this.getView().byId("idUseDynamicParametersCheckBox").setSelected(true)}else{this.getView().byId("idUseDynamicParametersCheckBox").setSelected(false)}},updateSubViewInstancesOnReset:function(e){var t=this;g=e;u=g.getNavigationTarget(u.getId());t.getView().fireEvent(sap.apf.modeler.ui.utils.CONSTANTS.events.UPDATESUBVIEWINSTANCESONRESET,{oConfigurationEditor:g,oParentObject:u})},handleChangeSemanticObjectValue:function(e){var i,a=this;i=e.getParameter("value").trim();u.setTitleKey(undefined);if(t.checkIsNotNullOrBlank(i)){u.setSemanticObject(i);A(a).then(function(e){if(e.semanticActions.length>0){u.setAction(a.byId("idActionField").getModel().getData().Objects[0].id);a.byId("idActionField").setSelectedKey(e.semanticActions[0].id)}else{a.byId("idActionField").setValue("")}C(e.semanticActions,a);I(a);w(a);O(a);P(a)})}g.setIsUnsaved()},handleChangeofAction:function(e){var i,a=this;i=e.getParameter("value");u.setTitleKey(undefined);if(t.checkIsNotNullOrBlank(i)){u.setAction(i)}C(undefined,a);I(a);w(a);O(a);P(a);g.setIsUnsaved()},handleChangeForTitleText:function(){var e=this,t;var i=e.byId("idDescription").getValue();if(i.trim().length===0){t=undefined;u.setTitleKey(t);C(undefined,e);I(e);w(e);O(e);P(e);g.setIsUnsaved()}else{e.getView().getViewData().oConfigurationHandler.getTextPool().setTextAsPromise(i,m).done(function(t){u.setTitleKey(t);I(e);e.byId("idDescription").setValue(i);w(e);O(e);P(e);g.setIsUnsaved()})}},handleSuggestions:function(e){var t=new sap.apf.modeler.ui.utils.SuggestionTextHandler(l);t.manageSuggestionTexts(e,m)},handleChangeOfNavigationTargetType:function(){var e=this;g.setIsUnsaved();var t=e.byId("idNavigationTargetTypeField").getSelectedKey();if(t===d("stepSpecific")){u.setStepSpecific();D(e)}else{u.setGlobal();M(e,false);e.byId("idAssignedStepsCombo").setSelectedKeys([]);U()}w(e,e.byId("idDescription").getValue())},handleChangeForAssignedSteps:function(){var e=this;g.setIsUnsaved();var t=e.byId("idAssignedStepsCombo").getSelectedKeys();var i=g.getStepsAssignedToNavigationTarget(u.getId());i.forEach(function(e){if(t.indexOf(e)===-1){var i=g.getStep(e);i.removeNavigationTarget(u.getId())}});t.forEach(function(e){if(i.indexOf(e)===-1){var t=g.getStep(e);t.addNavigationTarget(u.getId())}})},getValidationState:function(){var e=this;var t=true;e.byId("idNavigationParameterBox").getItems().forEach(function(e){if(!e.getController().validate()){t=false}});return p.getValidationState()&&e.byId("idContextMappingView").getController().getValidationState()&&t},getNavigationParameters:function(){return this.byId("idNavigationParameterBox").getItems()},addNavigationParameter:function(){S(this)},removeNavigationParameter:function(e){this.byId("idNavigationParameterBox").removeItem(e);h(this)},handleChangeForUseDynamicParameters:function(){var e=this.byId("idUseDynamicParametersCheckBox").getSelected();u.setUseDynamicParameters(e)},onExit:function(){var e=this;e.byId("idContextMappingView").destroy()},displayHelpAboutDynamicParameters:function(){var e=d("explanationOfDynamicParameters");var t=d("titleDynamicParameters");n.show(e,{icon:n.Icon.INFORMATION,title:t,actions:[n.Action.CLOSE]})}})});
//# sourceMappingURL=navigationTarget.controller.js.map