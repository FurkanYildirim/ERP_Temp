/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2018 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/library","sap/m/List","sap/m/Popover","sap/m/StandardListItem","sap/m/Text","sap/ui/core/CustomData","sap/ui/core/Fragment","sap/ui/core/UIComponent","sap/ui/core/mvc/ViewType","sap/apf/modeler/ui/utils/helper","sap/apf/modeler/ui/utils/nullObjectChecker","sap/apf/modeler/ui/utils/optionsValueModelBuilder","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,i,a,n,o,r,l,p,d,s,c,u,f,g){"use strict";var m=t.ListType,h=t.PlacementType;function b(e){var t=e.coreApi.getText;e.byId("idAppPage").setTitle(t("configModelerTitle"));e.byId("idAppTitle").setText(t("applicationOverview"));e.byId("idApplicationToolbar").setTooltip(t("applications"));e.byId("idAppNumberTitle").setText(t("applications"));e.byId("idAppNumberTitle").setTooltip(t("applications"));e.byId("idDescriptionLabel").setText(t("description"));if(e.coreApi.showSemanticObject()){e.byId("idSemanticObjectLabel").setText(t("semanticObject"))}e.byId("idImportButton").setText(t("import"));e.byId("idImportButton").setTooltip(t("importConfig"));e.byId("idNewButton").setText(t("new"));e.byId("idNewButton").setTooltip(t("newApplication"));e.byId("idEditIcon").setTooltip(t("editApplication"));e.byId("idDeleteIcon").setTooltip(t("deleteApplication"));e.byId("idTextpoolCleanupIcon").setTooltip(t("textCleanUp"));e.byId("idAriaPropertyForDelete").setText(t("ariaTextForDeleteIcon"));e.byId("idAriaPropertyForEdit").setText(t("ariaTextForEditIcon"));e.byId("idAriaPropertyForTextpoolCleanup").setText(t("ariaTextForTextpoolCleanupIcon"))}function v(e){var t=e.coreApi.getText;l.byId("idDeleteConfirmationFragment","idDeleteConfirmation").setTitle(t("confirmation"));l.byId("idDeleteConfirmationFragment","idDeleteButton").setText(t("deleteButton"));l.byId("idDeleteConfirmationFragment","idCancelButtonDialog").setText(t("cancel"))}function y(e){var t=e.applicationHandler.getList();e.byId("idAppCount").setText("("+t.length+")");var i=[];t.forEach(function(e){var t={};t.id=e.Application;t.description=e.ApplicationName;t.semanticObject=e.SemanticObject;i.push(t)});var a=u.prepareModel(i,i.length);e.byId("idApplicationTable").setModel(a);if(e.actualQuery!==""){e.filterValues(e.actualQuery)}}function I(e,t){var i=e.coreApi.createMessageObject({code:t});e.coreApi.putMessage(i)}function A(e){e.byId("idApplicationTable").attachEvent("addNewAppEvent",e.handleAdditionOfNewApp.bind(e));e.byId("idApplicationTable").attachEvent("updateAppListEvent",e.handleAppListUpdate.bind(e))}function T(e,t){var i,a;i={oParentControl:e.byId("idApplicationTable"),oCoreApi:e.coreApi};a=new sap.ui.view({viewName:"sap.apf.modeler.ui.view."+t,type:d.XML,viewData:i});e.getView().addDependent(a)}function C(e,t,i,a){e.getView().addDependent(t);var n=new o({text:e.coreApi.getText(i)});t.removeAllContent();t.addContent(n);t.addAriaDescribedBy(n);if(a){t.removeAllCustomData();t.addCustomData(a)}t.open()}function D(e){var t=e.byId("idAppListScrollContainer");var i=e.byId("idApplicationTable");var a=e.getView();i.addEventDelegate({onAfterRendering:function(){var i=jQuery(window).height();var n=jQuery(a.byId("idAppTitle").getDomRef()).height();var o=jQuery(a.byId("idApplicationToolbar").getDomRef()).height();var r=jQuery(a.byId("idAppPage").getDomRef()).find("header").height();var l=jQuery(a.byId("idAppPage").getDomRef()).find("footer").height();var d;if(n>0){n=n+80;d=n+o+r+l+25}else{d=232}t.setHeight(i-d+"px");t.setWidth("100%");s.onResize(function(){if(jQuery(a.getDomRef()).css("display")==="block"){i=jQuery(a.byId("idAppPage").getDomRef()).height();t.setHeight(i-d+"px");t.setWidth("100%")}});p.getRouterFor(e).attachRoutePatternMatched(function(e){if(e.getParameter("name")==="applicationList"){i=jQuery(a.getDomRef()).height();t.setHeight(i-d+"px");t.setWidth("100%")}})}})}function x(e,t){var o=new n({title:e.coreApi.getText("importDeliveredContent"),type:m.Active,press:function(){T(e,"importDeliveredContent")}});var r=new n({title:e.coreApi.getText("importFiles"),type:m.Active,press:function(){T(e,"importFiles")}});var l=new a({placement:h.Top,showHeader:false});var p=new i({items:[o,r]});l.addContent(p);l.openBy(t.getSource())}return e.extend("sap.apf.modeler.ui.controller.applicationList",{onInit:function(){var e=this;this.actualQuery="";var t=e.getOwnerComponent();if(c.checkIsNotUndefined(t)){e.coreApi=t.oCoreApi;if(!this.coreApi.showSemanticObject()){this.hideSemanticObjectColumn()}A(this);b(e);e.coreApi.getApplicationHandler(function(t,i){e.applicationHandler=t;if(e.applicationHandler&&!c.checkIsNotUndefined(i)){y(e)}else{e.showMessage("11508",i)}})}D(e)},showMessage:function(e,t){var i=this.coreApi.createMessageObject({code:e});if(t){i.setPrevious(t)}this.coreApi.putMessage(i)},hideSemanticObjectColumn:function(){this.byId("idSemanticObjectColumn").setVisible(false)},handleAddNewAppPress:function(){var e=this;if(c.checkIsNotNullOrUndefinedOrBlank(e.applicationHandler)){T(e,"newApplication")}else{e.showMessage("11509")}},handleListItemPress:function(e){var t=this,i;i=e.getParameter("listItem").getBindingContext().getPath().split("/")[2];p.getRouterFor(t).navTo("configurationList",{appId:t.byId("idApplicationTable").getModel().getData().Objects[i].id})},handleTextpoolCleanupPress:function(e){var t;var i=e.getSource().getBindingContext().getObject().id;var a=new r({value:{applicationId:i}});var n=this.coreApi.getText;t=sap.ui.xmlfragment("idTextpoolCleanupConfirmationFragment","sap.apf.modeler.ui.fragment.textpoolCleanupConfirmationDialog",this);t.setTitle(n("confirmation"));t.getButtons()[0].setText(n("ok"));t.getButtons()[1].setText(n("cancel"));C(this,t,"textpoolCleanupConfirmation",a)},handleConfirmTextpoolCleanup:function(e){var t=this;var i=l.byId("idTextpoolCleanupConfirmationFragment","idTextpoolCleanupConfirmation").getCustomData()[0].getValue().applicationId;t.coreApi.getConfigurationHandler(i,function(e){var a=e.getTextPool();t.coreApi.getUnusedTextKeys(i,function(e,n){if(!c.checkIsNotUndefined(n)){a.removeTexts(e,i,function(e){if(!c.checkIsNotUndefined(e)){t.showMessage("11511")}else{t.showMessage("11507",e)}t.closeTextpoolCleanupConfirmationDialog()})}else{t.showMessage("11506",n);t.closeTextpoolCleanupConfirmationDialog()}})})},closeTextpoolCleanupConfirmationDialog:function(){l.byId("idTextpoolCleanupConfirmationFragment","idTextpoolCleanupConfirmation").destroy()},handleCancelTextpoolCleanup:function(e){this.closeTextpoolCleanupConfirmationDialog()},handleEditPress:function(e){var t,i;if(c.checkIsNotNullOrUndefinedOrBlank(this.applicationHandler)){t=e.getSource().getBindingContext().getObject();i={parentControl:this.byId("idApplicationTable"),coreApi:this.coreApi,applicationData:t};sap.ui.view({viewName:"sap.apf.modeler.ui.view.editApplication",type:d.XML,viewData:i,async:true}).loaded().then(function(e){this.getView().addDependent(e)}.bind(this))}},handleDeletePress:function(e){var t=this,i;var a=e.getSource().getBindingContext().getPath().split("/")[2];var n=new r({value:{removeId:this.byId("idApplicationTable").getModel().getData().Objects[a].id,sPath:a}});i=sap.ui.xmlfragment("idDeleteConfirmationFragment","sap.apf.modeler.ui.fragment.deleteConfirmationDialog",t);v(t);C(t,i,"deleteApp",n)},handleConfirmDeletion:function(){var e=this;var t=l.byId("idDeleteConfirmationFragment","idDeleteConfirmation").getCustomData()[0].getValue().removeId;if(c.checkIsNotUndefined(t)){e.applicationHandler.removeApplication(t,function(t,i,a){if(!c.checkIsNotUndefined(a)&&typeof t==="string"){y(e);I(e,"11510")}else{e.showMessage("11501",a)}e.closeDialog()})}},closeDialog:function(){l.byId("idDeleteConfirmationFragment","idDeleteConfirmation").destroy()},handleNavigationWithSave:function(){var e=this;e.handleSavePress();l.byId("idUnsavedDataConfirmationFragment","idMessageDialog").destroy()},handleNavigationWithoutSave:function(){l.byId("idUnsavedDataConfirmationFragment","idMessageDialog").destroy()},handlePreventNavigation:function(){l.byId("idUnsavedDataConfirmationFragment","idMessageDialog").destroy()},handleImportPress:function(e){if(this.coreApi.isVendorContentAvailable()){x(this,e)}else{T(this,"importFiles")}},handleSavePress:function(){var e=this,t=[],i,a,n;i=e.applicationHandler.getList();a=e.byId("idApplicationTable").getModel().getData().Objects;for(n=0;n<i.length;n++){if(a[n].description!==i[n].ApplicationName||a[n].semanticObject!==i[n].SemanticObject){t.push(a[n])}}t.forEach(function(t){var i={ApplicationName:t.description,SemanticObject:t.semanticObject};e.applicationHandler.setAndSave(i,function(t,i,a){if(c.checkIsNotUndefined(a)){e.showMessage("11500",a)}},t.id)})},handleNavigationToConfigurationList:function(e){var t=this;var i={listItem:sap.ui.getCore().byId(e.currentTarget.id).getParent(),srcControl:t.byId("idApplicationTable")};t.byId("idApplicationTable").fireItemPress(i)},handleAdditionOfNewApp:function(e){var t=this,i,a,n,o=0,r;i=e.getParameter("appId");y(t);a=t.byId("idApplicationTable").getModel().getData().Objects;I(t,"11512");t.byId("idApplicationTable").rerender();for(n=0;n<a.length;n++){if(a[n].id===i){o=n;break}}r=t.byId("idApplicationTable").getItems();if(r.length){var l=r[o].getDomRef();if(l){l.scrollIntoView()}}if(this.actualQuery!==""){this.filterValues(this.actualQuery)}},handleAppListUpdate:function(){var e=this;y(e)},handleNavBack:function(){window.history.go(-1)},onSearch:function(e){var t=e.getParameters().newValue;this.actualQuery=t;this.filterValues(t)},filterValues:function(e){var t=[];if(e&&e.length>0){var i=new f("description",g.Contains,e);t.push(i)}var a=this.byId("idApplicationTable");var n=a.getBinding("items");n.filter(t,"Objects")}})});
//# sourceMappingURL=applicationList.controller.js.map