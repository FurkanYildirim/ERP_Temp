/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
sap.ui.define(["sap/apf/utils/hashtable","sap/apf/core/utils/filter","sap/ui/core/format/DateFormat","sap/apf/utils/exportToGlobal","sap/apf/utils/utils","sap/ui/thirdparty/jquery"],function(e,t,n,a,r,jQuery){"use strict";function i(e,t,n){var a=e.instances.messageHandler;var i=e.instances.persistenceProxy;var s=e.isUsingCloudFoundryProxy;var o=e.constructors.Hashtable;var m=new o(a);var l=new o(a);var u=new o(a);var p=0;var x={TextElement:sap.apf.core.constants.textKeyForInitialText,Language:sap.apf.core.constants.developmentLanguage,TextElementType:"XFLD",TextElementDescription:"",MaximumLength:10,Application:t,TranslationHint:""};function T(e,t){var n=m.getKeys();var a,r=n.length;var i=t.MaximumLength||10;var s=t.TranslationHint||"";var o;for(a=0;a<r;a++){o=m.getItem(n[a]);if(o.TextElementDescription===e&&o.MaximumLength===i&&o.TranslationHint===s){return n[a]}}return undefined}this.removeTexts=function(e,t,n){var a=[];var r,o;function l(t){var a;if(!t){for(a=0;a<o;a++){m.removeItem(e[a])}}n(t)}o=e.length;if(o===0){n(undefined);return}for(r=0;r<o;r++){if(e[r]===sap.apf.core.constants.textKeyForInitialText){continue}a.push({method:"DELETE",entitySetName:"texts",inputParameters:[{name:"TextElement",value:e[r]},{name:"Language",value:sap.apf.core.constants.developmentLanguage}]})}if(s){i.doChangeOperationsInBatch(a,l,t,true)}else{i.doChangeOperationsInBatch(a,l,t)}};this.isInitialTextKey=function(e){return e===sap.apf.core.constants.textKeyForInitialText};this.addTextsAndSave=function(e,t,n){function a(e,t){return e.TextElement===t.TextElement&&e.TextElementDescription===t.TextElementDescription&&e.MaximumLength===t.MaximumLength&&e.Language===t.Language&&e.TranslationHint===t.TranslationHint}var r;var o=e.length;var l;var u=[];var p=[];var x=[];var T;for(r=0;r<o;r++){if(e[r]===sap.apf.core.constants.textKeyForInitialText){continue}l=m.getItem(e[r].TextElement);if(l){if(!a(l,e[r])){u.push(e[r]);m.setItem(e[r].TextElement,e[r])}}else{p.push(e[r]);m.setItem(e[r].TextElement,e[r])}}o=u.length;for(r=0;r<o;r++){T=[{name:"TextElement",value:u[r].TextElement},{name:"Language",value:u[r].Language}];u[r].MaximumLength=parseInt(u[r].MaximumLength,10);x.push({method:"PUT",entitySetName:"texts",data:u[r],inputParameters:T})}o=p.length;for(r=0;r<o;r++){p[r].MaximumLength=parseInt(p[r].MaximumLength,10);x.push({method:"POST",entitySetName:"texts",data:p[r]})}if(x.length>0){if(s){i.doChangeOperationsInBatch(x,t,n,false)}else{i.doChangeOperationsInBatch(x,t,n)}}else{t(undefined)}};this.exportTexts=function(e){var n=r.renderHeaderOfTextPropertyFile(t,a);var i={TextElement:"AnalyticalConfigurationName",Language:sap.apf.core.constants.developmentLanguage,TextElementType:"XTIT",TextElementDescription:e,MaximumLength:250,Application:t,TranslationHint:""};return n+r.renderTextEntries(m,a)+r.renderEntryOfTextPropertyFile(i,a)};this.get=function(e){var t,n;if(e===sap.apf.core.constants.textKeyForInitialText){return x}if(m.hasItem(e)){return m.getItem(e)}if(l.hasItem(e)){t=l.getItem(e);if(t.TextElementDescription){return t}return m.getItem(t)}n=jQuery.extend({},true,x);n.TextElement=e;n.TextElementDescription=e;return n};this.getPersistentKey=function(e){return e};this.setTextAsPromise=function(e,n){var r;var s=jQuery.Deferred();var o=function(e,t,n){if(n){a.putMessage(n)}if(e){m.setItem(e.TextElement,e);r=e.TextElement}s.resolve(e&&e.TextElement)};var l={TextElement:"",Language:sap.apf.core.constants.developmentLanguage,TextElementType:n.TextElementType,TextElementDescription:e,MaximumLength:n.MaximumLength||10,Application:t,TranslationHint:n.TranslationHint||""};if(!e){s.resolve(sap.apf.core.constants.textKeyForInitialText)}r=T(e,n);if(r){s.resolve(r)}else{p++;i.create("texts",l,o,true)}return s.promise()};this.getTextKeys=function(e){var t=m.getKeys();var n,a,r=t.length;var i=[];for(n=0;n<r;n++){a=m.getItem(t[n]);if(e&&a.TextElementType!==e){continue}if(u.hasItem(t[n])){i.push(u.getItem(t[n]))}else{i.push(t[n])}}return i};this.getTextsByTypeAndLength=function(e,t){var n=m.getKeys();var a,r,i=n.length;var s=[];for(a=0;a<i;a++){r=m.getItem(n[a]);if(r.TextElementType===e&&r.MaximumLength===t){if(u.hasItem(n[a])){s.push({TextElement:u.getItem(n[a]),TextElementDescription:r.TextElementDescription})}else{s.push({TextElement:n[a],TextElementDescription:r.TextElementDescription})}}}return s};function f(){var e,t;t=n.length;for(e=0;e<t;e++){if(n[e].TextElement){m.setItem(n[e].TextElement,n[e])}}}f()}a("sap.apf.modeler.core.TextPool",i);return i});
//# sourceMappingURL=textPool.js.map