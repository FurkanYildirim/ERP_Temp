/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
sap.ui.define(["sap/apf/modeler/core/configurationEditor","sap/apf/utils/exportToGlobal","sap/apf/utils/hashtable","sap/apf/utils/utils","sap/apf/modeler/core/configurationObjects"],function(t,e,n,i,a){"use strict";function o(t){var e=this;var n=t.instances.messageHandler;var a=t.instances.persistenceProxy;var o=t.constructors.ConfigurationEditor;var r=t.constructors.Hashtable;var s=t.constructors.LazyLoader;var c=new r(n);var u=new r(n);var f=new r(n);var l=new r(n);var g,m;var p={constructors:{Hashtable:r},instances:{messageHandler:n}};this.exportTexts=function(t){var e=this.getConfiguration(t).AnalyticalConfigurationName;return m.exportTexts(e)};this.getTextPool=function(){return m};this.setApplicationIdAndContext=function(t,e,i){m=i||m;c=new r(n);var a,o=e.length;for(a=0;a<o;a++){c.setItem(e[a].AnalyticalConfiguration,e[a]);u.setItem(e[a].AnalyticalConfiguration,e[a].AnalyticalConfigurationName)}g=t};this.getApplicationId=function(){return g};this.setConfiguration=function(t,e){t.AnalyticalConfiguration=e||C();t.Application=g;c.setItem(t.AnalyticalConfiguration,t);return t.AnalyticalConfiguration};this.getList=function(){var t=[];var e=function(e,n){t.push(n)};c.each(e);return t};this.getConfiguration=function(t){return c.getItem(t)};this.loadConfiguration=function(i,c){var u,l=i.id||i;if(!i.updateExisting){u=f.getItem(l)}if(!u){u=new s(p,C);f.setItem(l,u)}u.asyncGetInstance(l,g);function g(t,e,n){c(t,e)}function C(s,c,u){var f={instances:{coreApi:t.instances.coreApi,messageHandler:n,configurationHandler:e,persistenceProxy:a,textPool:m,metadataFactory:t.instances.metadataFactory},constructors:{Hashtable:r,Step:t.constructors.Step,HierarchicalStep:t.constructors.HierarchicalStep,SmartFilterBar:t.constructors.SmartFilterBar,FacetFilter:t.constructors.FacetFilter,NavigationTarget:t.constructors.NavigationTarget,Representation:t.constructors.Representation,ConfigurationObjects:t.constructors.ConfigurationObjects,ElementContainer:t.constructors.ElementContainer,ConfigurationFactory:t.constructors.ConfigurationFactory,RegistryProbe:t.constructors.RegistryProbe}};new o(i,f,function(t,e){c(s,t,e)})}};this.resetConfiguration=function(t){var e;if(f.hasItem(t)){e=c.getItem(t);e.AnalyticalConfigurationName=u.getItem(t);f.removeItem(t);return t}};this.updateConfigurationName=function(t,e){u.setItem(t,e)};this.copyConfiguration=function(t,n){var i=this.getConfiguration(t);if(!i){n(null);return}e.loadConfiguration(t,a);function a(t){var a,o,r,c;c=sap.apf.modeler.core.ConfigurationObjects.deepDataCopy(i);a=C();c.AnalyticalConfiguration=a;e.setConfiguration(c,a);o=t.copy(a);r=new s(p,undefined,{id:a,instance:o});f.setItem(a,r);n(a)}};this.replaceConfigurationId=function(t,e){if(t.indexOf("apf1972-")===0){var n=c.getItem(t);var i=f.getItem(t).getInstance();var a=new s(p,undefined,{id:e,instance:i});n.AnalyticalConfiguration=e;c.setItem(e,n);u.setItem(e,n.AnalyticalConfigurationName);c.removeItem(t);f.setItem(e,a);f.removeItem(t)}};this.exportConfiguration=function(i,o){var r;this.loadConfiguration(i,s);function s(s){if(!s.isSaved()){n.putMessage(n.createMessageObject({code:"11007",aParameters:[i]}));o(null)}else{var c=t.functions.getApplication(g);var u=e.getConfiguration(i).AnalyticalConfigurationName;r=s.serialize();r.configHeader={Application:g,ApplicationName:c.ApplicationName,SemanticObject:c.SemanticObject,AnalyticalConfiguration:i,AnalyticalConfigurationName:u,UI5Version:sap.ui.version};a.readEntity("configuration",function(t,e,a){if(a){n.putMessage(n.createMessageObject({code:"5022",aParameters:[i]}));o(null)}else{r.configHeader.CreationUTCDateTime=t.CreationUTCDateTime;r.configHeader.LastChangeUTCDateTime=t.LastChangeUTCDateTime;r=JSON.stringify(r,null,"\t");o(r,u)}},[{name:"AnalyticalConfiguration",value:i}],["CreationUTCDateTime","LastChangeUTCDateTime"],g)}}};this.memorizeConfiguration=function(t){var e,n;n=f.getItem(t);if(!n){return null}e=n.getInstance();if(e){l.setItem(t,e.copy(t));return t}return null};this.restoreMemorizedConfiguration=function(t){var e,n;n=l.removeItem(t);if(n){e=new s(p,undefined,{id:t,instance:n});f.setItem(t,e);return n}return null};this.removeConfiguration=function(t,e){function n(n,i){if(!i){c.removeItem(t);f.removeItem(t)}e(t,n,i)}if(t.indexOf("apf1972-")!==0){a.remove("configuration",[{name:"AnalyticalConfiguration",value:t}],n,undefined,g)}else{c.removeItem(t);f.removeItem(t);e(t,undefined,undefined)}};this.removeAllConfigurations=function(){c=new r(n)};function C(){return"apf1972-"+i.createPseudoGuid(32)}}e("sap.apf.modeler.core.ConfigurationHandler",o);return o});
//# sourceMappingURL=configurationHandler.js.map