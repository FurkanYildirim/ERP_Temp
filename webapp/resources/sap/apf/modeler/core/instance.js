/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/thirdparty/datajs","sap/apf/utils/hashtable","sap/apf/utils/utils","sap/apf/core/constants","sap/apf/core/messageHandler","sap/apf/core/sessionHandler","sap/apf/core/representationTypes","sap/apf/core/entityTypeMetadata","sap/apf/core/configurationFactory","sap/apf/core/utils/uriGenerator","sap/apf/core/metadata","sap/apf/core/metadataFacade","sap/apf/core/metadataProperty","sap/apf/core/messageDefinition","sap/apf/core/metadataFactory","sap/apf/core/odataProxy","sap/apf/cloudFoundry/modelerProxy","sap/apf/cloudFoundry/ajaxHandler","sap/apf/utils/proxyTextHandlerForLocalTexts","sap/apf/core/ajax","sap/apf/core/odataRequest","sap/apf/modeler/core/messageDefinition","sap/apf/modeler/core/textHandler","sap/apf/modeler/core/textPool","sap/apf/modeler/core/applicationHandler","sap/apf/modeler/core/configurationHandler","sap/apf/modeler/core/configurationEditor","sap/apf/modeler/core/step","sap/apf/modeler/core/hierarchicalStep","sap/apf/modeler/core/smartFilterBar","sap/apf/modeler/core/facetFilter","sap/apf/modeler/core/navigationTarget","sap/apf/modeler/core/elementContainer","sap/apf/modeler/core/representation","sap/apf/modeler/core/configurationObjects","sap/apf/utils/parseTextPropertyFile","sap/apf/modeler/core/lazyLoader","sap/apf/modeler/core/registryWrapper","sap/apf/utils/exportToGlobal","sap/apf/utils/startParameter","sap/apf/core/utils/fileExists","sap/apf/core/utils/annotationHandler","sap/ui/thirdparty/jquery"],function(e,t,a,n,r,o,i,s,c,u,f,p,l,d,g,m,y,v,h,C,x,A,H,F,T,S,M,b,j,P,O,E,L,R,w,N,U,D,I,G,q,V,jQuery){"use strict";function k(e,n){var r=this;var o,i,s,c,u,f,p,l,d,g,m,y,v,h,C,x,A,S,M,j,P,O,E,L,R,w,U,D,I,G,q,V,k,B,z,W,K,J,X,$,Q,Y;var Z=[];var _;var ee;o=n&&n.constructors&&n.constructors.ApplicationHandler||T;s=n&&n.constructors&&n.constructors.ConfigurationHandler||sap.apf.modeler.core.ConfigurationHandler;c=n&&n.constructors&&n.constructors.ConfigurationEditor||sap.apf.modeler.core.ConfigurationEditor;u=n&&n.constructors&&n.constructors.ConfigurationObjects||sap.apf.modeler.core.ConfigurationObjects;f=n&&n.constructors&&n.constructors.ConfigurationFactory||sap.apf.core.ConfigurationFactory;v=n&&n.constructors&&n.constructors.ElementContainer||sap.apf.modeler.core.ElementContainer;p=n&&n.constructors&&n.constructors.Step||b;l=n&&n.constructors&&n.constructors.HierarchicalStep||sap.apf.modeler.core.HierarchicalStep;d=n&&n.constructors&&n.constructors.SmartFilterBar||sap.apf.modeler.core.SmartFilterBar;g=n&&n.constructors&&n.constructors.FacetFilter||sap.apf.modeler.core.FacetFilter;m=n&&n.constructors&&n.constructors.NavigationTarget||sap.apf.modeler.core.NavigationTarget;y=n&&n.constructors&&n.constructors.Representation||sap.apf.modeler.core.Representation;C=n&&n.constructors&&n.constructors.Hashtable||t;x=n&&n.constructors&&n.constructors.RegistryProbe||sap.apf.modeler.core.RegistryWrapper;O=n&&n.constructors&&n.constructors.LazyLoader||sap.apf.modeler.core.LazyLoader;A=n&&n.constructors&&n.constructors.Metadata||sap.apf.core.Metadata;S=n&&n.constructors&&n.constructors.EntityTypeMetadata||sap.apf.core.EntityTypeMetadata;M=n&&n.constructors&&n.constructors.MetadataFacade||sap.apf.core.MetadataFacade;j=n&&n.constructors&&n.constructors.MetadataProperty||sap.apf.core.MetadataProperty;P=n&&n.constructors&&n.constructors.MetadataFactory||sap.apf.core.MetadataFactory;E=n&&n.constructors&&n.constructors.StartParameter||sap.apf.utils.StartParameter;L=n&&n.constructors&&n.constructors.AnnotationHandler||sap.apf.core.utils.AnnotationHandler;h=n&&n.constructors&&n.constructors.FileExists||sap.apf.core.utils.FileExists;R=n&&n.constructors&&n.constructors.ProxyTextHandlerForLocalTexts||sap.apf.utils.ProxyTextHandlerForLocalTexts;i=n&&n.constructors&&n.constructors.AjaxHandler||sap.apf.cloudFoundry.AjaxHandler;ee=n&&n.instances&&n.instances.datajs||OData;if(n&&n.constructors&&n.constructors.TextHandler){w=new n.constructors.TextHandler}else{w=new H}if(n&&n.constructors&&n.constructors.MessageHandler){U=new n.constructors.MessageHandler(true)}else{U=new sap.apf.core.MessageHandler(true)}U.activateOnErrorHandling(true);U.loadConfig(sap.apf.core.messageDefinition);U.loadConfig(sap.apf.modeler.core.messageDefinition);U.setTextResourceHandler(w);if(n&&n.instances&&n.instances.component){Y={};Y.baseManifest=Object.getPrototypeOf(n.instances.component).getMetadata().getManifest();Y.manifest=jQuery.extend({},true,n.instances.component.getMetadata().getManifest())}I=new E(n&&n.instances&&n.instances.component,Y);this.getStartParameterFacade=function(){return I};this.ajax=function(e){var t=jQuery.extend(true,{},e);t.functions=t.functions||{};t.functions.getSapSystem=I.getSapSystem;if(n&&n.functions&&n.functions.ajax){t.functions.ajax=n.functions.ajax}t.instances={messageHandler:U};return sap.apf.core.ajax(t)};var te=new R({instances:{messageHandler:U}});V={manifests:Y,instances:{messageHandler:U,coreApi:this,proxyTextHandlerForLocalTexts:te}};var ae=n&&n.functions&&n.functions.isUsingCloudFoundryProxy&&n.functions.isUsingCloudFoundryProxy();if(ae){B={instances:{messageHandler:U},functions:{coreAjax:this.ajax}};V.instances.ajaxHandler=new i(B)}if(n&&n.constructors&&n.constructors.PersistenceProxy){G=new n.constructors.PersistenceProxy(e,V)}else{if(ae){G=new sap.apf.cloudFoundry.modelerProxy.ModelerProxy(e,V)}else if(Y&&Y.manifest["sap.apf"]&&Y.manifest["sap.apf"].activateLrep){G=new sap.apf.core.LayeredRepositoryProxy(e,V)}else{G=new sap.apf.core.OdataProxy(e,V)}}if(n&&n.constructors&&n.constructors.SessionHandler){D=new n.constructors.SessionHandler(V)}else{D=new sap.apf.core.SessionHandler(V)}var ne={functions:{getSapSystem:I.getSapSystem,getComponentNameFromManifest:a.getComponentNameFromManifest,getODataPath:sap.apf.core.utils.uriGenerator.getODataPath,getBaseURLOfComponent:sap.apf.core.utils.uriGenerator.getBaseURLOfComponent,addRelativeToAbsoluteURL:sap.apf.core.utils.uriGenerator.addRelativeToAbsoluteURL},instances:{fileExists:new h({functions:{ajax:this.ajax,getSapSystem:I.getSapSystem}})}};var re=new L(ne);k={constructors:{EntityTypeMetadata:S,Hashtable:C,Metadata:A,MetadataFacade:M,MetadataProperty:j},functions:{getServiceDocuments:function(){return[e.serviceRoot]},getSapSystem:I.getSapSystem},instances:{messageHandler:U,coreApi:r,annotationHandler:re},deactivateFatalError:true};q=new P(k);z={constructors:{Hashtable:C},instances:{messageHandler:U}};this.getCatalogServiceUri=n&&n.functions&&n.functions.getCatalogServiceUri;W=n&&n.functions&&n.functions.odataRequestWrapper||sap.apf.core.odataRequestWrapper;this.odataRequest=function(e,t,a,n){var r={instances:{datajs:ee},functions:{getSapSystem:I.getSapSystem}};W(r,e,t,a,n)};this.checkForTimeout=function(e){var t=sap.apf.core.utils.checkForTimeout(e);if(t){U.putMessage(t)}return t};this.getEntityTypeMetadataAsPromise=function(e,t){return q.getEntityTypeMetadata(e,t)};this.getEntityTypeMetadata=this.getEntityTypeMetadataAsPromise;this.getXsrfToken=function(e){return D.getXsrfToken(e)};this.getUriGenerator=function(){return sap.apf.core.utils.uriGenerator};this.getText=function(e,t){return w.getText(e,t)};this.putMessage=function(e){return U.putMessage(e)};this.check=function(e,t,a){return U.check(e,t,a)};this.createMessageObject=function(e){return U.createMessageObject(e)};this.setCallbackForMessageHandling=function(e){U.setMessageCallback(e)};this.isUsingCloudFoundryProxy=function(){return ae||false};this.isVendorContentAvailable=function(){if(I.isLrepActive()||ae&&this.getGenericExit("hasVendorContent")&&this.getGenericExit("hasVendorContent")()){return true}return false};this.importConfigurationFromVendorLayer=function(e,t,a,n){if(ae){this.getApplicationHandler(function(r,o){if(o){n(undefined,undefined,o);return}G.importVendorContent(e,t,a,n,r.registerApplicationCreatedOnServer)})}else{oe(e,t,a,n)}};function oe(e,t,a,n){var o;G.readAllConfigurationsFromVendorLayer().then(function(a){var n=e+"."+t;var s;for(s=0;s<a.length;s++){if(a[s].value===n){o=a[s].applicationText;break}}r.getApplicationHandler(i)});function i(t,a){if(a){n(undefined,undefined,a);return}var r=false;var i=t.getApplication(e);if(!i){r=true}var c={ApplicationName:o};t.setAndSave(c,s,e,r)}function s(e,a,r){if(r){n(t,undefined,r);return}c()}function c(){var t=new sap.apf.core.utils.Filter(U,"Language","eq",sap.apf.core.constants.developmentLanguage);var a=new sap.apf.core.utils.Filter(U,"Application","eq",e);a.addAnd(t);G.readCollection("texts",u,undefined,undefined,a,{layer:"VENDOR"})}function u(a,r,o){if(o){n(t,undefined,o);return}ie(a,e,f)}function f(a){if(a){n(t,undefined,a);return}G.readEntity("configuration",p,[{value:t}],undefined,e,{layer:"VENDOR"})}function p(e,t,r){if(r){n(undefined,t,r);return}var o=JSON.parse(e.SerializedAnalyticalConfiguration);se(o,a,n)}}function ie(e,t,a){r.getApplicationHandler(o);function n(n,r,o){var i;var s;if(o){a(o)}else{i={instances:{messageHandler:U,persistenceProxy:G},constructors:{Hashtable:C},isUsingCloudFoundryProxy:ae};s=new F(i,t,n);s.addTextsAndSave(e,a,t)}}function o(r,o){if(o){a(o);return}var i;var s=r.getApplication(t);if(!s){i=U.createMessageObject({code:11021});a(i);return}if(X&&X.getId()===t){X.getInstance().getTextPool().addTextsAndSave(e,a,t)}else{var c=new sap.apf.core.utils.Filter(U,"Application","eq",t);var u=new sap.apf.core.utils.Filter(U,"Language","eq",sap.apf.core.constants.developmentLanguage);u.addAnd(c);G.readCollection("texts",n,undefined,undefined,u)}}}this.importTexts=function(e,t){var a;var n;var r;var o=N(e,{instances:{messageHandler:U}});if(o.Messages.length>0){a=U.createMessageObject({code:11020});n=o.Messages.length;for(r=0;r<n-1;r++){o.Messages[r+1].setPrevious(o.Messages[r])}a.setPrevious(o.Messages[n-1]);t(a)}else{ie(o.TextElements,o.Application,t)}};function se(e,t,a){var n=e.configHeader;r.getApplicationHandler(o);function o(e,t){if(t){a(undefined,undefined,t);return}var o=false;var c=e.getList();c.forEach(function(e){if(e.Application===n.Application){o=true}});if(o){r.getConfigurationHandler(n.Application,s)}else{var u={ApplicationName:n.ApplicationName,SemanticObject:n.SemanticObject};e.setAndSave(u,i,n.Application,true)}}function i(e,t,o){if(o){a(undefined,undefined,o);return}r.getConfigurationHandler(n.Application,s)}function s(r,o){if(o){a(undefined,undefined,o);return}var i=jQuery.extend({},e,true);delete i.configHeader;var s=false;var u=r.getList();u.forEach(function(e){if(e.AnalyticalConfiguration===n.AnalyticalConfiguration){s=true}});if(s){t(p,l,n.AnalyticalConfigurationName)}else{r.setConfiguration({AnalyticalConfigurationName:n.AnalyticalConfigurationName},n.AnalyticalConfiguration);var f={id:n.AnalyticalConfiguration,creationDate:n.CreationUTCDateTime,lastChangeDate:n.LastChangeUTCDateTime,content:i};r.loadConfiguration(f,c)}function p(){r.setConfiguration({AnalyticalConfigurationName:n.AnalyticalConfigurationName},n.AnalyticalConfiguration);var e={updateExisting:true,id:n.AnalyticalConfiguration,creationDate:n.CreationUTCDateTime,lastChangeDate:n.LastChangeUTCDateTime,content:i};r.loadConfiguration(e,c)}function l(e){if(e&&e!==""){n.AnalyticalConfigurationName=e}var t=r.setConfiguration({AnalyticalConfigurationName:n.AnalyticalConfigurationName});var a={id:t,content:i};r.loadConfiguration(a,c)}}function c(e,t){if(t){a(undefined,undefined,t);return}e.save(a)}}this.importConfiguration=function(e,t,n){var r=JSON.parse(e);if(!o(r,n)){return}se(r,t,n);function o(t,n){var r=[],o=true,i;if(!a.isValidGuid(t.configHeader.Application)){r.push(U.createMessageObject({code:11037,aParameters:[t.configHeader.Application]}));o=false}if(!a.isValidGuid(t.configHeader.AnalyticalConfiguration)){r.push(U.createMessageObject({code:11038,aParameters:[t.configHeader.AnalyticalConfiguration]}));o=false}i=sap.apf.modeler.core.ConfigurationObjects.getTextKeysFromConfiguration(t);i.forEach(function(e){var t=new C(U);if(!t.hasItem(e)){t.setItem(e,e);if(!a.isValidGuid(e)){r.push(U.createMessageObject({code:11039,aParameters:[e]}));o=false}}});if(o){return o}r.forEach(function(e,t,a){if(t){e.setPrevious(a[t-1])}});n(e,undefined,r[r.length-1]);return o}};this.getApplicationHandler=function(e){if(!J){var t=n&&n.functions&&n.functions.loadApplicationHandler||a;J=new O(z,t)}J.asyncGetInstance("ApplicationHandlerId",e);function a(e,t){new o({instances:{messageHandler:U,persistenceProxy:G},constructors:{Hashtable:C},functions:{resetConfigurationHandler:n}},a);function a(a,n){t(e,a,n)}function n(e){if(X&&X.getId()===e){X.getInstance().removeAllConfigurations();X.reset()}}}};this.getConfigurationHandler=function(e,t){if(!X){K=n&&n.functions&&n.functions.loadConfigurationHandler||a;X=new O(z,K)}X.asyncGetInstance(e,t);function a(e,t,a){var n=new sap.apf.core.utils.Filter(U,"Application","eq",e);var o=new sap.apf.core.utils.Filter(U,"Language","eq",sap.apf.core.constants.developmentLanguage);o.addAnd(n);var i=[];var h=["AnalyticalConfiguration","AnalyticalConfigurationName","Application","CreatedByUser","CreationUTCDateTime","LastChangeUTCDateTime","LastChangedByUser"];i.push({entitySetName:"configuration",filter:n,selectList:h});i.push({entitySetName:"texts",filter:o});G.readCollectionsInBatch(i,A);function A(n,o){var i,h;var A;var H;var T=a;if(o){t(e,undefined,o)}else{A=n[0];H=n[1];h={instances:{messageHandler:U,persistenceProxy:G},constructors:{Hashtable:C},isUsingCloudFoundryProxy:ae};i=new F(h,e,H);if(!T){T=new s({instances:{messageHandler:U,persistenceProxy:G,coreApi:r,metadataFactory:q},constructors:{ConfigurationEditor:c,ConfigurationFactory:f,ConfigurationObjects:u,ElementContainer:v,EntityTypeMetadata:S,SmartFilterBar:d,FacetFilter:g,NavigationTarget:m,Hashtable:C,Representation:y,RegistryProbe:x,Step:p,HierarchicalStep:l,LazyLoader:O},functions:{getApplication:J.getInstance().getApplication}})}T.setApplicationIdAndContext(e,A,i);t(e,T,o)}}}};this.getUnusedTextKeys=function(e,t){var a={instances:{messageHandler:U,persistenceProxy:G},constructors:{Hashtable:C}};var n=new u(a);var r=null,o=null,i=null;n.getTextKeysFromAllConfigurations(e,function(e,t){if(o){return}r=e;o=t;if(t||i){s()}});this.getConfigurationHandler(e,function(e,t){if(o){return}i=e;o=t;if(t||r){s()}});function s(){var e=[];if(o){t(undefined,o);return}i.getTextPool().getTextKeys().forEach(function(t){if(!r.hasItem(t)){e.push(t)}});t(e,undefined)}};this.resetConfigurationHandler=function(){if(X){X.reset()}};this.getRepresentationTypes=function(){var e=sap.apf.core.representationTypes();var t=[];jQuery.extend(true,t,e);return t};this.getAllAvailableSemanticObjects=function(e){if(Q){e(Q,_);return}if(_){e([],_);return}Z.push(e);if(Z.length===1){var t={requestUri:"/sap/opu/odata/UI2/INTEROP/SemanticObjects?$format=json&$select=id,text",method:"GET",isSemanticObjectRequest:true};r.odataRequest(t,a,n)}function a(e,t){Q=e.results;Z.forEach(function(t){t(e.results,undefined)})}function n(e){var t;if(e&&e.messageObject){t=e.messageObject}else{U.createMessageObject({code:"11041"});Q=[]}_=t;Z.forEach(function(e){e([],t)})}};this.getSemanticActions=function(e){var t;var a=jQuery.Deferred();if(!$){$=new C(U)}t=$.getItem(e);if(t){a.resolve(t);return a.promise()}r.getAllAvailableSemanticObjects(o);return a.promise();function o(t,r){if(r){a.reject(r);return}var o=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation");var i={id:e,text:""};var s;for(s=0;s<t.length;s++){if(t[s].id===e){i=t[s];break}}if(!o){U.createMessageObject({code:"5038"});var c={semanticObject:i,semanticActions:[]};$.setItem(e,c);a.resolve(c)}else{o.getLinks({semanticObject:i.id,ignoreFormFactor:true,ui5Component:n.instances.component}).done(function(t){var n=[];t.forEach(function(e){var t=e.intent.split("-");var a=t[1].split("?");a=a[0].split("~");n.push({id:a[0],text:e.text})});var r={semanticObject:i,semanticActions:n};$.setItem(e,r);a.resolve(r)}).fail(function(){a.reject(U.createMessageObject({code:"11042"}))})}}};this.navigateToGenericRuntime=function(e,t,a){var o;if(n&&n.exits&&n.exits.getRuntimeUrl&&jQuery.isFunction(n.exits.getRuntimeUrl)){o=n.exits.getRuntimeUrl(e,t)}else{var i=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation");var s={};if(r.getStartParameterFacade().isLrepActive()){s["sap-apf-configuration-id"]=e+"."+t}else{s["sap-apf-configuration-id"]=t}var c=i.hrefForExternal({target:n.functions.getNavigationTargetForGenericRuntime(),params:s});var u=jQuery(location).attr("href");var f=u.split("#")[0];o=f+c}a(o)};this.readAllConfigurationsFromVendorLayer=function(){return G.readAllConfigurationsFromVendorLayer()};this.showSemanticObject=function(){if(I.isLrepActive()||ae){return false}return true};this.getGenericExit=function(e){if(n&&n.exits&&n.exits[e]&&typeof n.exits[e]==="function"){return n.exits[e]}return undefined};this.getComponent=function(){return n&&n.instances&&n.instances.component};if(n&&n.probe&&typeof n.probe==="function"){n.probe({constructors:{ApplicationHandler:o,ConfigurationHandler:s,ConfigurationEditor:c,ConfigurationObjects:u,ConfigurationFactory:f,MetadataFactory:P,Metadata:A,EntityTypeMetadata:S,MetadataFacade:M,MetadataProperty:j,Step:p,HierarchicalStep:l,SmartFilterBar:d,FacetFilter:g,NavigationTarget:m,Representation:y,ElementContainer:v,Hashtable:C,LazyLoader:O,AnnotationHandler:L,ProxyTextHandlerForLocalTexts:R,RegistryProbe:x},textHandler:w,messageHandler:U,sessionHandler:D,persistenceProxy:G,metadataFactory:q,injectForFollowUp:V,injectMetadataFactory:k,fnOdataRequestWrapper:W,proxyTextHandlerForLocalTexts:te,ajax:this.ajax,odataRequestWrapper:W,annotationHandler:re})}}I("sap.apf.modeler.core.Instance",k);return k});
//# sourceMappingURL=instance.js.map