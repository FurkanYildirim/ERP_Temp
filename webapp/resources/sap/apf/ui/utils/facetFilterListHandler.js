/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/ui/utils/facetFilterListConverter","sap/apf/ui/utils/facetFilterValueFormatter","sap/apf/utils/exportToGlobal","sap/m/FacetFilterList","sap/m/FacetFilterItem","sap/ui/Device","sap/ui/model/BindingMode","sap/ui/model/json/JSONModel","sap/ui/thirdparty/jquery"],function(e,t,i,s,a,r,l,n,jQuery){"use strict";function o(e,t,i){"use strict";var o=[];var u;var c=new sap.apf.ui.utils.FacetFilterListConverter;function d(t){if(t===null||t.length===0){var s=e.createMessageObject({code:"6010",aParameters:[e.getTextNotHtmlEncoded(i.getLabel())]});e.putMessage(s);u.setActive(false)}}function f(i,s,a,l){var n=new sap.apf.ui.utils.FacetFilterValueFormatter(t,e);var d=n.getFormattedFFData(i,s,a);var f=c.getFFListDataFromFilterValues(d,s,o);var F=u.getModel();F.setSizeLimit(500);F.setData(f);var g=F.getData();if(l){g.forEach(function(e){if(e.selected==false){if(!r.browser.msie){if(Object.values(u.getSelectedKeys()).indexOf(e.text)>-1){u.removeSelectedKey(e.key)}}else{if(Object.keys(u.getSelectedKeys()).indexOf(e.text)>-1){u.removeSelectedKey(e.key)}}}})}F.updateBindings()}this.createFacetFilterList=function(){var t=this;u=new s({title:e.getTextNotHtmlEncoded(i.getLabel()),multiSelect:i.isMultiSelection(),key:i.getPropertyName(),growing:false,growingScrollToLoad:true,listClose:this.onListClose.bind(this),listOpen:this.onListOpen.bind(this)});u.bindItems("/",new a({key:"{key}",text:"{text}",selected:"{selected}"}));var r=new n([]);r.setDefaultBindingMode(l.OneWay);u.setModel(r);if(!i.hasValueHelpRequest()){this.getFacetFilterListData().done(d)}this.getSelectedFFValues().then(function(e){c(e)});return u;function c(e){e.oFilterRestrictionPropagationPromiseForSelectedValues.done(function(e,t){c({aSelectedFilterValues:e,oFilterRestrictionPropagationPromiseForSelectedValues:t})});if(e.aSelectedFilterValues.length>0||o.length>0){o=e.aSelectedFilterValues;t.getFacetFilterListData().done(function(e,t,i){f(e,t,i,true)})}}};this.getFacetFilterListData=function(){var e;var t=jQuery.Deferred();var s=i.getValues();s.then(function(s){e=i.getAliasNameIfExistsElsePropertyName()||i.getPropertyName();i.getMetadata().then(function(i){t.resolve(s,e,i)})});return t.promise()};this.getSelectedFFValues=function(){var e=jQuery.Deferred();var t=i.getSelectedValues();t.then(function(t,i){e.resolve({aSelectedFilterValues:t,oFilterRestrictionPropagationPromiseForSelectedValues:i})});return e.promise()};this.setSelectedFFValues=function(e){i.setSelectedValues(e)};this.onListClose=function(){var e=[],i,s,a,r;i=u.getSelectedItems();e=i.map(function(e){return e.getKey()});s=JSON.stringify(e.sort());a=JSON.stringify(o.sort());r=s!==a;if(r){o=e;this.setSelectedFFValues(e);t.selectionChanged(true)}};this.onListOpen=function(){u.setBusy(true);this.getFacetFilterListData().done(function(e,t,i){f(e,t,i,false);u.setBusy(false)})}}i("sap.apf.ui.utils.FacetFilterListHandler",o);return o});
//# sourceMappingURL=facetFilterListHandler.js.map