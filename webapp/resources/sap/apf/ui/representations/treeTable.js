/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2018 SAP SE. All rights reserved
*/
sap.ui.define(["sap/apf/core/constants","sap/apf/ui/utils/formatter","sap/apf/modeler/ui/utils/constants","sap/apf/ui/representations/BaseUI5ChartRepresentation","sap/apf/ui/representations/utils/paginationDisplayOptionHandler","sap/m/FlexItemData","sap/m/Label","sap/m/Text","sap/m/VBox","sap/ui/core/library","sap/ui/model/BindingMode","sap/ui/table/Column","sap/ui/table/library","sap/ui/table/TreeTable"],function(e,t,r,a,i,o,n,l,s,p,u,d,c,f){"use strict";var T=p.HorizontalAlign,g=c.SelectionMode,h=c.VisibleRowCountMode;function b(e){return e.metadata.getPropertyMetadata(e.requiredFilter).text}function y(e){return e.oTreeTableControlObject.parameters.treeAnnotationProperties.hierarchyNodeExternalKeyFor}function m(e,t){if(e){if(t.getPropertyMetadata(e)["filter-restriction"]==="single-value"){return g.Single}return g.MultiToggle}return g.None}function F(e,t,r){var a;var i=function(e){return function(t){if(r.metadata!==undefined){var a;if(t){a=r.oFormatter.getFormattedValue(e,t);if(a!==undefined){return a}}}return t}};a=new f({showNoData:false,title:t,enableSelectAll:false,visibleRowCountMode:h.Auto});a.setLayoutData(new o({growFactor:1}));a.addStyleClass("sapUiSizeCompact");a.setSelectionMode(m(r.requiredFilter,r.metadata));var s=[],p,c;e.name.forEach(function(t,r){p=(new l).bindText(e.value[r],i(e.value[r]),u.OneWay);c=new d({label:new n({text:t}),template:p,tooltip:t});s.push(c)});s.forEach(function(e){a.addColumn(e)});r.oTreeTableModel.attachBatchRequestCompleted(function(){if(r.oApi.getUiApi().getLayoutView().getController()&&r.oApi.getUiApi().getLayoutView().getController().byId("stepContainer")){r.oApi.getUiApi().getLayoutView().getController().byId("stepContainer").getContent()[0].byId("idStepLayout").setBusy(false)}C(r,a,e);if(r.oRepresentationFilterHandler!==null){if(r.oRepresentationFilterHandler!==undefined){if(r.oRepresentationFilterHandler.getFilterValues().length>0){v(r)}else{r.oTreeTable.clearSelection()}}}});r.oTreeTableModel.attachBatchRequestSent(function(e){if(r.oApi.getUiApi().getLayoutView().getController()&&r.oApi.getUiApi().getLayoutView().getController().byId("stepContainer")){r.oApi.getUiApi().getLayoutView().getController().byId("stepContainer").getContent()[0].byId("idStepLayout").setBusy(true)}});a.setModel(r.oTreeTableModel);a.bindRows(r.oTreeTableControlObject);return a}function v(e){var t=e.oTreeTable.getRows();e.oTreeTable.clearSelection();setTimeout(function(){t.forEach(function(t,r){var a=t.getBindingContext();if(a){var i=a.getProperty(e.requiredFilter);e.oRepresentationFilterHandler.getFilterValues().forEach(function(t){if(i===t){e.oTreeTable.addSelectionInterval(r,r)}})}})},1)}function C(e,t,r){if(e.metadata!==null){if(e.metadata!==undefined){for(var a=0;a<r.name.length;a++){var i=e.metadata.getPropertyMetadata(r.value[a]);if(i["aggregation-role"]==="measure"){var o=t.getColumns()[a];o.setHAlign(T.End)}}}}}function A(e,t){var r=e.oTreeTable.getContextByIndex(t).getProperty(e.requiredFilter);var a=e.oTreeTable.getSelectionMode(e.requiredFilter);var i=e.oTreeTable.isIndexSelected(t);var o=e.oTreeTable.getContextByIndex(t).getProperty(b(e));var n=e.oTreeTable.getContextByIndex(t).getProperty(y(e));e.oPaginationDisplayOptionHandler.createDisplayValueLookupForPaginatedFilter(r,o,n);var l=e.oRepresentationFilterHandler.getFilterValues();if(i){l=x(e,a,r,l)}else{l=S(e,a,r,l)}E(e,l)}function R(e){e.oRepresentationFilterHandler.clearFilters()}function P(e){return e.filter(function(e,t,r){return r.indexOf(e)===t})}function x(e,t,r,a){if(t===g.Single){a=[r]}else{a.push(r)}return P(a)}function S(e,t,r,a){if(t===g.Single){a=[]}else{var i=a.indexOf(r);if(i!==-1){a.splice(i,1)}}return a}function E(e,t){R(e);e.oRepresentationFilterHandler.updateFilterFromSelection(t);e.oApi.selectionChanged()}function H(e){var t={name:[],value:[]};var r=e.oParameters.hierarchicalProperty.concat(e.oParameters.properties);r.forEach(function(r,a){var i=r.fieldName;var o=e.metadata.getPropertyMetadata(i).label||e.metadata.getPropertyMetadata(i).name;if(r.kind===sap.apf.modeler.ui.utils.CONSTANTS.propertyTypes.HIERARCHIALCOLUMN){if(r.labelDisplayOption==="text"){i=e.metadata.getPropertyMetadata(e.oTreeTableControlObject.parameters.treeAnnotationProperties.hierarchyNodeFor).text}else{i=e.oTreeTableControlObject.parameters.treeAnnotationProperties.hierarchyNodeExternalKeyFor}}t.name[a]=r.fieldDesc===undefined||!e.oApi.getTextNotHtmlEncoded(r.fieldDesc).length?o:e.oApi.getTextNotHtmlEncoded(r.fieldDesc);t.value[a]=i});return t}var w=function(e,t){var r=this;r.oParameters=t;r.requiredFilter=r.oParameters.requiredFilters[0];r.oKeyTextLookup={};r.type=sap.apf.ui.utils.CONSTANTS.representationTypes.TREE_TABLE_REPRESENTATION;sap.apf.ui.representations.BaseUI5ChartRepresentation.apply(r,[e,t]);r.oPaginationDisplayOptionHandler=new sap.apf.ui.representations.utils.PaginationDisplayOptionHandler;r._selectRowInTreeTable=function(e){var t=e.getParameter("userInteraction");var a=e.getParameter("rowIndex");if(!t||a===undefined||a===null){return}A(r,a)};r.handleRowSelectionInTreeTable=function(e){r._selectRowInTreeTable(e)}};w.prototype=Object.create(sap.apf.ui.representations.BaseUI5ChartRepresentation.prototype);w.prototype.constructor=w;w.prototype.getMainContent=function(e){if(!this.oTreeTable){var t=H(this);this.oTreeTable=F(t,e,this);this.oTreeTable.attachRowSelectionChange(this.handleRowSelectionInTreeTable.bind(this))}return new s({fitContainer:true,items:[this.oTreeTable]})};w.prototype.getSelections=function(){var e=[],t=this,r;this.oRepresentationFilterHandler.getFilterValues().forEach(function(a){r=t.oPaginationDisplayOptionHandler.getDisplayNameForPaginatedFilter(a,t.parameter.requiredFilterOptions,t.requiredFilter,t.oFormatter,t.metadata);e.push({id:a,text:r})});return e};w.prototype.removeAllSelection=function(){this.oRepresentationFilterHandler.clearFilters();this.oTreeTable.clearSelection();this.oApi.selectionChanged()};w.prototype.getFilter=function(){var e=this.oApi.createFilter();var t=e.getTopAnd().addOr("exprssionOr");this.oRepresentationFilterHandler.getFilterValues().forEach(function(e){var r={id:e,name:this.requiredFilter,operator:"EQ",value:e};t.addExpression(r)}.bind(this));return e};w.prototype.setFilterValues=function(e){var t=this,r=[];var a=t.requiredFilter;t.oRepresentationFilterHandler.clearFilters();e.forEach(function(e){var i=e[a];var o=e[b(t)];var n=e[y(t)];t.oPaginationDisplayOptionHandler.createDisplayValueLookupForPaginatedFilter(i,o,n);r.push(i)});t.oRepresentationFilterHandler.updateFilterFromSelection(r)};w.prototype.updateTreetable=function(e,t,r,a){this.oTreeTableModel=t;this.oTreeTableControlObject=e;this.metadata=r;this.oFormatter=new sap.apf.ui.utils.formatter({getEventCallback:this.oApi.getEventCallback.bind(this.oApi),getTextNotHtmlEncoded:this.oApi.getTextNotHtmlEncoded,getExits:this.oApi.getExits()},this.metadata);if(this.oTreeTable&&a){this.oTreeTable.bindRows(this.oTreeTableControlObject)}};w.prototype.getPrintContent=function(e){var t=this.oTreeTable.clone();var r={oRepresentation:t};return r};w.prototype.getSelectedFilterPropertyLabel=function(e){return this.metadata.getPropertyMetadata(e)["hierarchy-node-for"]};w.prototype.destroy=function(){if(this.oParameters){this.oParameters=null}if(this.oTreeTableModel){this.oTreeTableModel=null}if(this.oTreeTableControlObject){this.oTreeTableControlObject=null}if(this.oTreeTable){this.oTreeTable.destroy()}if(this.metadata){this.metadata=null}if(this.oRepresentationFilterHandler){this.oRepresentationFilterHandler=null}sap.apf.ui.representations.BaseUI5ChartRepresentation.prototype.destroy.call(this)};return w},true);
//# sourceMappingURL=treeTable.js.map