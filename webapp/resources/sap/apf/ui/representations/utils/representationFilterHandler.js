/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/ui/representations/utils/displayOptionHandler","sap/apf/utils/exportToGlobal","sap/apf/utils/utils","sap/apf/core/metadataProperty","sap/ui/thirdparty/jquery"],function(e,t,r,a,jQuery){"use strict";function i(e){return e.filter(function(e,t,r){return r.indexOf(e)===t})}function o(e,t,a){var i,o;var s=e.oParameter.requiredFilters[0];if(s){var n=e.oParameter.requiredFilterOptions?e.oParameter.requiredFilterOptions.labelDisplayOption:undefined;var l=e.oDisplayOptionHandler.getColumnNameBasedOnDisplayOption(s,n,t);var u=new sap.apf.core.MetadataProperty(t.getPropertyMetadata(l));e.aFilterValues.forEach(function(t){for(i=0;i<a.length;i++){if(a[i][s]===t){if(a[i]["formatted_"+l]){o=a[i]["formatted_"+l]}else{o=r.convertToExternalFormat(a[i][l],u)}break}}e.filterValueLookup[t]=o})}}function s(e,t,r){this.oApi=e;this.aFilterValues=[];this.oParameter=t;this.sRequiredFilter=this.oParameter.requiredFilters[0];this.oDisplayOptionHandler=new sap.apf.ui.representations.utils.DisplayOptionHandler;this.filterValueLookup={};this.oTimeAxisDateConverter=r}s.prototype.constructor=s;s.prototype.setMetadataAndDataResponse=function(e,t){this.oMetadata=e;this.aDataResponse=t};s.prototype.validateFiltersWithDataset=function(){var e=[];var t=this.aDataResponse.map(function(e){return e[this.sRequiredFilter]}.bind(this));e=this.aFilterValues.filter(function(e){return t.indexOf(e)!==-1});this.aFilterValues=e};s.prototype.createFilterFromSelectedValues=function(e){var t=this,r=false,a;var o=this.oApi.createFilter();if(e&&e.length>0){this.aFilterValues=i(e.concat(this.aFilterValues))}var s=o.getTopAnd().addOr("exprssionOr");var n=o.getOperators().EQ;r=t.oTimeAxisDateConverter.bIsConversionToDateRequired(this.oParameter.requiredFilters[0],this.oMetadata);this.aFilterValues.forEach(function(e){if(r){a=t.oTimeAxisDateConverter.getConvertedDateLookUp()[e]||e}else{a=e}var i={id:e,name:t.sRequiredFilter,operator:n,value:a};s.addExpression(i)});return o};s.prototype.updateFilterFromSelection=function(e){var t=i(e);this.aFilterValues=t.slice(0)};s.prototype.clearFilters=function(){this.aFilterValues=[]};s.prototype.getDisplayInfoForFilters=function(e,t){var r=[],a=this;o(a,e,t);a.aFilterValues.forEach(function(e){var t={id:e,text:a.filterValueLookup[e]};r.push(t)});return r};s.prototype.getFilterValues=function(){return this.aFilterValues};s.prototype.getIfSelectedFilterChanged=function(e){var t=jQuery(this.aFilterValues).not(e).length===0&&jQuery(e).not(this.aFilterValues).length===0;return!t};t("sap.apf.ui.representations.utils.RepresentationFilterHandler",s);return s});
//# sourceMappingURL=representationFilterHandler.js.map