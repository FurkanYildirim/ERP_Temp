/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/security/encodeXML","sap/m/Button","sap/m/Dialog","sap/m/library","sap/m/Link","sap/m/MessageBox","sap/m/MessageToast","sap/m/Text","sap/m/VBox","sap/ui/Device","sap/ui/core/HTML","sap/ui/core/library","sap/ui/thirdparty/jquery"],function(e,t,o,a,s,i,n,r,l,g,c,u,p,jQuery){"use strict";var d=s.DialogType,f=s.FlexAlignItems,w=p.ValueState;var m;function h(e){var t=e.getMessage();while(e.getPrevious()){e=e.getPrevious();t=t+"\n"+e.getMessage()}return t}function y(e,t){var o=e.getView().getViewData().oCoreApi;var a=o.getGenericExit("closeFatalErrorDialog");if(a){a(o,e,t)}else{window.history.go(-1)}}function v(e,t){n.information(t.getMessage(),{styleClass:c.system.desktop?"sapUiSizeCompact":""})}function x(e,t){r.show(t.getMessage(),{width:"20em"})}function A(e){var t=m.oCoreApi.getLogMessages();var o=false;for(var a=0;a<t.length;a++){if(t[a].search(5021)!==-1){o=true;break}}return o}function C(e,s){var i=new a(e.createId("idShowDetailsDialog"),{contentWidth:jQuery(window).height()*.6+"px",contentHeight:jQuery(window).height()*.6+"px",title:m.oCoreApi.getTextNotHtmlEncoded("error"),type:d.Message,state:w.Error,content:new u({content:["<div><p> "+t(h(s))+"</p></div>"].join(""),sanitizeContent:true}),beginButton:new o({text:m.oCoreApi.getTextNotHtmlEncoded("close"),press:function(){i.close()}}),afterClose:function(){i.destroy()}});i.setInitialFocus(i);i.open()}function E(e,t){var s=A(e);var n=new a(e.createId("idFatalDialog"),{title:m.oCoreApi.getTextNotHtmlEncoded("error"),type:d.Message,state:w.Error,content:[new l({text:s?m.oCoreApi.getTextNotHtmlEncoded("application-reload"):m.oCoreApi.getTextNotHtmlEncoded("fatalErrorMessage")}),new g({alignItems:f.End,items:[new i({text:m.oCoreApi.getTextNotHtmlEncoded("showDetails"),press:function(){C(e,t)}})]})],beginButton:new o({text:m.oCoreApi.getTextNotHtmlEncoded("close"),press:function(){y(e,n)}}),afterClose:function(){n.destroy()}});n.setInitialFocus(n);n.open()}function T(e,t){var s=m.oCoreApi;var n=m.uiApi;var r=new a(e.createId("idShowValidStateDialog"),{title:s.getTextNotHtmlEncoded("error"),type:d.Message,state:w.Error,content:[new l({text:s.getTextNotHtmlEncoded("lastValidStateMessage")}),new g({alignItems:f.End,items:[new i({text:s.getTextNotHtmlEncoded("showDetails"),press:function(){C(e,t)}})]})],beginButton:new o({text:s.getTextNotHtmlEncoded("gobackToValidState"),press:function(){var e=s.restoreApfState();e.then(function(){n.getAnalysisPath().getController().bLastValidState=true;n.getAnalysisPath().getCarouselView().getController().removeAllThumbnails();s.updatePath(n.getAnalysisPath().getController().callBackForUpdatePath.bind(n.getAnalysisPath().getController()));n.getLayoutView().getController().setPathTitle();r.close();n.getAnalysisPath().getCarouselView().rerender();n.getLayoutView().setBusy(false)},function(){r.close()})}}),endButton:new o({text:s.getTextNotHtmlEncoded("startNewAnalysis"),press:function(){n.getAnalysisPath().getToolbar().getController().resetAnalysisPath();r.close()}}),afterClose:function(){r.destroy()}});r.setInitialFocus(r);r.open()}function b(e,t){var o=m.oCoreApi.isApfStateAvailable();if(o){T(e,t)}else{E(e,t)}}sap.ui.controller("sap.apf.ui.reuse.controller.messageHandler",{onInit:function(){var e=this;if(c.system.desktop){e.getView().addStyleClass("sapUiSizeCompact")}m=e.getView().getViewData()},showMessage:function(t){var o=this;var a=t.getSeverity();var s=sap.apf.core.constants.message.severity;switch(a){case s.fatal:m.uiApi.getLayoutView().setBusy(false);b(o,t);break;case s.error:m.uiApi.getLayoutView().setBusy(false);break;case s.information:v(o,t);break;case s.success:x(o,t);break;default:e.error("Error type not defined");break}if(a===s.warning||a===s.error){r.show(t.getMessage(),{width:"40%",offset:"0 -50",animationDuration:2e3})}}})});
//# sourceMappingURL=messageHandler.controller.js.map