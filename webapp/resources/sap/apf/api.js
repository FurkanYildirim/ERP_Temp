/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/ui/instance","sap/apf/core/instance","sap/apf/core/messageHandler","sap/apf/core/messageDefinition","sap/apf/core/constants","sap/apf/core/utils/filterSimplify","sap/ui/thirdparty/datajs","sap/apf/utils/utils","sap/apf/utils/filter","sap/apf/utils/externalContext","sap/apf/utils/startFilterHandler","sap/apf/utils/startFilter","sap/apf/utils/filterIdHandler","sap/apf/utils/serializationMediator","sap/apf/utils/navigationHandler","sap/apf/utils/startParameter","sap/apf/messageCallbackForStartup","sap/apf/ui/representations/RepresentationInterfaceProxy","sap/base/Log","sap/m/App","sap/m/Text","sap/ui/thirdparty/jquery"],function(t,e,r,n,a,i,s,o,c,u,f,p,l,d,g,h,m,v,C,F,P,jQuery){"use strict";function S(s,c,v){var S;var A;var y;var H;var x;var R;var b;var T;var M;var k;var E;var w;var q;var I=true;var j=jQuery.Deferred();var L=new jQuery.Deferred;var B;var O;this.type="api";this.constants={};this.constants.eventTypes=a.eventTypes;this.destroy=function(){S.activateOnErrorHandling(false);S.setMessageCallback(undefined);S.setLifeTimePhaseShutdown();if(w&&w.destroy){w.destroy()}if(A){A.destroy()}w=undefined;A=undefined;S=undefined;y=undefined;H=undefined};this.activateOnErrorHandling=function(t){return A.activateOnErrorHandling(t)};this.getStartParameterFacade=function(){return A.getStartParameterFacade()};this.getLogMessages=function(){return A.getLogMessages()};this.createStep=function(t,e,r){return A.createStep(t,e,r)};this.getActiveStep=function(){return A.getActiveStep()};this.getCategories=function(){return A.getCategories()};this.getSteps=function(){return A.getSteps()};this.getStepTemplates=function(){return A.getStepTemplates()};this.getFacetFilterConfigurations=function(){return A.getFacetFilterConfigurations()};this.getApplicationConfigProperties=function(){return A.getApplicationConfigProperties()};this.moveStepToPosition=function(t,e,r){return A.moveStepToPosition(t,e,r)};this.removeStep=function(t,e){return A.removeStep(t,e)};this.resetPath=function(){return A.resetPath()};this.setActiveStep=function(t){return A.setActiveStep(t)};this.stepIsActive=function(t){return A.stepIsActive(t)};this.updatePath=function(t){return A.updatePath(t)};this.getApfLocation=function(){return A.getUriGenerator().getApfLocation()};this.readPaths=function(t){return A.readPaths(t)};this.savePath=function(t,e,r){A.savePath(t,e,r)};this.openPath=function(t,e,r){return A.openPath(t,e,r)};this.deletePath=function(t,e){return A.deletePath(t,e)};this.addFacetFilter=function(t){w.getLayoutView().getController().addFacetFilter(t)};this.getEventCallback=function(t){return w.getEventCallback(t)};this.putMessage=function(t){return A.putMessage(t)};this.createMessageObject=function(t){return A.createMessageObject(t)};this.getTextHtmlEncoded=function(t,e){return A.getTextHtmlEncoded(t,e)};this.getTextNotHtmlEncoded=function(t,e){return A.getTextNotHtmlEncoded(t,e)};if(!v){this.loadApplicationConfig=function(t){A.loadApplicationConfig(t)}}else{this.loadApplicationConfig=function(t){}}this.createFilter=function(){return A.createFilter()};this.addPathFilter=function(t){return b.add(t)};this.updatePathFilter=function(t,e){b.update(t,e)};this.getPathFilter=function(t){return b.get(t)};this.createReadRequest=function(t){return A.createReadRequest(t)};this.createReadRequestByRequiredFilter=function(t){return A.createReadRequestByRequiredFilter(t)};this.selectionChanged=function(t){w.selectionChanged(t)};this.createApplicationLayout=function(){if(!B){B=(new F).addStyleClass("sapApf")}return B};this.startApf=function(){var t;var e=this;var r=this.createApplicationLayout();L.done(function(){try{if(this.fnBeforeApfStartupCallback&&typeof this.fnBeforeApfStartupCallback==="function"){this.fnBeforeApfStartupCallback.apply(s,[this])}j.resolve();w.createApplicationLayout(r).then(function(){t=H.checkMode();var r=w.handleStartup(t);r.done(function(){if(e.fnAfterApfStartupCallback&&typeof e.fnAfterApfStartupCallback==="function"){e.fnAfterApfStartupCallback.apply(s,[e])}S.setLifeTimePhaseRunning()})})}catch(t){I=false}}.bind(this));return r};this.addMasterFooterContent=function(t){return w.addMasterFooterContentRight(t)};this.setEventCallback=function(t,e){switch(t){case a.eventTypes.contextChanged:w.setEventCallback(t,e);return true;case a.eventTypes.printTriggered:w.setEventCallback(t,e);return true;case a.eventTypes.format:this.customFormat(e);return true;default:return false}};this.customFormat=function(t){w.setCustomFormatExit(t)};this.setCallbackBeforeApfStartup=function(t){this.fnBeforeApfStartupCallback=t};this.setCallbackAfterApfStartup=function(t){this.fnAfterApfStartupCallback=t};this.getPropertyValuesOfExternalContext=function(t){var e=jQuery.Deferred();R.getCombinedContext().then(function(r){var n=r.getFilterTermsForProperty(t);var a=[];n.forEach(function(t){var e={Low:t.getValue(),Option:t.getOp(),High:t.getHighValue()};a.push(e)});e.resolve(a)});return e.promise()};this.startupSucceeded=function(){return I};if(s&&s.getInjections instanceof Function){if(!c){c={}}jQuery.extend(c,c,s.getInjections())}y=new(c&&c.constructors&&c.constructors.StartParameter||h)(s,v);S=new(c&&c.constructors&&c.constructors.MessageHandler||r);S.activateOnErrorHandling(true);S.setLifeTimePhaseStartup();S.loadConfig(n,true);q=c&&c.functions&&c.functions.messageCallbackForStartup||m;S.setMessageCallback(q);if(c&&c.functions&&c.functions.isUsingCloudFoundryProxy){O=c.functions.isUsingCloudFoundryProxy}else{O=function(){return false}}try{A=new(c&&c.constructors&&c.constructors.CoreInstance||e.constructor)({functions:{isUsingCloudFoundryProxy:O,getCumulativeFilter:function(){return x.getCumulativeFilter()},getCombinedContext:function(){return R.getCombinedContext()},ajax:c&&c.functions&&c.functions.ajax,serializeApfState:function(t,e){return E.serialize(t,e)},deserializeApfState:function(t){return E.deserialize(t)},odataRequest:c&&c.functions&&c.functions.odataRequest,getComponentName:function(){if(v&&v.manifest&&v.manifest["sap.app"]){return v.manifest["sap.app"].id}return s.getMetadata().getComponentName()}},instances:{messageHandler:S,startParameter:y,datajs:c&&c.instances&&c.instances.datajs||OData,component:s},constructors:{Request:c&&c.constructors&&c.constructors.Request,Metadata:c&&c.constructors&&c.constructors.Metadata,MetadataFactory:c&&c.constructors&&c.constructors.MetadataFactory,ResourcePathHandler:c&&c.constructors&&c.constructors.ResourcePathHandler,TextResourceHandler:c&&c.constructors&&c.constructors.TextResourceHandler,SessionHandler:c&&c.constructors&&c.constructors.SessionHandler,Persistence:c&&c.constructors&&c.constructors.Persistence},manifests:v,exits:c&&c.exits,coreProbe:c&&c.coreProbe,corePromise:L});M={instances:{startParameter:y,component:s,messageHandler:S},functions:{getConfigurationProperties:A.getApplicationConfigProperties,ajax:A.ajax}};R=new(c&&c.constructors&&c.constructors.ExternalContext||u)(M);T={functions:{getFacetFilterConfigurations:this.getFacetFilterConfigurations,getReducedCombinedContext:A.getReducedCombinedContext,createRequest:A.getFunctionCreateRequest()},instances:{messageHandler:S,onBeforeApfStartupPromise:j.promise()},constructors:{StartFilter:p}};x=new(c&&c.constructors&&c.constructors.StartFilterHandler||f)(T);k={functions:{setRestrictionByProperty:x.setRestrictionByProperty,getRestrictionByProperty:x.getRestrictionByProperty},instances:{messageHandler:S}};b=new(c&&c.constructors&&c.constructors.FilterIdHandler||l)(k);E=new(c&&c.constructors&&c.constructors.SerializationMediator||d)({instances:{coreApi:A,filterIdHandler:b,startFilterHandler:x,messageHandler:S}});var z={constructors:{FilterReduction:i.FilterReduction},functions:{getCumulativeFilterUpToActiveStep:A.getCumulativeFilterUpToActiveStep,getNavigationTargets:A.getNavigationTargets,getActiveStep:A.getActiveStep,createRequest:A.getFunctionCreateRequest(),getXappStateId:A.getStartParameterFacade().getXappStateId,isFilterReductionActive:A.getStartParameterFacade().isFilterReductionActive,getAllParameterEntitySetKeyProperties:A.getMetadataFacade().getAllParameterEntitySetKeyProperties},instances:{messageHandler:S,component:s,serializationMediator:E}};H=new(c&&c.constructors&&c.constructors.NavigationHandler||g)(z);w=new(c&&c.constructors&&c.constructors.UiInstance||t)({oCoreApi:A,oFilterIdHandler:b,oSerializationMediator:E,oNavigationHandler:H,oComponent:s,oStartParameter:y,oStartFilterHandler:x,functions:c&&c.functions||{},exits:c&&c.exits||{}})}catch(t){I=false;this.startApf=function(){return new P({text:""})};this.loadApplicationConfig=function(){return""};C.error("Caught exception during creation of APF API")}if(A){A.createRepresentation=function(t,e){var r=t.replaceAll(".","/");var n=sap.ui.requireSync(r)||o.extractFunctionFromModulePathString(t);var a=new sap.apf.ui.representations.RepresentationInterfaceProxy(A,w);return new n(a,e)}}if(c&&c.probe&&typeof c.probe==="function"){c.probe({apfApi:this,coreApi:A,component:s,uiApi:w,messageHandler:S,serializationMediator:E,navigationHandler:H,startParameter:y,injectedFunctionsNavigationHandler:z&&z.functions,startFilterHandler:x,externalContext:R,filterIdHandler:b,corePromise:L})}}sap.apf.Api=S;return S},true);
//# sourceMappingURL=api.js.map