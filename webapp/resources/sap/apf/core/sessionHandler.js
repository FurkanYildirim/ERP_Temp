/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/core/ajax","sap/apf/utils/exportToGlobal","sap/apf/utils/filter","sap/apf/utils/hashtable","sap/apf/core/constants","sap/ui/model/odata/ODataUtils","sap/ui/thirdparty/jquery"],function(e,t,s,a,n,r,jQuery){"use strict";function i(e){var t=null;var s=false;var n=false;var i=false;var f="";var o="";var u=new a(e.instances.messageHandler);var c=e.instances.coreApi;var l=e.instances.messageHandler;if(e&&e.functions&&e.functions.serializeApfState&&typeof e.functions.serializeApfState=="function"){s=e.functions.serializeApfState}if(e&&e.functions&&e.functions.deserializeApfState&&typeof e.functions.deserializeApfState=="function"){n=e.functions.deserializeApfState}this.type="sessionHandler";this.ajax=function(e){sap.apf.core.ajax(e)};this.getXsrfToken=function(e){var t=jQuery.Deferred();e=p(e);var s=u.getItem(e);if(s!==undefined&&s!==false){return t.resolve(s)}this.fetchXcsrfToken(e).done(function(s){u.setItem(e,s);t.resolve(s)});return t.promise()};function p(e){var t=c.getStartParameterFacade().getSapSystem();if(t){return r.setOrigin(e,{force:true,alias:t})}return e}this.fetchXcsrfToken=function(e){var t=jQuery.Deferred();var s="HEAD";if(u.getItem(e)===false){s="GET"}this.ajax({url:c.getUriGenerator().getAbsolutePath(e),type:s,beforeSend:function(e){e.setRequestHeader("x-csrf-token","Fetch")},success:a.bind(this),error:n.bind(this),async:true});function a(e,s,a){o=a.getResponseHeader("x-csrf-token");if(o!==undefined&&o!==null){t.resolve(o)}if(o===null){o="";t.resolve(o)}}function n(s,a,n){if(s.status===405&&u.getItem(e)!==false){u.setItem(e,false);this.fetchXcsrfToken(e).done(function(e){t.resolve(e)})}else{o="";var r=l.createMessageObject({code:5101,aParameters:[]});l.putMessage(r);t.resolve(o)}}return t.promise()};this.setDirtyState=function(e){i=e};this.isDirty=function(){return i};this.setPathName=function(e){if(typeof e!="string"){f="";return}f=e};this.getPathName=function(){return f};this.isApfStateAvailable=function(){if(t===null){return false}return true};this.storeApfState=function(){var e=true;if(s){s(undefined,e).done(function(e){t=e})}};this.restoreApfState=function(){if(this.isApfStateAvailable()&&n){c.resetPath();return n(t)}}}t("sap.apf.core.SessionHandler",i);return i});
//# sourceMappingURL=sessionHandler.js.map