/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2018 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/core/constants","sap/apf/utils/utils","sap/apf/core/messageObject","sap/apf/utils/hashtable","sap/base/Log","sap/ui/Device","sap/apf/core/messageDefinition"],function(e,r,s,t,i,n){"use strict";function a(a){var o={initial:0,startup:1,running:2,shutdown:3};var f=this;var g;var u=[];var d=0;var c;var v;var l;var p=false;var h=false;var m=false;var y=false;var w=false;var M="";var C={code:e.message.code.errorUnknown,severity:e.message.severity.error,rawText:"Unknown Error occurred"};var E=o.initial;var b=[];this.setLifeTimePhaseStartup=function(e){E=o.startup};this.setLifeTimePhaseRunning=function(){E=o.running};this.setLifeTimePhaseShutdown=function(){E=o.shutdown};this.fatalErrorOccurredAtStartup=function(){var r;if(E!==o.startup){return false}for(r=0;r<b.length;r++){if(b[r].getSeverity()===e.message.severity.fatal){return true}}return false};this.createMessageObject=function(r){var t=new s(r);if(a){if(t.getCode()===undefined){t.setCode(e.message.code.errorUnknown)}I.bind(this)(t);O(t,1)}else if(r.enrichInfoInMessageObject===true){I.bind(this)(t)}return t};this.activateOnErrorHandling=function(e){p=e;if(p===true){jQuery(window).on("error",F)}else{jQuery(window).off("error")}};this.setTextResourceHandler=function(e){g=e};this.loadConfig=function(e,r){if(c===undefined||r){c=new t(f)}for(var s=0;s<e.length;s++){D(e[s])}};this.setMessageCallback=function(e){if(e!==undefined&&typeof e==="function"){v=e}else{v=undefined}};this.setCallbackForTriggeringFatal=function(e){if(e!==undefined&&typeof e==="function"){l=e}else{l=undefined}};this.putMessage=function(r){var s;var t=0;var i;if(r.getCode()===undefined){r.setCode(e.message.code.errorUnknown)}I.bind(this)(r);if(r.getSeverity()===e.message.severity.fatal){i=f.createMessageObject({code:e.message.code.errorExitTriggered});I.bind(this)(i);i.setSeverity(e.message.severity.fatal);if(i.getMessage()===""){i.setMessage("The app has stopped working due to a technical error.")}}s=r.getPrevious();while(s!==undefined&&s.type&&s.type==="messageObject"&&t<10){if(s.getCode()===undefined){s.setCode(e.message.code.errorUnknown)}I.bind(this)(s);s=s.getPrevious();t++}if(i!==undefined){i.setPrevious(r);r=i}if(!a){O(r,10)}b.push(r);if(h){return}if(r.getSeverity()===e.message.severity.technError){return}if(v!==undefined){if(E===o.shutdown||E===o.startup&&r.getSeverity()!==e.message.severity.fatal){return}h=true;v(r);h=false}if(l!==undefined&&m===false){m=true;l(r);m=false}if(r.getSeverity()===e.message.severity.fatal&&E!==o.shutdown){if(n.browser.firefox){w=true}throw new Error(M)}};this.check=function(r,s,t){var i=t||e.message.code.errorCheck;if(!r){var n=this.createMessageObject({code:i,aParameters:[s]});f.putMessage(n)}};this.getConfigurationByCode=function(e){if(c===undefined){return undefined}return c.getItem(e)};this.getLogMessages=function(){return jQuery.extend(true,[],u)};this.reset=function(){c=undefined;v=undefined;u=[];b=[]};this.isOwnException=function(e){return e&&e.message&&e.message.search(M)>-1};function x(e){if(n.browser.firefox){return w}return e.originalEvent&&e.originalEvent.message&&e.originalEvent.message.search(M)>-1}function k(r){return r.originalEvent&&r.originalEvent.message&&r.originalEvent.message.search(M)===-1&&r.originalEvent.message.search(e.message.code.suppressFurtherException)>-1}function P(){var s=r.createPseudoGuid(32);return e.message.code.suppressFurtherException+s}function T(r){var s=parseInt(r,10);return s==e.message.code.errorExitTriggered||s==e.message.code.errorUnknown||s==e.message.code.errorInMessageDefinition}function S(r){var s=parseInt(r,10);return s==e.message.code.errorExitTriggered||s==e.message.code.errorInMessageDefinition}function I(r){function s(e,r){var s=0;while(e.indexOf("{"+s+"}")>-1){if(typeof r[s]==="string"){e=e.replace("{"+s+"}",r[s])}else{e=e.replace("{"+s+"}","undefined")}s++}return e}var t=r.getCode();var i=f.getConfigurationByCode(t);if(i===undefined){i=jQuery.extend(true,{},C);if(T(t)){if(r.hasRawText()){i.rawText=r.getRawText()}i.rawText+=" "+r.getParameters();if(S(t)){i.severity=e.message.severity.fatal}}else{i.rawText="Message "+t+"  "+r.getParameters()+" (Message Code has no Configuration)"}if(!T(t)){r.setCode(i.code)}}if(i.severity!==undefined){r.setSeverity(i.severity)}else{r.setSeverity(e.message.severity.technError)}if(i.rawText){r.setMessage(i.rawText)}else{var n=r.getParameters();if(r.getSeverity()===e.message.severity.technError){var a=f.getConfigurationByCode(i.code).text;if(!a){a=f.getConfigurationByCode(i.code).description}r.setMessage(s(a,n))}else{try{if(g&&i.key){r.setMessage(g.getMessageText(i.key,r.getParameters()))}else if(i.description){r.setMessage(s(i.description,n))}else{r.setMessage("Message Code: "+t+" "+n.toString())}}catch(e){if(i.description){r.setMessage(s(i.description,n))}else{r.setMessage("Message Code: "+t+" "+n.toString())}}}}}function O(r,s){var t="APF message ";var n="";var a=s-1;if(s===0){return}var o=r.getPrevious();if(o!==undefined){O(o,a);n=" - (see previous message for more information)"}d++;var f=t+"("+d+"): "+r.getCode()+" - "+r.getMessage()+n;if(y){alert("Fatal Error during Log Writing "+f);return}y=true;if(r.getSeverity()===e.message.severity.fatal){if(u.length<2){u.unshift(f)}}switch(r.getSeverity()){case e.message.severity.warning:i.warning(f);break;case e.message.severity.error:i.error(f);break;case e.message.severity.fatal:i.error(f);break;case e.message.severity.technError:i.error(f);break;default:i.info(f)}y=false}function j(r){f.check(r!==undefined&&r.hasOwnProperty("code")!==false,"MessageHandler setItem: oItem is undefined or property 'code' is missing",e.message.code.errorInMessageDefinition);var s=c.setItem(r.code,r);f.check(s===undefined,"MessageHandler setItem: Configuration includes duplicated codes",e.message.code.errorInMessageDefinition)}function D(e){if(e.type===undefined){e.type="message"}j(e)}function F(e){var r;var t="";var i="";var a="";var o="";var f=true;if(n.browser.firefox){f=false}if(f&&e&&e.originalEvent){t=e.originalEvent.message;a=e.originalEvent.filename;i=e.originalEvent.lineno}if(x(e)){e.stopImmediatePropagation();e.preventDefault()}else if(k(e)){return}else if(h){o="";if(f){o=t+" (source: "+a+":"+i+")"}r=new s({code:"5070",aParameters:[o]});I.bind(this)(r);O(r,1)}else{o="";if(f){o=t+" (source: "+a+":"+i+")"}r=new s({code:"5070",aParameters:[o]});I.bind(this)(r);O(r,1)}}function L(){M=P()}L()}sap.apf=sap.apf||{};sap.apf.core=sap.apf.core||{};sap.apf.core.MessageHandler=a;return a});
//# sourceMappingURL=messageHandler.js.map