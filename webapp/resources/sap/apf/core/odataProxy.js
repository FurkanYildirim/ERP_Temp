/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/thirdparty/datajs","sap/apf/utils/exportToGlobal","sap/apf/utils/utils","sap/apf/core/constants","sap/ui/thirdparty/jquery"],function(e,t,a,s,jQuery){"use strict";function n(e,t){var s=t.instances.coreApi;var n=t.instances.messageHandler;var r=e.serviceRoot;function o(e,t){return s.getEntityTypeMetadata(e,t)}function i(e){var t,a,s;if(!e){return""}a=e.length;if(a===1){return"('"+e[0].value+"')"}s="(";for(t=0;t<a;t++){if(t>0){s=s+","}s=s+e[t].name+"='"+e[t].value+"'"}return s+")"}function c(e){var t;if(e.messageObject&&e.messageObject.getCode){t=e.messageObject}else if(e.response&&e.response.statusCode&&e.response.statusCode>=400){t=n.createMessageObject({code:"11005",aParameters:[e.response.statusCode.toString(),e.response.statusText]})}else{t=n.createMessageObject({code:"5201"})}n.putMessage(t);return t}function u(e,t){var a=c(e);t(undefined,undefined,a)}function f(e,t,a,s){var r;var i;if(e&&e.results){r=e.results}else if(e){r=e}else{i=n.createMessageObject({code:"5201"})}o(t,a).done(function(e){s(r,e,i)})}function d(e){var t=JSON.parse(e.SerializedAnalyticalConfiguration);delete e.SerializedAnalyticalConfiguration;t.configHeader=e;e.SerializedAnalyticalConfiguration=JSON.stringify(t);return e}this.readEntity=function(e,t,a,n,o){var c=sap.apf.core.constants.entitySets[e];s.getXsrfToken(r).done(function(e){var o=r+"/"+c;o=o+i(a);if(n&&n.length>0){o=o+"?$select="+n.join()}var d={requestUri:o,async:true,method:"GET",headers:{"x-csrf-token":e}};s.odataRequest(d,function(e){f(e,r,c,t)},function(e){u(e,t)})})};function p(e,t,s){var n="'";if(s&&s.dataType){return a.formatValue(t,s.dataType.type)}if(typeof t==="number"){return t}return n+a.escapeOdata(t)+n}function g(e){var t=jQuery.Deferred();s.getXsrfToken(r).done(function(a){var s=[];var n,c=e.length;var u;var f=0;for(n=0;n<c;n++){u=sap.apf.core.constants.entitySets[e[f].entitySetName];o(r,u).done(function(n){var r,o,u;var d=false;r=sap.apf.core.constants.entitySets[e[f].entitySetName];r=r+i(e[f].inputParameters);if(e[f].selectList&&e[f].selectList.length>0){r=r+"?$select="+e[f].selectList.join();d=true}if(e[f].filter){if(d){r=r+"&"}else{r=r+"?"}r=r+"$filter="+e[f].filter.toUrlParam({formatValue:function(e,t){return p(e,t,n)}})}o=e[f].method||"GET";u={requestUri:r,method:o,headers:{"Accept-Language":sap.ui.getCore().getConfiguration().getLanguage(),"x-csrf-token":a}};if(o!=="GET"){u.data=e[f].data}s.push(u);f++;if(f===c){t.resolve(s)}})}});return t}function h(e,t,a,s){var n=jQuery.Deferred();var c="";var u=e+i(t);if(a&&a.length>0){c="$select="+a.join()}o(r,e).done(function(t){if(s){if(c){c=c+"&"}c=c+"$filter="+s.toUrlParam({formatValue:function(e,a){return p(e,a,t)}})}if(e===sap.apf.core.constants.entitySets.application){if(c){c=c+"&"}c=c+"$orderby=ApplicationName"}if(c){u=u+"?"+c}n.resolve(u)});return n}function l(e,t){var a="unknown error";var s="unknown error";var r="";if(e.message!==undefined){a=e.message}var o="unknown";if(e.response&&e.response.statusCode){o=e.response.statusCode;s=e.response.statusText||"";r=e.response.requestUri}if(e.messageObject&&e.messageObject.type==="messageObject"){t([],e.messageObject)}else{t([],n.createMessageObject({code:"5001",aParameters:[o,a,s,r]}))}}this.doChangeOperationsInBatch=function(e,t){s.getXsrfToken(r).done(function(a){g(e).done(function(e){var o={requestUri:r+"/"+"$batch",method:"POST",headers:{"x-csrf-token":a},data:{__batchRequests:[{__changeRequests:e}]}};var i=function(e,a){var s;var r;var o,i,c;var u="";var f,d;if(e&&e.__batchResponses){for(f=0;f<e.__batchResponses.length;f++){if(e.__batchResponses[f].message){o=e.__batchResponses[f].message;i="";u=a.requestUri;s=n.createMessageObject({code:"5001",aParameters:[i,o,"",u]});break}for(d=0;d<e.__batchResponses[f].__changeResponses.length;d++){r=e.__batchResponses[f].__changeResponses[d];if(r.message){o=r.message;c=r.data;i=r.statusCode;u=a.requestUri;s=n.createMessageObject({code:"5001",aParameters:[i,o,c,u]});break}}}t(s)}};var c=function(e){l(e,t)};s.odataRequest(o,i,c,OData.batchHandler)})})};this.readCollectionsInBatch=function(e,t){s.getXsrfToken(r).done(function(a){g(e).done(function(e){var o={requestUri:r+"/"+"$batch",async:true,method:"POST",headers:{"x-csrf-token":a},data:{__batchRequests:e}};var i=function(e){var a=[];var s,r,o,i,c;var u;if(e&&e.__batchResponses){for(u=0;u<e.__batchResponses.length;u++){if(e.__batchResponses[u].data&&e.__batchResponses[u].data.results){a.push(e.__batchResponses[u].data.results)}else if(e.__batchResponses[u].message){r=e.__batchResponses[u].message;o=e.__batchResponses[u].response.body;i=e.__batchResponses[u].response.statusCode;c=a.requestUri;s=n.createMessageObject({code:"5001",aParameters:[i,r,o,c]});break}else{c=a.requestUri;s=n.createMessageObject({code:"5001",aParameters:["unknown","unknown error","unknown error",c]});break}}t(a,s)}};var c=function(e){l(e,t)};s.odataRequest(o,i,c,OData.batchHandler)})})};this.readCollection=function(e,t,a,s,n){v(e,t,a,s,n)};function v(e,t,a,i,c){var f=sap.apf.core.constants.entitySets[e];var d=function(e,a){var s;var i;var c="";if(e&&e.__batchResponses){if(e.__batchResponses[0].data&&e.__batchResponses[0].data.results){s=e.__batchResponses[0].data.results}else if(e.__batchResponses[0].message){var u=e.__batchResponses[0].message;var d=e.__batchResponses[0].response.body;var p=e.__batchResponses[0].response.statusCode;c=a.requestUri;i=n.createMessageObject({code:"5001",aParameters:[p,u,d,c]})}else{c=a.requestUri;i=n.createMessageObject({code:"5001",aParameters:["unknown","unknown error","unknown error",c]})}o(r,f).done(function(e){t(s,e,i)})}};s.getXsrfToken(r).done(function(e){h(f,a,i,c).done(function(a){var n={requestUri:r+"/"+"$batch",async:true,method:"POST",headers:{"x-csrf-token":e},data:{__batchRequests:[{requestUri:a,method:"GET",headers:{"x-csrf-token":e,"Accept-Language":sap.ui.getCore().getConfiguration().getLanguage()}}]}};s.odataRequest(n,d,function(e){u(e,t)},OData.batchHandler)})})}this.create=function(e,t,a){if(e==="configuration"){t=d(t)}var i=sap.apf.core.constants.entitySets[e];s.getXsrfToken(r).done(function(e){var u=r+"/"+i;var f={requestUri:u,async:true,method:"POST",headers:{"x-csrf-token":e},data:t};function d(e,t){var s;var c;if(e&&t.statusCode===201){s=e}else{c=n.createMessageObject({code:"5201"})}o(r,i).done(function(e){a(s,e,c)})}function p(e){var t=c(e);a(undefined,undefined,t)}s.odataRequest(f,d,p)})};this.update=function(e,t,a,u){if(e==="configuration"){t=d(t)}var f=sap.apf.core.constants.entitySets[e];s.getXsrfToken(r).done(function(e){var d=r+"/"+f+i(u);var p={requestUri:d,method:"PUT",headers:{"x-csrf-token":e},data:t};function g(e,t){var s;if(t.statusCode!==204){s=n.createMessageObject({code:"5201"})}o(r,f).done(function(e){a(e,s)})}function h(e){var t=c(e);a(undefined,t)}s.odataRequest(p,g,h)})};this.remove=function(e,t,a,u){var f=sap.apf.core.constants.entitySets[e];s.getXsrfToken(r).done(function(e){var d=r+"/"+f+i(t);o(r,f).done(function(t){if(u){d=d+"$filter="+u.toUrlParam({formatValue:function(e,a){return p(e,a,t)}})}var a={requestUri:d,method:"DELETE",headers:{"x-csrf-token":e}};s.odataRequest(a,g,h)});function g(e,t){if(t.statusCode===204){o(r,f).done(function(e){a(e,undefined)})}else{var s=n.createMessageObject({code:"5201"});a(undefined,s)}}function h(e){var t=c(e);a(undefined,t)}})}}t("sap.apf.core.OdataProxy",n);return n});
//# sourceMappingURL=odataProxy.js.map