/*
 * SAPUI5
    (c) Copyright 2009-2021 SAP SE. All rights reserved
  
 */
sap.ui.define("sap/sac/df/DFTable",["sap/ui/core/Control","sap/base/Log","sap/sac/df/firefly/library"],function(e,t,i){var n="FA.EMPTY_DP";var r=e.extend("sap.sac.df.DFTable",{metadata:{library:"sap.sac.df",properties:{dataProviderName:{type:"string"},multiDimModelId:{type:"string",defaultValue:"om"},enabled:{type:"boolean",defaultValue:false},width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"}}},renderer:{apiVersion:2,render:function e(t,i){t.openStart("div",i).class("sapUiZenDFTable").style("opacity",i._getOpacity()).style("zIndex",i._getZIndex()).style("height",i.getHeight()).style("width",i.getWidth()).openEnd().close("div")}},onAfterRendering:function(){if(e.prototype.onAfterRendering){e.prototype.onAfterRendering.apply(this,arguments)}if(this.mInnerTable){this._updateQueryManager();this._attachInnerTableToControl()}else{t.info("DF: Start - DFTable - onAfterRendering");this.setBusy(true);this._loadMultiDimModel().then(this._setDataProvider.bind(this)).then(this._initInnerTable.bind(this)).finally(function(){this.setBusy(false);t.info("DF: End - DFTable - onAfterRendering")}.bind(this))}},exit:function(){if(this.mInnerTable){var t=this.mInnerTable.getView();t.getNativeControl().destroy();t.destroy();if(this.mInnerTable.destroyView){this.mInnerTable.destroyView()}this.mRootControl.destroy()}delete this.mInnerTable;delete this.mRootControl;delete this.mDataProviderInstance;e.prototype.exit.apply(this,arguments)},refresh:function(){if(this.mInnerTable){this.mInnerTable.refreshView();this.setEnabled(true)}},clear:function(){if(this.mInnerTable){this.mInnerTable.clearTable()}},setDataProviderName:function(e){if(!e){e=n}else if(e.startsWith("$")){e=this._getUrlParams("dataProviderName")}var i=this.getDataProviderName();if(i===e){return}this._setDataProvider().catch(function(e){t.error(e)});this.setEnabled(false);this.setProperty("dataProviderName",e,true)},setEnabled:function(e){this.setProperty("enabled",e,true);var t=document.getElementById(this.getId());if(t){t.style.opacity=this._getOpacity();t.style.zIndex=this._getZIndex()}},setBusy:function(e){if(this.mInnerTable){this.mInnerTable.setBusy(e)}},_getOpacity:function(){return this.getEnabled()?"1":"0.4"},_getZIndex:function(){return this.getEnabled()?"1":"-1"},_getMultiDimModel:function(){return this.getModel(this.getMultiDimModelId())},_getUrlParams:function(e){return(window.location.href.split(e+"=")[1]||"").split("&")[0]},_getFireflyUiManager:function(e){var t=e.getSession();t.openSubSystem(i.SubSystemType.GUI);return t.getSubSystem(i.SubSystemType.GUI)},_attachInnerTableToControl:function(){if(this.mRootControl){var e=this.$();if(e.children().length===0){e.css("position","relative");this.mRootControl.renderIntoAnchor(this.getId(),e[0])}}},_initInnerTable:function(){var e=this._getMultiDimModel();if(e){var n=this._getFireflyUiManager(e);this.mRootControl=n.newBasicControl(i.UiType.ROOT,null,this.getId()+"--inner_tbl_cont","Interactive table container");var r=i.UiGenesis.create(this.mRootControl);this.mInnerTable=i.AuGdsQbInteractiveTableView.create(r);this.mInnerTable.setLocalizationProvider(i.UiLocalizationCenter.getCenter());r.setRoot(this.mInnerTable.getView());if(this.mDataProviderInstance){this._updateQueryManager();this._attachInnerTableToControl()}else{t.info("Data provider is not initialized. No Data to be shown.")}}else{t.info("Could not retrieve MultiDimModel. Failed to initialize DFTable.")}},_loadMultiDimModel:function(){t.info("DF: Start - model initialize");return Promise.resolve().then(function(){var e=this._getMultiDimModel();if(e){e.attachEvent("queryAdded",null,this._onQueryAdded,this);return e.loaded()}return Promise.reject("DF: MultiDimModel is not initialized")}.bind(this))},_onQueryAdded:function(e){var t=e.getParameter("dataProviderName");if(t===this.getDataProviderName()){return this._setDataProvider()}},_setDataProvider:function(){return Promise.resolve().then(function(){t.info("DF: Set Data provider");var e=this.getDataProviderName();if(e){if(e===n){t.info("DF: Updated - Data provider to null");this.mDataProviderInstance=null}else{var i=this._getMultiDimModel();if(i){this.mDataProviderInstance=i.getDataProvider(e);if(this.mDataProviderInstance){t.info("DF: Updated - Data provider to "+e);this._updateQueryManager();this._attachInnerTableToControl()}else{t.info("DF: No Data provider found.")}}else{t.info("DF: MultiDimModel is not initialized.")}}return Promise.resolve(null)}else{throw new Error("Data provider name must be specified")}}.bind(this))},_updateQueryManager:function(){if(this.mInnerTable){var e=null;if(this.mDataProviderInstance){e=this.mDataProviderInstance.getQueryManager()}t.info("DF: Updated - Query manager of DFTable");this.mInnerTable.queryManagerUpdated(e)}}});return r});
//# sourceMappingURL=DFTable.js.map