/*!
 * SAPUI5
    (c) Copyright 2009-2021 SAP SE. All rights reserved
  
 */
sap.ui.define(["sap/sac/df/firefly/ff4330.olap.catalog.impl","sap/sac/df/firefly/ff4340.olap.reference","sap/sac/df/firefly/ff4410.olap.ip.providers","sap/sac/df/firefly/ff8050.application.ui"],function(t){"use strict";t.Ui5GridCellContextProvider=function(){};t.Ui5GridCellContextProvider.prototype=new t.XObject;t.Ui5GridCellContextProvider.prototype._ff_c="Ui5GridCellContextProvider";t.Ui5GridCellContextProvider.create=function(e){var r=new t.Ui5GridCellContextProvider;r.setup();r.m_queryManager=e;return r};t.Ui5GridCellContextProvider.prototype.m_queryManager=null;t.Ui5GridCellContextProvider.prototype.releaseObject=function(){this.m_queryManager=null;t.XObject.prototype.releaseObject.call(this)};t.Ui5GridCellContextProvider.prototype.getCellContext=function(e,r,i){var n=this.m_queryManager.cloneQueryManager();return t.CellContextGetAction.createAndRunAction(e,r,n,i)};t.Ui5GridExport=function(){};t.Ui5GridExport.prototype=new t.XObject;t.Ui5GridExport.prototype._ff_c="Ui5GridExport";t.Ui5GridExport.create=function(e,r){var i=new t.Ui5GridExport;i.m_table=e;i.m_tableDefinition=r;return i};t.Ui5GridExport.getDimensionMemberName=function(e){var r=null;var i=e.getDimension();if(i.isStructure()){var n=i.getStructureMember(e.getName());var o=n.getDimension().getDisplayKeyField();var a=n.getFieldValue(o);if(t.notNull(a)){r=a.getValue().getStringRepresentation()}}if(t.isNull(r)){r=e.getName()}return r};t.Ui5GridExport.prototype.m_table=null;t.Ui5GridExport.prototype.m_tableDefinition=null;t.Ui5GridExport.prototype._export=function(){var e=this.m_table.getRowList();var r=this.m_table.getColumnList();var i=e.size();var n=r.size();var o=i-1;var a=n-1;var l=t.PrFactory.createStructure();l.putInteger(t.Ui5GridExportConstants.TOTAL_ROWS,this.m_table.getRowsTotalCount());l.putInteger(t.Ui5GridExportConstants.TOTAL_COLUMNS,this.m_table.getColumnsTotalCount());var s=this.m_table.getHeaderRowList();var u=l.putNewList("Cells");if(this.m_table.getColumnsTotalCount()!==0||this.m_table.getRowsTotalCount()!==0){var p=s.size();var g=t.XMath.min(r.size(),a+1);var E=t.XMath.min(e.size(),o+1);var C;var d=0;var f;for(f=0;f<p;f++){C=s.get(f);if(t.notNull(C)&&!C.isEffectivelyHidden()){this.renderRow(u,C,d++,g)}else if(t.isNull(C)){d++}}for(f=0;f<E;f++){C=e.get(f);if(t.notNull(C)&&!C.isEffectivelyHidden()){this.renderRow(u,C,d++,g)}else if(t.isNull(C)){d++}}}return l};t.Ui5GridExport.prototype.renderRow=function(e,r,i,n){var o=0;var a=this.m_table.getPreColumnsAmount();for(var l=0;l<a+n;l++){var s=r.getCells().get(l);if(t.notNull(s)&&s.getParentColumn()!==null&&!s.getParentColumn().isEffectivelyHidden()){this.renderCell(e,s,i,o++)}else if(t.isNull(s)){o++}}};t.Ui5GridExport.prototype.renderCell=function(e,r,i,n){var o=e.addNewStructure();o.putInteger(t.Ui5GridExportConstants.ROW,i);o.putInteger(t.Ui5GridExportConstants.COLUMN,n);var a=r.getMergedColumns();var l=r.getMergedRows();if(a!==0||l!==0){var s=o.putNewStructure(t.Ui5GridExportConstants.MERGED);if(a>=0&&l>=0){if(r.getMergedColumns()>0){s.putInteger(t.Ui5GridExportConstants.MERGED_COLUMNS,r.getMergedColumns())}if(r.getMergedRows()>0){s.putInteger(t.Ui5GridExportConstants.MERGED_ROWS,r.getMergedRows())}}else{s.putInteger(t.Ui5GridExportConstants.ORIGINAL_COLUMN,n+r.getMergedColumns());s.putInteger(t.Ui5GridExportConstants.ORIGINAL_ROW,i+r.getMergedRows())}}if(r.getCommentDocumentId()!==null){o.putString(t.Ui5GridExportConstants.DOCUMENT_ID,r.getCommentDocumentId())}var u;if(!r.isRepeatedHeader()||r.isEffectiveRepetitiveHeaderCells()){o.putString(t.Ui5GridExportConstants.FORMATTED,r.getFormatted());u=r.getFormattingPattern()}else{o.putString(t.Ui5GridExportConstants.FORMATTED,"");u=""}if(!r.isHeaderCell()){o.putString(t.Ui5GridExportConstants.FORMAT_STRING,u)}if(r.getPlain()!==null){var p=r.getPlain().getValueType();o.putString(t.Ui5GridExportConstants.CELL_DATA_TYPE,p.getName());if(!r.isHeaderCell()){if(p===t.XValueType.BOOLEAN){o.putBoolean(t.Ui5GridExportConstants.CELL_PLAIN,t.XValueUtil.getBoolean(r.getPlain(),false,true))}else if(p===t.XValueType.DOUBLE){o.putDouble(t.Ui5GridExportConstants.CELL_PLAIN,t.XValueUtil.getDouble(r.getPlain(),false,true))}else if(p===t.XValueType.LONG){o.putLong(t.Ui5GridExportConstants.CELL_PLAIN,t.XValueUtil.getLong(r.getPlain(),false,true))}else if(p===t.XValueType.INTEGER){o.putInteger(t.Ui5GridExportConstants.CELL_PLAIN,t.XValueUtil.getInteger(r.getPlain(),false,true))}else{o.putString(t.Ui5GridExportConstants.CELL_PLAIN,r.getPlain().getStringRepresentation())}}}var g=r.getEffectiveCellType();var E=this.getCellType(g);o.putString(t.Ui5GridExportConstants.CELL_TYPE,E);var C;if(t.XString.isEqual(E,t.Ui5GridExportConstants.CT_DIM_MEMBER_COL)||t.XString.isEqual(E,t.Ui5GridExportConstants.CT_VALUE)){var d=r.getParentColumn();var f=d.getTupleIndex();o.putInteger("TupleIndexCol",f)}if(t.XString.isEqual(E,t.Ui5GridExportConstants.CT_DIM_MEMBER_ROW)||t.XString.isEqual(E,t.Ui5GridExportConstants.CT_VALUE)){var c=r.getParentRow();var m=c.getTupleIndex();o.putInteger("TupleIndexRow",m)}if(t.XString.isEqual(E,t.Ui5GridExportConstants.CT_DIM_MEMBER_COL)||t.XString.isEqual(E,t.Ui5GridExportConstants.CT_DIM_HEADER_COL)){var _=this.m_tableDefinition.getColumnDimension(i);if(t.notNull(_)){o.putString("Dimension",this.getDimensionName(_))}}if(t.XString.isEqual(E,t.Ui5GridExportConstants.CT_DIM_MEMBER_ROW)||t.XString.isEqual(E,t.Ui5GridExportConstants.CT_DIM_HEADER_ROW)){var T=this.m_tableDefinition.getRowDimension(n);if(t.notNull(T)){o.putString("Dimension",this.getDimensionName(T))}}if(t.XString.isEqual(E,t.Ui5GridExportConstants.CT_DIM_MEMBER_COL)){C=this.m_tableDefinition.getColumnTupleElement(n,i);var M=C.getDimensionMember();o.putString("Member",t.Ui5GridExport.getDimensionMemberName(M));o.putBoolean(t.Ui5GridExportConstants.REPEATED_MEMBER_NAME,r.isRepeatedHeader())}if(t.XString.isEqual(E,t.Ui5GridExportConstants.CT_DIM_MEMBER_ROW)){C=this.m_tableDefinition.getRowTupleElement(n,i);o.putString("Member",t.Ui5GridExport.getDimensionMemberName(C.getDimensionMember()));o.putBoolean(t.Ui5GridExportConstants.REPEATED_MEMBER_NAME,r.isRepeatedHeader())}if(r.isEffectiveTotalsContext()){o.putBoolean(t.Ui5GridExportConstants.TOTALS,true)}var D=r.isInHierarchy();o.putBoolean(t.Ui5GridExportConstants.IN_HIERARCHY,D);if(D){o.putInteger(t.Ui5GridExportConstants.HIERARCHY_LEVEL,r.getHierarchyLevel());o.putBoolean(t.Ui5GridExportConstants.HIERARCHY_NODE_EXPANDED,r.isExpanded())}this.fillSemanticObjects(o,r,i,n,t.XString.isEqual(E,t.Ui5GridExportConstants.CT_VALUE));if(r.getValueException()!==null){o.putString(t.Ui5GridExportConstants.VAL_EXPT,r.getValueException().getName())}};t.Ui5GridExport.prototype.fillSemanticObjects=function(e,r,i,n,o){var a=t.PrFactory.createList();this.addSemanticObjectFromTupleElement(a,this.m_tableDefinition.getColumnTupleElement(n,i));this.addSemanticObjectFromTupleElement(a,this.m_tableDefinition.getRowTupleElement(n,i));if(o){var l=this.m_tableDefinition.getColumnTuple(n);var s;if(t.notNull(l)){for(s=0;s<l.size();s++){this.addSemanticObjectFromTupleElement(a,l.getTupleElementAt(s))}}l=this.m_tableDefinition.getRowTuple(i);if(t.notNull(l)){for(s=0;s<l.size();s++){this.addSemanticObjectFromTupleElement(a,l.getTupleElementAt(s))}}}var u=r.getDataCellRef();if(t.notNull(u)){var p=this.m_tableDefinition.getQueryModel().getQueryDataCell(u);if(t.notNull(p)&&p.getSemanticObject()!==null){a.addString(p.getSemanticObject())}}if(a.hasElements()){e.put("SemanticObjects",a)}};t.Ui5GridExport.prototype.addSemanticObjectFromTupleElement=function(e,r){if(t.notNull(r)){var i=this.m_tableDefinition.getQueryModel().getDimensionByName(r.getDimension().getName());var n=i.getSemanticObject();if(t.notNull(n)){e.addString(n)}if(i.isStructure()){var o=r.getDimensionMember();if(t.notNull(o)){var a=i.getStructureMember(o.getName());n=a.getSemanticObject();if(t.notNull(n)){e.addString(n)}}}}};t.Ui5GridExport.prototype.getDimensionName=function(t){var e=this.m_tableDefinition.getQueryModel().getDimensionByName(t.getName());if(e.isMeasureStructure()){return"MeasureStructure"}if(e.isStructure()){return"NonMeasureStructure"}return e.getExternalName()!==null?e.getExternalName():t.getName()};t.Ui5GridExport.prototype.getCellType=function(e){if(e===t.SacTableConstants.CT_VALUE){return t.Ui5GridExportConstants.CT_VALUE}else if(e===t.SacTableConstants.CT_INPUT){return t.Ui5GridExportConstants.CT_VALUE}else if(e===t.SacTableConstants.CT_UNBOOKED){return t.Ui5GridExportConstants.CT_VALUE}else if(e===t.SacTableConstants.CT_HEADER){return t.Ui5GridExportConstants.CT_HEADER}else if(e===t.SacTableConstants.CT_ROW_DIM_HEADER){return t.Ui5GridExportConstants.CT_DIM_HEADER_ROW}else if(e===t.SacTableConstants.CT_COL_DIM_HEADER){return t.Ui5GridExportConstants.CT_DIM_HEADER_COL}else if(e===t.SacTableConstants.CT_COL_DIM_MEMBER){return t.Ui5GridExportConstants.CT_DIM_MEMBER_COL}else if(e===t.SacTableConstants.CT_ROW_DIM_MEMBER){return t.Ui5GridExportConstants.CT_DIM_MEMBER_ROW}else if(e===t.SacTableConstants.CT_EMPTY_AXIS_ROW_HEADER){return t.Ui5GridExportConstants.CT_EMPTY_AXIS_HEADER_ROW}else if(e===t.SacTableConstants.CT_EMPTY_AXIS_COLUMN_HEADER){return t.Ui5GridExportConstants.CT_EMPTY_AXIS_HEADER_COL}else{return t.XInteger.convertToString(e)}};t.Ui5GridExportConstants={TOTAL_ROWS:"TotalRows",TOTAL_COLUMNS:"TotalColumns",IN_HIERARCHY:"InHierarchy",HIERARCHY_LEVEL:"HierarchyLevel",HIERARCHY_NODE_EXPANDED:"HierarchyNodeExpanded",ROW:"Row",COLUMN:"Column",MERGED:"Merged",MERGED_COLUMNS:"MergedColumns",MERGED_ROWS:"MergedRows",ORIGINAL_COLUMN:"OriginalColumn",ORIGINAL_ROW:"OriginalRow",DOCUMENT_ID:"DocumentId",FORMATTED:"Value",FORMAT_STRING:"FormatString",REPEATED_MEMBER_NAME:"RepeatedMemberName",CELL_DATA_TYPE:"Type",CELL_PLAIN:"PlainValue",CELL_TYPE:"CellType",CT_VALUE:"Value",CT_HEADER:"Header",CT_DIM_HEADER_ROW:"DimHeaderRow",CT_DIM_HEADER_COL:"DimHeaderCol",CT_DIM_MEMBER_COL:"DimMemberCol",CT_DIM_MEMBER_ROW:"DimMemberRow",CT_EMPTY_AXIS_HEADER_ROW:"EmptyAxisHeaderRow",CT_EMPTY_AXIS_HEADER_COL:"EmptyAxisHeaderCol",DATA_ROW:"DataRow",DATA_COLUMN:"DataColumn",TOTALS:"Totals",VAL_EXPT:"ValueException"};t.QFilterCartesianListTransformer=function(){};t.QFilterCartesianListTransformer.prototype=new t.XObject;t.QFilterCartesianListTransformer.prototype._ff_c="QFilterCartesianListTransformer";t.QFilterCartesianListTransformer.create=function(e){var r=new t.QFilterCartesianListTransformer;r.setup();r.m_cartesianList=e;return r};t.QFilterCartesianListTransformer.prototype.m_cartesianList=null;t.QFilterCartesianListTransformer.prototype.releaseObject=function(){this.m_cartesianList=null;t.XObject.prototype.releaseObject.call(this)};t.QFilterCartesianListTransformer.prototype.convertMemberFilterList=function(){var e=t.PrList.create();if(t.notNull(this.m_cartesianList)){for(var r=0;r<this.m_cartesianList.size();r++){var i=this.m_cartesianList.getCartesianElement(r);if(t.notNull(i)){var n=i.getLow();var o=i.getHigh();var a=i.getSetSign()===t.SetSign.EXCLUDING;var l=e.addNewStructure();l.putString("Low",n.getString());l.putString("High",o.getString());l.putString("ComparisonOperator",i.getComparisonOperator().getName());l.putString("Text",this.computeFilterValueText(i,a));l.putBoolean("IsExcluding",a);l.put("Hierarchy",this.getHierarchyInfo(i))}}}return e};t.QFilterCartesianListTransformer.prototype.computeFilterValueText=function(e,r){var i=this.getFilterElementValueText(e,e.getLow());var n=this.getFilterElementValueText(e,e.getHigh());var o=t.notNull(n)?t.XStringUtils.concatenate3(i," - ",n):i;if(r){o=t.XStringUtils.concatenate3("!( ",o," )")}return o};t.QFilterCartesianListTransformer.prototype.getFilterElementValueText=function(e,r){var i=r.getString();var n=e.getDimension();var o=n.getTextField();if(t.notNull(o)){var a=r.getSupplementValueString(o.getName());if(t.XStringUtils.isNotNullAndNotEmpty(a)){i=a}}return i};t.QFilterCartesianListTransformer.prototype.getHierarchyInfo=function(e){var r=t.PrStructure.create();var i=e.getHierarchyName();if(t.notNull(i)){r.putString("name",i);r.putString("version",e.getHierarchyVersion());r.putString("dueDate",e.getHierarchyDueDate().getStringRepresentation());r.putInteger("levelOffset",e.getLevelOffset());r.putInteger("depth",e.getDepth())}return r};t.CellContextGetAction=function(){};t.CellContextGetAction.prototype=new t.DfRsSyncAction;t.CellContextGetAction.prototype._ff_c="CellContextGetAction";t.CellContextGetAction.createAndRunAction=function(e,r,i,n){var o=new t.CellContextGetAction;o.setupActionAndRun(e,r,n,i);return o};t.CellContextGetAction.prototype.m_queryManager=null;t.CellContextGetAction.prototype.m_indexInfo=null;t.CellContextGetAction.prototype.setupAction=function(e,r,i,n){t.DfRsSyncAction.prototype.setupAction.call(this,e,r,i,n);this.m_queryManager=n;this.m_indexInfo=i};t.CellContextGetAction.prototype.releaseObject=function(){this.m_queryManager=null;this.m_indexInfo=null;t.DfRsSyncAction.prototype.releaseObject.call(this)};t.CellContextGetAction.prototype.processSynchronization=function(e){try{var r=this.m_indexInfo.getColumnIndex();var i=this.m_indexInfo.getRowIndex();var n=this.m_queryManager.getClassicResultSet();var o=this.m_queryManager.getQueryModel();var a=o.getCellContextManager();a.addCellContextFromResultSetTuples("rsTuple",n.getColumnsAxis().getTupleAt(r),n.getRowsAxis().getTupleAt(i));this.m_queryManager.invalidateState();this.m_queryManager.processQueryExecution(e,this,null);return true}catch(e){this.addError(t.ErrorCodes.CELL_CONTEXT_ACTION_FAILED,t.XException.getMessage(e));return false}};t.CellContextGetAction.prototype.onQueryExecuted=function(e,r,i){var n=t.PrStructure.create();if(e.isValid()){this.addAllMessages(e);var o=r.getCellContextNames().getIterator();while(o.hasNext()){var a=o.next();var l=r.getCellContextByName(a);var s=l.getCartesianProduct();if(t.notNull(s)){for(var u=0;u<s.size();u++){var p=s.getCartesianChild(u);var g=p.getDimension();if(t.notNull(g)){var E=g.getExternalName();if(t.XStringUtils.isNullOrEmpty(E)){E=g.getName()}n.put(E,this.populateDimensionStructure(g,p))}}}}}this.setData(n);this.endSync()};t.CellContextGetAction.prototype.populateDimensionStructure=function(e,r){var i=t.PrStructure.create();i.putString("Name",e.getExternalName());i.putString("TechName",e.getName());i.putBoolean("HierarchyActive",e.isHierarchyActive());i.put("Filter",t.QFilterCartesianListTransformer.create(r).convertMemberFilterList());return i};t.DragonflyModule=function(){};t.DragonflyModule.prototype=new t.DfModule;t.DragonflyModule.prototype._ff_c="DragonflyModule";t.DragonflyModule.s_module=null;t.DragonflyModule.getInstance=function(){if(t.isNull(t.DragonflyModule.s_module)){t.DfModule.checkInitialized(t.ProviderModule.getInstance());t.DfModule.checkInitialized(t.OlapReferenceModule.getInstance());t.DfModule.checkInitialized(t.OlapCatalogImplModule.getInstance());t.DfModule.checkInitialized(t.ApplicationUiModule.getInstance());t.DragonflyModule.s_module=t.DfModule.startExt(new t.DragonflyModule);t.DfModule.stopExt(t.DragonflyModule.s_module)}return t.DragonflyModule.s_module};t.DragonflyModule.prototype.getName=function(){return"ff8120.dragonfly"};t.DragonflyModule.getInstance();return sap.firefly});
//# sourceMappingURL=ff8120.dragonfly.js.map