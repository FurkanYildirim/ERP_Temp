/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){function e(e,t,r){if(r){return t?t(e):e}if(!e||!e.then){e=Promise.resolve(e)}return t?e.then(t):e}sap.ui.define(["../../../UIUtil","../../core/errors","../../sina/ComparisonOperator","../../sina/SearchResultSetItemAttribute","../../sina/SimpleCondition","../../sina/UserCategoryDataSource","../AbstractProvider","./template","./template2"],function(t,r,a,i,n,s,u,o,l){function c(e){"@babel/helpers - typeof";return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function h(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}function d(e,t,r){if(t)h(e.prototype,t);if(r)h(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function v(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});Object.defineProperty(e,"prototype",{writable:false});if(t)m(e,t)}function m(e,t){m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return m(e,t)}function p(e){var t=S();return function r(){var a=b(e),i;if(t){var n=b(this).constructor;i=Reflect.construct(a,arguments,n)}else{i=a.apply(this,arguments)}return g(this,i)}}function g(e,t){if(t&&(typeof t==="object"||typeof t==="function")){return t}else if(t!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return y(e)}function y(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function S(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function b(e){b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function e(t){return t.__proto__||Object.getPrototypeOf(t)};return b(e)}var C=t["registerHandler"];var F=r["ForcedBySearchTermTestError"];var O=r["NotImplementedError"];var I=a["ComparisonOperator"];var V=i["SearchResultSetItemAttribute"];var R=n["SimpleCondition"];var _=s["UserCategoryDataSource"];var A=u["AbstractProvider"];var P=o["createTemplate"];var T=l["createTemplate"];var w=function(t){v(a,t);var r=p(a);function a(){var e;f(this,a);e=r.call(this);e.id="sample";return e}d(a,[{key:"initAsync",value:function t(r){try{const t=this;t.sina=r.sina;t.templateProvider=P;if(document.location.href.indexOf("use=sample1")>0){t.templateProvider=T}var a=t.templateProvider(t);a._init(a);var i=Promise.resolve({capabilities:t.sina._createCapabilities({fuzzy:false})});return e(i)}catch(e){return Promise.reject(e)}}},{key:"getSuggestionList",value:function e(t){var r=this._stringify(t);var a=new RegExp('"valueFormatted":"([^{/]+?)","valueHighlighted',"g");var i=r.match(a).slice();var n=i.toString().split(" ");n=n.toString().split(",");i=i.concat(n);i=i.filter(function(e,t){if(e!==""){return i.indexOf(e)==t}});return i}},{key:"_stringify",value:function e(t){var r=[];var a=JSON.stringify(t,function(e,t){if(c(t)==="object"&&t!==null){if(r.indexOf(t)!==-1){return undefined}r.push(t)}return t});r=null;return a}},{key:"adjustImageViewing",value:function e(){var t,r,a;try{C("image-mouseenter",$(".sapUshellSearchResultListItem-Image"),"mouseenter",function(){t=$(this).clone();$("body").append(t);r=($(window).height()-$(t).outerHeight())*.33;a=($(window).width()-$(t).outerWidth())*.33;t.css({position:"absolute",top:r+"px",left:a+"px"}).show()});C("image-mouseleave",$(".sapUshellSearchResultListItem-Image"),"mouseleave",function(){t.remove()})}catch(e){}}},{key:"applyFilters",value:function e(t,r){var a=[];if(r.filter.rootCondition instanceof R){}else{if(r.filter.rootCondition.conditions.length===0||r.filter.rootCondition.conditions[0].conditions.length===0){if(r.filter.dataSource instanceof _){var i=r.filter.dataSource.subDataSources;if(i){return t.filter(function(e){return i.find(function(t){return t.id===e.dataSource.id})})}}return t}}var n=[];var s=[];if(r.filter.rootCondition instanceof R){var u=r.filter.rootCondition;n.push({attribute:u.attribute,operator:u.operator,value:u.value,fits:false});s.push(u.attribute)}else{for(var o=0;o<r.filter.rootCondition.conditions.length;o++){var l=r.filter.rootCondition.conditions[o].conditions;for(var c=0;c<l.length;c++){n.push({attribute:l[c].attribute,value:l[c].value,operator:l[c].operator,fits:false});s.push(l[c].attribute)}}}var f=false;for(var h=0;h<t.length;h++){var d=t[h];var v=[];for(var m=0;m<n.length;m++){f=false;for(var p=0;p<d.detailAttributes.length;p++){var g=d.detailAttributes[p];if(g instanceof V){if(g.id===n[m].attribute&&this.checkFilterValueMatch(g.value,n[m].value,n[m].operator)){f=true}}}for(var y=0;y<d.titleAttributes.length;y++){var S=d.titleAttributes[y];if(S instanceof V){if(S.id===n[m].attribute&&this.checkFilterValueMatch(S.value,n[m].value,n[m].operator)){f=true}}}n[m].fits=f;v.push(f)}if(v.toString().match(/false/)===null){a.push(d)}else{var b=[];var C=s.filter(function(e,t){return s.indexOf(e)==t});for(var F=0;F<C.length;F++){f=false;var O=C[F];for(var I=0;I<n.length;I++){if(n[I].attribute===O&&n[I].fits===true){f=true;break}}b.push(f)}if(b.toString().match(/false/)===null){a.push(d)}}}return a}},{key:"checkFilterValueMatch",value:function e(t,r,a){switch(a){case I.Co:{return t.toLowerCase().includes(r.toLowerCase())}case I.Eq:{return r===t}case I.Ne:{return r!==t}case I.Gt:{return r>t}case I.Ge:{return r>=t}case I.Lt:{return r<t}case I.Le:{return r<=t}default:{return t===r}}return false}},{key:"adjustHighlights",value:function e(t,r){var a=[];var i="";for(var n=0;n<t.length;n++){var s=t[n];var u=true;i="";s.titleHighlighted=this.addHighlight(s.title,r);if(s.titleHighlighted!==s.title){u=false}for(var o=0;o<s.detailAttributes.length;o++){var l=s.detailAttributes[o];i=l.metadata.type;if(i==="String"||i==="Integer"){l.valueHighlighted=this.addHighlight(l.valueFormatted,r);if(l.valueHighlighted!==l.valueFormatted){u=false}}}for(var c=0;c<s.titleAttributes.length;c++){var f=s.titleAttributes[c];i=f.metadata.type;if(i==="String"||i==="Integer"||i==="ImageUrl"){f.valueHighlighted=this.addHighlight(f.valueFormatted,r);if(f.valueHighlighted!==f.valueFormatted){u=false}}}if(u===false||r==="*"||r===""){a.push(s)}}return a}},{key:"addHighlight",value:function e(t,r){if(typeof t!=="string"||typeof r!=="string"){return t}var a=t.toLowerCase().indexOf(r.toLowerCase());if(a>-1){var i=a+r.length;var n=t.substring(0,a)+"<b>"+t.substring(a,i)+"</b>"+t.substring(i);return n}return t}},{key:"addSuvLinkToSearchResultItem",value:function e(t,r,a){var i=this.sina._createSuvNavTargetResolver();if(!r){r="/resources/sap/esh/search/ui/sinaNexTS/providers/sample/docs/folklorist_authors_and_publications.suv"}if(!a){a=[]}var n={};n.obj={suvThumbnailAttribute:t,suvTargetMimeTypeAttribute:{value:"application/vnd.sap.universal-viewer+suv"},suvTargetUrlAttribute:{value:r}};i.resolveSuvNavTargets(null,n,a)}},{key:"executeSearchQuery",value:function t(r){try{const t=this;var a=t;t.searchQuery=r;return e(new Promise(function(e){var t;var i=a.templateProvider(a);var n=i.searchResultSetItemArray;var s=i.searchResultSetItemArray2;var u=n.concat(s);var o;if(i.searchResultSetItemArray3){o=i.searchResultSetItemArray3;u=u.concat(o)}var l=r.filter.searchTerm;var c=r.filter.dataSource.id;var f=r.filter.dataSource.type;var h=a.generateFacets(r);if(l===F.forcedBySearchTerm){throw new F}var d;if(c==="Scientists"||c==="Folklorists"){d=a.adjustHighlights(n,l);d=a.applyFilters(d,r);t=a.sina._createSearchResultSet({items:d,facets:h,query:r,title:"",totalCount:d.length})}else if(c==="Mysterious_Sightings"||c==="Urban_Legends"){d=a.adjustHighlights(s,l);d=a.applyFilters(d,r);t=a.sina._createSearchResultSet({items:d,facets:h,query:r,title:"",totalCount:d.length})}else if(c==="Publications"){d=a.adjustHighlights(o,l);d=a.applyFilters(d,r);t=a.sina._createSearchResultSet({items:d,facets:h,query:r,title:"",totalCount:d.length})}else if(c==="All"||f===a.sina.DataSourceType.UserCategory){h[0].items.forEach(function(e){e.measureValue=0;e.measureValueFormatted=""});d=a.adjustHighlights(n,l);d=a.applyFilters(d,r);var v=d.length;d=a.adjustHighlights(s,l);d=a.applyFilters(d,r);var m=d.length;var p=0;if(o){d=a.adjustHighlights(o,l);d=a.applyFilters(d,r);p=d.length}h[0].items[0].measureValue=v;h[0].items[0].measureValueFormatted=""+v;h[0].items[1].measureValue=m;h[0].items[1].measureValueFormatted=""+m;if(o&&h[0].items.length>2){h[0].items[2].measureValue=p;h[0].items[2].measureValueFormatted=""+p}h[0].items=h[0].items.filter(function(e){return e.measureValue>0});d=a.adjustHighlights(u,l);d=a.applyFilters(d,r);var g=[];for(var y=r.skip;y<r.skip+r.top&&y<d.length;y++){g.push(d[y])}t=a.sina._createSearchResultSet({items:g,facets:h,query:r,title:"",totalCount:d.length})}e(t)}))}catch(e){return Promise.reject(e)}}},{key:"executeHierarchyQuery",value:function e(t){throw new O}},{key:"executeSuggestionQuery",value:function t(r){try{const t=this;var a=t;var i=r.filter.searchTerm;var n=t.templateProvider(t);var s=n.searchResultSetItemArray.concat(n.searchResultSetItemArray2).concat(n.searchResultSetItemArray3);var u=t.getSuggestionList(s);var o=u.filter(function(e){var t=new RegExp("^"+i,"gi");return e.match(t)});if(o.length===0){o=u}var l=[];var c=function e(t){var i=a.sina.SuggestionCalculationMode.Data;var n=r.filter.clone();n.setSearchTerm(t);return a.sina._createSearchTermSuggestion({searchTerm:t,calculationMode:i,filter:n,label:t})};for(var f=0;f<o.length;f++){l.push(c(o[f]))}var h=t.sina._createSuggestionResultSet({title:"Suggestions",query:r,items:l});return e(new Promise(function(e){e(h)}))}catch(e){return Promise.reject(e)}}},{key:"executeChartQuery",value:function t(r){try{const t=this;var a=t.generateFacets(r);var i=1;if(r.dimension==="LOCATION"||a.length===1){i=0}return e(new Promise(function(e){e(a[i])}))}catch(e){return Promise.reject(e)}}},{key:"getChartResultSetItemsForLocations",value:function e(t){var r=[];var a;var i=[];var n,s,u,o,l;for(s=0;s<t.length;s++){l=t[s].detailAttributes;for(u=0;u<l.length;u++){if(l[u].id==="LOCATION"){a=l[u].value;if(i.indexOf(a)===-1){i.push(a);n=this.sina._createChartResultSetItem({filterCondition:this.sina.createSimpleCondition({attribute:"LOCATION",operator:this.sina.ComparisonOperator.Eq,value:a}),dimensionValueFormatted:a,measureValue:1,measureValueFormatted:"1"});r.push(n)}else{for(o=0;o<r.length;o++){if(r[o].filterCondition.value===a){r[o].measureValue=r[o].measureValue+1;r[o].measureValueFormatted=""+r[o].measureValue}}}}}}return r}},{key:"getChartResultSetItemsForPublications",value:function e(t){var r=[];var a;var i=[];var n,s,u,o,l;for(s=0;s<t.length;s++){l=t[s].detailAttributes;for(u=0;u<l.length;u++){if(l[u].id==="PUBLICATION"){a=l[u].value;if(i.indexOf(a)===-1){i.push(a);n=this.sina._createChartResultSetItem({filterCondition:this.sina.createSimpleCondition({attribute:"PUBLICATION",operator:this.sina.ComparisonOperator.Eq,value:a}),dimensionValueFormatted:a,measureValue:1,measureValueFormatted:"1"});r.push(n)}else{for(o=0;o<r.length;o++){if(r[o].filterCondition.value===a){r[o].measureValue=r[o].measureValue+1;r[o].measureValueFormatted=""+r[o].measureValue}}}}}}return r}},{key:"getSientistOrFolkloristFacet",value:function e(t,r){var a;var i=[];var n,s,u,o,l,c;var f=[];for(s=0;s<r.length;s++){l=r[s].titleAttributes;if(t.filter.dataSource.id==="Mysterious_Sightings"||t.filter.dataSource.id==="Urban_Legends"||t.filter.dataSource.id==="Publications"){l=r[s].detailAttributes}for(u=0;u<l.length;u++){if(l[u].id==="SCIENTIST"||l[u].id==="FOLKLORIST"){a=l[u].value;c=l[u].id;if(i.indexOf(a)===-1){i.push(a);n=this.sina._createChartResultSetItem({filterCondition:this.sina.createSimpleCondition({attribute:l[u].id,operator:this.sina.ComparisonOperator.Eq,value:a}),dimensionValueFormatted:a,measureValue:1,measureValueFormatted:"1"});f.push(n)}else{for(o=0;o<f.length;o++){if(f[o].filterCondition.value===a){f[o].measureValue=f[o].measureValue+1;f[o].measureValueFormatted=""+f[o].measureValue}}}}}}return[f,c]}},{key:"getTopFacetOnly",value:function e(t){var r=t.filter.sina.allDataSource;var a=[this.sina._createDataSourceResultSetItem({dataSource:t.filter.sina.dataSources[1],dimensionValueFormatted:r.labelPlural,measureValue:4,measureValueFormatted:"4"}),this.sina._createDataSourceResultSetItem({dataSource:t.filter.sina.dataSources[2],dimensionValueFormatted:r.labelPlural,measureValue:5,measureValueFormatted:"5"})];if(t.filter.sina.dataSources[3]){a[2]=this.sina._createDataSourceResultSetItem({dataSource:t.filter.sina.dataSources[3],dimensionValueFormatted:r.labelPlural,measureValue:1,measureValueFormatted:"1"})}var i=[this.sina._createDataSourceResultSet({title:t.filter.dataSource.label,items:a,query:t})];return i}},{key:"generateFacets",value:function e(t){if(t.filter.dataSource.id==="All"||t.filter.dataSource.type===this.sina.DataSourceType.UserCategory){return this.getTopFacetOnly(t)}var r=[];var a;var i=this.templateProvider(this);var n=this.sina.createFilter({searchTerm:this.searchQuery.filter.searchTerm,dataSource:this.searchQuery.filter.dataSource,rootCondition:this.searchQuery.filter.rootCondition.clone()});var s=[];var u;if(t.filter.dataSource.id==="Publications"){u=i.searchResultSetItemArray3}else if(t.filter.dataSource.id==="Scientists"||t.filter.dataSource.id==="Folklorists"){u=i.searchResultSetItemArray}else if(t.filter.dataSource.id==="Urban_Legends"||t.filter.dataSource.id==="Mysterious_Sightings"){u=i.searchResultSetItemArray2}if(t.filter.dataSource.id==="Scientists"||t.filter.dataSource.id==="Mysterious_Sightings"){s=this.getChartResultSetItemsForLocations(u);a=this.sina._createChartResultSet({items:s,query:this.sina.createChartQuery({filter:n,dimension:"LOCATION"}),title:"Locations"});r.push(a)}var o=this.getSientistOrFolkloristFacet(t,u);s=o[0];var l=o[1];a=this.sina._createChartResultSet({items:s,query:this.sina.createChartQuery({filter:n,dimension:l}),title:l.charAt(0).toUpperCase()+l.slice(1).toLowerCase()+"s"});r.push(a);return r}}]);return a}(A);var k={__esModule:true};k.Provider=w;return k})})();
//# sourceMappingURL=Provider.js.map