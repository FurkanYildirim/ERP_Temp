{"version":3,"file":"PoiHelper.js","names":["sap","ui","define","ContentConnector","ContentResource","ContentDeliveryService","NodeContentType","TransformationMatrix","THREE","assert","uid","unitVector","Vector3","cleanUpUserData","child","userData","skipIt","children","forEach","PoiHelper","this","_symbolSceneCache","prototype","createPOI","url","scene","poiSceneId","viewport","poiPosition","nodeInfo","getNearestEntityOrVisibleElementNodes","_implementation","sid","viewportRect","getDomRef","getBoundingClientRect","screenX","x","left","screenY","y","top","hit","hitTest","ignoreOverlay","Promise","reject","matrix","Matrix4","compose","point","_getNativeCamera","quaternion","transform","convertTo4x3","elements","pickedNodes","object","referenceNode","length","nodeId","transformType","nodeHierarchy","getDefaultNodeHierarchy","symbolNode","createNode","name","Symbol","view","getCurrentView","getViews","loadSymbolScene","then","rootNodeRef","entityId","add","apply","treeNode","updateNodeInfos","target","visible","setShouldRenderFrame","slice","veId","contentType","updatePOI","symbolNodeSid","persistentIdToNodeRef","position","set","removeNode","_symbolCenterFixed","resolve","removePOI","nodeRef","vsm","getViewStateManager","setVisibilityState","getPoiRect","camera","boundingBox","Box3","setFromObject","vertices","min","z","max","frustum","Frustum","setFromProjectionMatrix","multiplyMatrices","projectionMatrix","matrixWorldInverse","intersectsBox","vertex","i","containsPoint","vertexWorldCoord","copy","vertexScreenSpace","project","box2","Box2","halfScreen","Vector2","width","height","box2min","clone","multiply","box2max","adjustPoi","poiNodeRef","getBackgroundProjection","screenPos","getWorldPosition","_width","_height","updateMatrix","updateMatrixWorld","direction","setFromMatrixColumn","matrixWorld","normalize","updateNodeId","newNodeId","poiNode","setNodePersistentId","findSymbolSceneInCache","sceneId","find","item","cacheEntry","sourceType","contentResource","source","veid","sourceId","contentConnector","cds","cleanup","removeContentManagerResolver","setTimeout","destroy","attachEventOnce","getNodeProxy","getNodeRef","push","event","getParameter","addContentManagerResolver","pattern","dimension","contentManagerClassName","settings","loader","addContentResource","bind"],"sources":["PoiHelper-dbg.js"],"mappings":"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"}