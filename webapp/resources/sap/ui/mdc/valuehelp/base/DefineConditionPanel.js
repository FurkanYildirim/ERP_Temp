/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/base/ManagedObjectObserver","sap/base/util/merge","sap/base/util/deepEqual","sap/ui/mdc/condition/Condition","sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/mdc/field/ConditionsType","sap/ui/mdc/field/splitValue","sap/ui/mdc/enums/FieldEditMode","sap/ui/mdc/enums/FieldDisplay","sap/ui/mdc/enums/BaseType","sap/ui/mdc/enums/ConditionValidated","sap/ui/mdc/enums/OperatorValueType","sap/ui/mdc/Field","sap/ui/mdc/ValueHelp","sap/ui/mdc/valuehelp/Popover","sap/ui/mdc/valuehelp/content/FixedList","sap/ui/mdc/valuehelp/content/FixedListItem","sap/ui/model/base/ManagedObjectModel","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/ui/model/type/String","sap/ui/model/ParseException","sap/ui/core/library","sap/ui/core/InvisibleText","sap/ui/layout/Grid","sap/ui/layout/GridData","sap/m/library","sap/m/Button","sap/m/Panel","sap/m/OverflowToolbar","sap/m/OverflowToolbarLayoutData","sap/m/ToolbarSpacer","sap/m/Text","sap/m/Title","sap/ui/core/IconPool","sap/ui/core/InvisibleMessage","sap/ui/thirdparty/jquery"],function(e,t,i,a,n,s,r,o,l,d,u,h,p,v,g,f,c,C,y,I,m,b,O,_,T,x,S,P,w,D,V,N,M,E,$,L,B,jQuery){"use strict";var F=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");var A=sap.ui.getCore().getLibraryResourceBundle("sap.m");sap.ui.getCore().attachLocalizationChanged(function(){F=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");A=sap.ui.getCore().getLibraryResourceBundle("sap.m")});var R=P.ButtonType;var H=_.ValueState;var U=_.InvisibleMessageMode;var j=_.TextAlign;var k=P.BackgroundDesign;var G=P.ToolbarDesign;var X=P.OverflowToolbarPriority;var K=e.extend("sap.ui.mdc.valuehelp.base.DefineConditionPanel",{metadata:{library:"sap.ui.mdc",properties:{conditions:{type:"object[]",group:"Data",defaultValue:[],byValue:true},config:{type:"object",defaultValue:{}},label:{type:"string",defaultValue:""},inputOK:{type:"boolean",defaultValue:true},_pagination:{type:"boolean",defaultValue:false,visibility:"hidden"}},aggregations:{_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},associations:{fieldHelp:{type:"sap.ui.mdc.ValueHelp",multiple:false},valueHelp:{type:"sap.ui.mdc.ValueHelp",multiple:false}},events:{conditionProcessed:{}}},_oManagedObjectModel:null,renderer:{apiVersion:2,render:function(e,t){e.openStart("section",t);e.class("sapUiMdcDefineConditionPanel");e.openEnd();e.renderControl(t.getAggregation("_content"));e.close("section")}},init:function(){sap.ui.getCore().getMessageManager().registerObject(this,true);e.prototype.init.apply(this,arguments);this.oInvisibleMessage=B.getInstance();this._oManagedObjectModel=new y(this);this._oObserver=new t(W.bind(this));this._oObserver.observe(this,{properties:["conditions","config"]});this._iStartIndex=0;this._iShownConditions=10;this._iShownAdditionalConditions=0;this._sOperatorHelpId=this.getId()+"--rowSelect-help";this._oContentEventDelegate={onpaste:this.onPaste};le.call(this);this.setModel(this._oManagedObjectModel,"$this");this.setModel(this._oManagedObjectModel,"$condition")},exit:function(){sap.ui.getCore().getMessageManager().unregisterObject(this,true);this._oObserver.disconnect();this._oObserver=undefined;if(this._sConditionsTimer){clearTimeout(this._sConditionsTimer);this._sConditionsTimer=null}if(this._oDefaultType){this._oDefaultType.destroy();delete this._oDefaultType}this._oManagedObjectModel.destroy();delete this._oManagedObjectModel},byId:function(e){return sap.ui.getCore().byId(this.getId()+"--"+e)},onBeforeRendering:function(){if(!this.getModel("$i18n")){this.setModel(new m({bundleName:"sap/ui/mdc/messagebundle",async:false}),"$i18n")}if(this.getConditions().length===0&&!this._sConditionsTimer){this.updateDefineConditions()}},removeCondition:function(e){var t=e.oSource;var i=t.getBindingContext("$this");var a=this.getConditions();var n=i.getPath();var s=n.match(/^.*\/(\d+)\/$/);var r;if(s){r=parseInt(s[1])}if(r>0&&a.length-1===r){this._bFocusLastRemoveBtn=true}this.oInvisibleMessage.announce(F.getText("valuehelp.DEFINECONDITIONS_REMOVECONDITION_ANNOUNCE"),U.Polite);var o=this.byId("conditions");var l=o.getContent();var d=-1;for(var u=0;u<l.length;u++){var h=l[u];if(h instanceof v&&h.getValueHelp()===this._sOperatorHelpId){d++}if(h instanceof v&&h.hasOwnProperty("_iValueIndex")&&h.getBindingContext("$this").getPath().startsWith(n)){if(h.isInvalidInput()){h.setValue(null)}}}if(a.length===1&&r===0){this.addDummyCondition(1);a=this.getConditions()}if(d===0&&this._iStartIndex>0){this._iStartIndex=this._iStartIndex-this._iShownConditions}a.splice(r,1);this.setProperty("conditions",a,true);Te.call(this,undefined);this.fireConditionProcessed()},addCondition:function(e){var t=this.getConditions();var i=this.getConfig();var a=i.maxConditions;var n=this.byId("conditions");var s=n.getContent();var r=0;var o=-1;for(var l=0;l<s.length;l++){var d=s[l];if(d instanceof v&&d.getValueHelp()===this._sOperatorHelpId){r++;var u=d.getBindingContext("$this");var h=u.getPath();var p=h.match(/^.*\/(\d+)\/$/);if(p){o=parseInt(p[1])}}}if(a===-1||t.length<a){this.addDummyCondition(o+1);this._bFocusLastCondition=true;if(r>=this._iShownConditions){this._iShownAdditionalConditions++}}this.oInvisibleMessage.announce(F.getText("valuehelp.DEFINECONDITIONS_ADDCONDITION_ANNOUNCE"),U.Polite)},addDummyCondition:function(e){var t=ee.call(this);var i=Z.call(this);var a=i.name;var r=n.createCondition(a,i.valueDefaults?i.valueDefaults:[],undefined,undefined,h.NotValidated);if(i.valueTypes[0]&&i.valueTypes[0]!==p.Static){r.isInitial=true}s.updateConditionValues(r);s.checkConditionsEmpty(r,t);var o=this.getConditions();if(e!==undefined){o.splice(e,0,r)}else{o.push(r)}this.setProperty("conditions",o,true);if(!r.isInitial){this.fireConditionProcessed()}},updateDefineConditions:function(){var e=xe.call(this);oe.call(this,e,true,false);if(e.length===0){this.addDummyCondition()}if(e.length<this._iStartIndex){this._iStartIndex=0}},onChange:function(e){var t=e&&e.getParameter("promise");var i=e&&e.getSource();var a=function(e){var t=ee.call(this);var i=this.getConditions();s.checkConditionsEmpty(i,t);s.updateConditionsValues(i,t);oe.call(this,i,false,false);if(e){i.forEach(function(e){if(!e.isEmpty){delete e.isInitial}})}this.setProperty("conditions",i,true)}.bind(this);if(t){t.then(function(e){this._bPendingChange=false;a({mParameters:{value:e}});if(this._bPendingValidateCondition){_e.call(this,i);delete this._bPendingValidateCondition}}.bind(this)).catch(function(e){this._bPendingChange=false;if(this._bPendingValidateCondition){_e.call(this,i);delete this._bPendingValidateCondition}}.bind(this));this._bPendingChange=true;return}else{a()}},onSelectChange:function(e){var t=e.getSource();var i=e.getParameter("promise");i.then(function(e){var i=t._sOldKey;var n=s.getOperator(e);var r=i&&s.getOperator(i);var o=t.getBindingContext("$this");var l=o.getObject();var d=o.getPath();var u=parseInt(d.split("/")[2]);var h=this.getConditions();if(u>=0){l=h[u]}if(n&&r){var v=false;if(!a(n.valueTypes[0],r.valueTypes[0])&&n.valueTypes[0]!==p.Static){if(u>=0){l.values.forEach(function(e,t){if(e!==null){if(n.valueTypes[t]===p.Self&&r.valueTypes[t]===p.SelfNoParse||n.valueTypes[t]===p.SelfNoParse&&r.valueTypes[t]===p.Self){var i=Q.call(this,n.name,t);var a=Q.call(this,r.name,t);var s=a.formatValue(l.values[t],"string");var o=i.parseValue(s,"string");if(o!==l.values[t]){l.values[t]=i.parseValue(s,"string");v=true}}else{l.values[t]=null;v=true}}}.bind(this))}}if(u>=0&&n.valueDefaults){l.values.forEach(function(e,t){if(l.isInitial&&e!==n.valueDefaults[t]||e===null){l.values[t]=n.valueDefaults[t];l.isInitial=true;v=true}})}if(!n.valueTypes[1]&&r.valueTypes[1]){if(u>=0){if(l.values.length>1&&l.values[1]){l.values=l.values.slice(0,1);v=true}}}if(l.invalid){delete l.invalid;v=true}if(v){s.checkConditionsEmpty(l,ee.call(this));this.setProperty("conditions",h,true);Te.call(this,false)}}delete t._sOldKey}.bind(this)).catch(function(e){var i=t.getBindingContext("$this");var a=i.getObject();var n=i.getPath();var s=parseInt(n.split("/")[2]);var r=this.getConditions();if(s>=0){a=r[s]}a.invalid=true;this.setProperty("conditions",r,true);t._sOldKey=t.getValue();Te.call(this,true)}.bind(this))},onPaste:function(e){var t=e.originalEvent.clipboardData.getData("text/plain");var a=o(t,true);if(a.length>1){var n=e.srcControl;var l=n.getBindingContext("$condition").getPath();var u=parseInt(l.split("/")[2]);var h=this.getConditions();var p=i({},this.getConfig());p.display=d.Value;p.getConditions=function(){return h};p.defaultOperatorName=h[u].operator;p.valueType=p.dataType;delete p.dataType;var v=new r(p);try{h.splice(u,1);var g=v._parseValueToIndex(t,"string",u);v.validateValue(h);s.checkConditionsEmpty(g);this.setProperty("conditions",g,true);this.fireConditionProcessed()}catch(e){var f=new O(F.getText("field.PASTE_ERROR"));var c={element:n,property:"value",type:v,newValue:t,oldValue:"",exception:f,message:f.message};n.fireParseError(c,false,true)}v.destroy();e.stopImmediatePropagation(true);e.preventDefault()}},cleanUp:function(){var e=this.byId("conditions");var t=e.getContent();for(var i=0;i<t.length;i++){var a=t[i];if(a instanceof v&&a.hasOwnProperty("_iValueIndex")){if(a.isInvalidInput()){a.setValue()}}}this.setProperty("inputOK",true,true);if(this._iStartIndex>0||this._iShownAdditionalConditions>0){this._iStartIndex=0;this._iShownAdditionalConditions=0;he.call(this)}},getInitialFocusedControl:function(){var e=this.getAggregation("_content").getContent()[1];var t=e.getContent()[0];return t},_getValueHelp:function(){return this.getValueHelp()||this.getFieldHelp&&this.getFieldHelp()}});function W(e){if(e.name==="value"){z.call(this,e.object,e.current,e.old)}if(e.name==="config"){var t=this.getConditions();var i=e.current&&e.current.operators;var n=e.old&&e.old.operators;var s=false;if(!a(i,n)){s=true;ie.call(this)}var r=e.current&&e.current.dataType;var o=e.old&&e.old.valueType;var l=r&&r.getMetadata().getName();var d=o&&o.getMetadata().getName();var u=r&&r.getFormatOptions();var h=o&&o.getFormatOptions();var p=r&&r.getConstraints();var v=o&&o.getConstraints();if(l!==d||!a(u,h)||!a(p,v)){if(!s){ie.call(this)}if(this._sConditionsTimer){this._bUpdateType=true}else if(t.length>0){this._bUpdateType=true;he.call(this);this._bUpdateType=false;oe.call(this,t,true,true)}}}if(e.name==="conditions"&&!this._bConditionUpdateRunning){if(this._sConditionsTimer){clearTimeout(this._sConditionsTimer);this._sConditionsTimer=null}this._sConditionsTimer=setTimeout(function(){this._sConditionsTimer=null;this._bConditionUpdateRunning=true;this.updateDefineConditions();he.call(this);this._bUpdateType=false;this._bConditionUpdateRunning=false}.bind(this),0)}}function q(e){return true}function z(e,t,i){e._sOldKey=i;var a=0;if(t&&i){var n=s.getOperator(t);var r=s.getOperator(i);var o=e.getParent();var l;var d;a=o.indexOfContent(e);l=o.getContent()[a+2];if(l&&l.hasOwnProperty("_iValueIndex")&&l._iValueIndex===0){if(l instanceof v&&!l.isInvalidInput()){l.setValueState(H.None);l.setValueStateText()}d=o.getContent()[a+3];if(d&&d.hasOwnProperty("_iValueIndex")&&d._iValueIndex===1){if(d instanceof v&&!d.isInvalidInput()){d.setValueState(H.None);d.setValueStateText()}}else{d=undefined}}else{l=undefined}if(q(t)){var u=this._getValueHelp();l&&l.setValueHelp&&l.setValueHelp(u);d&&d.setValueHelp&&d.setValueHelp(u)}else{l&&l.setValueHelp&&l.setValueHelp();d&&d.setValueHelp&&d.setValueHelp()}if(n.createControl||r.createControl){if(l){l.destroy()}if(d){d.destroy()}}else{if(l&&n.valueTypes[0]!==r.valueTypes[0]){l.unbindProperty("value")}if(d&&n.valueTypes[1]!==r.valueTypes[1]&&r.valueTypes[1]){d.unbindProperty("value")}}}if(!t){var h=e.getBindingContext("$this").getObject();if(h){var p=this.getConditions();a=s.indexOfCondition(h,p);if(a>=0){h=p[a];h.operator=i;this.setProperty("conditions",p,true)}}}var g=this.oOperatorModel.getData();var f;for(var c=0;c<g.length;c++){var C=g[c];if(C.key===t){f=C.text;break}}e.setAdditionalValue(f);this.onChange()}function J(e,t,i,a){var n=s.getOperator(e.operator);if(!n||!n.valueTypes[t]){return null}var r=Q.call(this,n.name,t);var o=this._oManagedObjectModel.getContext(a.getPath()+"values/"+t+"/");var l;if(n.createControl){l=n.createControl(r,"$this>",t,i)}if(!l){l=new v(i,{delegate:re.call(this),value:{path:"$this>",type:r,mode:"TwoWay",targetType:"raw"},editMode:{parts:[{path:"$condition>operator"},{path:"$condition>invalid"}],formatter:fe},multipleLines:false,width:"100%",valueHelp:q(e.operator)?this._getValueHelp():null})}if(l.getMetadata().hasProperty("placeholder")){if(t===0){l.bindProperty("placeholder",{path:"$condition>operator",formatter:Ie})}else{l.bindProperty("placeholder",{path:"$condition>operator",formatter:me})}}l._iValueIndex=t;if(l.attachChange){l.attachChange(this.onChange.bind(this))}l.addDelegate(this._oContentEventDelegate,true,this);l.setLayoutData(new S({span:{parts:[{path:"$condition>"},{path:"$this>/config"}],formatter:ye.bind(this)}}));l.setBindingContext(o,"$this");l.setBindingContext(a,"$condition");l.setFieldGroupIds([a.getPath()]);return l}function Q(e,t){var i=ae.call(this);var a=s.getOperator(e);if(a.valueTypes[t]&&[p.Self,p.Static].indexOf(a.valueTypes[t])===-1){i=a._createLocalType(a.valueTypes[t],i)}var n=false;if(a.valueTypes[t]===p.Static){n=true;i=ne.call(this)}var r=n?u.String:se.call(this,i);var o;switch(r){case u.Numeric:var l=i.getFormatOptions();if(l&&l.hasOwnProperty("emptyString")&&l.emptyString===null){o=i}else{o=Y(i,{emptyString:null})}break;case u.Date:case u.Time:case u.DateTime:o=i;break;default:if(i.getConstraints()&&i.getConstraints().hasOwnProperty("nullable")&&i.getConstraints().nullable===false){o=Y(i);if(i._bCreatedByOperator){o=a._createLocalType(a.valueTypes[t],i)}}else{o=i}break}return o}function Y(e,t,a){var n=sap.ui.require(e.getMetadata().getName().replace(/\./g,"/"));var s=i(e.getFormatOptions(),t||{});var r=i(e.getConstraints(),a||{});if(r.hasOwnProperty("nullable")&&r.nullable===false){r.nullable=true}return new n(s,r)}function Z(){var e=ee.call(this);var t;var i=this.getConfig().defaultOperatorName;if(i){t=s.getOperator(i)}else{var a=ae.call(this);var n=se.call(this,a);t=s.getDefaultOperator(n)}if(t&&e.indexOf(t.name)<0){for(var r=0;r<e.length;r++){t=s.getOperator(e[r]);if(!t||t.exclude||!t.hasRequiredValues()){t=undefined}else{break}}}if(!t){t=s.getOperator(e[0])}return t}function ee(){var e=this.getConfig();var t=e&&e.operators;if(!t||t.length===0){t=s.getOperatorsForType(u.String)}return t}function te(){var e;var t=ee.call(this);for(var i=0;i<t.length;i++){var a=t[i];var n=s.getOperator(a);if(!e){e=n.group.id}else if(e!==n.group.id){return true}}return false}function ie(){if(!this.oOperatorModel){return}var e=ae.call(this);var t=ee.call(this);var i=[];var a=te.call(this);var n=this._sOperatorHelpId+"-pop-fl";var r=sap.ui.getCore().byId(n);var o;if(a){o=new C({key:"{om>key}",text:"{om>text}",additionalText:"{om>additionalText}",groupKey:"{om>groupId}",groupText:"{om>groupText}"})}else{o=new C({key:"{om>key}",text:"{om>text}",additionalText:"{om>additionalText}"})}r.bindAggregation("items",{path:"om>/",templateShareable:false,template:o});r.setGroupable(a);for(var l=0;l<t.length;l++){var d=t[l];var u=s.getOperator(d);if(!u||u.showInSuggest!==undefined&&u.showInSuggest==false){continue}var h=u.getLongText(se.call(this,e));var p=u.additionalInfo;if(p===undefined){if(p!==""&&u.formatRange){p=u.formatRange(u._getRange(undefined,e),e)}else if(!a){p=u.group.text}}i.push({key:u.name,text:h,additionalText:p,groupId:u.group.id,groupText:u.group.text})}this.oOperatorModel.setData(i)}function ae(){var e=this.getConfig();var t=e&&e.dataType;if(!t){t=ne.call(this)}return t}function ne(){if(!this._oDefaultType){this._oDefaultType=new b}return this._oDefaultType}function se(e){var t=e.getMetadata().getName();var i=e.getFormatOptions();var a=e.getConstraints();var n=this.getConfig().delegate;var s=this.getConfig().control;var r=n?n.getTypeMap(s).getBaseType(t,i,a):u.String;if(r===u.Unit){r=u.Numeric}return r}function re(){var e=this.getConfig();var t=e.delegateName||"sap/ui/mdc/field/FieldBaseDelegate";var i=e.payload;return{name:t,payload:i}}function oe(e,t,i){var a=ae.call(this);var n=[];var r=0;for(r=0;r<e.length;r++){var o=e[r];var l=s.getOperator(o.operator);if(l&&l.valueTypes[0]===p.Static&&(o.values.length===0||i)){if(l.getStaticText){var d=l.getStaticText(a,se.call(this,a));if(o.values.length>0){o.values[0]=d}else{o.values.push(d)}n.push(r)}}}if(t&&n.length>0){this.setProperty("conditions",e,true)}}function le(){var e=new T(this.getId()+"--ivtOperator",{text:"{$i18n>valuehelp.DEFINECONDITIONS_OPERATORLABEL}"});var t=new $(this.getId()+"-title",{text:{path:"$this>/label"}});var i=new w(this.getId()+"--prev",{icon:L.getIconURI("navigation-left-arrow"),tooltip:A.getText("PAGINGBUTTON_PREVIOUS"),visible:{path:"$this>/_pagination"},layoutData:new N({priority:X.NeverOverflow}),press:Pe.bind(this)});var a=new w(this.getId()+"--next",{icon:L.getIconURI("navigation-right-arrow"),tooltip:A.getText("PAGINGBUTTON_NEXT"),visible:{path:"$this>/_pagination"},layoutData:new N({priority:X.NeverOverflow}),press:Se.bind(this)});var n=new w(this.getId()+"--removeAll",{text:A.getText("CONDITIONPANEL_REMOVE_ALL"),visible:{path:"$this>/_pagination"},layoutData:new N({priority:X.Low}),press:we.bind(this)});var s=new w(this.getId()+"--insert",{icon:L.getIconURI("add"),visible:{path:"$this>/_pagination"},layoutData:new N({priority:X.Low}),press:De.bind(this)});var r=new E(this.getId()+"--pageCount",{text:Ve.call(this),wrapping:false,textAlign:j.Center,visible:{path:"$this>/_pagination"},layoutData:new N({priority:X.NeverOverflow})});var o=new V(this.getId()+"--toolbar",{width:"100%",design:G.Transparent,content:[t,new M,i,r,a,n,s]});var l=new D(this.getId()+"--panel",{headerToolbar:o,expanded:true,height:"100%",backgroundDesign:k.Transparent}).addStyleClass("sapMdcDefineconditionPanel");l.addDependent(new g(this._sOperatorHelpId,{typeahead:new f(this._sOperatorHelpId+"-pop",{content:[new c(this._sOperatorHelpId+"-pop-fl",{filterList:false,useFirstMatch:true})]})}));var d=new x(this.getId()+"--conditions",{width:"100%",hSpacing:0,vSpacing:0,containerQuery:true}).addStyleClass("sapUiMdcDefineConditionGrid");ge.call(this,undefined,d,0,null,0);l.addContent(e);l.addContent(d);this._oInvisibleAddOperatorButtonText=new T({text:F.getText("valuehelp.DEFINECONDITIONS_ADDCONDITION_DESCRIPTION")});l.addContent(this._oInvisibleAddOperatorButtonText);var u=new w(this.getId()+"--addBtn",{press:this.addCondition.bind(this),type:R.Default,text:"{$i18n>valuehelp.DEFINECONDITIONS_ADDCONDITION}",layoutData:new S({span:"XL2 L3 M3 S3",indent:"XL9 L8 M8 S7",linebreak:true,visibleS:{parts:[{path:"$this>/conditions"},{path:"$this>/config"}],formatter:de.bind(this)},visibleM:{parts:[{path:"$this>/conditions"},{path:"$this>/config"}],formatter:de.bind(this)},visibleL:{parts:[{path:"$this>/conditions"},{path:"$this>/config"}],formatter:de.bind(this)},visibleXL:{parts:[{path:"$this>/conditions"},{path:"$this>/config"}],formatter:de.bind(this)}}),ariaDescribedBy:this._oInvisibleAddOperatorButtonText});d.addContent(u);d.attachValidateFieldGroup(Oe,this);this.setAggregation("_content",l)}function de(e,t){var i=t.hasOwnProperty("maxConditions")?t.maxConditions:-1;return i===-1||e.length<i}function ue(e,t){var i=t.hasOwnProperty("maxConditions")?t.maxConditions:-1;return i!==1}function he(){var e=this.getConditions();var t=this.byId("conditions");var i=this.byId("prev");var a=this.byId("next");var n=this.byId("pageCount");var r;var o=-1;var l=0;var d=-1;var u=this._iShownConditions+this._iShownAdditionalConditions;for(var p=0;p<e.length&&o<u;p++){var v=e[p];var g=s.getOperator(v.operator);if(v.validated!==h.Validated||g.exclude){d++;if(d>=this._iStartIndex){o++;if(o<u){var f=this._oManagedObjectModel.getContext("/conditions/"+p+"/");if(!this.oOperatorModel){this.oOperatorModel=new I;this.setModel(this.oOperatorModel,"om");ie.call(this)}r=t.getContent();if(r[l]&&r[l].isA("sap.ui.mdc.Field")){l=be.call(this,v,t,l,f,o)}else{l=ge.call(this,v,t,l,f,o)}}}}}r=t.getContent();while(r[l]&&r[l]!==this.byId("addBtn")){r[l].destroy();l++}if(this._bFocusLastCondition){l=ve.call(this,"-operator");setTimeout(function(){r[l].focus()},0);this._bFocusLastCondition=false}if(this._bFocusLastRemoveBtn){l=pe.call(this,["-removeBtnLarge","-removeBtnSmall"]);r[l].focus();this._bFocusLastRemoveBtn=false}n.setText(Ve.call(this));i.setEnabled(this._iStartIndex>0);a.setEnabled(o>=u);this.setProperty("_pagination",d>=u)}function pe(e){var t=this.byId("conditions");var i=t.getContent();var a=i.length-1;if(!Array.isArray(e)){e=[e]}var n=0;var s=e[n];while(a>=0&&s!==undefined){var r=i[a];if(r.getId().endsWith(s)){var o=jQuery(r.getDomRef());if(o.is(":visible")){return a}else{n++;s=e[n]}}a--}return 0}function ve(e){var t=this.byId("conditions");var i=t.getContent();var a=i.length-1;var n=e;while(a>=0){var s=i[a];if(s.getId().endsWith(n)){return a}a--}return 0}function ge(e,t,i,a,n){var s=this.getId()+"--"+n;if(!this._oOperatorFieldType){this._oOperatorFieldType=new b({},{minLength:1})}var r=new v(s+"-operator",{value:{path:"$this>operator",type:this._oOperatorFieldType},width:"100%",display:d.Description,editMode:l.Editable,multipleLines:false,valueHelp:this._sOperatorHelpId,change:this.onSelectChange.bind(this),ariaLabelledBy:this.getId()+"--ivtOperator"}).setLayoutData(new S({span:{parts:[{path:"$this>/conditions"},{path:"$this>/config"}],formatter:Ce.bind(this)},linebreak:true})).setBindingContext(a,"$this");if(a){r.setFieldGroupIds([a.getPath()])}this._oObserver.observe(r,{properties:["value"]});t.insertContent(r,i);i++;var o=new w(s+"--removeBtnSmall",{press:this.removeCondition.bind(this),type:R.Transparent,icon:"sap-icon://decline",tooltip:"{$i18n>valuehelp.DEFINECONDITIONS_REMOVECONDITION}"}).setLayoutData(new S({span:"XL1 L1 M1 S2",indent:{path:"$this>operator",formatter:ce},visibleS:{parts:[{path:"$this>/conditions"},{path:"$this>/config"}],formatter:ue.bind(this)},visibleM:false,visibleL:false,visibleXL:false})).setBindingContext(a,"$this");if(a){o.setFieldGroupIds([a.getPath()])}t.insertContent(o,i);i++;if(e){for(var u=0;u<e.values.length;u++){var h=J.call(this,e,u,s+"-values"+u,a);if(h){t.insertContent(h,i);i++}}}var p=new w(s+"--removeBtnLarge",{press:this.removeCondition.bind(this),type:R.Transparent,icon:"sap-icon://decline",tooltip:"{$i18n>valuehelp.DEFINECONDITIONS_REMOVECONDITION}"}).setLayoutData(new S({span:"XL1 L1 M1 S1",indent:{path:"$this>operator",formatter:ce},visibleS:false,visibleM:{parts:[{path:"$this>/conditions"},{path:"$this>/config"}],formatter:ue.bind(this)},visibleL:{parts:[{path:"$this>/conditions"},{path:"$this>/config"}],formatter:ue.bind(this)},visibleXL:{parts:[{path:"$this>/conditions"},{path:"$this>/config"}],formatter:ue.bind(this)}})).setBindingContext(a,"$this");t.insertContent(p,i);i++;return i}function fe(e,t){if(!e){return this.getEditMode()}else if(t){return l.ReadOnly}var i=s.getOperator(e);var a=false;if(i&&i.valueTypes[0]===p.Static){a=true}return a?l.Display:l.Editable}function ce(e){var t=e&&s.getOperator(e);if(!t||!t.valueTypes[0]||t.valueTypes[0]===p.Static&&!t.getStaticText){return"XL8 L8 M8 S0"}else{return""}}function Ce(e,t){var i=t.hasOwnProperty("maxConditions")?t.maxConditions:-1;var a="XL3 L3 M3 ";if(i===1){a+="S12"}else{a+="S10"}return a}function ye(e,t){var i=t.hasOwnProperty("maxConditions")?t.maxConditions:-1;var a=e&&s.getOperator(e.operator);var n="";if(a&&a.valueTypes[1]){n="XL4 L4 M4 "}else{n="XL8 L8 M8 "}if(i===1){n+="S12"}else{n+="S10"}return n}function Ie(e){var t=e&&s.getOperator(e);if(t&&t.aLabels){return t.aLabels[0]}else if(t&&t.valueTypes[1]){return F.getText("valuehelp.DEFINECONDITIONS_FROM")}else{return F.getText("valuehelp.DEFINECONDITIONS_VALUE")}}function me(e){var t=e&&s.getOperator(e);if(t&&t.aLabels){return t.aLabels[1]}else if(t&&t.valueTypes[1]){return F.getText("valuehelp.DEFINECONDITIONS_TO")}}function be(e,t,i,a,n){var s=this.getId()+"--"+n;var r=t.getContent();var o;var l=r[i];l.setBindingContext(a,"$this");if(a){l.setFieldGroupIds([a.getPath()])}if(l.getValueState()===H.Error&&!e.invalid){l.setValue(l.getValue())}i++;var d=r[i];d.setBindingContext(a,"$this");if(a){d.setFieldGroupIds([a.getPath()])}i++;var u;var h=r[i];var p;if(h.hasOwnProperty("_iValueIndex")&&h._iValueIndex===0){if(e.values.length>0){u=this._oManagedObjectModel.getContext(a.getPath()+"values/0/");h.setBindingContext(u,"$this");h.setBindingContext(a,"$condition");if(h.getMetadata().hasProperty("value")&&(this._bUpdateType||!h.getBindingInfo("value"))){o=Q.call(this,e.operator,0);h.bindProperty("value",{path:"$this>",type:o})}i++;p=r[i];if(p.hasOwnProperty("_iValueIndex")&&p._iValueIndex===1){if(e.values.length>1){u=this._oManagedObjectModel.getContext(a.getPath()+"values/1/");p.setBindingContext(u,"$this");if(p.getMetadata().hasProperty("value")&&(this._bUpdateType||!p.getBindingInfo("value"))){o=Q.call(this,e.operator,1);p.bindProperty("value",{path:"$this>",type:o})}i++}else{p.destroy()}}else if(e.values.length>1){p=J.call(this,e,1,s+"-values1",a);if(p){t.insertContent(p,i);i++}}}else{h.destroy();h=undefined;p=r[i+1];if(p&&p.hasOwnProperty("_iValueIndex")&&p._iValueIndex===1){p.destroy()}}}else if(e.values.length>0){for(var v=0;v<e.values.length;v++){var g=J.call(this,e,v,s+"-values"+v,a);if(g){t.insertContent(g,i);i++}}}r=t.getContent();var f=r[i];f.setBindingContext(a,"$this");i++;return i}function Oe(e){if(this._bPendingChange){this._bPendingValidateCondition=true;return}var t=e.getSource();while(!(t.getParent()instanceof x)){t=t.getParent()}_e.call(this,t)}function _e(e){var t=e.getParent();var i=t.indexOfContent(e);var a;if(e.getId().endsWith("-operator")){a=e.getBindingContext("$this");i=i+2;e=t.getContent()[i]}else if(e.getId().endsWith("-removeBtnSmall")){a=e.getBindingContext("$this");i=i+1;e=t.getContent()[i]}else{a=e.getBindingContext("$condition")}var n;var r=a.getObject();var o=s.getOperator(r.operator);var l=!!r.invalid;if(!l&&o.valueTypes.length>0&&o.valueTypes[0]!==p.Static){if(o.valueTypes.length>1&&o.valueTypes[1]){if(e.hasOwnProperty("_iValueIndex")&&e._iValueIndex===0){n=t.getContent()[i+1]}else if(e.hasOwnProperty("_iValueIndex")&&e._iValueIndex===1){n=t.getContent()[i-1]}}if(e.getMetadata().getAllProperties().valueState&&!e.isInvalidInput()&&(!n||!n.isInvalidInput())){var d=e.getBinding("value").getType();try{o.validate(r.values,d);e.setValueState(H.None);e.setValueStateText();if(n&&n.getMetadata().getAllProperties().valueState){n.setValueState(H.None);n.setValueStateText()}}catch(t){l=true;e.setValueState(H.Error);e.setValueStateText(t.message);if(n&&n.getMetadata().getAllProperties().valueState){n.setValueState(H.Error);n.setValueStateText(t.message)}}}}Te.call(this,l);this.fireConditionProcessed()}function Te(e){var t=0;if(e!==true){var i=this.getConditions();for(t=0;t<i.length;t++){if(i[t].invalid){e=true;break}}}if(e!==true){var a=this.byId("conditions");var n=a.getContent();e=false;for(t=0;t<n.length;t++){var s=n[t];if(s.hasOwnProperty("_iValueIndex")&&s.getValueState&&s.getValueState()===H.Error){e=true;break}}}this.setProperty("inputOK",!e,true)}function xe(){return this.getConditions().filter(function(e){var t=s.getOperator(e.operator);return e.validated!==h.Validated||t.exclude})}function Se(e){this._iStartIndex=this._iStartIndex+this._iShownConditions;this._iShownAdditionalConditions=0;he.call(this)}function Pe(e){this._iStartIndex=this._iStartIndex-this._iShownConditions;if(this._iStartIndex<0){this._iStartIndex=0}this._iShownAdditionalConditions=0;he.call(this)}function we(e){var t=this.getConditions().filter(function(e){var t=s.getOperator(e.operator);return e.validated===h.Validated&&!t.exclude});this.addDummyCondition(t.length+1);this._iStartIndex=0;this._iShownAdditionalConditions=0;this.setProperty("conditions",t,true);this.oInvisibleMessage.announce(F.getText("valuehelp.DEFINECONDITIONS_REMOVECONDITION_ANNOUNCE"),U.Polite);this.fireConditionProcessed()}function De(e){var t=this.getConditions();var i=this.getFormatOptions();var a=i.maxConditions;var n=this.byId("conditions");var s=n.getContent();var r=0;var o=-1;for(var l=0;l<s.length;l++){var d=s[l];if(d instanceof v&&d.getValueHelp()===this._sOperatorHelpId){r++;if(r===1){var u=d.getBindingContext("$this");var h=u.getPath();var p=h.match(/^.*\/(\d+)\/$/);if(p){o=parseInt(p[1])}}}}if(a===-1||t.length<a){this.addDummyCondition(o);if(r>=this._iShownConditions){this._iShownAdditionalConditions++}}this.oInvisibleMessage.announce(F.getText("valuehelp.DEFINECONDITIONS_ADDCONDITION_ANNOUNCE"),U.Polite)}function Ve(){var e=xe.call(this);var t=Math.ceil((e.length-this._iShownAdditionalConditions)/this._iShownConditions);var i=Math.floor(this._iStartIndex/this._iShownConditions)+1;var a=F.getText("valuehelp.PAGE_COUNT",[i,t]);return a}return K});
//# sourceMappingURL=DefineConditionPanel.js.map