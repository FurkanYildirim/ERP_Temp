/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/base/Log","sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/mdc/flexibility/Util","sap/ui/fl/changeHandler/condenser/Classification","sap/ui/mdc/util/mapVersions"],function(e,n,t,i,r,o){"use strict";var a=function(e,n){var t=function(n){if(e._pQueue===n){delete e._pQueue}};e._pQueue=e._pQueue instanceof Promise?e._pQueue.then(n):n();e._pQueue.then(t.bind(null,e._pQueue));return e._pQueue};var u=function(e){return new Promise(function(n,t){sap.ui.require([e],n,t)}).then(function(e){o(e);return e})};var f=function(r,f,d,c){var l=c===i.REVERT;var s=l?r.getRevertData():r.getContent();var g,v=null,p=d.modifier;return a(f,function(){return p.getProperty(f,"filterConditions").then(function(i){g=e({},i);if(g){for(var a in g){if(a===s.name){v=g[a];break}}}if(!v){g[s.name]=[];v=g[s.name]}if(!l){r.setRevertData({name:s.name,condition:s.condition})}var c=t.indexOfCondition(s.condition,v);if(c<0){v.push(s.condition);p.setProperty(f,"filterConditions",g);return p.getProperty(f,"delegate").then(function(e){return u(e.name)}).then(function(e){var t=e&&(e.getFilterDelegate?o(e.getFilterDelegate()).addCondition:e.addCondition);if(t){return t(f,s.name,d).catch(function(e){n.error("Error during Delegate.addCondition call: "+e)})}}).finally(function(){if(l){r.resetRevertData()}})}})})};var d=function(r,f,d,c){var l=c===i.REVERT;var s=l?r.getRevertData():r.getContent();var g,v,p=-1,m=d.modifier;return a(f,function(){return m.getProperty(f,"filterConditions").then(function(i){g=e({},i);if(g){for(var a in g){if(a===s.name){v=g[a];break}}}if(!l){r.setRevertData({name:s.name,condition:s.condition})}if(v&&v.length>0){p=t.indexOfCondition(s.condition,v);if(p>=0){v.splice(p,1);m.setProperty(f,"filterConditions",g);return m.getProperty(f,"delegate").then(function(e){return u(e.name)}).then(function(e){var t=e&&(e.getFilterDelegate?o(e.getFilterDelegate()).removeCondition:e.removeCondition);if(t){return t(f,s.name,d).catch(function(e){n.error("Error during Delegate.removeCondition call: "+e)})}}).finally(function(){if(l){r.resetRevertData()}})}}})})};var c=function(e,n){var t=e.getContent();return{classification:r.Reverse,affectedControl:e.getSelector(),uniqueKey:t.name+"_"+JSON.stringify(t.condition)}};var l={};l.addCondition=i.createChangeHandler({apply:f,revert:d,getCondenserInfo:c});l.removeCondition=i.createChangeHandler({apply:d,revert:f,getCondenserInfo:c});return l});
//# sourceMappingURL=ConditionFlex.js.map