/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/p13n/Engine","sap/ui/mdc/flexibility/Util","sap/ui/fl/changeHandler/Base","sap/ui/fl/changeHandler/condenser/Classification"],function(e,t,n,r){"use strict";var o=function(e,t,n,r){if(r){e.resetRevertData()}else{e.setRevertData(n)}};var a=function(e,n,r,a){return new Promise(function(i,s){var c=a===t.REVERT;var g=r.modifier;var d=c?e.getRevertData():e.getContent();Promise.resolve().then(g.getProperty.bind(g,n,"sortConditions")).then(function(t){var r=t?t.sorters:[];var a={name:d.key||d.name,descending:d.descending};r.splice(d.index,0,a);t={sorters:r};g.setProperty(n,"sortConditions",t);o(e,n,a,c);i()}).catch(function(e){s(e)})})};var i=function(e,r,a,i){return new Promise(function(s,c){var g=a.modifier;var d=i===t.REVERT;var f=d?e.getRevertData():e.getContent();Promise.resolve().then(g.getProperty.bind(g,r,"sortConditions")).then(function(t){var a=t?t.sorters:[];if(!a){c()}var i=a.filter(function(e){return e.name===f.name});var u=a.indexOf(i[0]);if(u>-1){a.splice(u,1)}else{return n.markAsNotApplicable("The specified change is already existing - change appliance ignored",true)}t={sorters:a};g.setProperty(r,"sortConditions",t);o(e,r,f,d);s()}).catch(function(e){c(e)})})};var s=function(e,n,r,a){return new Promise(function(i,s){var c=a===t.REVERT;var g=r.modifier;var d=c?e.getRevertData():e.getContent();Promise.resolve().then(g.getProperty.bind(g,n,"sortConditions")).then(function(t){var r=t?t.sorters:[];var a=r.filter(function(e){return e.name===d.name});var s=r.indexOf(a[0]);r.splice(d.index,0,r.splice(s,1)[0]);t={sorters:r};g.setProperty(n,"sortConditions",t);o(e,n,d,c);i()}).catch(function(e){s(e)})})};var c={};c.addSort=t.createChangeHandler({apply:a,revert:i,getCondenserInfo:function(e,t){return{affectedControl:{id:e.getContent().name},affectedControlIdProperty:"name",targetContainer:e.getSelector(),targetAggregation:"sorters",customAggregation:t.modifier.bySelector(e.getSelector(),t.appComponent).getSortConditions().sorters,classification:r.Create,setTargetIndex:function(e,t){e.getContent().index=t},getTargetIndex:function(e){return e.getContent().index}}}});c.removeSort=t.createChangeHandler({apply:i,revert:a,getCondenserInfo:function(e,t){return{affectedControl:{id:e.getContent().name},affectedControlIdProperty:"name",targetContainer:e.getSelector(),targetAggregation:"sorters",customAggregation:t.modifier.bySelector(e.getSelector(),t.appComponent).getSortConditions().sorters,classification:r.Destroy,sourceIndex:e.getRevertData().index,setIndexInRevertData:function(e,t){var n=e.getRevertData();n.index=t;e.setRevertData(n)}}}});c.moveSort=t.createChangeHandler({apply:s,revert:s,getCondenserInfo:function(e,t){return{affectedControl:{id:e.getContent().name},affectedControlIdProperty:"name",targetContainer:e.getSelector(),targetAggregation:"sorters",classification:r.Move,sourceIndex:e.getRevertData().index,customAggregation:t.modifier.bySelector(e.getSelector(),t.appComponent).getSortConditions().sorters,sourceContainer:e.getSelector(),sourceAggregation:"sorters",setTargetIndex:function(e,t){e.getContent().index=t},getTargetIndex:function(e){return e.getContent().index},setIndexInRevertData:function(e,t){var n=e.getRevertData();n.index=t;e.setRevertData(n)}}}});return c});
//# sourceMappingURL=SortFlex.js.map