/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./Control","./ActionToolbar","./table/TableSettings","./table/GridTableType","./table/TreeTableType","./table/ResponsiveTableType","./table/PropertyHelper","./table/utils/Personalization","./mixin/FilterIntegrationMixin","sap/m/Text","sap/m/ToolbarSpacer","sap/m/Button","sap/m/Title","sap/m/OverflowToolbar","sap/m/library","sap/m/table/Util","sap/m/table/columnmenu/Menu","sap/m/MessageBox","sap/ui/core/Core","sap/ui/core/format/NumberFormat","sap/ui/core/Item","sap/ui/core/format/ListFormat","sap/ui/core/library","sap/ui/events/KeyCodes","sap/ui/model/Sorter","sap/ui/model/base/ManagedObjectModel","sap/base/strings/capitalize","sap/base/util/deepEqual","sap/base/util/Deferred","sap/base/util/UriParameters","sap/ui/core/InvisibleMessage","sap/ui/core/InvisibleText","sap/ui/mdc/p13n/subcontroller/ColumnController","sap/ui/mdc/p13n/subcontroller/SortController","sap/ui/mdc/p13n/subcontroller/FilterController","sap/ui/mdc/p13n/subcontroller/GroupController","sap/ui/mdc/p13n/subcontroller/AggregateController","sap/ui/mdc/p13n/subcontroller/ColumnWidthController","sap/ui/mdc/actiontoolbar/ActionToolbarAction","sap/ui/mdc/table/menu/QuickActionContainer","sap/ui/mdc/table/menu/ItemContainer","sap/ui/mdc/enums/ProcessingStrategy","sap/ui/core/theming/Parameters","sap/base/Log","sap/ui/performance/trace/FESRHelper","sap/ui/mdc/enums/TableMultiSelectMode","sap/ui/mdc/enums/TableSelectionMode","sap/ui/mdc/enums/TableP13nMode","sap/ui/mdc/enums/TableType","sap/ui/mdc/enums/TableGrowingMode","sap/ui/mdc/enums/TableRowAction","sap/ui/mdc/enums/TableRowCountMode"],function(t,e,i,o,n,r,s,a,l,u,p,h,d,g,c,f,_,b,y,m,T,C,v,E,B,I,P,x,A,S,w,D,R,M,F,z,H,L,N,O,V,k,j,G,U,K,W,q,Q){"use strict";var X=c.ToolbarDesign;var $=c.ToolbarStyle;var Y=c.IllustratedMessageType;var J=v.TitleLevel;var Z=v.SortOrder;var tt=new window.WeakMap;var et=function(t){if(!tt.has(t)){tt.set(t,{oFilterInfoBar:null})}return tt.get(t)};var it={Table:o,TreeTable:n,ResponsiveTable:r,null:o};var ot=t.extend("sap.ui.mdc.Table",{metadata:{library:"sap.ui.mdc",designtime:"sap/ui/mdc/designtime/table/Table.designtime",interfaces:["sap.ui.mdc.IFilterSource","sap.ui.mdc.IxState"],defaultAggregation:"columns",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null,invalidate:true},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null,invalidate:true},p13nMode:{type:"sap.ui.mdc.enums.TableP13nMode[]",defaultValue:[]},delegate:{type:"object",defaultValue:{name:"sap/ui/mdc/TableDelegate",payload:{}}},headerLevel:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:J.Auto},autoBindOnInit:{type:"boolean",group:"Misc",defaultValue:true},header:{type:"string",group:"Misc",defaultValue:null},headerVisible:{type:"boolean",group:"Misc",defaultValue:true},useColumnLabelsAsTooltips:{type:"boolean",group:"Misc",defaultValue:false},selectionMode:{type:"sap.ui.mdc.enums.TableSelectionMode",defaultValue:W.None},showRowCount:{type:"boolean",group:"Misc",defaultValue:true},threshold:{type:"int",group:"Appearance",defaultValue:-1},sortConditions:{type:"object"},filterConditions:{type:"object",defaultValue:{}},groupConditions:{type:"object"},aggregateConditions:{type:"object"},enableExport:{type:"boolean",defaultValue:false},busyIndicatorDelay:{type:"int",defaultValue:100},enableColumnResize:{type:"boolean",group:"Behavior",defaultValue:true},showPasteButton:{type:"boolean",group:"Behavior",defaultValue:false},enablePaste:{type:"boolean",group:"Behavior",defaultValue:true},multiSelectMode:{type:"sap.ui.mdc.enums.TableMultiSelectMode",group:"Behavior",defaultValue:K.Default},enableAutoColumnWidth:{type:"boolean",group:"Behavior",defaultValue:false},propertyInfo:{type:"object[]",defaultValue:[]}},aggregations:{_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},type:{type:"sap.ui.mdc.table.TableTypeBase",altTypes:["sap.ui.mdc.enums.TableType"],multiple:false},columns:{type:"sap.ui.mdc.table.Column",multiple:true},creationRow:{type:"sap.ui.mdc.table.CreationRow",multiple:false},actions:{type:"sap.ui.core.Control",multiple:true,forwarding:{getter:"_createToolbar",aggregation:"actions"}},variant:{type:"sap.ui.fl.variants.VariantManagement",multiple:false},quickFilter:{type:"sap.ui.core.Control",multiple:false},rowSettings:{type:"sap.ui.mdc.table.RowSettings",multiple:false},dataStateIndicator:{type:"sap.m.plugins.DataStateIndicator",multiple:false},noData:{type:"sap.ui.core.Control",multiple:false,altTypes:["string"]},copyProvider:{type:"sap.m.plugins.CopyProvider",multiple:false}},associations:{filter:{type:"sap.ui.mdc.IFilter",multiple:false}},events:{rowPress:{parameters:{bindingContext:{type:"sap.ui.model.Context"}}},selectionChange:{parameters:{selectAll:{type:"boolean"}}},beforeExport:{parameters:{exportSettings:{type:"object"},userExportSettings:{type:"object"},filterSettings:{type:"object[]"}}},paste:{parameters:{data:{type:"string[][]"}}}}},constructor:function(){this._oTableReady=new A;this._oFullInitialize=new A;t.apply(this,arguments);this.bCreated=true;this._updateAdaptation();this._initializeContent()},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.class("sapUiMdcTable");t.style("height","100%");t.style("width",e.getWidth());t.openEnd();t.renderControl(e.getAggregation("_content"));t.close("div")}}});var nt=["variant","quickFilter"];l.call(ot.prototype);nt.forEach(function(t){var e=P(t),i="_o"+e,o="get"+e,n="set"+e,r="destroy"+e;ot.prototype[o]=function(){return this[i]};ot.prototype[r]=function(){var t=this[i];this[n]();if(t){t.destroy()}return this};ot.prototype[n]=function(e){this.validateAggregation(t,e,false);var n=this._createToolbar(),r=e!==this[i];if(!e||r){n.removeBetween(this[o]());this[i]=e}if(r&&e){this._setToolbarBetween(n)}return this}});ot.prototype.init=function(){t.prototype.init.apply(this,arguments);this.mSkipPropagation={rowSettings:true};this._bForceRebind=true;this._setPropertyHelperClass(s);this._setupPropertyInfoStore("propertyInfo");this._oManagedObjectModel=new I(this);this.setModel(this._oManagedObjectModel,"$sap.ui.mdc.Table")};ot.prototype.applySettings=function(e,i){if(e&&"type"in e){var o={type:e.type};if("delegate"in e){o.delegate=e.delegate;delete e.delegate}delete e.type;t.prototype.applySettings.call(this,o,i)}t.prototype.applySettings.call(this,e,i);this.initControlDelegate()};ot.prototype._setToolbarBetween=function(t){[this._oVariant,this._oQuickFilter].forEach(function(e){if(e){t.addBetween(e)}})};ot.prototype.initialized=function(){return this._oTableReady.promise};ot.prototype._fullyInitialized=function(){return this._oFullInitialize.promise};ot.prototype.getDataStateIndicatorPluginOwner=function(t){return this._oTable||this._oFullInitialize.promise};ot.prototype.getCopyProviderPluginOwner=function(){return this._oTable||this._oFullInitialize.promise};ot.prototype.setCopyProvider=function(t){this.setAggregation("copyProvider",t,true);if(t&&this._oToolbar&&!y.byId(this.getId()+"-copy")){this._oToolbar.insertEnd(this._getCopyButton(),0)}return this};ot.prototype.getColumnClipboardSettings=function(t){return this.getPropertyHelper().getColumnClipboardSettings(t)};ot.prototype.setDataStateIndicator=function(t){this._handleDataStateEvents(this.getDataStateIndicator(),"detach");this.setAggregation("dataStateIndicator",t,true);this._handleDataStateEvents(this.getDataStateIndicator(),"attach");return this};ot.prototype._handleDataStateEvents=function(t,e){if(t){t[e+"ApplyFilter"](this._onApplyMessageFilter,this);t[e+"ClearFilter"](this._onClearMessageFilter,this);t[e+"Event"]("filterInfoPress",function(){a.openFilterDialog(this)},this)}};ot.prototype._onApplyMessageFilter=function(t){this._oMessageFilter=t.getParameter("filter");t.preventDefault();if(this.isTableBound()){this.rebind()}};ot.prototype._onClearMessageFilter=function(t){this._oMessageFilter=null;t.preventDefault();if(this.isTableBound()){this.rebind()}};ot.prototype._isOfType=function(t,e){var i=this._getType();if(e){return i.isA(it[t].getMetadata().getName())}else{return i.constructor===it[t]}};ot.prototype.scrollToIndex=function(t){if(typeof t!=="number"){return Promise.reject("The iIndex parameter has to be a number")}return this._getType().scrollToIndex(t)};ot.prototype.focusRow=function(t,e){return this.scrollToIndex(t).then(function(){return this._oTable._setFocus(t,e)}.bind(this))};ot.prototype.setType=function(t){if(!this.bCreated||this.getType()==t){return this.setAggregation("type",t,true)}if(this._oToolbar){this._getType().removeToolbar()}this._destroyDefaultType();this.setAggregation("type",t,true);if(this._oTable){var e=this.getNoData();this.setNoData();this._vNoData=e;this._oTable.destroy("KeepDom");this._oTable=null;this._bTableExists=false}else{this._onAfterTableCreated();this._onAfterFullInitialization()}if(this._oRowTemplate){this._oRowTemplate.destroy();this._oRowTemplate=null}this._oTableReady=new A;this._oFullInitialize=new A;this._bFullyInitialized=false;this._initializeContent();return this};ot.prototype._getType=function(){var t=this.getType();if(!this._oDefaultType&&(typeof t==="string"||t===null)){this._oDefaultType=new it[t];this.addDependent(this._oDefaultType)}return this._oDefaultType||this.getType()};ot.prototype._destroyDefaultType=function(){if(this._oDefaultType){this._oDefaultType.destroy();delete this._oDefaultType}};ot.prototype.setRowSettings=function(t){this.setAggregation("rowSettings",t,true);this._getType().updateRowSettings();if(this.isTableBound()){this._bForceRebind=true;this.rebind()}return this};ot.prototype.setHeaderLevel=function(t){if(this.getHeaderLevel()===t){return this}this.setProperty("headerLevel",t,true);this._oTitle&&this._oTitle.setLevel(t);return this};ot.prototype.focus=function(t){if(this._oTable){this._oTable.focus(t)}};ot.prototype.setBusy=function(t){this.setProperty("busy",t,true);if(this._oTable){this._oTable.setBusy(t)}return this};ot.prototype.setBusyIndicatorDelay=function(t){this.setProperty("busyIndicatorDelay",t,true);if(this._oTable){this._oTable.setBusyIndicatorDelay(t)}return this};ot.prototype.setCreationRow=function(t){this.setAggregation("creationRow",t,true);if(t){t.update()}return this};ot.prototype.setEnableColumnResize=function(t){var e=this.getEnableColumnResize();this.setProperty("enableColumnResize",t,true);if(this.getEnableColumnResize()!==e){this._updateColumnResize();this._updateAdaptation()}return this};var rt=function(t){var e=false;if(t&&(t.indexOf("Sort")>-1||t.indexOf("Column")>-1||t.indexOf("Group")>-1||t.indexOf("Aggregate")>-1||t.indexOf("Filter")>-1)){e=true}return e};ot.prototype._onModifications=function(t){if(rt(t)&&this.isTableBound()){this.rebind()}if(!this.isPropertyHelperFinal()){this._bFinalzingPropertiesOnModification=true;this.finalizePropertyHelper().then(function(){delete this._bFinalzingPropertiesOnModification}.bind(this))}this.getColumns().forEach(function(t){t._onModifications()})};ot.prototype.setP13nMode=function(t){var e=this.getP13nMode();var i=[];if(t&&t.length>1){var o=t.reduce(function(t,e,i){t[e]=true;return t},{});if(o.Column){i.push("Column")}if(o.Sort){i.push("Sort")}if(o.Filter){i.push("Filter")}if(o.Group){i.push("Group")}if(o.Aggregate){i.push("Aggregate")}}else{i=t}this.setProperty("p13nMode",i,true);this._updateAdaptation();if(!x(e.sort(),this.getP13nMode().sort())){st(this)}return this};ot.prototype._updateAdaptation=function(){var t={controller:{}};var e=[];if(this.getColumns().length>0&&this._isOfType(Q.TreeTable)){e.push(this.getColumns()[0].getPropertyKey())}var i={Column:new R({control:this,stableKeys:e}),Sort:new M({control:this}),Group:new z({control:this}),Filter:new F({control:this}),Aggregate:new H({control:this}),ColumnWidth:new L({control:this})};this.getActiveP13nModes().forEach(function(e){t.controller[e]=i[e]});if(this.getEnableColumnResize()){t.controller["ColumnWidth"]=i["ColumnWidth"]}this.getEngine().register(this,t)};function st(t){t._updateP13nButton();if(t._oTable){var e=t._oTable.getDragDropConfig()[0];if(e){e.setEnabled(t.getActiveP13nModes().indexOf("Column")>-1)}}if(t.isFilteringEnabled()){lt(t)}at(t)}ot.prototype.setFilterConditions=function(t){this.setProperty("filterConditions",t,true);var e=this.getInbuiltFilter();if(e){e.setFilterConditions(t)}at(this);return this};function at(t){var e=ht(t);var i=dt(t);var o=gt(t);if(!e){return}if(o.length===0){var n=e.getDomRef();if(n&&n.contains(document.activeElement)){t.focus()}e.setVisible(false);ut(t).setText("");return}t._fullyInitialized().then(function(){var n=t.getPropertyHelper();var r=o.map(function(t){return n.hasProperty(t)?n.getProperty(t).label:""});var s=y.getLibraryResourceBundle("sap.ui.mdc");var a=C.getInstance();var l;if(r.length>1){l=s.getText("table.MULTIPLE_FILTERS_ACTIVE",[r.length,a.format(r)])}else{l=s.getText("table.ONE_FILTER_ACTIVE",r[0])}if(!e.getVisible()){e.setVisible(true)}i.setText(l);ut(t).setText(l)})}function lt(t){if(!t._oTable){return}var e=ht(t);var i=ut(t);if(!e){e=pt(t)}t._getType().insertFilterInfoBar(e,i.getId())}function ut(t){if(!t._oFilterInfoBarInvisibleText){t._oFilterInfoBarInvisibleText=(new D).toStatic()}return t._oFilterInfoBarInvisibleText}function pt(t){var e=t.getId()+"-filterInfoBar";var i=et(t).oFilterInfoBar;var o=y.getLibraryResourceBundle("sap.ui.mdc");if(i&&!i.bIsDestroyed){i.destroy()}i=new g({id:e,active:true,design:X.Info,visible:false,content:[new u({id:e+"-text",wrapping:false}),new p,new h({type:c.ButtonType.Transparent,tooltip:o.getText("infobar.REMOVEALLFILTERS"),icon:"sap-icon://decline",press:function(){a.createFilterChange(t,{conditions:[],strategy:k.FullReplace});t.focus()}})],press:function(){a.openFilterDialog(t,function(){if(gt(t).length===0){t.focus()}})}});et(t).oFilterInfoBar=i;at(t);return i}function ht(t){var e=et(t).oFilterInfoBar;if(e&&(e.bIsDestroyed||e.bIsBeingDestroyed)){return null}return et(t).oFilterInfoBar}function dt(t){var e=ht(t);return e?e.getContent()[0]:null}ot.prototype.setThreshold=function(t){this.setProperty("threshold",t,true);if(!this._oTable){return this}t=this.getThreshold()>-1?this.getThreshold():undefined;if(this._isOfType(Q.ResponsiveTable)){this._oTable.setGrowingThreshold(t)}else{this._oTable.setThreshold(t)}return this};ot.prototype._onFilterProvided=function(t){this._updateInnerTableNoData()};ot.prototype._onFilterRemoved=function(t){this._updateInnerTableNoData()};ot.prototype._onFiltersChanged=function(t){if(this.isTableBound()&&t.getParameter("conditionsBased")){this._oTable.setShowOverlay(true)}};ot.prototype._onFilterSearch=function(t){this._bAnnounceTableUpdate=true};ot.prototype.setNoData=function(t){this._vNoData=this.validateAggregation("noData",t,false);if(!this._oTable){return this}if(t&&t.isA&&t.isA("sap.m.IllustratedMessage")){this._sLastNoDataTitle="";t.setEnableVerticalResponsiveness(!this._isOfType(Q.ResponsiveTable));var e=this._oTable.getAggregation("_noColumnsMessage");if(!e){e=f.getNoColumnsIllustratedMessage(function(){a.openSettingsDialog(this)}.bind(this));e.setEnableVerticalResponsiveness(!this._isOfType(Q.ResponsiveTable));this._oTable.setAggregation("_noColumnsMessage",e)}}this._oTable.setNoData(t);this._updateInnerTableNoData();return this};ot.prototype.getNoData=function(){return this._vNoData&&!this._vNoData.bIsDestroyed?this._vNoData:null};ot.prototype.destroyNoData=function(){if(this._oTable){this._oTable.destroyNoData(true);this._vNoData=null}return this};ot.prototype._updateInnerTableNoData=function(){var t=this.getNoData();if(!t||typeof t=="string"){return this._updateInnerTableNoDataText()}if(!t.isA("sap.m.IllustratedMessage")||this._sLastNoDataTitle!=t.getTitle()){return}var e=y.getLibraryResourceBundle("sap.ui.mdc");if(!this.isTableBound()){t.setDescription(" ");if(this.getFilter()){t.setTitle(e.getText("table.NO_DATA_WITH_FILTERBAR"));t.setIllustrationType(Y.SearchEarth)}else{t.setIllustrationType(Y.EmptyList);t.setTitle(e.getText("table.NO_DATA"))}}else if(ft(this)){t.setTitle(e.getText("table.NO_RESULTS_TITLE"));t.setDescription(e.getText("table.NO_RESULTS_DESCRIPTION"));t.setIllustrationType(Y.NoFilterResults)}else{t.setTitle(e.getText("table.NO_DATA")).setDescription(" ");t.setIllustrationType(Y.NoEntries)}this._sLastNoDataTitle=t.getTitle()};ot.prototype._updateInnerTableNoDataText=function(){if(this._oTable){this._oTable.setNoData(this._getNoDataText())}};ot.prototype._getNoDataText=function(){var t=this.getNoData();if(t&&typeof t=="string"){return t}var e=y.getLibraryResourceBundle("sap.ui.mdc");if(!this.isTableBound()){return e.getText(this.getFilter()?"table.NO_DATA_WITH_FILTERBAR":"table.NO_DATA")}if(ft(this)){return e.getText("table.NO_RESULTS")}return e.getText("table.NO_DATA")};ot.prototype._updateRowActions=function(){this._getType().updateRowActions()};ot.prototype._initializeContent=function(){var t=this._getType();var e=[this.awaitControlDelegate(),t.loadModules()];if(this.isFilteringEnabled()){e.push(this.retrieveInbuiltFilter())}Promise.all(e).then(function(){if(this.bIsDestroyed){return}this._updateAdaptation();var e=this.getControlDelegate();if(e.preInit){e.preInit(this)}if(!this._bTableExists&&t.constructor===this._getType().constructor){this._createContent();this._bTableExists=true}}.bind(this)).catch(function(t){this._onAfterTableCreated();throw t}.bind(this))};ot.prototype._onAfterTableCreated=function(t){if(this._oTableReady){this._oTableReady[t?"resolve":"reject"](this)}};ot.prototype._onAfterFullInitialization=function(t){if(this._oFullInitialize){this._oFullInitialize[t?"resolve":"reject"](this)}};ot.prototype._createContent=function(){this._createToolbar();this._createTable();this._updateColumnResize();this._updateRowActions();this._updateExpandAllButton();this._updateCollapseAllButton();this._updateExportButton();this.getColumns().forEach(this._insertInnerColumn,this);this.getControlDelegate().initializeContent(this).then(function(){this.setAggregation("_content",this._oTable);this._onAfterTableCreated(true);return Promise.all([this.getPropertyInfo().length===0?this.finalizePropertyHelper():this.awaitPropertyHelper(),this.initialized()])}.bind(this)).then(function(){var t=this.getCreationRow();if(t){t.update()}if(this.getAutoBindOnInit()){var e=this.getEngine();e.isModificationSupported(this).then(function(t){if(t){e.waitForChanges(this).then(function(){this.rebind()}.bind(this))}else{this.rebind()}}.bind(this))}this._bFullyInitialized=true;this._onAfterFullInitialization(true)}.bind(this)).catch(function(t){this._onAfterFullInitialization();throw t}.bind(this))};ot.prototype.setHeader=function(t){this.setProperty("header",t,true);this._updateHeaderText();return this};ot.prototype.setHeaderVisible=function(t){this.setProperty("headerVisible",t,true);if(this._oTitle){this._oTitle.setWidth(this.getHeaderVisible()?undefined:"0px")}return this};ot.prototype.setShowRowCount=function(t){this.setProperty("showRowCount",t,true);this._updateHeaderText();return this};ot.prototype.setEnableExport=function(t){this.setProperty("enableExport",t,true);this._updateExportButton();return this};ot.prototype.setShowPasteButton=function(t){if((t=!!t)==this.getShowPasteButton()){return this}this.setProperty("showPasteButton",t,true);if(t&&!this._oPasteButton&&this._oToolbar){this._oToolbar.insertEnd(this._getPasteButton(),0);this._oPasteButton.setEnabled(this.getEnablePaste())}else if(this._oPasteButton){this._oPasteButton.setVisible(t);this._oPasteButton.setEnabled(this.getEnablePaste())}return this};ot.prototype.setEnablePaste=function(t){this.setProperty("enablePaste",t,true);if(this._oPasteButton){this._oPasteButton.setEnabled(this.getEnablePaste())}return this};ot.prototype._setShowP13nButton=function(t){this._bHideP13nButton=!t;this._updateP13nButton()};ot.prototype._isP13nButtonHidden=function(){return this._bHideP13nButton};ot.prototype._createToolbar=function(){if(this.isDestroyStarted()||this.isDestroyed()){return}if(!this._oToolbar){this._oTitle=new d(this.getId()+"-title",{text:this.getHeader(),width:this.getHeaderVisible()?undefined:"0px",level:this.getHeaderLevel(),titleStyle:J.H4});this._oToolbar=new e(this.getId()+"-toolbar",{design:X.Transparent,begin:[this._oTitle],end:[this._getCopyButton(),this._getPasteButton(),this._getP13nButton()]})}this._oToolbar.setStyle(this._isOfType(Q.ResponsiveTable)?$.Standard:$.Clear);return this._oToolbar};ot.prototype._getVisibleProperties=function(){var t=[],e;this.getColumns().forEach(function(i,o){e=i&&i.getPropertyKey();if(e){t.push({name:e})}});return t};ot.prototype.getConditions=function(){return this.getInbuiltFilter()?this.getInbuiltFilter().getConditions():[]};ot.prototype._getSortedProperties=function(){return this.getSortConditions()?this.getSortConditions().sorters:[]};ot.prototype._getGroupedProperties=function(){return this.getGroupConditions()?this.getGroupConditions().groupLevels:[]};ot.prototype._getAggregatedProperties=function(){return this.getAggregateConditions()?this.getAggregateConditions():{}};ot.prototype._getXConfig=function(){return this.getEngine().readXConfig(this)};function gt(t){return t.isFilteringEnabled()?_t(t.getFilterConditions()):[]}function ct(t){var e=y.byId(t.getFilter());return e?_t(e.getConditions()):[]}function ft(t){var e=y.byId(t.getFilter());return gt(t).length>0||ct(t).length>0||e&&e.getSearch()!==""}function _t(t){return Object.keys(t||{}).filter(function(e){return t[e].length>0})}ot.prototype.getCurrentState=function(){var t={};var e=this.getActiveP13nModes();if(e.indexOf("Column")>-1){t.items=this._getVisibleProperties()}if(this.isSortingEnabled()){t.sorters=this._getSortedProperties()}if(this.isFilteringEnabled()){t.filter=this.getFilterConditions()}if(this.isGroupingEnabled()){t.groupLevels=this._getGroupedProperties()}if(this.isAggregationEnabled()){t.aggregations=this._getAggregatedProperties()}if(this.getEnableColumnResize()){t.xConfig=this._getXConfig()}return t};ot.prototype.isFilteringEnabled=function(){return this.getActiveP13nModes().includes(q.Filter)};ot.prototype.isSortingEnabled=function(){return this.getActiveP13nModes().includes(q.Sort)};ot.prototype.isGroupingEnabled=function(){return this.getActiveP13nModes().includes(q.Group)};ot.prototype.isAggregationEnabled=function(){return this.getActiveP13nModes().includes(q.Aggregate)};ot.prototype.getSupportedP13nModes=function(){var t=bt(Object.keys(q),this._getType().getSupportedP13nModes());if(this.isControlDelegateInitialized()){t=bt(t,this.getControlDelegate().getSupportedP13nModes(this))}return t};ot.prototype.getActiveP13nModes=function(){return bt(this.getP13nMode(),this.getSupportedP13nModes())};function bt(t,e){return t.filter(function(t){return e.includes(t)})}ot.prototype._getP13nButton=function(){if(!this._oP13nButton){this._oP13nButton=i.createSettingsButton(this.getId(),[function(){a.openSettingsDialog(this)},this])}this._updateP13nButton();return this._oP13nButton};ot.prototype._updateP13nButton=function(){if(this._oP13nButton){var t=this.getActiveP13nModes();var e=t.length===1&&t[0]==="Aggregate";this._oP13nButton.setVisible(t.length>0&&!e&&!this._bHideP13nButton)}};ot.prototype._getCopyButton=function(){var t=this.getCopyProvider();if(t){return t.getCopyButton({id:this.getId()+"-copy"})}};ot.prototype._getPasteButton=function(){if(this.getShowPasteButton()){if(!this._oPasteButton){this._oPasteButton=i.createPasteButton(this.getId())}return this._oPasteButton}};ot.prototype._isExportEnabled=function(){return this.getEnableExport()&&this.isControlDelegateInitialized()&&this.getControlDelegate().getSupportedFeatures(this).export};ot.prototype._updateExportButton=function(){var t=this._oToolbar!=null&&this._isExportEnabled();if(t&&!this._oExportButton){this._oExportButton=this._createExportButton()}if(!this._oExportButton){return}if(this._oToolbar&&!this._oToolbar.getEnd().includes(this._oExportButton)){this._oToolbar.addEnd(this._oExportButton)}this._oExportButton.setEnabled(!f.isEmpty(this.getRowBinding()));this._oExportButton.setVisible(this._isExportEnabled())};ot.prototype._createExportButton=function(){return i.createExportButton(this.getId(),{default:[function(){this._onExport()},this],exportAs:[function(){this._onExport(true)},this]})};ot.prototype._createExportColumnConfiguration=function(){var t=this.getColumns();return this._fullyInitialized().then(function(){return this.finalizePropertyHelper()}.bind(this)).then(function(){var e=this.getPropertyHelper();var i=[];t.forEach(function(t){var o=e.getColumnExportSettings(t);i=i.concat(o)},this);return i}.bind(this))};ot.prototype._isCollapseAllEnabled=function(){return this.isControlDelegateInitialized()&&this.getControlDelegate().getSupportedFeatures(this).collapseAll};ot.prototype._updateCollapseAllButton=function(){var t=this._oToolbar!=null&&this._isCollapseAllEnabled();if(t&&!this._oCollapseAllButton){this._oCollapseAllButton=i.createExpandCollapseAllButton(this.getId(),[function(){this.getControlDelegate().collapseAll(this)},this],false)}if(!this._oCollapseAllButton){return}if(this._oToolbar&&!this._oToolbar.getEnd().includes(this._oCollapseAllButton)){this._oToolbar.insertEnd(this._oCollapseAllButton,0)}this._oCollapseAllButton.setEnabled(!f.isEmpty(this.getRowBinding()));this._oCollapseAllButton.setVisible(this._isCollapseAllEnabled())};ot.prototype._isExpandAllEnabled=function(){return this.isControlDelegateInitialized()&&this.getControlDelegate().getSupportedFeatures(this).expandAll};ot.prototype._updateExpandAllButton=function(){var t=this._oToolbar!=null&&this._isExpandAllEnabled();if(t&&!this._oExpandAllButton){this._oExpandAllButton=i.createExpandCollapseAllButton(this.getId(),[function(){this.getControlDelegate().expandAll(this)},this],true)}if(!this._oExpandAllButton){return}if(this._oToolbar&&!this._oToolbar.getEnd().includes(this._oExpandAllButton)){this._oToolbar.insertEnd(this._oExpandAllButton,0)}this._oExpandAllButton.setEnabled(!f.isEmpty(this.getRowBinding()));this._oExpandAllButton.setVisible(this._isExpandAllEnabled())};ot.prototype._getColumnLabel=function(t){var e=this.getPropertyHelper();var i=e.getProperty(t);return i&&i.label};ot.prototype._onExport=function(t){var e=this;return this._createExportColumnConfiguration().then(function(i){var o,n,r,s;if(!i||!i.length){sap.ui.require(["sap/m/MessageBox"],function(t){t.error(y.getLibraryResourceBundle("sap.ui.mdc").getText("table.NO_COLS_EXPORT"),{styleClass:this.$()&&this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":""})}.bind(e));return}s=e.getRowBinding();n=e._getColumnLabel.bind(e);o=t?"exportAs":"export";r={workbook:{columns:i,context:{title:e.getHeader()}},dataSource:s,fileName:e.getHeader()};e._getExportHandler().then(function(t){t[o](r,n)})})};ot.prototype._getExportHandler=function(){var t=this;if(this._oExportHandler){return Promise.resolve(this._oExportHandler)}return new Promise(function(e,i){Promise.all([t._loadExportLibrary(),t.getControlDelegate().fetchExportCapabilities(t)]).then(function(i){var o=i[1];sap.ui.require(["sap/ui/export/ExportHandler"],function(i){t._oExportHandler=new i(o);t._oExportHandler.attachBeforeExport(t._onBeforeExport,t);e(t._oExportHandler)})}).catch(function(t){if(!sap.ui.getCore().getLoadedLibraries().hasOwnProperty("sap.ui.export")){b.error(y.getLibraryResourceBundle("sap.ui.mdc").getText("ERROR_MISSING_EXPORT_LIBRARY"))}i(t)})})};ot.prototype._onBeforeExport=function(t){var e=t.getParameter("filterSettings");var i=this.getPropertyHelper();e.forEach(function(t){var e=i.getProperties().find(function(e){return e.path===t.getProperty()});if(e){t.setLabel(e.label);t.setType(e.typeConfig.typeInstance)}});this.fireBeforeExport({exportSettings:t.getParameter("exportSettings"),userExportSettings:t.getParameter("userExportSettings"),filterSettings:e})};ot.prototype._loadExportLibrary=function(){if(!this._oExportLibLoadPromise){this._oExportLibLoadPromise=y.loadLibrary("sap.ui.export",true)}return this._oExportLibLoadPromise};ot.prototype.onkeydown=function(t){if(t.isMarked()){return}if((t.metaKey||t.ctrlKey)&&t.shiftKey&&t.which===E.E){if(this._oExportButton&&this._oExportButton.getEnabled()&&this._isExportEnabled()){this._onExport(true);t.setMarked();t.preventDefault()}}if((t.metaKey||t.ctrlKey)&&t.which===E.COMMA){if(this._oP13nButton&&this._oP13nButton.getVisible()){this._oP13nButton.firePress();t.setMarked();t.preventDefault()}}};ot.prototype._createTable=function(){var t=this._getType();this._oTable=t.createTable(this.getId()+"-innerTable");this._oRowTemplate=t.createRowTemplate(this.getId()+"-innerTableRow");t.updateTable();if(this.getNoData()){this.setNoData(this.getNoData())}if(this.isFilteringEnabled()){lt(this)}if(!this._oColumnHeaderMenu){this._oQuickActionContainer=new O({table:this});this._oItemContainer=new V({table:this});this._oColumnHeaderMenu=new _({id:this.getId()+"-columnHeaderMenu",_quickActions:[this._oQuickActionContainer],_items:[this._oItemContainer]});this.addDependent(this._oColumnHeaderMenu);U.setSemanticStepname(this._oColumnHeaderMenu,"beforeOpen","mdc:tbl:p13n:col");this._oColumnHeaderMenu.attachBeforeOpen(this._createColumnMenuContent,this)}};ot.prototype._createColumnMenuContent=function(t){var e=t.getParameter("openBy");var i=this.getColumns()[e.getParent().indexOfColumn(e)];t.preventDefault();this._oQuickActionContainer.setColumn(i);this._oItemContainer.setColumn(i);this._fullyInitialized().then(function(){return this.finalizePropertyHelper()}.bind(this)).then(function(){Promise.all([this._oQuickActionContainer.initializeQuickActions(),this._oItemContainer.initializeItems()]).then(function(){if(this._oQuickActionContainer.hasQuickActions()||this._oItemContainer.hasItems()){this._oColumnHeaderMenu.openBy(e,true);a.detectUserPersonalizationCompletion(this,this._oColumnHeaderMenu)}}.bind(this))}.bind(this))};ot.prototype._updateColumnResize=function(){var t=this._getType();if(this.getEnableColumnResize()){t.enableColumnResize()}else{t.disableColumnResize()}};ot.prototype._onColumnMove=function(t){a.createColumnReorderChange(this,{column:t.column,index:t.newIndex})};ot.prototype._onCustomSort=function(t,e){var i=t.getParameter("property");this.getCurrentState().sorters.forEach(function(t){if(t.name===i){if(t.descending&&e===Z.Descending||!t.descending&&e===Z.Ascending){e=Z.None}}});a.createSortChange(this,{property:i,sortOrder:e})};ot.prototype._onRowPress=function(t){if(this.getSelectionMode()!==W.SingleMaster){this.fireRowPress({bindingContext:t.bindingContext})}};ot.prototype._onSelectionChange=function(t){if(!this._bSelectionChangedByAPI){this.fireSelectionChange({selectAll:t.selectAll})}};ot.prototype._onColumnResize=function(t){a.createColumnWidthChange(this,{column:t.column,width:t.width})};ot.prototype._onCustomGroup=function(t){a.createGroupChange(this,{property:t})};ot.prototype._onCustomAggregate=function(t){a.createAggregateChange(this,{property:t})};ot.prototype._insertInnerColumn=function(t,e){if(!this._oTable){return}var i=t.getInnerColumn();this._setMobileColumnTemplate(t,e);this._bForceRebind=true;if(e===undefined){this._oTable.addColumn(i)}else{this._oTable.insertColumn(i,e)}this._getType()._onColumnInsert(t)};ot.prototype.moveColumn=function(t,e){t._bIsBeingMoved=true;this.removeAggregation("columns",t,true);this.insertAggregation("columns",t,e,true);delete t._bIsBeingMoved;if(this._oTable){var i=t.getInnerColumn();this._oTable.removeColumn(i);this._oTable.insertColumn(i,e);this._updateMobileColumnTemplate(t,e)}};ot.prototype.removeColumn=function(t){t=this.removeAggregation("columns",t,true);this._updateMobileColumnTemplate(t,-1);return t};ot.prototype.addColumn=function(t){this.addAggregation("columns",t,true);this._insertInnerColumn(t);return this};ot.prototype.insertColumn=function(t,e){this.insertAggregation("columns",t,e,true);this._insertInnerColumn(t,e);return this};ot.prototype._setMobileColumnTemplate=function(t,e){if(!this._oRowTemplate){return}var i=t.getTemplateClone();if(e>=0){this._oRowTemplate.insertCell(i,e);this._oTable.getItems().forEach(function(t){if(t.isA("sap.m.GroupHeaderListItem")){return}t.insertAggregation("cells",new D,e,true)})}else{this._oRowTemplate.addCell(i)}};ot.prototype._updateMobileColumnTemplate=function(t,e){if(!this._oRowTemplate){return}var i,o;if(this._oRowTemplate){i=t.getTemplateClone();o=this._oRowTemplate.indexOfCell(i);yt(this._oRowTemplate,o,e)}if(o>-1){this._oTable.getItems().forEach(function(t){if(t.removeCell){yt(t,o,e)}})}};function yt(t,e,i){var o=t.removeCell(e);if(o){if(i>-1){t.insertCell(o,i)}else{o.destroy()}}}ot.prototype.getSelectedContexts=function(){if(this.isControlDelegateInitialized()){return this.getControlDelegate().getSelectedContexts(this)}return[]};ot.prototype.clearSelection=function(){if(this.isControlDelegateInitialized()){this._bSelectionChangedByAPI=true;this.getControlDelegate().clearSelection(this);this._bSelectionChangedByAPI=false}};ot.prototype._registerInnerFilter=function(t){t.attachSearch(this._rebind,this)};ot.prototype.isTableBound=function(){return this._getType().isTableBound()};ot.prototype.bindRows=function(){if(!this.isControlDelegateInitialized()||!this._oTable){return}if(this._bFinalzingPropertiesOnModification){this.propertiesFinalized().then(function(){this.bindRows()}.bind(this));return}var t={};this.getControlDelegate().updateBindingInfo(this,t);if(!t.path){return}if(this._oRowTemplate){t.template=this._oRowTemplate}else{delete t.template}ot._addBindingListener(t,"dataRequested",this._onDataRequested.bind(this));ot._addBindingListener(t,"dataReceived",this._onDataReceived.bind(this));ot._addBindingListener(t,"change",this._onBindingChange.bind(this));this._oTable.setShowOverlay(false);this._updateColumnsBeforeBinding();this.getControlDelegate().updateBinding(this,t,this._bForceRebind?null:this.getRowBinding());this._updateInnerTableNoData();this._bForceRebind=false};ot.prototype._onDataRequested=function(){this._bIgnoreChange=true};ot.prototype._onDataReceived=function(){this._bIgnoreChange=false;this._updateTableHeaderState()};ot.prototype._onBindingChange=function(){this._updateExpandAllButton();this._updateCollapseAllButton();this._updateExportButton();if(this._bIgnoreChange){return}this._updateTableHeaderState()};ot.prototype._updateTableHeaderState=function(){this._updateHeaderText()};ot.prototype._updateHeaderText=function(){var t,e;if(!this._oNumberFormatInstance){this._oNumberFormatInstance=m.getFloatInstance()}if(this._oTitle&&this.getHeader()){t=this.getHeader();if(this.getShowRowCount()){e=this.getRowBinding()?this.getRowBinding().getCount():0;if(e>0){var i=this._oNumberFormatInstance.format(e);t+=" ("+i+")"}}this._oTitle.setText(t)}if(!this._bIgnoreChange&&this._bAnnounceTableUpdate){this._bAnnounceTableUpdate=false;f.announceTableUpdate(this.getHeader(),e)}};ot.prototype._updateColumnsBeforeBinding=function(){var t=this.getColumns();var e=this.getPropertyHelper();t.forEach(function(t){var i=e.getProperty(t.getPropertyKey());var o=i?i.getSortableProperties().map(function(t){return t.name}):[];var n=this._getSortedProperties().find(function(t){return o.includes(t.name)});var r=Z.None;if(n){r=n.descending?Z.Descending:Z.Ascending}this._getType().updateSortIndicator(t,r)},this)};ot.prototype.getRowBinding=function(){return this._getType().getRowBinding()};ot.prototype._getRowBinding=function(){G.error(this+": The method '_getRowBinding' must not be used will be deleted soon. Use 'getRowBinding' instead.");return this.getRowBinding()};ot._addBindingListener=function(t,e,i){if(!t.events){t.events={}}if(!t.events[e]){t.events[e]=i}else{var o=t.events[e];t.events[e]=function(){i.apply(this,arguments);o.apply(this,arguments)}}};ot.prototype._rebind=function(){if(this._bFullyInitialized){this.bindRows()}else{this._fullyInitialized().then(this._rebind.bind(this))}};ot.prototype._getSorters=function(){var t=this.getSortConditions()?this.getSortConditions().sorters:[];var e=[],i=this.getPropertyHelper();t.forEach(function(t){if(i.hasProperty(t.name)){var o=i.getProperty(t.name).path;e.push(new B(o,t.descending))}});return e};ot.prototype._onPaste=function(t){if(this.getEnablePaste()){this.firePaste({data:t.data})}};ot.prototype.exit=function(){this._destroyDefaultType();if(this._oRowTemplate){this._oRowTemplate.destroy()}this._oRowTemplate=null;this._oTable=null;if(this._oToolbar&&!this._bTableExists){this._oToolbar.destroy()}this._oToolbar=null;this._oTitle=null;this._vNoData=null;this._oNumberFormatInstance=null;nt.forEach(function(t){var e=P(t),i="_o"+e;this[i]=null},this);this._oTableReady=null;this._oFullInitialize=null;this._oPasteButton=null;this._oP13nButton=null;if(this._oFilterInfoBarInvisibleText){this._oFilterInfoBarInvisibleText.destroy();this._oFilterInfoBarInvisibleText=null}if(this._oColumnHeaderMenu){this._oColumnHeaderMenu.destroy();this._oColumnHeaderMenu=null}this._oManagedObjectModel.destroy();delete this._oManagedObjectModel;t.prototype.exit.apply(this,arguments)};ot.prototype.addAction=function(e){if(e.getMetadata().getName()!=="sap.ui.mdc.actiontoolbar.ActionToolbarAction"){e=new N(e.getId()+"-action",{action:e})}return t.prototype.addAggregation.apply(this,["actions",e])};ot.prototype.onThemeChanged=function(){if(this._oExportButton){var t=c.ButtonType[j.get({name:"_sap_ui_mdc_Table_ExportButtonType"})];this._oExportButton.setType(t)}};ot.prototype._enableV4LegacySelection=function(){this._bV4LegacySelectionEnabled=true;if(this._oTable&&this._isOfType("Table",true)){var t=this._oTable.getPlugins().find(function(t){return t.isA("sap.ui.table.plugins.ODataV4Selection")});if(t){t.destroy();this.getControlDelegate().initializeSelection(this)}}};return ot});
//# sourceMappingURL=Table.js.map