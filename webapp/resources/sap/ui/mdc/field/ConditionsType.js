/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/field/ConditionType","sap/ui/mdc/condition/ConditionValidateException","sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/mdc/field/splitValue","sap/ui/model/SimpleType","sap/ui/model/FormatException","sap/ui/model/ParseException","sap/ui/model/ValidateException","sap/base/util/merge","sap/ui/base/SyncPromise"],function(t,e,i,n,o,r,s,a,l,u){"use strict";var p=o.extend("sap.ui.mdc.field.ConditionsType",{constructor:function(e,i){o.apply(this,arguments);this.sName="Conditions";e=h(e);this._oConditionType=new t(e,this.oConstraints);this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc")}});p.prototype.destroy=function(){o.prototype.destroy.apply(this,arguments);if(this._oConditionType){this._oConditionType.destroy();this._oConditionType=undefined}this._bDestroyed=true};p.prototype.setFormatOptions=function(t){o.prototype.setFormatOptions.apply(this,arguments);t=h(t);if(this._oConditionType){this._oConditionType.setFormatOptions(t)}};function h(t){t=l({},t);if(t.asyncParsing){delete t.asyncParsing}return t}p.prototype.setConstraints=function(t){o.prototype.setConstraints.apply(this,arguments);if(this._oConditionType){this._oConditionType.setConstraints(this.oConstraints)}};p.prototype.formatValue=function(t,e){if(t==undefined||t==null||this._bDestroyed){return null}if(!Array.isArray(t)){throw new r("No valid conditions provided")}var i;if(!e||e==="string"||e==="any"){i=""}else if(e==="float"||e==="int"){i=0}if(C.call(this)){return T.call(this)||i}var n=m.call(this);var o=[];var s=function(t,e){return u.resolve().then(function(){return this._oConditionType.formatValue(t,e)}.bind(this))};for(var a=0;a<t.length;a++){o.push(s.call(this,t[a],e));if(n>0&&a>=n-1){break}}return u.all(o).then(function(t){return f.call(this,t,i)}.bind(this)).unwrap()};function f(t,e){for(var i=0;i<t.length;i++){if(e){e=e+this._oResourceBundle.getText("field.SEPARATOR")+t[i]}else{e=t[i]}}return e}p.prototype.parseValue=function(t,e){if(this._bDestroyed){return null}if(C.call(this)&&t===""){return this.oFormatOptions.getConditions?this.oFormatOptions.getConditions():[]}return this._parseValueToIndex(t,e,-1)};p.prototype._parseValueToIndex=function(t,e,i){var o=this.oFormatOptions.operators||[];var r=o.indexOf("BT")>=0||o.length===0;var s=n(t,!r);if(s.length>1||r&&s.length===1&&typeof s[0]==="string"&&s[0].search(/\t/)>=0){return c.call(this,s,e,i)}else{return d.call(this,t,e,i)}};function d(t,e,i){var n=function(t,e){return this._oConditionType.parseValue(t,e)};var o=function(t){throw t};return v.call(this,[t],e,i,n,o)}function c(t,e,n){var o=this.oFormatOptions.operators||[];var r=o.indexOf("BT")>=0||o.length===0;var a=r&&i.getOperator("BT");var l=function(t,e){return u.resolve().then(function(){t=t.trim();if(r){var e=t.split(/\t/g);if(e.length==2&&e[0]&&e[1]){t=a.tokenFormat;for(var i=0;i<2;i++){t=t.replace(new RegExp("\\{"+i+"\\}","g"),e[i])}}}return this._oConditionType._parseValue(t,"string",false)}.bind(this))};var p=function(t){if(t instanceof s){throw new s(this._oResourceBundle.getText("field.PASTE_ERROR"))}throw t};return v.call(this,t,e,n,l,p)}function v(t,e,i,n,o){var r=[];for(var s=0;s<t.length;s++){r.push(n.call(this,t[s],e))}var a=u.all(r).then(function(t){var e=this.oFormatOptions.getConditions&&this.oFormatOptions.getConditions();for(var n=0;n<t.length;n++){e=y.call(this,t[n],e,i);if(i>=0){i++}}return e}.bind(this)).catch(function(t){o.call(this,t)}.bind(this)).unwrap();if(a instanceof Promise&&this.oFormatOptions.asyncParsing){this.oFormatOptions.asyncParsing(a)}return a}function y(t,e,n){var o=g(this.oFormatOptions.valueType);var r=m.call(this);if(r!==1&&this.oFormatOptions.getConditions){if(t){if(O(this.oFormatOptions.valueType)&&!o&&e.length===1&&(e[0].values[0][0]===null||e[0].values[0][0]===undefined||e[0].values[0][1]===null||e[0].values[0][1]===undefined)&&(t.values[0][0]!==null&&t.values[0][0]!==undefined&&t.values[0][1]!==null&&t.values[0][1]!==undefined)){e.splice(0,1)}if(i.indexOfCondition(t,e)===-1){if(n>=0&&e.length>n){e.splice(n,0,t)}else{e.push(t)}}else{throw new s(this._oResourceBundle.getText("field.CONDITION_ALREADY_EXIST",[t.values[0]]))}if(r>0&&r<e.length){e.splice(0,e.length-r)}}return e}else if(o&&this.oFormatOptions.getConditions&&e.length>1){var a=t&&t.values[0][1];var l=t&&t.inParameters;var u=t&&t.outParameters;var p=t&&t.payload;for(var h=0;h<e.length;h++){e[h].values[0][1]=a;if(a===undefined){e[h].values[0][0]=t.values[0][0]}e[h].values[0].splice(2);if(e[h].operator==="BT"){e[h].values[1][1]=a;if(a===undefined){e[h].values[1][0]=t.values[0][0]}e[h].values[1].splice(2)}if(l||e[h].inParameters){e[h].inParameters=l}if(u||e[h].outParameters){e[h].outParameters=u}if(p||e[h].payload){e[h].payload=p}}if(e.length===0){e.push(t)}return e}else if(t){return[t]}else{return[]}}p.prototype.validateValue=function(t){if(t===undefined||t===null||this._bDestroyed){return}if(!Array.isArray(t)){throw new e("No valid conditions provided",undefined,undefined,t)}try{for(var i=0;i<t.length;i++){var n=t[i];this._oConditionType.validateValue(n)}var o=m.call(this);if(t.length===0&&o===1){this._oConditionType.validateValue(null)}}catch(i){if(i instanceof e){i.setConditions(t)}else if(i instanceof a){throw new e(i.message,i.violatedConstraints,l({},n))}throw i}};function m(){var t=1;if(this.oFormatOptions.hasOwnProperty("maxConditions")){t=this.oFormatOptions.maxConditions}return t}function g(t){if(O(t)){var e=t.getFormatOptions();var i=!e||!e.hasOwnProperty("showMeasure")||e.showMeasure;var n=!e||!e.hasOwnProperty("showNumber")||e.showNumber;var o=!e||!e.hasOwnProperty("showTimezone")||e.showTimezone;var r=!e||!e.hasOwnProperty("showDate")||e.showDate;var s=!e||!e.hasOwnProperty("showTime")||e.showTime;if(i&&!n||o&&!r&&!s){return true}}return false}function O(t){return t&&t.isA("sap.ui.model.CompositeType")}function C(){var t=false;if(this.oFormatOptions.hasOwnProperty("noFormatting")){t=this.oFormatOptions.noFormatting}return t}function T(){if(this.oFormatOptions.hasOwnProperty("keepValue")){return this.oFormatOptions.keepValue}return null}return p});
//# sourceMappingURL=ConditionsType.js.map