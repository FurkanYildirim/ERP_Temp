/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/base/DataType","sap/ui/core/Core","sap/base/util/merge","sap/base/util/isPlainObject","sap/base/Log"],function(e,t,r,o,i,n){"use strict";var a={name:{type:"string",mandatory:true,forComplexProperty:{allowed:true}},label:{type:"string",mandatory:true,forComplexProperty:{allowed:true}},tooltip:{type:"string",forComplexProperty:{allowed:true}},visible:{type:"boolean",default:{value:true},forComplexProperty:{allowed:true}},path:{type:"string"},dataType:{type:"string",mandatory:true},formatOptions:{type:"object"},constraints:{type:"object"},maxConditions:{type:"int",default:{value:-1}},caseSensitive:{type:"boolean",default:{value:true}},group:{type:"string",forComplexProperty:{allowed:true}},groupLabel:{type:"string",forComplexProperty:{allowed:true}},filterable:{type:"boolean",default:{value:true},forComplexProperty:{valueIfNotAllowed:false}},sortable:{type:"boolean",default:{value:true},forComplexProperty:{valueIfNotAllowed:false}},propertyInfos:{type:"PropertyReference[]",forComplexProperty:{allowed:true}}};var p={isComplex:function(){return j.isPropertyComplex(this)},getSimpleProperties:function(){return this.propertyInfosProperties||[this]},getSortableProperties:function(){return this.getSimpleProperties().filter(function(e){return e.sortable})},getFilterableProperties:function(){return this.getSimpleProperties().filter(function(e){return e.filterable})},getVisibleProperties:function(){return this.getSimpleProperties().filter(function(e){return e.visible})}};var l=["name","label","tooltip","visible","path","dataType","formatOptions","constraints","maxConditions","group","groupLabel","caseSensitive"];var u=new WeakMap;function f(e){return JSON.stringify(e,function(e,t){return t===undefined?null:t})||""}function s(e,t){var o=r.getLoadedLibraries();if(!(window.top["sap-ui-mdc-config"]&&window.top["sap-ui-mdc-config"].disableStrictPropertyInfoValidation)&&!("sap.fe.core"in o||"sap.fe.macros"in o||"sap.sac.df"in o)){y(e,t)}if(n.getLevel()<n.WARNING){return}var i=f(t);n.warning("Invalid property definition: "+e+(i?"\n"+i:""))}function y(e,t){var r=t?f(t):null;throw new Error("Invalid property definition: "+e+(r?"\n"+r:""))}function c(e,t){t.map(function(e){Object.keys(p).forEach(function(t){Object.defineProperty(e,t,{value:function(){return p[t].call(this)},writable:true})})})}function d(e){var t=Object.getOwnPropertyNames(e);Object.freeze(e);for(var r=0;r<t.length;r++){var o=e[t[r]];if(typeof o==="function"){Object.freeze(o)}else if(i(o)&&!Object.isFrozen(o)){d(o)}else if(Array.isArray(o)){d(o)}}}function v(e,t){if(!t){return e}return t.split(".").reduce(function(e,t){return e&&e[t]?e[t]:null},e)}function P(e){var r;if(typeof e==="object"){r="object"}else{r=e.replace("PropertyReference","string")}return t.getType(r)}function b(e){var t=P(e);if(t.isArrayType()){return t.getBaseType().getDefaultValue()}else{return t.getDefaultValue()}}function g(e,t){t.forEach(function(t){e.prepareProperty(t)});d(t)}function m(e,t,r,o,i,n){var a=o==null;var p=[];var l=j.isPropertyComplex(t);if(a){n=u.get(e).mAttributeMetadata;i=t}if(!i){return[]}for(var f in n){var s=n[f];var y=a?f:o+"."+f;var c=i[f];if(l&&!s.forComplexProperty.allowed){if("valueIfNotAllowed"in s.forComplexProperty){i[f]=s.forComplexProperty.valueIfNotAllowed}continue}if(c!=null&&typeof s.type==="string"&&s.type.startsWith("PropertyReference")||y==="propertyInfos"){if(l||y!=="propertyInfos"){h(i,f,r)}continue}if(c==null){w(i,s,o,f,p,c)}if(typeof s.type==="object"){p=p.concat(m(e,t,r,y,i[f],s.type))}}return p}function h(e,t,r){var o=e[t];var i;var n=t;if(Array.isArray(o)){i=o.map(function(e){return r[e]});n+="Properties"}else{i=r[o];n+="Property"}Object.defineProperty(e,n,{value:i})}function w(e,t,r,i,n,a){if("default"in t){var p=t.default;if(a===null&&p.ignoreIfNull&&"value"in p){return}if(p.value===undefined){e[i]=b(t.type)}else if(typeof p.value==="string"&&p.value.startsWith("attribute:")){n.push({source:p.value.substring(p.value.indexOf(":")+1),targetPath:r,targetAttribute:i,targetType:t.type})}else if(typeof p.value==="object"){e[i]=o({},p.value)}else{e[i]=p.value}}else{e[i]=b(t.type)}}function x(e){return Object.freeze(e.reduce(function(e,t){e[t.name]=t;return e},{}))}function C(e,t,r){for(var o in e){var i=e[o];var n=t==null?o:t+"."+o;var a=r?r.forComplexProperty:{};i.forComplexProperty=Object.assign({allowed:a.allowed&&a.propagateAllowance,propagateAllowance:true},i.forComplexProperty);if(typeof i.type==="object"){C(i.type,n,i)}}}function A(e,t){if(!Array.isArray(t)){y("Property infos must be an array.")}var r=u.get(e);var i=o([],t);e.validateProperties(i,r.aPreviousRawProperties);r.aProperties=i;r.mProperties=x(i);r.aPreviousRawProperties=o([],t);c(e,i);g(e,i)}var j=e.extend("sap.ui.mdc.util.PropertyHelper",{constructor:function(t,r,o){e.call(this);if(r&&!e.isA(r,"sap.ui.base.ManagedObject")){throw new Error("The type of the parent is invalid.")}Object.keys(o||{}).forEach(function(e){if(e in a&&o[e]!==true){throw new Error("The attribute '"+e+"' is reserved and cannot be overridden by additional attributes.")}});var i={};var n=Object.keys(o||{});i.mAttributeMetadata=l.concat(n).reduce(function(e,t){e[t]=t in a?a[t]:o[t];return e},{});C(i.mAttributeMetadata);i.aMandatoryAttributes=Object.keys(i.mAttributeMetadata).filter(function(e){return i.mAttributeMetadata[e].mandatory});i.oParent=r||null;u.set(this,i);A(this,t)}});j.prototype.validateProperties=function(e,t){var r=new Set;for(var o=0;o<e.length;o++){this.validateProperty(e[o],e,t);r.add(e[o].name)}if(r.size!==e.length){y("Properties do not have unique names.")}};j.prototype.validateProperty=function(e,t,r){if(!i(e)){y("Property info must be a plain object.")}O(this,e,t);if(j.isPropertyComplex(e)){if(!e.propertyInfos||e.propertyInfos.length===0){y("Complex property does not reference existing properties.",e)}}var o=u.get(this);o.aMandatoryAttributes.forEach(function(t){var r=o.mAttributeMetadata[t].forComplexProperty.allowed;if(e[t]==null&&j.isPropertyComplex(e)&&!r){return}if(!(t in e)){s("Property does not contain mandatory attribute '"+t+"'.",e)}else if(e[t]==null){y("Property does not contain mandatory attribute '"+t+"'.",e)}})};function O(e,t,r,o,i,n){var a=o==null;if(a){n=u.get(e).mAttributeMetadata;i=t}for(var p in i){var l=n[p];var f=a?p:o+"."+p;var c=i[p];if(!l){s("Property contains invalid attribute '"+f+"'.",t)}else if(j.isPropertyComplex(t)&&!l.forComplexProperty.allowed){s("Complex property contains invalid attribute '"+f+"'.",t)}else if(typeof l.type==="object"&&c&&typeof c==="object"){O(e,t,r,f,c,l.type)}else if(c!=null&&!P(l.type).isValid(c)){y("The value of '"+f+"' is invalid.",t)}else if(c&&typeof l.type==="string"&&l.type.startsWith("PropertyReference")){I(e,t,r,f,c,l)}}}function I(e,t,r,o,i,n){var a=n.type.endsWith("[]")?i:[i];var p=new Set(a);if(a.indexOf(t.name)>-1){y("Property references itself in the '"+o+"' attribute.",t)}if(p.size!==a.length){y("Property contains duplicate names in the '"+o+"' attribute.",t)}for(var l=0;l<r.length;l++){if(p.has(r[l].name)){if(j.isPropertyComplex(r[l])){y("Property references complex properties in the '"+o+"' attribute.",t)}p.delete(r[l].name)}}if(p.size>0){y("Property references non-existing properties in the '"+o+"' attribute.",t)}}j.prototype.prepareProperty=function(e){var t=this.getPropertyMap();var r=m(this,e,t);r.forEach(function(r){var o=v(e,r.targetPath);if(o){var i=v(e,r.source);if(i==null){i=b(r.targetType)}o[r.targetAttribute]=i;if(typeof r.targetType==="string"&&r.targetType.startsWith("PropertyReference")){h(o,r.targetAttribute,t)}}})};j.prototype.getParent=function(){var e=u.get(this);return e?e.oParent:null};j.prototype.setProperties=function(e){A(this,e)};j.prototype.getProperties=function(){var e=u.get(this);return e?e.aProperties:[]};j.prototype.getPropertyMap=function(){var e=u.get(this);return e?e.mProperties:{}};j.prototype.getProperty=function(e){return this.getPropertyMap()[e]||null};j.prototype.hasProperty=function(e){return e in this.getPropertyMap()};j.isPropertyComplex=function(e){return e!=null&&typeof e==="object"?"propertyInfos"in e:false};j.prototype.getSortableProperties=function(){return this.getProperties().filter(function(e){return e.sortable})};j.prototype.getFilterableProperties=function(){return this.getProperties().filter(function(e){return e.filterable})};j.prototype.getVisibleProperties=function(){return this.getProperties().filter(function(e){return e.visible})};j.prototype.destroy=function(){e.prototype.destroy.apply(this,arguments);u.delete(this)};return j});
//# sourceMappingURL=PropertyHelper.js.map