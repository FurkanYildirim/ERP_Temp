/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/DynamicDateOption","sap/m/DynamicDateValueHelpUIType","sap/m/Input","sap/ui/mdc/enums/BaseType","sap/ui/mdc/enums/FieldDisplay","sap/ui/mdc/enums/OperatorValueType","sap/ui/mdc/util/DateUtil","sap/ui/mdc/util/loadModules","sap/ui/model/json/JSONModel","sap/ui/model/FormatException","sap/ui/model/ParseException","sap/ui/model/ValidateException","sap/ui/core/library"],function(e,t,a,r,o,s,i,p,n,l,u,y,v){"use strict";var h=v.ValueState;var f;var d;var g=e.extend("sap.ui.mdc.condition.OperatorDynamicDateOption",{metadata:{library:"sap.ui.mdc",properties:{operator:{type:"object"},type:{type:"object"},baseType:{type:"sap.ui.mdc.enums.BaseType"}}}});g.prototype.exit=function(){e.prototype.exit.apply(this,arguments);if(this._oModel){this._oModel.destroy();this._oModel=undefined;this._mChangeHandler=undefined}if(this._aUITypes){for(var t=0;t<this._aUITypes.length;t++){this._aUITypes[t].destroy()}this._aUITypes=undefined}};g.prototype.applySettings=function(){e.prototype.applySettings.apply(this,arguments);var t=[];var a=this.getBaseType();if(a===r.DateTime){if(!d){t.push("sap/m/DateTimePicker")}}else if(!f){t.push("sap/m/DatePicker")}if(t.length>0){return p(t).then(function(e){if(a===r.DateTime){d=e[0]}else{f=e[0]}})}};g.prototype.validateProperty=function(t,a){if(t==="operator"&&a&&(typeof a!=="object"||!a.isA||!a.isA("sap.ui.mdc.condition.Operator"))){throw new Error('"'+a+'" is of type '+typeof a+", expected "+'sap.ui.mdc.condition.Operator for property "'+t+'" of '+this)}else if(t==="type"&&a&&(typeof a!=="object"||!a.isA||!a.isA("sap.ui.model.Type"))){throw new Error('"'+a+'" is of type '+typeof a+", expected "+'sap.ui.model.Type for property "'+t+'" of '+this)}return e.prototype.validateProperty.apply(this,arguments)};g.prototype.isRange=function(){var e=this.getOperator();return e.isA("sap.ui.mdc.condition.RangeOperator")};g.prototype.getText=function(e){var t=this.getOperator();var a=this.getBaseType();return t.getLongText(a)};g.prototype.getValueHelpUITypes=function(e){if(!this._aUITypes){var a=this.getOperator();var o=this.getType();var i=this.getBaseType();this._aUITypes=[];for(var p=0;p<a.valueTypes.length;p++){var n=a.valueTypes[p];if(n===s.Self){var l;if(i===r.DateTime){l="datetime"}else{l="date"}this._aUITypes.push(new t({type:l}))}else if(!n||n===s.Static){continue}else{o=a._createLocalType(n,o);if(o.isA("sap.ui.model.type.Integer")||o.isA("sap.ui.model.odata.type.Int")){this._aUITypes.push(new t({type:"int"}))}else{this._aUITypes.push(new t({type:"custom"}))}}}}return this._aUITypes};g.prototype.createValueHelpUI=function(e,t){var o=e.getValue();var p=this.getOperator();var l=this.getType();var u=this.getKey();var y=e.getId();if(!o||o.operator!==u){o={operator:u,values:[]};if(p.valueDefaults){o.values=p.valueDefaults}}c.call(this,e);if(!e.aControlsByParameters){e.aControlsByParameters={}}e.aControlsByParameters[u]=[];var v=function(e){t(this)}.bind(this);for(var h=0;h<p.valueTypes.length;h++){var g=p.valueTypes[h];var m=this.getBaseType();var T;if(!g){continue}if(!e.aControlsByParameters[u][h]){if(p.createControl){if(!this._oModel){v=function(e){var t=e.getParameter("path");var a=t.split("/");var r=a[0]||a[1];if(this._mChangeHandler&&this._mChangeHandler[r]){this._mChangeHandler[r](this)}}.bind(this);this._oModel=new n;this._oModel.attachPropertyChange({},v,this);this._mChangeHandler={}}var _=this._oModel.getData();_[y]={value0:o&&o.values[0],value1:o&&o.values[1]};this._mChangeHandler[y]=t;if(g!==s.Self){l=p._createLocalType(g,l)}var C=p.createControl(l,"internal>/"+y+"/value"+h,h,y+"-"+h);C.setModel(this._oModel,"internal");e.aControlsByParameters[u].push(C)}else if(g===s.Self){if(o&&o.values[h]){T=i.typeToDate(o.values[h],l,m)}var O=l.getFormatOptions();var B;if(m===r.DateTime){B=d}else{B=f}var P=new B(y+"-"+h,{dateValue:T,displayFormat:O.style||O.pattern,displayFormatType:O.calendarType,change:v});e.aControlsByParameters[u].push(P)}else if(typeof g==="object"){l=p._createLocalType(p.valueTypes[h],l);var D=l.formatValue(o&&o.values[h],"string");var V=new a(y+"-"+h,{value:D,change:v});e.aControlsByParameters[u].push(V)}}}return e.aControlsByParameters[u]};g.prototype.validateValueHelpUI=function(e){var t=this.getKey();var a=this.getOperator();var r=this.getType();var o;var s=true;var i=h.None;var p;var n=0;try{o=this.getValueHelpOutput(e);for(n=0;n<o.values.length;n++){var l=o.values[n];if(l===undefined||l===null){s=false}}a.validate(o.values,r)}catch(e){s=false;i=h.Error;p=e.message;if(e&&!(e instanceof u)&&!(e instanceof y)){throw e}}if(!a.createControl){for(n=0;n<e.aControlsByParameters[t].length;n++){var v=e.aControlsByParameters[t][n];if(v.setValueState){v.setValueState(i);v.setValueStateText(p)}}}return s};g.prototype.getValueHelpOutput=function(e){var t=this.getKey();var a={operator:t,values:[]};var r=this.getOperator();var o=this.getType();var p=this.getBaseType();var n=e.getId();for(var l=0;l<r.valueTypes.length;l++){if(!r.valueTypes[l]){continue}var y=e.aControlsByParameters[t][l];if(y){var v;if(r.createControl){v=this._oModel?this._oModel.getProperty("/"+n+"/value"+l):null}else if(r.valueTypes[l]===s.Self){if(!y.isValidValue()){throw new u}v=y.getDateValue();if(v){v=i.dateToType(v,o,p)}}else{v=y.getValue();o=r._createLocalType(r.valueTypes[l],o);v=o.parseValue(v,"string")}a.values.push(v)}}return a};g.prototype.getGroupHeader=function(){var t=this.getOperator();if(t.group&&t.group.text){return t.group.text}return e.prototype.getGroupHeader.apply(this,arguments)};g.prototype.getGroup=function(){var t=this.getOperator();if(t.group){return t.group.id}return e.prototype.getGroup.apply(this,arguments)};g.prototype.toDates=function(e){var t=this.getOperator();var a=this.getType();var r=this.getBaseType();var o;var p=0;if(t.isA("sap.ui.mdc.condition.RangeOperator")){o=t._getRange(e&&e.values,a,r);for(p=0;p<o.length;p++){o[p]=i.typeToDate(o[p],a,r)}}else if(t.valueTypes.length===0){o=[]}else if(t.valueTypes[0]===s.Self){o=[];for(p=0;p<e.values.length;p++){o.push(e.values[p]?i.typeToDate(e.values[p],a,r):e.values[p])}if(o.length===1){o.push(o[0])}}else if([s.Self,s.Static].indexOf(t.valueTypes[0])===-1){throw new Error("Cannot convert to date, use RangeOperator")}return o};g.prototype.format=function(e){var t=this.getOperator();var a=this.getType();return t.format(e,a,o.Value)};g.prototype.parse=function(e){var t=this.getOperator();var a=this.getType();if(e&&t.parse(e)){var r={};r.operator=this.getKey();r.values=t.parse(e,a,o.Value);return r}};g.prototype.enhanceFormattedValue=function(e,t){return false};function c(e){var t=this.getKey();if(e&&e.aControlsByParameters&&e.aControlsByParameters[t]){for(var a=0;a<e.aControlsByParameters[t].length;a++){var r=e.aControlsByParameters[t][a];if(!r.bIsDestroyed){r.destroy()}}delete e.aControlsByParameters[t]}}return g});
//# sourceMappingURL=OperatorDynamicDateOption.js.map