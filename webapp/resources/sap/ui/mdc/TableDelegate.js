/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./AggregationBaseDelegate","./util/loadModules","sap/ui/model/Sorter","sap/ui/core/library","sap/ui/core/Core","sap/ui/mdc/enums/TableP13nMode","sap/ui/mdc/enums/TableType","sap/ui/mdc/util/FilterUtil"],function(e,t,r,i,n,o,l,a){"use strict";var u=Object.assign({},e);u.updateBindingInfo=function(e,t){t.parameters={};t.sorter=[];if(e._oMessageFilter){t.filters=[e._oMessageFilter]}else{t.filters=this.getFilters(e)}if(e._isOfType(l.ResponsiveTable)){var r=e._getGroupedProperties()[0];if(r){var i=this.getGroupSorter(e,r.name);if(i){t.sorter.push(i)}}}var n=this.getSorters(e);t.sorter=t.sorter.concat(t.sorter.length===1?n.filter(function(e){return e.sPath!==t.sorter[0].sPath}):n)};u.getFilters=function(e){var t=e.isFilteringEnabled();var r=[],i=[];if(t){var o=e.getPropertyHelper().getProperties();var l=e.getConditions()||{};var u=a.getFilterInfo(e,l,o);if(u.filters){r.push(u.filters)}}var s=n.byId(e.getFilter());if(s){var p=s.getConditions();if(p){var f=s.getPropertyInfoSet?s.getPropertyInfoSet():null;var c=a.getFilterInfo(e,p,f);if(c.filters){i.push(c.filters)}}}return r.concat(i)};u.getGroupSorter=function(e,t){var i=e._getSortedProperties().find(function(e){return e.name===t});var n=e.getPropertyHelper().getProperty(t).path;var o=i?i.descending:false;if(!e._mFormatGroupHeaderInfo||e._mFormatGroupHeaderInfo.propertyName!==t){e._mFormatGroupHeaderInfo={propertyName:t,formatter:function(r){return this.formatGroupHeader(e,r,t)}.bind(this)}}return new r(n,o,e._mFormatGroupHeaderInfo.formatter)};u.getSorters=function(e){return e._getSorters()};u.updateBinding=function(e,t,r){this.rebind(e,t)};u.formatGroupHeader=function(e,t,r){var i=e.getPropertyHelper().getProperty(r);var o=i.textProperty;var l=n.getLibraryResourceBundle("sap.ui.mdc");var a="table.ROW_GROUP_TITLE";var u=[i.label,t.getProperty(i.path,true)];if(o){a="table.ROW_GROUP_TITLE_FULL";u.push(t.getProperty(o.path,true))}return l.getText(a,u)};u.validateState=function(t,r,o){if(o=="Filter"&&t._oMessageFilter){var l=n.getLibraryResourceBundle("sap.ui.mdc");return{validation:i.MessageType.Information,message:l.getText("table.PERSONALIZATION_DIALOG_FILTER_MESSAGESTRIP")}}return e.validateState.apply(this,arguments)};u.rebind=function(e,t){e._getType().bindRows(t)};u.getFilterDelegate=function(){return{addItem:function(e,t){return Promise.resolve(null)},addCondition:function(e,t,r){return Promise.resolve()},removeCondition:function(e,t,r){return Promise.resolve()}}};u.fetchExportCapabilities=function(e){return Promise.resolve({XLSX:{}})};u.expandAll=function(e){throw Error("Unsupported operation: TableDelegate does not support #expandAll")};u.collapseAll=function(e){throw Error("Unsupported operation: TableDelegate does not support #collapseAll")};u.initializeContent=function(e){return this.initializeSelection(e)};u.initializeSelection=function(e){if(e._isOfType(l.Table,true)){return s(e)}else{return p(e)}};function s(e){var r={Single:"Single",SingleMaster:"Single",Multi:"MultiToggle"};return t("sap/ui/table/plugins/MultiSelectionPlugin").then(function(t){var i=t[0];e._oTable.addPlugin(new i({limit:"{$sap.ui.mdc.Table#type>/selectionLimit}",enableNotification:true,showHeaderSelector:"{$sap.ui.mdc.Table#type>/showHeaderSelector}",selectionMode:{path:"$sap.ui.mdc.Table>/selectionMode",formatter:function(e){return r[e]}},enabled:{path:"$sap.ui.mdc.Table>/selectionMode",formatter:function(e){return e in r}},selectionChange:function(t){e._onSelectionChange({selectAll:t.getParameter("selectAll")})}}))})}function p(e){var t={Single:"SingleSelectLeft",SingleMaster:"SingleSelectMaster",Multi:"MultiSelect"};var r={Default:"SelectAll",ClearAll:"ClearAll"};e._oTable.bindProperty("mode",{path:"$sap.ui.mdc.Table>/selectionMode",formatter:function(e){return t[e]}});e._oTable.bindProperty("multiSelectMode",{path:"$sap.ui.mdc.Table>/multiSelectMode",formatter:function(e){return r[e]||"SelectAll"}});e._oTable.attachSelectionChange(function(t){e._onSelectionChange({selectAll:t.getParameter("selectAll")})});return Promise.resolve()}u.getSelectedContexts=function(e){if(!e._oTable){return[]}if(e._isOfType(l.Table,true)){var t=e._oTable;var r=t.getPlugins().find(function(e){return e.isA("sap.ui.table.plugins.MultiSelectionPlugin")});if(!r){return[]}return r.getSelectedIndices().map(function(e){return t.getContextByIndex(e)},this)}if(e._isOfType(l.ResponsiveTable)){return e._oTable.getSelectedContexts()}return[]};u.clearSelection=function(e){if(!e._oTable){return}if(e._isOfType(l.Table,true)){var t=e._oTable.getPlugins().find(function(e){return e.isA("sap.ui.table.plugins.SelectionPlugin")});if(t){t.clearSelection()}}if(e._isOfType(l.ResponsiveTable)){e._oTable.removeSelections(true)}};u.getSupportedFeatures=function(e){return{export:true,expandAll:false,collapseAll:false}};u.getSupportedP13nModes=function(e){var t=[o.Column,o.Sort,o.Filter];if(e._isOfType(l.ResponsiveTable)){t.push(o.Group)}return t};return u});
//# sourceMappingURL=TableDelegate.js.map