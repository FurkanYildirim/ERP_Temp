/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/write/_internal/Versions","sap/ui/fl/Utils","sap/ui/fl/write/api/Version","sap/ui/fl/write/api/FeaturesAPI","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/write/api/ContextBasedAdaptationsAPI"],function(e,r,t,n,o,i,a){"use strict";function s(e){var r=i.getFlexReferenceForControl(e);if(!r){throw Error("The application ID could not be determined")}return r}function l(e){if(!e.control){throw Error("No control was provided")}if(!e.layer){throw Error("No layer was provided")}var t=s(e.control);return r.getVersionsModel({nonNormalizedReference:t,reference:t,layer:e.layer})}function d(e){var r=s(e.control);var t=a.hasAdaptationsModel({layer:e.layer,reference:r});if(!e.adaptationId&&t){return a.refreshAdaptationModel(e)}else if(e.adaptationId&&t){var n=a.getAdaptationsModel(e);n.switchDisplayedAdaptation(e.adaptationId);return Promise.resolve(e.adaptationId)}return Promise.resolve()}var c={};c.initialize=function(e){if(!e.control){return Promise.reject("No control was provided")}if(!e.layer){return Promise.reject("No layer was provided")}var n=t.getAppComponentForControl(e.control);return r.initialize({reference:s(n),layer:e.layer})};c.clearInstances=function(){r.clearInstances()};c.isDraftAvailable=function(e){var r=l(e);var t=r.getProperty("/versions");var o=t.find(function(e){return e.version===n.Number.Draft});return!!o};c.isOldVersionDisplayed=function(e){var r=l(e);var t=r.getProperty("/displayedVersion");var o=r.getProperty("/activeVersion");return t!==n.Number.Draft&&t!==o};c.loadDraftForApplication=function(e){e.version=n.Number.Draft;return c.loadVersionForApplication(e)};c.loadVersionForApplication=function(r){if(!r.control){return Promise.reject("No control was provided")}if(!r.layer){return Promise.reject("No layer was provided")}var i=l(r);if(i){if(r.version===undefined){r.version=i.getProperty("/activeVersion")}i.setProperty("/displayedVersion",r.version);i.setProperty("/persistedVersion",r.version);if(r.version!==n.Number.Draft&&o.isPublishAvailable()){var a=i.getProperty("/versions");if(a.length){var c=a.find(function(e){return e.version===r.version});if(c){i.setProperty("/publishVersionEnabled",!c.isPublished)}}}}return d(r).then(function(n){var o=t.getAppComponentForControl(r.control);var i=s(o);return e.clearAndInitialize({componentId:o.getId(),reference:i,version:r.version,allContexts:r.allContexts,adaptationId:n})})};c.activate=function(e){if(!e.control){return Promise.reject("No control was provided")}if(!e.layer){return Promise.reject("No layer was provided")}if(!e.title){return Promise.reject("No version title was provided")}var n=s(e.control);return r.activate({nonNormalizedReference:n,reference:n,layer:e.layer,title:e.title,appComponent:t.getAppComponentForControl(e.control),displayedVersion:e.displayedVersion})};c.discardDraft=function(n){if(!n.control){return Promise.reject("No control was provided")}if(!n.layer){return Promise.reject("No layer was provided")}var o=t.getAppComponentForControl(n.control);var i=s(o);return r.discardDraft({nonNormalizedReference:i,reference:i,layer:n.layer}).then(function(r){if(r.backendChangesDiscarded){var t=a.hasAdaptationsModel({layer:n.layer,reference:i});if(t){return a.refreshAdaptationModel(n).then(function(t){return e.clearAndInitialize({componentId:o.getId(),reference:i,adaptationId:t}).then(function(){return r})})}return e.clearAndInitialize({componentId:o.getId(),reference:i}).then(function(){return r})}return r})};c.publish=function(e){if(!e.selector){return Promise.reject("No selector was provided")}if(!e.layer){return Promise.reject("No layer was provided")}if(!e.version){return Promise.reject("No version was provided")}e.styleClass=e.styleClass||"";e.reference=s(e.selector);return r.publish(e)};return c});
//# sourceMappingURL=VersionsAPI.js.map