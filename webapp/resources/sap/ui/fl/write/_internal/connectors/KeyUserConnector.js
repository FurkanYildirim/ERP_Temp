/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/fl/Layer","sap/ui/fl/write/_internal/connectors/BackendConnector","sap/ui/fl/initial/_internal/connectors/KeyUserConnector","sap/ui/fl/initial/_internal/connectors/Utils","sap/ui/fl/write/_internal/connectors/Utils","sap/base/util/restricted/_pick","sap/ui/fl/write/_internal/FlexInfoSession","sap/ui/core/BusyIndicator","sap/base/Log","sap/m/MessageBox"],function(e,n,t,r,s,a,i,o,u,l,c){"use strict";var S="/flex/keyuser";var E=e({},t,{layers:[n.CUSTOMER,n.PUBLIC],ROUTES:{CHANGES:S+r.API_VERSION+"/changes/",SETTINGS:S+r.API_VERSION+"/settings",TOKEN:S+r.API_VERSION+"/settings",VERSIONS:{GET:S+r.API_VERSION+"/versions/",ACTIVATE:S+r.API_VERSION+"/versions/activate/",DISCARD:S+r.API_VERSION+"/versions/draft/",PUBLISH:S+r.API_VERSION+"/versions/publish/"},TRANSLATION:{UPLOAD:S+r.API_VERSION+"/translation/texts",DOWNLOAD:S+r.API_VERSION+"/translation/texts/",GET_SOURCELANGUAGE:S+r.API_VERSION+"/translation/sourcelanguages/"},CONTEXTS:S+r.API_VERSION+"/contexts/"},isLanguageInfoRequired:true,loadFeatures:function(e){return t.loadFeatures.call(E,e).then(function(e){e.isContextSharingEnabled=true;return e})},getContexts:function(e){var n=["type","$skip","$filter"];var t=i(e,n);var a=s.getUrl(E.ROUTES.CONTEXTS,e,t);return s.sendRequest(a,"GET",{initialConnector:r}).then(function(e){return e.response})},loadContextDescriptions:function(e){var n={};s.addLanguageInfo(n);R(e);var t=s.getUrl(E.ROUTES.CONTEXTS,e,n);e.payload=JSON.stringify(e.flexObjects);e.dataType="json";e.contentType="application/json; charset=utf-8";return a.sendRequest(t,"POST",e).then(function(e){return e.response})},isContextSharingEnabled:function(){return Promise.resolve(true)},getFlexInfo:function(e){return o.get(e.selector)||{}}});function R(e){e.initialConnector=r;e.tokenUrl=E.ROUTES.TOKEN}function T(e){var n={title:e.title};e.payload=JSON.stringify(n);e.dataType="json";e.contentType="application/json; charset=utf-8"}function O(e){e.version=e.versionNumber.toString();delete e.versionNumber;return e}E.versions={load:function(e){R(e);var n={};s.addLanguageInfo(n);n.limit=e.limit;var t=s.getUrl(E.ROUTES.VERSIONS.GET,e,n);return s.sendRequest(t,"GET",e).then(function(e){return e.response.versions.map(function(e){return O(e)})})},activate:function(e){R(e);T(e);var n={version:e.version};s.addLanguageInfo(n);var t=s.getUrl(E.ROUTES.VERSIONS.ACTIVATE,e,n);return a.sendRequest(t,"POST",e).then(function(e){var n=e.response;return O(n)})},discardDraft:function(e){R(e);var n=s.getUrl(E.ROUTES.VERSIONS.DISCARD,e);return a.sendRequest(n,"DELETE",e)},publish:function(e){var n=sap.ui.getCore().getLibraryResourceBundle("sap.ui.fl");var t=function(t){u.hide();var r=n.getText("MSG_CF_PUBLISH_ERROR",t?[t.message||t]:undefined);var s=n.getText("HEADER_TRANSPORT_ERROR");l.error("publish version error"+t);c.show(r,{icon:c.Icon.ERROR,title:s,styleClass:e.styleClass});return"Error"};R(e);var r={version:e.version};var i=s.getUrl(E.ROUTES.VERSIONS.PUBLISH,e,r);return a.sendRequest(i,"POST",e).then(function(){u.hide();return n.getText("MSG_CF_PUBLISH_SUCCESS")})["catch"](t)}};E.translation={getTexts:function(e){R(e);var n=i(e,["sourceLanguage","targetLanguage"]);var t=s.getUrl(E.ROUTES.TRANSLATION.DOWNLOAD,e,n);return s.sendRequest(t,"GET",e).then(function(e){return e.response})},getSourceLanguages:function(e){R(e);var n={};var t=s.getUrl(E.ROUTES.TRANSLATION.GET_SOURCELANGUAGE,e,n);return s.sendRequest(t,"GET",e).then(function(e){return e&&e.response&&e.response.sourceLanguages?e.response.sourceLanguages:[]})},postTranslationTexts:function(e){R(e);var n=s.getUrl(E.ROUTES.TRANSLATION.UPLOAD,e,{});return s.sendRequest(n,"POST",e)}};E.initialConnector=r;return E});
//# sourceMappingURL=KeyUserConnector.js.map