/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/fl/apply/_internal/changes/descriptor/Applier","sap/ui/fl/apply/_internal/changes/descriptor/ApplyStrategyFactory","sap/ui/fl/apply/_internal/changes/Applier","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/apply/api/ControlVariantApplyAPI","sap/ui/fl/variants/VariantModel","sap/ui/fl/FlexControllerFactory","sap/ui/fl/Layer","sap/ui/fl/Utils","sap/ui/performance/Measurement"],function(e,n,t,o,r,a,i,s,l,p,c,u){"use strict";var d={};d._componentInstantiationPromises=new WeakMap;var f={};function m(n,t){if(c.getUshellContainer()){return Promise.resolve(n)}var o=window.sessionStorage.getItem("sap.ui.rta.restart."+p.CUSTOMER);if(o){var r=a.getFlexReferenceForControl(t);if(o!==r&&o!=="true"){e.error("an application component was started "+"which does not match the component for which the restart was triggered:\n"+"Triggering component: "+o+"\n"+"Started component: "+r);return Promise.resolve(n)}return new Promise(function(e,o){Promise.all([sap.ui.getCore().loadLibrary("sap.ui.rta",{async:true}),t.rootControlLoaded()]).then(function(){sap.ui.require(["sap/ui/rta/api/startKeyUserAdaptation"],function(o){o({rootControl:t});e(n)})}).catch(function(e){o(e)})})}return Promise.resolve(n)}function g(e){var n=l.createForControl(e);var t;return n._oChangePersistence.loadChangesMapForComponent(e).then(function(r){var a=o.applyAllChangesForControl.bind(o,r,e,n);a._bIsSapUiFlFlexControllerApplyChangesOnControl=true;e.addPropagationListener(a);t=d._createVariantModel(n,e);return t.initialize()}).then(function(){e.setModel(t,i.getVariantModelName());u.end("flexProcessing");return t}).then(function(n){return m(n,e)})}function h(e,n){if(c.isApplicationComponent(e)){var t=e.getId();r.rebuildFilteredResponse(a.getFlexReferenceForControl(e));var o=r.initialize({componentId:t,asyncHints:n.asyncHints}).then(g.bind(this,e)).then(function(){if(f[t]){f[t].forEach(function(n){var t=e.getModel(i.getVariantModelName());n.setModel(t,i.getVariantModelName())});delete f[t]}});d._componentInstantiationPromises.set(e,o);return o}else if(c.isEmbeddedComponent(e)){var s=c.getAppComponentForControl(e);if(s&&c.isApplicationComponent(s)){if(d._componentInstantiationPromises.has(s)){return d._componentInstantiationPromises.get(s).then(function(){var n=s.getModel(i.getVariantModelName());e.setModel(n,i.getVariantModelName())})}f[s.getId()]=f[s.getId()]||[];f[s.getId()].push(e)}return Promise.resolve()}return Promise.resolve()}function C(e,o){if(!c.isApplication(o)||!e.id){return Promise.resolve()}r.initialize({componentData:e.componentData||e.settings&&e.settings.componentData,asyncHints:e.asyncHints,manifest:o,componentId:e.id});return n.applyChangesIncludedInManifest(o,t.getRuntimeStrategy())}d._createVariantModel=function(e,n){return new s({},{flexController:e,appComponent:n})};d.instanceCreatedHook=function(){return h.apply(undefined,arguments)};d.componentLoadedHook=function(){return C.apply(undefined,arguments)};return d});
//# sourceMappingURL=ComponentLifecycleHooks.js.map