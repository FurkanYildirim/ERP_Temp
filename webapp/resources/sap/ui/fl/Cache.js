/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/ObjectPath","sap/base/Log","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/api/ControlVariantApplyAPI"],function(e,n,t,a){"use strict";var r=function(){};function c(e){switch(e.fileType){case"change":if(e.selector&&e.selector.persistencyKey){return["comp","changes"]}if(e.variantReference){return"variantDependentControlChanges"}return"changes";case"ctrl_variant":return"variants";case"ctrl_variant_change":return"variantChanges";case"ctrl_variant_management_change":return"variantManagementChanges";case"variant":return["comp","variants"];default:return undefined}}function i(n,a){var r=t.getFlexObjectsFromStorageResponse(n);var i=c(a);return e.get(i,r)}function l(e,n){if(!n){return e}return e===r.NOTAG?e.replace(/>$/,"".concat("-",n,">")):e.concat("-",n)}function o(e){return e.replace(/(^W\/|")/g,"")}r.NOTAG="<NoTag>";r.clearEntries=function(){t.clearState()};r.getChangesFillingCache=function(e,n,a){var r=Promise.resolve();if(a){r=t.clearAndInitialize(n)}return r.then(function(){return t.getStorageResponse(e.name)}).catch(function(){return{}})};r.getCacheKey=function(e,t){if(!e||!e.name||!t){n.warning("Not all parameters were passed to determine a flexibility cache key.");return Promise.resolve(r.NOTAG)}return this.getChangesFillingCache(e).then(function(e){if(e&&e.cacheKey){return o(e.cacheKey)}return r.NOTAG}).then(function(e){var n=t.getModel(a.getVariantModelName());if(!n){return e}var r=n.getVariantManagementControlIds();var c=n.getCurrentControlVariantIds().filter(function(e){return!r.includes(e)});return l(e,c.join("-"))})};r.addChange=function(e,n){var a=i(e.name,n);if(!a){return}a.push(n);t.getFlexObjectsDataSelector().checkUpdate({reference:e.name})};r.updateChange=function(e,n){var a=i(e.name,n);if(!a){return}for(var r=0;r<a.length;r++){if(a[r].fileName===n.fileName){a.splice(r,1,n);break}}t.getFlexObjectsDataSelector().checkUpdate({reference:e.name})};r.deleteChange=function(e,n){var a=i(e.name,n);if(!a){return}for(var r=0;r<a.length;r++){if(a[r].fileName===n.fileName){a.splice(r,1);break}}t.getFlexObjectsDataSelector().checkUpdate({reference:e.name})};r.removeChanges=function(e,n){var a=t.getFlexObjectsFromStorageResponse(e.name);if(!a){return}a.changes=a.changes.filter(function(e){return n.indexOf(e.fileName)===-1});t.getFlexObjectsDataSelector().checkUpdate({reference:e.name})};return r},true);
//# sourceMappingURL=Cache.js.map