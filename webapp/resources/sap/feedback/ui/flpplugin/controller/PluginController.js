"use strict";sap.ui.define(["sap/base/Log","../common/Constants","../common/UI5Util","../data/AppContextData","../data/ThemeData","../ui/ShellBarButton"],function(e,t,r,n,i,u){function a(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function o(e,t){try{var r=e()}catch(e){return t(e)}if(r&&r.then){return r.then(void 0,t)}return r}function s(e){"@babel/helpers - typeof";return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function c(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,l(n.key),n)}}function f(e,t,r){if(t)p(e.prototype,t);if(r)p(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function l(e){var t=h(e,"string");return typeof t==="symbol"?t:String(t)}function h(e,t){if(s(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==undefined){var n=r.call(e,t||"default");if(s(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var v=a(t);var m=a(r);var b=a(n);var y=a(i);var d=a(u);var T=function(){function t(e,r){c(this,t);this._pxApiWrapper=e;this._resourceBundle=r}f(t,[{key:"initPlugin",value:function e(){try{var t=function e(){r.prepareThemingSupport();r.initAppTriggeredPush()};var r=this;var n=function(){if(r._pxApiWrapper.pxApi.isUserInitiatedFeedbackEnabled){return Promise.resolve(r.initUserInitiatedFeedback()).then(function(){})}}();return Promise.resolve(n&&n.then?n.then(t):t(n))}catch(e){return Promise.reject(e)}}},{key:"prepareThemingSupport",value:function e(){y.initLastTheme();this._pxApiWrapper.updateThemeId(m.getTheme());this.subscribeThemeChanged()}},{key:"initUserInitiatedFeedback",value:function e(){try{var t=this;return Promise.resolve(d.initShellBarButton(t._resourceBundle,t.openSurveyCallback.bind(t))).then(function(){})}catch(e){return Promise.reject(e)}}},{key:"subscribeThemeChanged",value:function e(){sap.ui.getCore().attachThemeChanged(this.themeChanged.bind(this))}},{key:"themeChanged",value:function e(t){this.onThemeChanged(t)}},{key:"openSurveyCallback",value:function t(){try{var r=this;var n=o(function(){return Promise.resolve(b.getData()).then(function(e){r._pxApiWrapper.openSurvey(e)})},function(t){var r;if(t instanceof Error){r=t.message}e.error(v.ERROR.CANNOT_TRIGGER_USER_INITIATED_FEEDBACK,r,v.COMPONENT.PLUGIN_CONTROLLER)});return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}},{key:"onThemeChanged",value:function e(t){var r=t.getParameters().theme;this._pxApiWrapper.updateThemeId(r);y.updateCurrentTheme(r)}},{key:"initAppTriggeredPush",value:function e(){m.getEventBus().subscribe(v.EVENT_BUS.CHANNEL_ID,v.EVENT_BUS.EVENT_ID,this.eventBusCallback,this)}},{key:"eventBusCallback",value:function e(t,r,n){this._pxApiWrapper.requestPush(n)}},{key:"unsubscribeFromTheEventBusForTesting",value:function e(){m.getEventBus().unsubscribe(v.EVENT_BUS.CHANNEL_ID,v.EVENT_BUS.EVENT_ID,this.eventBusCallback,this)}}]);return t}();return T});
//# sourceMappingURL=PluginController.js.map