"use strict";sap.ui.define(["sap/feedback/ui/thirdparty/sap-px/pxapi","sap/base/Log","sap/ui/Device","../common/Constants","../common/Util","../embeddedCfg/EmbeddedPxConfig","../pxapi/PxApiWrapper","../storage/PushStateMigrator"],function(e,r,n,t,i,a,u,o){function f(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function s(e){"@babel/helpers - typeof";return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function l(e,r){if(!(e instanceof r)){throw new TypeError("Cannot call a class as a function")}}function N(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||false;t.configurable=true;if("value"in t)t.writable=true;Object.defineProperty(e,p(t.key),t)}}function c(e,r,n){if(r)N(e.prototype,r);if(n)N(e,n);Object.defineProperty(e,"prototype",{writable:false});return e}function p(e){var r=O(e,"string");return typeof r==="symbol"?r:String(r)}function O(e,r){if(s(e)!=="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var t=n.call(e,r||"default");if(s(t)!=="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}var d=e["Environment"];var T=n["system"];var P=f(t);var v=f(i);var m=f(a);var I=f(u);var _=f(o);var E=function(){function e(r){l(this,e);this._pxApiWrapper=new I(r)}c(e,[{key:"pxApiWrapper",get:function e(){return this._pxApiWrapper}},{key:"init",value:function e(n,t){try{var i=function e(n){if(a)return n;r.error(P.ERROR.INIT_PARAMS_INCONSISTENT,undefined,P.COMPONENT.INIT_CONTROLLER);return false};var a=false;var u=this;if(!_.migrate()){r.error(P.ERROR.PUSH_STATE_MIGRATION_FAILED,undefined,P.COMPONENT.PLUGIN_CONTROLLER);return Promise.resolve(false)}if(u.isPhone()){r.info(P.INFO.PHONE_NOT_SUPPORTED,undefined,P.COMPONENT.INIT_CONTROLLER);return Promise.resolve(false)}var o=function(){if(u.hasOldParameters(n)){return Promise.resolve(u.initWithOldParameters(n,t)).then(function(e){a=true;return e})}else return function(){if(u.hasNewParameters(n)){if(u.hasUrlParameters()){u.overwriteWithUrlParameters(n)}return Promise.resolve(u.initWithNewParameters(n,t)).then(function(e){a=true;return e})}}()}();return Promise.resolve(o&&o.then?o.then(i):i(o))}catch(e){return Promise.reject(e)}}},{key:"isPhone",value:function e(){return T.phone}},{key:"hasNewParameters",value:function e(n){if(n.configUrl&&n.unitId&&n.environment){r.debug(P.DEBUG.INIT_PARAMS_MANDATORY_FOUND_NEW,undefined,P.COMPONENT.INIT_CONTROLLER);return true}r.debug(P.DEBUG.INIT_PARAMS_MANDATORY_NOT_SET_NEW,undefined,P.COMPONENT.INIT_CONTROLLER);if(n.configJson){r.debug(P.DEBUG.INIT_PARAMS_MANDATORY_FOUND_JSON,undefined,P.COMPONENT.INIT_CONTROLLER);return true}r.debug(P.DEBUG.INIT_PARAMS_MANDATORY_NOT_SET_JSON,undefined,P.COMPONENT.INIT_CONTROLLER);return false}},{key:"hasOldParameters",value:function e(n){if(n.qualtricsInternalUri&&n.tenantId){r.debug(P.DEBUG.INIT_PARAMS_MANDATORY_FOUND_OLD,undefined,P.COMPONENT.INIT_CONTROLLER);return true}r.debug(P.DEBUG.INIT_PARAMS_MANDATORY_NOT_SET_OLD,undefined,P.COMPONENT.INIT_CONTROLLER);return false}},{key:"hasUrlParameters",value:function e(){if(v.isUnitIdUrlParamSet()&&v.isEnvironmentUrlParamSet()){r.debug(P.DEBUG.INIT_PARAMS_URL_MODIFIED,undefined,P.COMPONENT.INIT_CONTROLLER);return true}return false}},{key:"overwriteWithUrlParameters",value:function e(r){var n=v.getUnitIdUrlParamValue();if(n){r.unitId=n}var t=v.getEnvironmentUrlParamValue();if(t){r.environment=t}}},{key:"initWithNewParameters",value:function e(n,t){try{var i=function e(n){if(a)return n;r.error(P.ERROR.INIT_PARAMS_INCONSISTENT,undefined,P.COMPONENT.INIT_CONTROLLER);return false};var a=false;var u=this;var o=function(){if(n.configUrl&&!n.configJson){var e={tenantId:n.tenantId,tenantRole:n.tenantRole};var r={configUrl:n.configUrl,unitId:n.unitId,environment:n.environment};return Promise.resolve(u._pxApiWrapper.initialize(e,r,undefined,t)).then(function(e){a=true;return e})}else return function(){if(!n.configUrl&&n.configJson){var e={tenantId:n.tenantId,tenantRole:n.tenantRole};var r=n.configJson;return Promise.resolve(u._pxApiWrapper.initialize(e,undefined,r,t)).then(function(e){a=true;return e})}}()}();return Promise.resolve(o&&o.then?o.then(i):i(o))}catch(e){return Promise.reject(e)}}},{key:"initWithOldParameters",value:function e(r,n){try{var t=this;var i={version:"0.3.1",unitId:P.DEFAULT_VALUE_NA,environment:d.prod,startupConfig:{qualtricsInternalUri:r.qualtricsInternalUri,productName:r.productName,platformType:r.platformType,scopeSet:t.convertScopeSet(r.scopeSet)},runtimeConfig:{useApi:true},themingConfig:{writeToGlobals:true},pushConfig:m.pushConfig()};var a={tenantId:r.tenantId,tenantRole:r.tenantRole};return Promise.resolve(t._pxApiWrapper.initialize(a,undefined,i,n))}catch(e){return Promise.reject(e)}}},{key:"convertScopeSet",value:function e(r){var n={featurePush:P.SCOPE_SETS.APP_PUSH,dynamicPush:P.SCOPE_SETS.TIMED_PUSH};if(r){var t=r.split(",");t=this.appendManualScopeSet(t);var i=t.map(function(e){return n[e.trim()]||e.trim()});return i}return[P.SCOPE_SETS.MANUAL]}},{key:"appendManualScopeSet",value:function e(r){if(r.indexOf(P.SCOPE_SETS.MANUAL)>-1){return r}r.push(P.SCOPE_SETS.MANUAL);return r}}]);return e}();return E});
//# sourceMappingURL=InitController.js.map