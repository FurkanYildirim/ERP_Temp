/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/array/uniqueSort","sap/base/util/merge","sap/fe/core/converters/ConverterContext","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/SemanticDateOperators","sap/fe/core/helpers/StableIdHelper","sap/fe/core/library","sap/fe/core/StateFilterToSelectionVariant","sap/fe/core/type/TypeUtil","sap/ui/core/Component","sap/ui/core/Fragment","sap/ui/core/util/XMLPreprocessor","sap/ui/core/XMLTemplateProcessor","sap/ui/Device","sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/model/Filter","./controls/AnyElement","./helpers/MetaModelFunction","./templating/FilterHelper"],function(e,t,n,o,i,r,s,a,c,l,u,p,f,g,d,m,b,O,h,v,P,y){"use strict";var S={};var j=y.getConditions;var C=b.system;var A=c.generate;var x=r.pathInModel;var E=r.compileExpression;const T=l.ProgrammingModel;function $(e){if(!e){return undefined}return e.replace(/"/g," ").replace(/\\/g,"\\\\").split(/\s+/).reduce(function(e,t){if(t!==""){e=`${e?`${e} `:""}"${t}"`}return e},undefined)}async function F(e){var t;const n=e.getModel();const o=n.getMetaModel();const r=o.getMetaPath(e.getPath());const s=i.getInvolvedDataModelObjects(o.getContext(r));await e.requestProperty((t=s.targetEntityType.keys[0])===null||t===void 0?void 0:t.name)}function M(e){let t=false;if(e){e.getCurrentContexts().forEach(function(e){if(e&&e.isTransient()){t=true}})}return t}async function R(e,t,n,o){return e.getLinks({semanticObject:n,params:o})}function N(e){const t=[];const n=Object.keys(e);let o;for(let i=0;i<n.length;i++){o={LocalProperty:{$PropertyPath:n[i]},SemanticObjectProperty:e[n[i]]};t.push(o)}return t}function w(e,t,n,o,i){for(let r=0;r<e.length;r++){const s=e[r];const a=s.intent;const c=a.split("-")[1].split("?")[0];if(i&&i.includes(c)){o.push({text:s.text,targetSemObject:a.split("#")[1].split("-")[0],targetAction:c.split("~")[0],targetParams:n})}else if(!i&&t&&t.indexOf(c)===-1){o.push({text:s.text,targetSemObject:a.split("#")[1].split("-")[0],targetAction:c.split("~")[0],targetParams:n})}}}function D(e,t,n,o){if(o&&o.length>0){const i=e.allowedActions||undefined;const r=e.unavailableActions?e.unavailableActions:[];const s=e.mapping?N(e.mapping):[];const a={navigationContexts:t,semanticObjectMapping:s};w(o,r,a,n,i)}}function L(e,t,n,o){if(o.length>0){const i=[e.action];const r=[];const s=[];const a={navigationContexts:t,semanticObjectMapping:s};w(o,r,a,n,i)}}async function k(t,n,o,i,r,s,a){const c=a.getShellServices();const l={};let u="",p="";let f;let g=[];let d=[];let m;async function b(){const e=c.parseShellHash(document.location.hash);u=e.semanticObject;p=e.action;return R(c,o,u,l)}try{if(n){if(i&&i.length>0){for(let e=0;e<i.length;e++){const t=i[e].$PropertyPath;if(!l[t]){l[t]={value:n[t]}}}}else{const e=r.getObject(`${s}/$Type/$Key`);for(const t in e){const o=e[t];if(!l[o]){l[o]={value:n[o]}}}}}const e=G(o).getViewData();const O=[];let h;if(e.additionalSemanticObjects){m=Object.keys(e.additionalSemanticObjects);for(let n=0;n<m.length;n++){h=await Promise.resolve(R(c,o,m[n],l));D(e.additionalSemanticObjects[m[n]],t,O,h)}}const v=[];const P=a.getComponentData();if(P.feEnvironment&&P.feEnvironment.getIntent()){const e=P.feEnvironment.getIntent();h=await Promise.resolve(R(c,o,e.semanticObject,l));L(e,t,v,h)}const y=o.getBindingContext("internal");const S=await b();if(S){if(S.length>0){let n=false;const o={};const i=[];const a=`${s}@`;const c=`${s}/@`;const l=r.getObject(a);f=qe.getSemanticObjectAnnotations(l,u);if(!f.bHasEntitySetSO){const e=r.getObject(c);f=qe.getSemanticObjectAnnotations(e,u)}d=f.aUnavailableActions;d.push(p);o.navigationContexts=t;o.semanticObjectMapping=f.aMappings;w(S,d,o,i);O.forEach(function(e){var t;let{targetSemObject:o}=e;if(((t=i[0])===null||t===void 0?void 0:t.targetSemObject)===o){n=true}});if(e.additionalSemanticObjects&&i[0]&&e.additionalSemanticObjects[i[0].targetSemObject]&&!!e.additionalSemanticObjects[i[0].targetSemObject].allowedActions){n=true}const m=O.concat(v);g=n?m:m.concat(i);y.setProperty("relatedApps/visibility",g.length>0);y.setProperty("relatedApps/items",g)}else{y.setProperty("relatedApps/visibility",false)}}else{y.setProperty("relatedApps/visibility",false)}}catch(t){e.error("Cannot read links",t)}return g}function B(e,t){const n={bHasEntitySetSO:false,aAllowedActions:[],aUnavailableActions:[],aMappings:[]};let o,i;let r;for(const s in e){if(s.indexOf("com.sap.vocabularies.Common.v1.SemanticObject")>-1&&e[s]===t){n.bHasEntitySetSO=true;o=`@${"com.sap.vocabularies.Common.v1.SemanticObjectMapping"}`;i=`@${"com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions"}`;if(s.indexOf("#")>-1){r=s.split("#")[1];o=`${o}#${r}`;i=`${i}#${r}`}if(e[o]){n.aMappings=n.aMappings.concat(e[o])}if(e[i]){n.aUnavailableActions=n.aUnavailableActions.concat(e[i])}break}}return n}function I(t,n){const o=t.getModel().getMetaModel();const i=t.getBindingContext();const r=i&&i.getPath()||"";const s=o.getMetaPath(r);const a=`${s}/`+`@com.sap.vocabularies.Common.v1.SemanticKey`;const c=o.getObject(a);const l=i===null||i===void 0?void 0:i.getObject();if(!l&&i){i.requestObject().then(async function(e){return qe.updateRelateAppsModel(i,e,t,c,o,s,n)}).catch(function(t){e.error("Cannot update the related app details",t)})}else{return qe.updateRelateAppsModel(i,l,t,c,o,s,n)}}function V(e){if(e&&e.isA(["sap.m.Button","sap.m.OverflowToolbarButton"])&&e.getVisible()&&e.getEnabled()){e.firePress()}}function q(e){if(e.isA("sap.fe.core.AppComponent")){return e}const t=f.getOwnerComponentFor(e);if(!t){throw new Error("There should be a sap.fe.core.AppComponent as owner of the control")}else{return q(t)}}function U(e){const t=e.getRootViewController();return t.isFclEnabled()?t.getRightmostView():qe.getTargetView(e.getRootContainer().getCurrentPage())}function G(e){if(e&&e.isA("sap.ui.core.ComponentContainer")){const t=e.getComponentInstance();e=t&&t.getRootControl()}while(e&&!e.isA("sap.ui.core.mvc.View")){e=e.getParent()}return e}function H(e,t){for(const n in t){if(t[n]!==e[n]){return false}}return true}function W(e,t,n){const o=e.getObject(`${t}/`)||{},i={};for(const e in o){if(o.hasOwnProperty(e)&&!/^\$/i.test(e)&&o[e].$kind&&H(o[e],n||{$kind:"Property"})){i[e]=o[e]}}return i}function Y(e,t){let n=[];if(e&&t){n=e.getObject(`${t}@Org.OData.Capabilities.V1.FilterRestrictions/RequiredProperties`)}return n}function _(e,t){const n=e&&e.getActions();if(n){n.forEach(function(e){if(e.isA("sap.ui.mdc.actiontoolbar.ActionToolbarAction")){e=e.getAction()}if(e.isA("sap.m.MenuButton")){const n=e.getMenu();const o=n.getItems();o.forEach(e=>{if(e.data("IBNData")){t.push(e)}})}else if(e.data("IBNData")){t.push(e)}})}return t}function Q(t,n){const o={};const i=qe.getAppComponent(n);const r=s.isStickySessionSupported(n.getModel().getMetaModel());const a=function(n){if(n){const e=Object.keys(n);e.forEach(function(e){if(e.indexOf("_")!==0&&e.indexOf("odata.context")===-1){o[e]={value:n[e]}}})}if(t.length){t.forEach(function(t){const n=t.data("IBNData").semanticObject;const s=t.data("IBNData").action;i.getShellServices().getLinks({semanticObject:n,action:s,params:o}).then(function(e){t.setVisible(t.getVisible()&&e&&e.length===1);if(r){t.getBindingContext("internal").setProperty(t.getId().split("--")[1],{shellNavigationNotAvailable:!(e&&e.length===1)})}return}).catch(function(t){e.error("Cannot retrieve the links from the shell service",t)})})}};if(n&&n.getBindingContext()){var c;(c=n.getBindingContext())===null||c===void 0?void 0:c.requestObject().then(function(e){return a(e)}).catch(function(t){e.error("Cannot retrieve the links from the shell service",t)})}else{a()}}function K(e,t,n,o){const i=!n?e.getObject(e.getPath()).toString():n;let r=e.getPath().split("/@")[0];const s=e.getObject(r).$Type;const a=J(e.getModel(),s);if(a){r=`/${a}`}if(o){return e.getObject(`${r}/${i}@Org.OData.Core.V1.OperationAvailable`)}if(t){return`${r}/${i}`}else{return{sContextPath:r,sProperty:e.getObject(`${r}/${i}@Org.OData.Core.V1.OperationAvailable/$Path`),sBindingParameter:e.getObject(`${r}/${i}/@$ui5.overload/0/$Parameter/0/$Name`)}}}function J(e,t){const n=e.getObject("/");for(const e in n){if(typeof n[e]==="object"&&n[e].$Type===t){return e}}}function X(e,t){const n=e["@com.sap.vocabularies.Common.v1.Text"],o=n&&(e&&e["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"]||t&&t["@com.sap.vocabularies.UI.v1.TextArrangement"]);if(o){if(o.$EnumMember==="com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly"){return"Description"}else if(o.$EnumMember==="com.sap.vocabularies.UI.v1.TextArrangementType/TextLast"){return"ValueDescription"}else if(o.$EnumMember==="com.sap.vocabularies.UI.v1.TextArrangementType/TextSeparate"){return"Value"}return"DescriptionValue"}return n?"DescriptionValue":"Value"}function z(e){const t=e.getModel().getMetaModel();return t.getObject(`${t.getMetaPath(e.getPath())}/$Type`)}async function Z(t,n,o){let i=n;const r=t.indexOf("(");if(r>-1){const n=t.slice(r+1,-1);let o=z(i);while(o!==n){i=i.getBinding().getContext();if(i){o=z(i)}else{e.warning("Cannot determine target type to request property value for bound action invocation");return Promise.resolve(undefined)}}}return i.requestObject(o)}async function ee(e,t,n,o){const i=n&&n.indexOf("/")===0?Re(n,e.getModel()):Z(t,e,n);return i.then(function(n){return{vPropertyValue:n,oSelectedContext:e,sAction:t,sDynamicActionEnabledPath:o}})}async function te(t,n){return Promise.all(n).then(function(e){if(e.length){const n=[],o=[];e.forEach(function(e){if(e){if(e.vPropertyValue){t.getModel().setProperty(e.sDynamicActionEnabledPath,true);n.push(e.oSelectedContext)}else{o.push(e.oSelectedContext)}}});ne(t,e[0].sAction,n,o)}return}).catch(function(t){e.trace("Cannot retrieve property value from path",t)})}function ne(e,t,n,o){const i=`${e.getPath()}/dynamicActions/${t}`,r=e.getModel();r.setProperty(`${i}/aApplicable`,n);r.setProperty(`${i}/aNotApplicable`,o)}function oe(e){const t=p.getDataTypeClassName(e);const n=p.getBaseType(t,{},{});return O.getOperatorsForType(n)}function ie(e,t){return e.filter(function(e){return t.indexOf(e)>-1})}function re(e){const t=qe.AllowedExpressionsPrio;e.sort(function(e,n){return t.indexOf(e)-t.indexOf(n)});return e[0]}function se(e,t,n,o,i,r){const s=qe.getFilterRestrictionsByPath(t,n);const c=["EQ"];const l=["EQ","GE","LE","LT","GT","BT","NOTLE","NOTLT","NOTGE","NOTGT"];const u=["EQ","BT"];const p=["TODAY","TOMORROW","YESTERDAY","DATE","FIRSTDAYWEEK","LASTDAYWEEK","FIRSTDAYMONTH","LASTDAYMONTH","FIRSTDAYQUARTER","LASTDAYQUARTER","FIRSTDAYYEAR","LASTDAYYEAR"];const f=["EQ","GE","LE","LT","GT","BT","NE","NOTBT","NOTLE","NOTLT","NOTGE","NOTGT"];const g=["Contains","NotContains","StartsWith","NotStartsWith","EndsWith","NotEndsWith"];const d=a.getSupportedOperations();const m=i==="true"||i===true;let b=[];const O=r&&typeof r==="string"?JSON.parse(r).customData:r;if(n.getObject(`${t}/@com.sap.vocabularies.Common.v1.ResultContext`)===true){return c}if(O&&O.operatorConfiguration&&O.operatorConfiguration.length>0){b=a.getFilterOperations(O.operatorConfiguration,o)}else{b=a.getSemanticDateOperations(o)}let h=oe(o);if(m){h=d.concat(h)}let v=[];if(s&&s.FilterAllowedExpressions&&s.FilterAllowedExpressions[e]){const t=qe.getSpecificAllowedExpression(s.FilterAllowedExpressions[e]);switch(t){case"SingleValue":const e=o==="Edm.Date"&&m?p:c;v=ie(h,e);break;case"MultiValue":v=ie(h,c);break;case"SingleRange":let t;if(m){if(o==="Edm.Date"){t=b}else if(o==="Edm.DateTimeOffset"){t=b}else{t=l}}else if(o==="Edm.DateTimeOffset"){t=u}else{t=l}const n=ie(h,t);v=n;break;case"MultiRange":v=ie(h,f);break;case"SearchExpression":v=ie(h,g);break;case"MultiRangeOrSearchExpression":v=ie(h,g.concat(f));break;default:break}}return v}S.getOperatorsForProperty=se;function ae(){const e=["EQ","NE"];return e.toString()}function ce(e){const t=oe(e);const n=["EQ","GE","LE","LT","GT","BT","NE","NOTBT","NOTLE","NOTLT","NOTGE","NOTGT"];return ie(t,n)}function le(e,t){const n=t.substring(0,t.lastIndexOf("/"));const o=e.getObject(`${n}/@com.sap.vocabularies.Common.v1.ResultContext`);const i={};if(o&&n!==t){i.contextPath=n;i.parameterProperties=qe.getContextPathProperties(e,n)}return i}function ue(e,t,n,o,i){var r;const s=j(i,e);if(i!==null&&i!==void 0&&i.SemanticDates&&n&&n.indexOf(i===null||i===void 0?void 0:(r=i.SemanticDates)===null||r===void 0?void 0:r.operator)>-1){const e=qe.addSemanticDatesToConditions(i===null||i===void 0?void 0:i.SemanticDates);if(e&&Object.keys(e).length>0){o.push(e)}}else if(s){if(t.length===0||t.indexOf(s.operator)>-1){o.push(s)}}return o}function pe(e){const t=[];if(e!==null&&e!==void 0&&e.high){t.push(e===null||e===void 0?void 0:e.high)}if(e!==null&&e!==void 0&&e.low){t.push(e===null||e===void 0?void 0:e.low)}return{values:t,operator:e===null||e===void 0?void 0:e.operator,isEmpty:undefined}}function fe(e,t,n){const o=qe.getAppComponent(n);const i=o.getNavigationService();return i.mixAttributesAndSelectionVariant(t,e.toJSONString())}function ge(e,t,n,o){const i=t.filterConditions;const r=t.filterConditionsWithoutConflict?t.filterConditionsWithoutConflict:{};const s=o!==null&&o!==void 0&&o.propertiesWithoutConflict?o.propertiesWithoutConflict:{};const a=u.getSelectionVariantFromConditions(i,n.getPropertyHelper());for(const t in i){const n=a.getSelectOption(t);if(!e.getSelectOption(t)){if(t==="$editState"){continue}if(n){e.massAddSelectOption(t,n)}}else{if(s&&t in s){e.massAddSelectOption(s[t],n)}if(t in r){e.massAddSelectOption(r[t],n)}}}return e}function de(e){const t=s.isStickySessionSupported(e.getModel().getMetaModel());const n=e.getModel("ui").getProperty("/isEditable");return t&&n}function me(e,t,n){if(t&&e&&e.length){for(let o=0;o<e.length;o++){const i=t.getSelectOption("DisplayCurrency"),r=n&&n.getSelectOption("DisplayCurrency");if(e[o].$PropertyPath==="DisplayCurrency"&&(!i||!i.length)&&r&&r.length){const e=r[0];const n=e["Sign"];const o=e["Option"];const i=e["Low"];const s=e["High"];t.addSelectOption("DisplayCurrency",n,o,i,s)}}}}async function be(e,t,n,o,i,r){const s=e.getComponentData(),a=s&&s.startupParameters||{},c=e.getShellServices();const l=await c.getStartupAppState(e);const u=(l===null||l===void 0?void 0:l.getData())||{},p=u.selectionVariant&&u.selectionVariant.SelectOptions||[];t.forEach(function(e){var t;const s=o?`/${e.$Name}`:(t=e.getPath)===null||t===void 0?void 0:t.call(e).slice(e.getPath().lastIndexOf("/")+1);const c=o?s.slice(1):s;if(r&&i){if(r[c]){n.setProperty(s,r[c])}}else if(a[c]){n.setProperty(s,a[c][0])}else if(p.length>0){for(const e of p){if(e.PropertyName===c){const t=e.Ranges.length?e.Ranges[e.Ranges.length-1]:undefined;if(t&&t.Sign==="I"&&t.Option==="EQ"){n.setProperty(s,t.Low)}}}}})}function Oe(e,t){const n=t,o=n!==undefined?Object.keys(n).filter(function(e){return n[e].useForCreate}):[];let i;for(let t=0;t<o.length;t++){const n=o[t];const r=e&&e[n];if(r&&r.length===1){i=i||Object.create(null);i[n]=r[0]}}return i}function he(e){const t=[];if(e.parameters){const n=Object.keys(e.parameters)||[];if(n.length>0){n.forEach(function(n){const o=e.parameters[n];if(o.value&&o.value.value&&o.value.format==="binding"){const e={LocalProperty:{$PropertyPath:o.value.value},SemanticObjectProperty:n};if(t.length>0){for(let n=0;n<t.length;n++){var i;if(((i=t[n].LocalProperty)===null||i===void 0?void 0:i.$PropertyPath)!==e.LocalProperty.$PropertyPath){t.push(e)}}}else{t.push(e)}}})}}return t}function ve(t,n){const o={};let i;const r=t.controlConfiguration;for(const t in r){if(t.indexOf("@com.sap.vocabularies.UI.v1.DataPoint")>-1||t.indexOf("@com.sap.vocabularies.UI.v1.Chart")>-1){var s,a;const c=(s=r[t].navigation)===null||s===void 0?void 0:(a=s.targetOutbound)===null||a===void 0?void 0:a.outbound;if(c!==undefined){const r=n[c];if(r.semanticObject&&r.action){if(t.indexOf("Chart")>-1){i=A(["fe","MicroChartLink",t])}else{i=A(["fe","HeaderDPLink",t])}const e=qe.getSemanticObjectMapping(r);o[i]={semanticObject:r.semanticObject,action:r.action,semanticObjectMapping:e}}else{e.error(`Cross navigation outbound is configured without semantic object and action for ${c}`)}}}}return o}function Pe(e,t){const n=typeof t==="string"?JSON.parse(t):t;for(let t=0;t<n.length;t++){const o=n[t]["LocalProperty"]&&n[t]["LocalProperty"]["$PropertyPath"]||n[t]["@com.sap.vocabularies.Common.v1.LocalProperty"]&&n[t]["@com.sap.vocabularies.Common.v1.LocalProperty"]["$Path"];const i=n[t]["SemanticObjectProperty"]||n[t]["@com.sap.vocabularies.Common.v1.SemanticObjectProperty"];const r=e.getSelectOption(o);if(r){e.removeSelectOption(o);e.massAddSelectOption(i,r)}}return e}async function ye(e,t,n){return new Promise(function(o){let i,r;if(n===""){i=e.getObject(`${t}@${"com.sap.vocabularies.Common.v1.SemanticObject"}`);r=e.getObject(`${t}@${"com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions"}`)}else{i=e.getObject(`${t}@${"com.sap.vocabularies.Common.v1.SemanticObject"}#${n}`);r=e.getObject(`${t}@${"com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions"}#${n}`)}const s=[{semanticObject:i}];const a={semanticObject:i};o({semanticObjectPath:t,semanticObjectForGetLinks:s,semanticObject:a,unavailableActions:r})})}async function Se(t,o,i,r){return Promise.all(t).then(function(e){let t,s,a,c=[];let l={};const u=function(e,t){for(const n in t){if(n===e){return true}else{return false}}};for(let n=0;n<e.length;n++){t=e[n];if(t&&t.length>0&&t[0]!==undefined){const e={};let i;let p;for(let l=0;l<t.length;l++){c.push([]);let f=false;let g=false;for(let e=0;e<t[l][0].length;e++){s=t[l][0][e];a=s&&s.intent.split("?")[0].split("-")[1];if(!(s&&s.intent&&s.intent.indexOf(r)===0)){f=true;if(!u(a,o[n].unavailableActions)){c[l].push(s);g=true}}}i={semanticObject:o[n].semanticObject,path:o[n].path,HasTargets:g,HasTargetsNotFiltered:f};if(e[o[n].semanticObject]===undefined){e[o[n].semanticObject]={}}p=o[n].path.replace(/\//g,"_");if(e[o[n].semanticObject][p]===undefined){e[o[n].semanticObject][p]={}}e[o[n].semanticObject][p]=Object.assign(e[o[n].semanticObject][p],i)}const f=Object.keys(e)[0];if(Object.keys(l).includes(f)){l[f]=Object.assign(l[f],e[f])}else{l=Object.assign(l,e)}c=[]}}if(Object.keys(l).length>0){i.setProperty("semanticsTargets",n(l,i.getProperty("semanticsTargets")));return l}return}).catch(function(t){e.error("fnUpdateSemanticTargetsModel: Cannot read links",t)})}async function je(e,t,n,o,i){return qe.getSemanticObjectsFromPath(n,o,i)}function Ce(e,t,n,o,i){let r,s;let a,c;for(let l=0;l<o.length;l++){s=o[l];r=Object.keys(n.getObject(s+"@"));for(let o=0;o<r.length;o++){if(r[o].indexOf(`@${"com.sap.vocabularies.Common.v1.SemanticObject"}`)===0&&r[o].indexOf(`@${"com.sap.vocabularies.Common.v1.SemanticObjectMapping"}`)===-1&&r[o].indexOf(`@${"com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions"}`)===-1){c=/#(.*)/.exec(r[o]);a=c?c[1]:"";i.push(qe.getSemanticObjectPromise(e,t,n,s,a))}}}}function Ae(t,n){const o=function(e,t,n){if(!e){return n}if(e instanceof Array){e.forEach(e=>{n=n.concat(o(e,t,[]))});return n}if(e[t]){n.push(e[t])}if(typeof e=="object"&&e!==null){const i=Object.keys(e);if(i.length>0){for(let r=0;r<i.length;r++){n=n.concat(o(e[i[r]],t,[]))}}}return n};const i=function(e,t){return o(e,t,[])};const r=function(e){return e.filter(function(t,n){return e.indexOf(t)===n})};const s=t.getView();const a=s.getBindingContext("internal");if(a){const o=[];const c=t.getOwnerComponent();const l=f.getOwnerComponentFor(c);const u=l.getMetaModel();let p=c.getModel(n).getData();if(JSON.stringify(p)==="{}"){p=c.getModel(n)._getObject("/",undefined)}let g=i(p,"semanticObjectPath");g=r(g);const d=l.getShellServices();let m=d.getHash();const b=[];const O=[];let h;if(m&&m.indexOf("?")!==-1){m=m.split("?")[0]}Ce(l,s,u,g,o);if(o.length===0){return Promise.resolve()}else{Promise.all(o).then(async function(e){const t=[];let n;const o=e.filter(function(e){if(e.semanticObject!==undefined&&e.semanticObject.semanticObject&&typeof e.semanticObject.semanticObject==="object"){n=E(x(e.semanticObject.semanticObject.$Path));e.semanticObject.semanticObject=n;e.semanticObjectForGetLinks[0].semanticObject=n;return true}else if(e){return e.semanticObject!==undefined}else{return false}});for(let e=0;e<o.length;e++){h=o[e];if(h&&h.semanticObject&&!(h.semanticObject.semanticObject.indexOf("{")===0)){b.push(h.semanticObjectForGetLinks);O.push({semanticObject:h.semanticObject.semanticObject,unavailableActions:h.unavailableActions,path:o[e].semanticObjectPath});t.push(d.getLinksWithCache([h.semanticObjectForGetLinks]))}}return qe.updateSemanticTargets(t,O,a,m)}).catch(function(t){e.error("fnGetSemanticTargetsFromTable: Cannot get Semantic Objects",t)})}}else{return Promise.resolve()}}function xe(e){const t={};if(e&&e.FilterExpressionRestrictions!==undefined){e.FilterExpressionRestrictions.forEach(function(e){if(e.Property&&e.AllowedExpressions!==undefined){if(t[e.Property.$PropertyPath]!==undefined){t[e.Property.$PropertyPath].push(e.AllowedExpressions)}else{t[e.Property.$PropertyPath]=[e.AllowedExpressions]}}})}return t}function Ee(e,t){let n=[];if(e&&e[t]){n=e[t].map(function(e){return e.$PropertyPath})}return n}function Te(e,t,n){const o=t+"/";return e.reduce((e,t)=>{if(t.startsWith(o)){const n=t.replace(o,"");if(e.indexOf(n)===-1){e.push(n)}}return e},n)}function $e(e,o){const i={RequiredProperties:[],NonFilterableProperties:[],FilterAllowedExpressions:{}};let r;const a="$NavigationPropertyBinding";const c="@Org.OData.Capabilities.V1.FilterRestrictions";const l=e.replaceAll("%2F","/").split("/").filter(s.filterOutNavPropBinding);const u=`/${l.join("/")}/`;const p=s.getEntitySetPath(e,o);const f=p.split("/").filter(s.filterOutNavPropBinding);const g=o.getObject(`${u}$ContainsTarget`);const d=!!g&&l[l.length-1];if(!g){r=o.getObject(`${p}${c}`);i.RequiredProperties=Ee(r,"RequiredProperties")||[];const e=o.getObject(`${u}@com.sap.vocabularies.Common.v1.ResultContext`);if(!e){i.NonFilterableProperties=Ee(r,"NonFilterableProperties")||[]}i.FilterAllowedExpressions=xe(r)||{}}if(l.length>1){const e=g?d:f[f.length-1];const r=g?p:`/${f.slice(0,-1).join(`/${a}/`)}`;const s={RequiredProperties:[],NonFilterableProperties:[],FilterAllowedExpressions:{}};if(!e.includes("%2F")){const t=o.getObject(`${r}${c}`);i.RequiredProperties=Te(Ee(t,"RequiredProperties")||[],e,i.RequiredProperties||[]);i.NonFilterableProperties=Te(Ee(t,"NonFilterableProperties")||[],e,i.NonFilterableProperties||[]);const n=xe(t)||{};s.FilterAllowedExpressions=Object.keys(n).reduce((t,o)=>{if(o.startsWith(e+"/")){const i=o.replace(e+"/","");t[i]=n[o]}return t},{})}i.FilterAllowedExpressions=n({},i.FilterAllowedExpressions||{},s.FilterAllowedExpressions||{});const u=P.getNavigationRestrictions(o,r,e.replaceAll("%2F","/"));const m=u&&u["FilterRestrictions"];const b=Ee(m,"RequiredProperties")||[];i.RequiredProperties=t(i.RequiredProperties.concat(b));const O=Ee(m,"NonFilterableProperties")||[];i.NonFilterableProperties=t(i.NonFilterableProperties.concat(O));i.FilterAllowedExpressions=n({},i.FilterAllowedExpressions||{},xe(m)||{});const h=o.getObject(`/${l.join("/")}${c}`);const v=Ee(h,"RequiredProperties")||[];i.RequiredProperties=t(i.RequiredProperties.concat(v));const y=Ee(h,"NonFilterableProperties")||[];i.NonFilterableProperties=t(i.NonFilterableProperties.concat(y));i.FilterAllowedExpressions=n({},i.FilterAllowedExpressions,xe(h)||{})}return i}async function Fe(e,t,n,o){n=n||{};if(o){return o.templateControlFragment(e,t,n.view).then(function(e){return o.targets==="xmlTree"&&e.length>0?e[0]:e})}else{const o=await d.process(m.loadTemplate(e,"fragment"),{name:e},t);const i=o.firstElementChild;if(!!n.isXML&&i){return i}return g.load({id:n.id,definition:o,controller:n.controller})}}function Me(e,t){const n=e.split("/").filter(Boolean),o=n.pop(),i=n.join("/"),r=i&&t.getObject(`/${i}`);if((r===null||r===void 0?void 0:r.$kind)==="Singleton"){const e=n[n.length-1];return`/${e}/${o}`}return undefined}async function Re(e,t){if(!e||!t){return Promise.resolve(null)}const n=t.getMetaModel();const o=Me(e,n);if(o){const e=t.bindProperty(o);return e.requestValue()}return Promise.resolve(null)}function Ne(e,t){let n;if(e.indexOf("@$ui5.overload")>-1){n=e.split("@$ui5.overload")[0]}else{const t=e.split("/0")[0].split(".");n=`/${t[t.length-1]}/`}return n+t}function we(e,t){const n=new v({anyText:e});t.addDependent(n);const o=n.getAnyText();t.removeDependent(n);n.destroy();return o}function De(){return!C.desktop||b.resize.width<=320}function Le(e,t,n){const o=e.data("entityType"),i=qe.getAppComponent(e).getMetaModel(),r={},s=[],a=[];let c="";let l=i.getObject(`${o}${t}`);if(n){l=l.SelectionVariant}if(l){c=l.Text;(l.SelectOptions||[]).filter(function(e){return e&&e.PropertyName&&e.PropertyName.$PropertyPath}).forEach(function(e){const t=e.PropertyName.$PropertyPath;if(!a.includes(t)){a.push(t)}for(const i in e.Ranges){var n,o;const s=e.Ranges[i];r[t]=(r[t]||[]).concat(new h(t,(n=s.Option)===null||n===void 0?void 0:(o=n.$EnumMember)===null||o===void 0?void 0:o.split("/").pop(),s.Low,s.High))}});for(const e in r){s.push(new h({filters:r[e],and:false}))}}return{properties:a,filters:s,text:c}}function ke(e,t,i,r){const s=t.createBindingContext(e);return o===null||o===void 0?void 0:o.createConverterContextForMacro(i,s||t,r,n,undefined)}function Be(e,t){return e.replace("_fe_"+t+"_","")}function Ie(e){e.forEach(e=>{if(e.sPath&&e.sPath.includes("fe_groupable")){e.sPath=qe.getInternalChartNameFromPropertyNameAndKind(e.sPath,"groupable")}});return e}async function Ve(e,t,n){const o=t.getBindingContext();if(o){const a=e===T.Draft?s.getDraftRootPath(o):s.getStickyRootPath(o);let c;if(a){var i,r;const e=(i=n.getRootViewController().getInstancedViews().find(e=>{var t;return((t=e.getBindingContext())===null||t===void 0?void 0:t.getPath())===a}))===null||i===void 0?void 0:i.getBindingContext();if(e){return e}const s=t.getModel("internal");c=s.getProperty("/simpleRootContext");if(((r=c)===null||r===void 0?void 0:r.getPath())===a){return c}const l=o.getModel();c=l.bindContext(a).getBoundContext();await qe.waitForContextRequested(c);s.setProperty("/simpleRootContext",c);return c}}}const qe={fireButtonPress:V,getTargetView:G,getCurrentPageView:U,hasTransientContext:M,updateRelatedAppsDetails:I,getAppComponent:q,getMandatoryFilterFields:Y,getContextPathProperties:W,getParameterInfo:le,updateDataFieldForIBNButtonsVisibility:Q,getEntitySetName:J,getActionPath:K,computeDisplayMode:X,isStickyEditMode:de,getOperatorsForProperty:se,getOperatorsForDateProperty:ce,getOperatorsForGuidProperty:ae,addExternalStateFiltersToSelectionVariant:ge,addPageContextToSelectionVariant:fe,addDefaultDisplayCurrency:me,setUserDefaults:be,getIBNActions:_,getHeaderFacetItemConfigForExternalNavigation:ve,getSemanticObjectMapping:he,setSemanticObjectMappings:Pe,getSemanticObjectPromise:je,getSemanticTargetsFromPageModel:Ae,getSemanticObjectsFromPath:ye,updateSemanticTargets:Se,waitForContextRequested:F,getFilterRestrictionsByPath:$e,getSpecificAllowedExpression:re,getAdditionalParamsForCreate:Oe,requestSingletonProperty:Re,templateControlFragment:Fe,FilterRestrictions:{REQUIRED_PROPERTIES:"RequiredProperties",NON_FILTERABLE_PROPERTIES:"NonFilterableProperties",ALLOWED_EXPRESSIONS:"FilterAllowedExpressions"},AllowedExpressionsPrio:["SingleValue","MultiValue","SingleRange","MultiRange","SearchExpression","MultiRangeOrSearchExpression"],normalizeSearchTerm:$,setContextsBasedOnOperationAvailable:te,setDynamicActionContexts:ne,requestProperty:ee,getParameterPath:Ne,getRelatedAppsMenuItems:w,getTranslatedTextFromExpBindingString:we,addSemanticDatesToConditions:pe,addSelectOptionToConditions:ue,updateRelateAppsModel:k,getSemanticObjectAnnotations:B,getFiltersInfoForSV:Le,getInternalChartNameFromPropertyNameAndKind:Be,getChartPropertiesWithoutPrefixes:Ie,createRootContext:Ve,isSmallDevice:De,getConverterContextForPath:ke};return qe},false);
//# sourceMappingURL=CommonUtils.js.map