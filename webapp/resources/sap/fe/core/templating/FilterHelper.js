/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/type/EDM","sap/ui/mdc/condition/Condition","sap/ui/mdc/enum/ConditionValidated"],function(e,t,n,i){"use strict";var o={};var a=t.isTypeFilterable;const s={Contains:"NotContains",StartsWith:"NotStartsWith",EndsWith:"NotEndsWith",Empty:"NotEmpty",NotEmpty:"Empty",LE:"NOTLE",GE:"NOTGE",LT:"NOTLT",GT:"NOTGT",BT:"NOTBT",NE:"EQ",EQ:"NE"};function d(e){let t;if(e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})\+(\d{1,4})/)){t=e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})\+(\d{1,4})/)[0]}else if(e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})/)){t=`${e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})/)[0]}+0000`}else if(e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)){t=`${e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)[0]}T00:00:00+0000`}else if(e.indexOf("Z")===e.length-1){t=`${e.split("Z")[0]}+0100`}else{t=undefined}return t}o._getDateTimeOffsetCompliantValue=d;function r(e){return e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)?e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)[0]:e.match(/^(\d{8})/)&&e.match(/^(\d{8})/)[0]}o._getDateCompliantValue=r;function l(e,t){let n;if(!a(t)){return undefined}n=e;switch(t){case"Edm.Boolean":if(typeof e==="boolean"){n=e}else{n=e==="true"||(e==="false"?false:undefined)}break;case"Edm.Double":case"Edm.Single":n=isNaN(e)?undefined:parseFloat(e);break;case"Edm.Byte":case"Edm.Int16":case"Edm.Int32":case"Edm.SByte":n=isNaN(e)?undefined:parseInt(e,10);break;case"Edm.Date":n=r(e);break;case"Edm.DateTimeOffset":n=d(e);break;case"Edm.TimeOfDay":n=e.match(/(\d{1,2}):(\d{1,2}):(\d{1,2})/)?e.match(/(\d{1,2}):(\d{1,2}):(\d{1,2})/)[0]:undefined;break;default:}return n===null?undefined:n}o.getTypeCompliantValue=l;function c(t,n,i,o){let a=n,d,r;const l={};l.values=[];l.isEmpty=null;if(n===undefined||n===null){return undefined}switch(t){case"CP":r="Contains";if(a){const t=a.indexOf("*");const n=a.lastIndexOf("*");if(t>-1){if(t===0&&n!==a.length-1){r="EndsWith";a=a.substring(1,a.length)}else if(t!==0&&n===a.length-1){r="StartsWith";a=a.substring(0,a.length-1)}else{a=a.substring(1,a.length-1)}}else{e.warning("Contains Option cannot be used without '*'.");return undefined}}break;case"EQ":r=n===""?"Empty":t;break;case"NE":r=n===""?"NotEmpty":t;break;case"BT":if(i===undefined||i===null){return}d=i;r=t;break;case"LE":case"GE":case"GT":case"LT":r=t;break;default:e.warning(`Selection Option is not supported : '${t}'`);return undefined}if(o==="E"){r=s[r]}l.operator=r;if(r!=="Empty"){l.values.push(a);if(d){l.values.push(d)}}return l}o.resolveConditionValues=c;function u(e){return e.indexOf("/")>0?e.split("/")[1]:e}o.getRangeProperty=u;function f(e,t,n,i){const o=[];e===null||e===void 0?void 0:e.forEach(e=>{const a=i?i(e,t,n):h(e,t);if(a){o.push(a)}});return o}function p(e,t,n){const i=e.lastIndexOf("/");const o=i>-1?e.substring(0,e.lastIndexOf("/")+1):"";const a=t.getObject(`${n}/${o}`);return a===null||a===void 0?void 0:a[e.replace(o,"")]}function m(e,t,n,i){const o=e.PropertyName,a={},s=o.value||o.$PropertyPath,d=e.Ranges;const r=p(s,t,n);if(r){const e=f(d,r,s,i);if(e.length){a[s]=(a[s]||[]).concat(e)}}return a}function g(e,t,n,o){let a={};if(!n){return a}const s=n.SelectOptions,d=n.Parameters;s===null||s===void 0?void 0:s.forEach(n=>{const i=n.PropertyName,s=i.value||i.$PropertyPath;if(Object.keys(a).includes(s)){a[s]=a[s].concat(m(n,t,e,o)[s])}else{a={...a,...m(n,t,e,o)}}});d===null||d===void 0?void 0:d.forEach(e=>{const t=e.PropertyName.value||e.PropertyName.$PropertyPath;const n=o?{operator:"EQ",value1:e.PropertyValue,value2:null,path:t,isParameter:true}:{operator:"EQ",values:[e.PropertyValue],isEmpty:null,validated:i.Validated,isParameter:true};a[t]=[n]});return a}o.getFiltersConditionsFromSelectionVariant=g;function h(e,t){let o;const a=e.Sign?u(e.Sign):undefined;const s=e.Option?u(e.Option):undefined;const d=l(e.Low,t.$Type||t.type);const r=e.High?l(e.High,t.$Type||t.type):undefined;const f=c(s,d,r,a);if(f){o=n.createCondition(f.operator,f.values,null,null,i.Validated)}return o}o.getConditions=h;const E=function(e,t){const o={};const a=e.getInterface(1).getPath(),s=e.getInterface(1).getModel();if(t){for(const e in t){const t=s.getObject(`${a}/${e}@com.sap.vocabularies.Common.v1.FilterDefaultValue`);if(t!==undefined){const a=e;o[a]=[n.createCondition("EQ",[t],null,null,i.Validated)]}}}return o};const v=function(e,t,i){const o={};const a=e.getInterface(1);const s=a.getModel();const d=a.getPath();for(const e in i){if(i[e][0]){const t=e.split("::");let a="";const r=t.length;const l=t.slice(0,t.length-1).join("/");const c=t[r-1];if(l){const e=s.getObject(d+"/"+l);if(e.$kind==="NavigationProperty"&&e.$isCollection){a+=`${l}*/`}else if(e.$kind==="NavigationProperty"){a+=`${l}/`}}a+=c;const u="values"in i[e][0]?i[e][0].values:[];o[a]=[n.createCondition(i[e][0].operator,u,null,null,null)]}}return o};function y(){const e={};e["$editState"]=[n.createCondition("DRAFT_EDIT_STATE",["ALL"],null,null,i.Validated)];return e}o.getEditStatusFilter=y;function T(e,t){var n,i;let o;const a=e.getInterface(1).getPath(),s=e.getInterface(1).getModel(),d=s.getObject(`${a}@`),r=s.getObject(`${a}/`);if(d&&(d["@com.sap.vocabularies.Common.v1.DraftRoot"]||d["@com.sap.vocabularies.Common.v1.DraftNode"])){o=y()}const l=(n=t)===null||n===void 0?void 0:n.selectionVariant;const c=((i=t)===null||i===void 0?void 0:i.defaultSemanticDates)||{};const u=E(e,r);const f=v(e,r,c);if(l){t=g(a,s,l)}else if(u){t=u}if(f){t={...t,...f}}if(o){t={...t,...o}}return Object.keys(t).length>0?JSON.stringify(t).replace(/([{}])/g,"\\$1"):undefined}o.getFilterConditions=T;function b(e){return(e===null||e===void 0?void 0:e.$Type)==="com.sap.vocabularies.UI.v1.SelectionVariantType"}o.isSelectionVariant=b;T.requiresIContext=true;return o},false);
//# sourceMappingURL=FilterHelper.js.map