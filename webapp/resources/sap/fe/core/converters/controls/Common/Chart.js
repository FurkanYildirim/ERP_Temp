/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/converters/annotations/DataField","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/BindingToolkit","sap/fe/core/templating/DataModelPathHelper","sap/ui/core/Core","../../helpers/Aggregation","../../helpers/ID","../../helpers/InsightsHelpers","../../ManifestSettings"],function(t,e,n,a,o,i,r,s,l,g,c,p){"use strict";var u={};var d=p.VisualizationType;var v=p.VariantManagementType;var f=p.TemplateType;var m=p.ActionType;var y=c.getInsightsVisibility;var h=g.getFilterBarID;var P=g.getChartID;var b=l.AggregationHelper;var A=r.getTargetObjectPath;var T=i.not;var S=i.getExpressionFromAnnotation;var C=i.equal;var M=i.compileExpression;var O=o.KeyHelper;var I=a.OverrideType;var D=a.insertCustomElements;var E=n.getActionsFromManifest;var F=e.isDataFieldForActionAbstract;function V(t,e,n){const a=[];if(t){const e=t.Actions||[];e.forEach(t=>{var e;let o;if(F(t)&&!t.Inline&&!t.Determining){const a=O.generateKeyFromDataField(t);switch(t.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForAction":if(!((e=t.ActionTarget)!==null&&e!==void 0&&e.isBound)){o={type:m.DataFieldForAction,annotationPath:n.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),key:a,visible:x(t,n)}}break;case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":o={type:m.DataFieldForIntentBasedNavigation,annotationPath:n.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),key:a,visible:x(t,n),isNavigable:true};break}}if(o){a.push(o)}})}return a}function N(t,e,n){const a=V(t,e,n);const o=E(n.getManifestControlConfiguration(e).actions,n,a);const i={enabled:I.overwrite,enableOnSelect:I.overwrite,visible:I.overwrite,command:I.overwrite};const r=D(a,o.actions,i);return{actions:r,commandActions:o.commandActions}}u.getChartActions=N;function w(t,e){var n;const a=e.getManifestWrapper();const o=e.getManifestControlConfiguration(t);const i=a.getVariantManagement();const r=[];const s=o===null||o===void 0?void 0:(n=o.chartSettings)===null||n===void 0?void 0:n.personalization;const l=i===v.Control?true:false;if(s!==undefined&&!s||s=="false"){return undefined}switch(true){case typeof s==="object":if(s.type){r.push("Type")}if(s.item){r.push("Item")}if(s.sort){r.push("Sort")}if(s.filter){r.push("Filter")}return r.join(",");case l:case!!s:return"Sort,Type,Item,Filter";default:return"Sort,Type,Item"}}u.getP13nMode=w;function B(t){var e;return(t===null||t===void 0?void 0:(e=t.annotationPath)===null||e===void 0?void 0:e.indexOf(`@${"com.sap.vocabularies.UI.v1.SelectionPresentationVariant"}`))!==-1?t===null||t===void 0?void 0:t.annotationPath:undefined}function $(t){let e;if(t!==null&&t!==void 0&&t.Property){var n;e={Property:{$PropertyPath:t===null||t===void 0?void 0:(n=t.Property)===null||n===void 0?void 0:n.value}}}else{e={Property:{$PropertyPath:t===null||t===void 0?void 0:t.name}}}return e}function z(e,n,a,o,i,r){var l;const g=new b(a.getEntityType(),a,true);if(!o&&!g.isAnalyticsSupported()){throw new Error("ApplySupported is not added to the annotations")}const c=g.getTransAggregations();const p=g.getCustomAggregateDefinitions();const u=a.getManifestWrapper();const v=u.getVariantManagement();const m=w(n,a);if(m===undefined&&v==="Control"){t.warning("Variant Management cannot be enabled when personalization is disabled")}const T={};const S=B(i);if(p){const t=g.getEntityType();for(const e of p){var C,M,O,I,D;const n=e===null||e===void 0?void 0:(C=e.annotations)===null||C===void 0?void 0:(M=C.Aggregation)===null||M===void 0?void 0:M.ContextDefiningProperties;const a=e===null||e===void 0?void 0:e.qualifier;const o=a&&t.entityProperties.find(t=>t.name===a);const i=o&&(o===null||o===void 0?void 0:(O=o.annotations)===null||O===void 0?void 0:(I=O.Common)===null||I===void 0?void 0:(D=I.Label)===null||D===void 0?void 0:D.toString());T[a]={name:a,label:i||`Custom Aggregate (${a})`,sortable:true,sortOrder:"both",contextDefiningProperty:n?n.map(t=>t.value):[]}}}const E={};const F=s.getLibraryResourceBundle("sap.fe.core");if(c){for(let t=0;t<c.length;t++){var V,z,x,G,j,k;E[c[t].Name]={name:c[t].Name,propertyPath:c[t].AggregatableProperty.valueOf().value,aggregationMethod:c[t].AggregationMethod,label:(V=c[t])!==null&&V!==void 0&&(z=V.annotations)!==null&&z!==void 0&&(x=z.Common)!==null&&x!==void 0&&x.Label?(G=c[t])===null||G===void 0?void 0:(j=G.annotations)===null||j===void 0?void 0:(k=j.Common)===null||k===void 0?void 0:k.Label.toString():`${F.getText("AGGREGATABLE_PROPERTY")} (${c[t].Name})`,sortable:true,sortOrder:"both",custom:false}}}const R=g.getAggregatableProperties();const H=g.getGroupableProperties();const Q={};Q.$Type="Org.OData.Aggregation.V1.ApplySupportedType";Q.AggregatableProperties=[];Q.GroupableProperties=[];if(R){Q.AggregatableProperties=R.map(t=>$(t))}if(H){Q.GroupableProperties=H.map(t=>({["$PropertyPath"]:t.value}))}const U=N(e,n,a);let[W]=n.split("@");if(W.lastIndexOf("/")===W.length-1){W=W.substr(0,W.length-1)}const K=((l=e.Title)===null||l===void 0?void 0:l.toString())||"";const q=a.getDataModelObjectPath();const J=W.length===0;const Y=q.targetEntitySet?q.targetEntitySet.name:q.startingEntitySet.name;const _=J?h(a.getContextPath()):undefined;const X={legendGroup:{layout:{position:"bottom"}}};let Z;if(a.getTemplateType()===f.ObjectPage){Z=true}else if(a.getTemplateType()===f.ListReport||a.getTemplateType()===f.AnalyticalListPage){Z=false}const tt=a.getManifestWrapper().hasMultipleVisualizations()||a.getTemplateType()===f.AnalyticalListPage;const et=tt?".handlers.onSegmentedButtonPressed":"";const nt=tt?"{= ${pageInternal>alpContentView} !== 'Table'}":"true";const at=g.getAllowedTransformations();Q.enableSearch=at?at.indexOf("search")>=0:true;let ot="";if(e.fullyQualifiedName.split("#").length>1){ot=e.fullyQualifiedName.split("#")[1]}return{type:d.Chart,id:ot?P(J?Y:W,ot,d.Chart):P(J?Y:W,d.Chart),collection:A(a.getDataModelObjectPath()),entityName:Y,personalization:w(n,a),navigationPath:W,annotationPath:a.getAbsoluteAnnotationPath(n),filterId:_,vizProperties:JSON.stringify(X),actions:U.actions,commandActions:U.commandActions,title:K,autoBindOnInit:Z,onSegmentedButtonPressed:et,visible:nt,customAgg:T,transAgg:E,applySupported:Q,selectionPresentationVariantPath:S,variantManagement:L(m,v),isInsightsEnabled:(r??false)&&y("Analytical",a,n)}}u.createChartVisualization=z;function L(t,e){return e==="Control"&&!t?v.None:e}function x(t,e){var n,a;return M(T(C(S((n=t.annotations)===null||n===void 0?void 0:(a=n.UI)===null||a===void 0?void 0:a.Hidden,[],undefined,e.getRelativeModelPathFunction()),true)))}function G(t){const e=t.getManifestWrapper().hasMultipleVisualizations()||t.getTemplateType()===f.AnalyticalListPage;const n=t.getDataModelObjectPath();const a=n.targetEntitySet?n.targetEntitySet.name:n.startingEntitySet.name;const o={type:d.Chart,id:P(a,d.Chart),entityName:a,title:"",collection:"",personalization:undefined,navigationPath:"",annotationPath:"",vizProperties:JSON.stringify({legendGroup:{layout:{position:"bottom"}}}),actions:[],commandActions:{},autoBindOnInit:false,onSegmentedButtonPressed:"",visible:e?"{= ${pageInternal>alpContentView} !== 'Table'}":"true",customAgg:{},transAgg:{},applySupported:{$Type:"Org.OData.Aggregation.V1.ApplySupportedType",AggregatableProperties:[],GroupableProperties:[],enableSearch:false},multiViews:false,variantManagement:v.None};return o}u.createBlankChartVisualization=G;return u},false);
//# sourceMappingURL=Chart.js.map