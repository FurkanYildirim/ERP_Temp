/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/util/merge", "sap/fe/core/converters/helpers/IssueManager", "./ConverterContext", "./ManifestSettings", "./MetaModelConverter", "./templates/ListReportConverter", "./templates/ObjectPageConverter"], function (merge, IssueManager, ConverterContext, ManifestSettings, MetaModelConverter, ListReportConverter, ObjectPageConverter) {
  "use strict";

  var _exports = {};
  var getInvolvedDataModelObjects = MetaModelConverter.getInvolvedDataModelObjects;
  var convertTypes = MetaModelConverter.convertTypes;
  var TemplateType = ManifestSettings.TemplateType;
  var IssueSeverity = IssueManager.IssueSeverity;
  var IssueCategoryType = IssueManager.IssueCategoryType;
  var IssueCategory = IssueManager.IssueCategory;
  function handleErrorForCollectionFacets(oFacets, oDiagnostics, sEntitySetName, level) {
    oFacets.forEach(oFacet => {
      let Message = `For entity set ${sEntitySetName}`;
      if ((oFacet === null || oFacet === void 0 ? void 0 : oFacet.$Type) === "com.sap.vocabularies.UI.v1.CollectionFacet" && !(oFacet !== null && oFacet !== void 0 && oFacet.ID)) {
        var _IssueCategoryType$Fa;
        Message = `${Message}, ` + `level ${level}, the collection facet does not have an ID.`;
        oDiagnostics.addIssue(IssueCategory.Facets, IssueSeverity.High, Message, IssueCategoryType, IssueCategoryType === null || IssueCategoryType === void 0 ? void 0 : (_IssueCategoryType$Fa = IssueCategoryType.Facets) === null || _IssueCategoryType$Fa === void 0 ? void 0 : _IssueCategoryType$Fa.MissingID);
      }
      if ((oFacet === null || oFacet === void 0 ? void 0 : oFacet.$Type) === "com.sap.vocabularies.UI.v1.CollectionFacet" && level >= 3) {
        var _IssueCategoryType$Fa2;
        Message = `${Message}, collection facet ${oFacet.Label} is not supported at ` + `level ${level}`;
        oDiagnostics.addIssue(IssueCategory.Facets, IssueSeverity.Medium, Message, IssueCategoryType, IssueCategoryType === null || IssueCategoryType === void 0 ? void 0 : (_IssueCategoryType$Fa2 = IssueCategoryType.Facets) === null || _IssueCategoryType$Fa2 === void 0 ? void 0 : _IssueCategoryType$Fa2.UnSupportedLevel);
      }
      if (oFacet !== null && oFacet !== void 0 && oFacet.Facets) {
        handleErrorForCollectionFacets(oFacet === null || oFacet === void 0 ? void 0 : oFacet.Facets, oDiagnostics, sEntitySetName, ++level);
        level = level - 1;
      }
    });
  }
  /**
   * Based on a template type, convert the metamodel and manifest definition into a json structure for the page.
   *
   * @param sTemplateType The template type
   * @param oMetaModel The odata model metaModel
   * @param oManifestSettings The current manifest settings
   * @param oDiagnostics The diagnostics wrapper
   * @param sFullContextPath The context path to reach this page
   * @param oCapabilities
   * @param component The template component
   * @returns The target page definition
   */
  function convertPage(sTemplateType, oMetaModel, oManifestSettings, oDiagnostics, sFullContextPath, oCapabilities, component) {
    var _oConvertedMetadata$e;
    const oConvertedMetadata = convertTypes(oMetaModel, oCapabilities);
    // TODO: This will have incomplete information because the conversion happens lazily
    oConvertedMetadata.diagnostics.forEach(annotationErrorDetail => {
      const checkIfIssueExists = oDiagnostics.checkIfIssueExists(IssueCategory.Annotation, IssueSeverity.High, annotationErrorDetail.message);
      if (!checkIfIssueExists) {
        oDiagnostics.addIssue(IssueCategory.Annotation, IssueSeverity.High, annotationErrorDetail.message);
      }
    });
    oConvertedMetadata === null || oConvertedMetadata === void 0 ? void 0 : (_oConvertedMetadata$e = oConvertedMetadata.entityTypes) === null || _oConvertedMetadata$e === void 0 ? void 0 : _oConvertedMetadata$e.forEach(oEntitySet => {
      var _oEntitySet$annotatio, _oEntitySet$annotatio2;
      if (oEntitySet !== null && oEntitySet !== void 0 && (_oEntitySet$annotatio = oEntitySet.annotations) !== null && _oEntitySet$annotatio !== void 0 && (_oEntitySet$annotatio2 = _oEntitySet$annotatio.UI) !== null && _oEntitySet$annotatio2 !== void 0 && _oEntitySet$annotatio2.Facets) {
        var _oEntitySet$annotatio3, _oEntitySet$annotatio4;
        handleErrorForCollectionFacets(oEntitySet === null || oEntitySet === void 0 ? void 0 : (_oEntitySet$annotatio3 = oEntitySet.annotations) === null || _oEntitySet$annotatio3 === void 0 ? void 0 : (_oEntitySet$annotatio4 = _oEntitySet$annotatio3.UI) === null || _oEntitySet$annotatio4 === void 0 ? void 0 : _oEntitySet$annotatio4.Facets, oDiagnostics, oEntitySet === null || oEntitySet === void 0 ? void 0 : oEntitySet.name, 1);
      }
    });
    const sTargetEntitySetName = oManifestSettings.entitySet;
    const sContextPath = (oManifestSettings === null || oManifestSettings === void 0 ? void 0 : oManifestSettings.contextPath) || (sFullContextPath === "/" ? sFullContextPath + sTargetEntitySetName : sFullContextPath);
    const oContext = oMetaModel.createBindingContext(sContextPath);
    const oFullContext = getInvolvedDataModelObjects(oContext);
    if (oFullContext) {
      let oConvertedPage = {};
      const converterContext = new ConverterContext(oConvertedMetadata, oManifestSettings, oDiagnostics, merge, oFullContext);
      switch (sTemplateType) {
        case TemplateType.ListReport:
        case TemplateType.AnalyticalListPage:
          oConvertedPage = ListReportConverter.convertPage(converterContext, oCapabilities === null || oCapabilities === void 0 ? void 0 : oCapabilities.InsightsSupported);
          break;
        case TemplateType.ObjectPage:
          oConvertedPage = ObjectPageConverter.convertPage(converterContext);
          break;
      }
      if (component !== null && component !== void 0 && component.extendPageDefinition) {
        oConvertedPage = component.extendPageDefinition(oConvertedPage, converterContext);
      }
      return oConvertedPage;
    }
    return undefined;
  }
  _exports.convertPage = convertPage;
  return _exports;
}, false);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJoYW5kbGVFcnJvckZvckNvbGxlY3Rpb25GYWNldHMiLCJvRmFjZXRzIiwib0RpYWdub3N0aWNzIiwic0VudGl0eVNldE5hbWUiLCJsZXZlbCIsImZvckVhY2giLCJvRmFjZXQiLCJNZXNzYWdlIiwiJFR5cGUiLCJJRCIsImFkZElzc3VlIiwiSXNzdWVDYXRlZ29yeSIsIkZhY2V0cyIsIklzc3VlU2V2ZXJpdHkiLCJIaWdoIiwiSXNzdWVDYXRlZ29yeVR5cGUiLCJNaXNzaW5nSUQiLCJMYWJlbCIsIk1lZGl1bSIsIlVuU3VwcG9ydGVkTGV2ZWwiLCJjb252ZXJ0UGFnZSIsInNUZW1wbGF0ZVR5cGUiLCJvTWV0YU1vZGVsIiwib01hbmlmZXN0U2V0dGluZ3MiLCJzRnVsbENvbnRleHRQYXRoIiwib0NhcGFiaWxpdGllcyIsImNvbXBvbmVudCIsIm9Db252ZXJ0ZWRNZXRhZGF0YSIsImNvbnZlcnRUeXBlcyIsImRpYWdub3N0aWNzIiwiYW5ub3RhdGlvbkVycm9yRGV0YWlsIiwiY2hlY2tJZklzc3VlRXhpc3RzIiwiQW5ub3RhdGlvbiIsIm1lc3NhZ2UiLCJlbnRpdHlUeXBlcyIsIm9FbnRpdHlTZXQiLCJhbm5vdGF0aW9ucyIsIlVJIiwibmFtZSIsInNUYXJnZXRFbnRpdHlTZXROYW1lIiwiZW50aXR5U2V0Iiwic0NvbnRleHRQYXRoIiwiY29udGV4dFBhdGgiLCJvQ29udGV4dCIsImNyZWF0ZUJpbmRpbmdDb250ZXh0Iiwib0Z1bGxDb250ZXh0IiwiZ2V0SW52b2x2ZWREYXRhTW9kZWxPYmplY3RzIiwib0NvbnZlcnRlZFBhZ2UiLCJjb252ZXJ0ZXJDb250ZXh0IiwiQ29udmVydGVyQ29udGV4dCIsIm1lcmdlIiwiVGVtcGxhdGVUeXBlIiwiTGlzdFJlcG9ydCIsIkFuYWx5dGljYWxMaXN0UGFnZSIsIkxpc3RSZXBvcnRDb252ZXJ0ZXIiLCJJbnNpZ2h0c1N1cHBvcnRlZCIsIk9iamVjdFBhZ2UiLCJPYmplY3RQYWdlQ29udmVydGVyIiwiZXh0ZW5kUGFnZURlZmluaXRpb24iLCJ1bmRlZmluZWQiXSwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIlRlbXBsYXRlQ29udmVydGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgRmFjZXRUeXBlcyB9IGZyb20gXCJAc2FwLXV4L3ZvY2FidWxhcmllcy10eXBlcy92b2NhYnVsYXJpZXMvVUlcIjtcbmltcG9ydCB7IFVJQW5ub3RhdGlvblR5cGVzIH0gZnJvbSBcIkBzYXAtdXgvdm9jYWJ1bGFyaWVzLXR5cGVzL3ZvY2FidWxhcmllcy9VSVwiO1xuaW1wb3J0IG1lcmdlIGZyb20gXCJzYXAvYmFzZS91dGlsL21lcmdlXCI7XG5pbXBvcnQgeyBJc3N1ZUNhdGVnb3J5LCBJc3N1ZUNhdGVnb3J5VHlwZSwgSXNzdWVTZXZlcml0eSB9IGZyb20gXCJzYXAvZmUvY29yZS9jb252ZXJ0ZXJzL2hlbHBlcnMvSXNzdWVNYW5hZ2VyXCI7XG5pbXBvcnQgdHlwZSBUZW1wbGF0ZUNvbXBvbmVudCBmcm9tIFwic2FwL2ZlL2NvcmUvVGVtcGxhdGVDb21wb25lbnRcIjtcbmltcG9ydCB0eXBlIENvbnRleHQgZnJvbSBcInNhcC91aS9tb2RlbC9Db250ZXh0XCI7XG5pbXBvcnQgdHlwZSBPRGF0YU1ldGFNb2RlbCBmcm9tIFwic2FwL3VpL21vZGVsL29kYXRhL3Y0L09EYXRhTWV0YU1vZGVsXCI7XG5pbXBvcnQgQ29udmVydGVyQ29udGV4dCBmcm9tIFwiLi9Db252ZXJ0ZXJDb250ZXh0XCI7XG5pbXBvcnQgdHlwZSB7IEJhc2VNYW5pZmVzdFNldHRpbmdzIH0gZnJvbSBcIi4vTWFuaWZlc3RTZXR0aW5nc1wiO1xuaW1wb3J0IHsgVGVtcGxhdGVUeXBlIH0gZnJvbSBcIi4vTWFuaWZlc3RTZXR0aW5nc1wiO1xuaW1wb3J0IHR5cGUgeyBFbnZpcm9ubWVudENhcGFiaWxpdGllcyB9IGZyb20gXCIuL01ldGFNb2RlbENvbnZlcnRlclwiO1xuaW1wb3J0IHsgY29udmVydFR5cGVzLCBnZXRJbnZvbHZlZERhdGFNb2RlbE9iamVjdHMgfSBmcm9tIFwiLi9NZXRhTW9kZWxDb252ZXJ0ZXJcIjtcbmltcG9ydCAqIGFzIExpc3RSZXBvcnRDb252ZXJ0ZXIgZnJvbSBcIi4vdGVtcGxhdGVzL0xpc3RSZXBvcnRDb252ZXJ0ZXJcIjtcbmltcG9ydCAqIGFzIE9iamVjdFBhZ2VDb252ZXJ0ZXIgZnJvbSBcIi4vdGVtcGxhdGVzL09iamVjdFBhZ2VDb252ZXJ0ZXJcIjtcbi8qKlxuICogQHR5cGVkZWYgUGFnZURlZmluaXRpb25cbiAqL1xuZXhwb3J0IHR5cGUgUGFnZURlZmluaXRpb24gPSB7XG5cdHRlbXBsYXRlOiBzdHJpbmc7XG59O1xuLyoqIEB0eXBlZGVmIElEaWFnbm9zdGljcyAqL1xuZXhwb3J0IGludGVyZmFjZSBJRGlhZ25vc3RpY3Mge1xuXHRhZGRJc3N1ZShcblx0XHRpc3N1ZUNhdGVnb3J5OiBJc3N1ZUNhdGVnb3J5IHwgc3RyaW5nLFxuXHRcdGlzc3VlU2V2ZXJpdHk6IElzc3VlU2V2ZXJpdHksXG5cdFx0ZGV0YWlsczogc3RyaW5nLFxuXHRcdGlzc3VlQ2F0ZWdvcnlUeXBlPzogYW55LFxuXHRcdGlzc3VlU3ViQ2F0ZWdvcnk/OiBzdHJpbmdcblx0KTogdm9pZDtcblx0Z2V0SXNzdWVzKCk6IGFueVtdO1xuXHRjaGVja0lmSXNzdWVFeGlzdHMoXG5cdFx0aXNzdWVDYXRlZ29yeTogSXNzdWVDYXRlZ29yeSxcblx0XHRpc3N1ZVNldmVyaXR5OiBJc3N1ZVNldmVyaXR5LFxuXHRcdGRldGFpbHM6IHN0cmluZyxcblx0XHRpc3N1ZUNhdGVnb3J5VHlwZT86IGFueSxcblx0XHRpc3N1ZVN1YkNhdGVnb3J5Pzogc3RyaW5nXG5cdCk6IGJvb2xlYW47XG59XG5mdW5jdGlvbiBoYW5kbGVFcnJvckZvckNvbGxlY3Rpb25GYWNldHMob0ZhY2V0czogRmFjZXRUeXBlc1tdLCBvRGlhZ25vc3RpY3M6IElEaWFnbm9zdGljcywgc0VudGl0eVNldE5hbWU6IHN0cmluZywgbGV2ZWw6IG51bWJlcikge1xuXHRvRmFjZXRzLmZvckVhY2goKG9GYWNldDogYW55KSA9PiB7XG5cdFx0bGV0IE1lc3NhZ2UgPSBgRm9yIGVudGl0eSBzZXQgJHtzRW50aXR5U2V0TmFtZX1gO1xuXHRcdGlmIChvRmFjZXQ/LiRUeXBlID09PSBVSUFubm90YXRpb25UeXBlcy5Db2xsZWN0aW9uRmFjZXQgJiYgIW9GYWNldD8uSUQpIHtcblx0XHRcdE1lc3NhZ2UgPSBgJHtNZXNzYWdlfSwgYCArIGBsZXZlbCAke2xldmVsfSwgdGhlIGNvbGxlY3Rpb24gZmFjZXQgZG9lcyBub3QgaGF2ZSBhbiBJRC5gO1xuXHRcdFx0b0RpYWdub3N0aWNzLmFkZElzc3VlKFxuXHRcdFx0XHRJc3N1ZUNhdGVnb3J5LkZhY2V0cyxcblx0XHRcdFx0SXNzdWVTZXZlcml0eS5IaWdoLFxuXHRcdFx0XHRNZXNzYWdlLFxuXHRcdFx0XHRJc3N1ZUNhdGVnb3J5VHlwZSxcblx0XHRcdFx0SXNzdWVDYXRlZ29yeVR5cGU/LkZhY2V0cz8uTWlzc2luZ0lEXG5cdFx0XHQpO1xuXHRcdH1cblx0XHRpZiAob0ZhY2V0Py4kVHlwZSA9PT0gVUlBbm5vdGF0aW9uVHlwZXMuQ29sbGVjdGlvbkZhY2V0ICYmIGxldmVsID49IDMpIHtcblx0XHRcdE1lc3NhZ2UgPSBgJHtNZXNzYWdlfSwgY29sbGVjdGlvbiBmYWNldCAke29GYWNldC5MYWJlbH0gaXMgbm90IHN1cHBvcnRlZCBhdCBgICsgYGxldmVsICR7bGV2ZWx9YDtcblx0XHRcdG9EaWFnbm9zdGljcy5hZGRJc3N1ZShcblx0XHRcdFx0SXNzdWVDYXRlZ29yeS5GYWNldHMsXG5cdFx0XHRcdElzc3VlU2V2ZXJpdHkuTWVkaXVtLFxuXHRcdFx0XHRNZXNzYWdlLFxuXHRcdFx0XHRJc3N1ZUNhdGVnb3J5VHlwZSxcblx0XHRcdFx0SXNzdWVDYXRlZ29yeVR5cGU/LkZhY2V0cz8uVW5TdXBwb3J0ZWRMZXZlbFxuXHRcdFx0KTtcblx0XHR9XG5cdFx0aWYgKG9GYWNldD8uRmFjZXRzKSB7XG5cdFx0XHRoYW5kbGVFcnJvckZvckNvbGxlY3Rpb25GYWNldHMob0ZhY2V0Py5GYWNldHMsIG9EaWFnbm9zdGljcywgc0VudGl0eVNldE5hbWUsICsrbGV2ZWwpO1xuXHRcdFx0bGV2ZWwgPSBsZXZlbCAtIDE7XG5cdFx0fVxuXHR9KTtcbn1cbi8qKlxuICogQmFzZWQgb24gYSB0ZW1wbGF0ZSB0eXBlLCBjb252ZXJ0IHRoZSBtZXRhbW9kZWwgYW5kIG1hbmlmZXN0IGRlZmluaXRpb24gaW50byBhIGpzb24gc3RydWN0dXJlIGZvciB0aGUgcGFnZS5cbiAqXG4gKiBAcGFyYW0gc1RlbXBsYXRlVHlwZSBUaGUgdGVtcGxhdGUgdHlwZVxuICogQHBhcmFtIG9NZXRhTW9kZWwgVGhlIG9kYXRhIG1vZGVsIG1ldGFNb2RlbFxuICogQHBhcmFtIG9NYW5pZmVzdFNldHRpbmdzIFRoZSBjdXJyZW50IG1hbmlmZXN0IHNldHRpbmdzXG4gKiBAcGFyYW0gb0RpYWdub3N0aWNzIFRoZSBkaWFnbm9zdGljcyB3cmFwcGVyXG4gKiBAcGFyYW0gc0Z1bGxDb250ZXh0UGF0aCBUaGUgY29udGV4dCBwYXRoIHRvIHJlYWNoIHRoaXMgcGFnZVxuICogQHBhcmFtIG9DYXBhYmlsaXRpZXNcbiAqIEBwYXJhbSBjb21wb25lbnQgVGhlIHRlbXBsYXRlIGNvbXBvbmVudFxuICogQHJldHVybnMgVGhlIHRhcmdldCBwYWdlIGRlZmluaXRpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvbnZlcnRQYWdlKFxuXHRzVGVtcGxhdGVUeXBlOiBUZW1wbGF0ZVR5cGUsXG5cdG9NZXRhTW9kZWw6IE9EYXRhTWV0YU1vZGVsLFxuXHRvTWFuaWZlc3RTZXR0aW5nczogQmFzZU1hbmlmZXN0U2V0dGluZ3MsXG5cdG9EaWFnbm9zdGljczogSURpYWdub3N0aWNzLFxuXHRzRnVsbENvbnRleHRQYXRoOiBzdHJpbmcsXG5cdG9DYXBhYmlsaXRpZXM/OiBFbnZpcm9ubWVudENhcGFiaWxpdGllcyxcblx0Y29tcG9uZW50PzogVGVtcGxhdGVDb21wb25lbnRcbikge1xuXHRjb25zdCBvQ29udmVydGVkTWV0YWRhdGEgPSBjb252ZXJ0VHlwZXMob01ldGFNb2RlbCwgb0NhcGFiaWxpdGllcyk7XG5cdC8vIFRPRE86IFRoaXMgd2lsbCBoYXZlIGluY29tcGxldGUgaW5mb3JtYXRpb24gYmVjYXVzZSB0aGUgY29udmVyc2lvbiBoYXBwZW5zIGxhemlseVxuXHRvQ29udmVydGVkTWV0YWRhdGEuZGlhZ25vc3RpY3MuZm9yRWFjaCgoYW5ub3RhdGlvbkVycm9yRGV0YWlsKSA9PiB7XG5cdFx0Y29uc3QgY2hlY2tJZklzc3VlRXhpc3RzID0gb0RpYWdub3N0aWNzLmNoZWNrSWZJc3N1ZUV4aXN0cyhcblx0XHRcdElzc3VlQ2F0ZWdvcnkuQW5ub3RhdGlvbixcblx0XHRcdElzc3VlU2V2ZXJpdHkuSGlnaCxcblx0XHRcdGFubm90YXRpb25FcnJvckRldGFpbC5tZXNzYWdlXG5cdFx0KTtcblx0XHRpZiAoIWNoZWNrSWZJc3N1ZUV4aXN0cykge1xuXHRcdFx0b0RpYWdub3N0aWNzLmFkZElzc3VlKElzc3VlQ2F0ZWdvcnkuQW5ub3RhdGlvbiwgSXNzdWVTZXZlcml0eS5IaWdoLCBhbm5vdGF0aW9uRXJyb3JEZXRhaWwubWVzc2FnZSk7XG5cdFx0fVxuXHR9KTtcblx0b0NvbnZlcnRlZE1ldGFkYXRhPy5lbnRpdHlUeXBlcz8uZm9yRWFjaCgob0VudGl0eVNldDogYW55KSA9PiB7XG5cdFx0aWYgKG9FbnRpdHlTZXQ/LmFubm90YXRpb25zPy5VST8uRmFjZXRzKSB7XG5cdFx0XHRoYW5kbGVFcnJvckZvckNvbGxlY3Rpb25GYWNldHMob0VudGl0eVNldD8uYW5ub3RhdGlvbnM/LlVJPy5GYWNldHMsIG9EaWFnbm9zdGljcywgb0VudGl0eVNldD8ubmFtZSwgMSk7XG5cdFx0fVxuXHR9KTtcblx0Y29uc3Qgc1RhcmdldEVudGl0eVNldE5hbWUgPSBvTWFuaWZlc3RTZXR0aW5ncy5lbnRpdHlTZXQ7XG5cdGNvbnN0IHNDb250ZXh0UGF0aCA9XG5cdFx0b01hbmlmZXN0U2V0dGluZ3M/LmNvbnRleHRQYXRoIHx8IChzRnVsbENvbnRleHRQYXRoID09PSBcIi9cIiA/IHNGdWxsQ29udGV4dFBhdGggKyBzVGFyZ2V0RW50aXR5U2V0TmFtZSA6IHNGdWxsQ29udGV4dFBhdGgpO1xuXHRjb25zdCBvQ29udGV4dCA9IG9NZXRhTW9kZWwuY3JlYXRlQmluZGluZ0NvbnRleHQoc0NvbnRleHRQYXRoKSBhcyBDb250ZXh0O1xuXHRjb25zdCBvRnVsbENvbnRleHQgPSBnZXRJbnZvbHZlZERhdGFNb2RlbE9iamVjdHMob0NvbnRleHQpO1xuXHRpZiAob0Z1bGxDb250ZXh0KSB7XG5cdFx0bGV0IG9Db252ZXJ0ZWRQYWdlID0ge307XG5cdFx0Y29uc3QgY29udmVydGVyQ29udGV4dCA9IG5ldyBDb252ZXJ0ZXJDb250ZXh0KG9Db252ZXJ0ZWRNZXRhZGF0YSwgb01hbmlmZXN0U2V0dGluZ3MsIG9EaWFnbm9zdGljcywgbWVyZ2UsIG9GdWxsQ29udGV4dCk7XG5cdFx0c3dpdGNoIChzVGVtcGxhdGVUeXBlKSB7XG5cdFx0XHRjYXNlIFRlbXBsYXRlVHlwZS5MaXN0UmVwb3J0OlxuXHRcdFx0Y2FzZSBUZW1wbGF0ZVR5cGUuQW5hbHl0aWNhbExpc3RQYWdlOlxuXHRcdFx0XHRvQ29udmVydGVkUGFnZSA9IExpc3RSZXBvcnRDb252ZXJ0ZXIuY29udmVydFBhZ2UoY29udmVydGVyQ29udGV4dCwgb0NhcGFiaWxpdGllcz8uSW5zaWdodHNTdXBwb3J0ZWQpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgVGVtcGxhdGVUeXBlLk9iamVjdFBhZ2U6XG5cdFx0XHRcdG9Db252ZXJ0ZWRQYWdlID0gT2JqZWN0UGFnZUNvbnZlcnRlci5jb252ZXJ0UGFnZShjb252ZXJ0ZXJDb250ZXh0KTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHRcdGlmIChjb21wb25lbnQ/LmV4dGVuZFBhZ2VEZWZpbml0aW9uKSB7XG5cdFx0XHRvQ29udmVydGVkUGFnZSA9IGNvbXBvbmVudC5leHRlbmRQYWdlRGVmaW5pdGlvbihvQ29udmVydGVkUGFnZSwgY29udmVydGVyQ29udGV4dCk7XG5cdFx0fVxuXHRcdHJldHVybiBvQ29udmVydGVkUGFnZTtcblx0fVxuXHRyZXR1cm4gdW5kZWZpbmVkO1xufVxuIl0sIm1hcHBpbmdzIjoiO0FBQUE7QUFBQTtBQUFBOzs7Ozs7Ozs7OztFQXNDQSxTQUFTQSw4QkFBOEIsQ0FBQ0MsT0FBcUIsRUFBRUMsWUFBMEIsRUFBRUMsY0FBc0IsRUFBRUMsS0FBYSxFQUFFO0lBQ2pJSCxPQUFPLENBQUNJLE9BQU8sQ0FBRUMsTUFBVyxJQUFLO01BQ2hDLElBQUlDLE9BQU8sR0FBSSxrQkFBaUJKLGNBQWUsRUFBQztNQUNoRCxJQUFJLENBQUFHLE1BQU0sYUFBTkEsTUFBTSx1QkFBTkEsTUFBTSxDQUFFRSxLQUFLLGtEQUFzQyxJQUFJLEVBQUNGLE1BQU0sYUFBTkEsTUFBTSxlQUFOQSxNQUFNLENBQUVHLEVBQUUsR0FBRTtRQUFBO1FBQ3ZFRixPQUFPLEdBQUksR0FBRUEsT0FBUSxJQUFHLEdBQUksU0FBUUgsS0FBTSw2Q0FBNEM7UUFDdEZGLFlBQVksQ0FBQ1EsUUFBUSxDQUNwQkMsYUFBYSxDQUFDQyxNQUFNLEVBQ3BCQyxhQUFhLENBQUNDLElBQUksRUFDbEJQLE9BQU8sRUFDUFEsaUJBQWlCLEVBQ2pCQSxpQkFBaUIsYUFBakJBLGlCQUFpQixnREFBakJBLGlCQUFpQixDQUFFSCxNQUFNLDBEQUF6QixzQkFBMkJJLFNBQVMsQ0FDcEM7TUFDRjtNQUNBLElBQUksQ0FBQVYsTUFBTSxhQUFOQSxNQUFNLHVCQUFOQSxNQUFNLENBQUVFLEtBQUssa0RBQXNDLElBQUlKLEtBQUssSUFBSSxDQUFDLEVBQUU7UUFBQTtRQUN0RUcsT0FBTyxHQUFJLEdBQUVBLE9BQVEsc0JBQXFCRCxNQUFNLENBQUNXLEtBQU0sdUJBQXNCLEdBQUksU0FBUWIsS0FBTSxFQUFDO1FBQ2hHRixZQUFZLENBQUNRLFFBQVEsQ0FDcEJDLGFBQWEsQ0FBQ0MsTUFBTSxFQUNwQkMsYUFBYSxDQUFDSyxNQUFNLEVBQ3BCWCxPQUFPLEVBQ1BRLGlC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