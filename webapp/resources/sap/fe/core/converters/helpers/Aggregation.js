/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/helpers/TypeGuards"],function(t){"use strict";var e={};var n=t.isNavigationProperty;var o=t.isEntityType;var i=t.isEntitySet;let r=function(){function t(t,e){var r;let g=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;this._entityType=t;this._converterContext=e;this._oAggregationAnnotationTarget=this._determineAggregationAnnotationTarget();if(n(this._oAggregationAnnotationTarget)||o(this._oAggregationAnnotationTarget)||i(this._oAggregationAnnotationTarget)){this.oTargetAggregationAnnotations=this._oAggregationAnnotationTarget.annotations.Aggregation}this._bApplySupported=(r=this.oTargetAggregationAnnotations)!==null&&r!==void 0&&r.ApplySupported?true:false;if(this._bApplySupported){var a,s,l,u;this._aGroupableProperties=(a=this.oTargetAggregationAnnotations)===null||a===void 0?void 0:(s=a.ApplySupported)===null||s===void 0?void 0:s.GroupableProperties;this._aAggregatableProperties=(l=this.oTargetAggregationAnnotations)===null||l===void 0?void 0:(u=l.ApplySupported)===null||u===void 0?void 0:u.AggregatableProperties;this.oContainerAggregationAnnotation=e.getEntityContainer().annotations.Aggregation}if(!this._aAggregatableProperties&&g){const t=this._getEntityProperties();this._aAggregatableProperties=t===null||t===void 0?void 0:t.filter(t=>{var e,n;return(e=t.annotations)===null||e===void 0?void 0:(n=e.Aggregation)===null||n===void 0?void 0:n.Aggregatable})}}e.AggregationHelper=t;var r=t.prototype;r._determineAggregationAnnotationTarget=function t(){var e,n,o,r,g;const a=(e=this._converterContext.getDataModelObjectPath())!==null&&e!==void 0&&(n=e.targetEntitySet)!==null&&n!==void 0&&(o=n.entityType)!==null&&o!==void 0&&(r=o.annotations)!==null&&r!==void 0&&(g=r.Common)!==null&&g!==void 0&&g.ResultContext?true:false;let s;if(a){var l,u,p,A;const t=this._converterContext.getDataModelObjectPath();const e=t===null||t===void 0?void 0:t.targetObject;const n=t===null||t===void 0?void 0:t.targetEntityType;if(e!==null&&e!==void 0&&(l=e.annotations)!==null&&l!==void 0&&(u=l.Aggregation)!==null&&u!==void 0&&u.ApplySupported){s=e}else if(n!==null&&n!==void 0&&(p=n.annotations)!==null&&p!==void 0&&(A=p.Aggregation)!==null&&A!==void 0&&A.ApplySupported){s=n}}else{var d;const t=this._converterContext.getEntitySet();if(i(t)&&(d=t.annotations.Aggregation)!==null&&d!==void 0&&d.ApplySupported){s=t}else{s=this._converterContext.getEntityType()}}return s};r.isAnalyticsSupported=function t(){return this._bApplySupported};r.isPropertyGroupable=function t(e){if(!this._bApplySupported){return undefined}else if(!this._aGroupableProperties||this._aGroupableProperties.length===0){return true}else{return this._aGroupableProperties.findIndex(t=>t.$target.fullyQualifiedName===e.fullyQualifiedName)>=0}};r.isPropertyAggregatable=function t(e){if(!this._bApplySupported){return undefined}else{const t=this._converterContext.getAnnotationsByTerm("Aggregation","Org.OData.Aggregation.V1.CustomAggregate",[this._oAggregationAnnotationTarget]);return t.some(t=>e.name===t.qualifier)}};r.getGroupableProperties=function t(){return this._aGroupableProperties};r.getAggregatableProperties=function t(){return this._aAggregatableProperties};r.getEntityType=function t(){return this._entityType};r.getAggregatedProperties=function t(e){if(e==="AggregatedProperties"){return this._converterContext.getAnnotationsByTerm("Analytics","com.sap.vocabularies.Analytics.v1.AggregatedProperties",[this._converterContext.getEntityContainer(),this._converterContext.getEntityType()])}return this._converterContext.getAnnotationsByTerm("Analytics","com.sap.vocabularies.Analytics.v1.AggregatedProperty",[this._converterContext.getEntityContainer(),this._converterContext.getEntityType()])};r.getTransAggregations=function t(){var e;let n=this.getAggregatedProperties("AggregatedProperty");if(!n||n.length===0){n=this.getAggregatedProperties("AggregatedProperties")[0]}return(e=n)===null||e===void 0?void 0:e.filter(t=>{if(this._getAggregatableAggregates(t.AggregatableProperty)){return t}})};r._getAggregatableAggregates=function t(e){const n=this.getAggregatableProperties()||[];return n.find(function(t){var n;const o=e.qualifier?e.qualifier:e.$target.name;if(t!==null&&t!==void 0&&(n=t.Property)!==null&&n!==void 0&&n.value){return t.Property.value===o}return(t===null||t===void 0?void 0:t.name)===o})};r._getEntityProperties=function t(){let e;if(i(this._oAggregationAnnotationTarget)){var n,r;e=(n=this._oAggregationAnnotationTarget)===null||n===void 0?void 0:(r=n.entityType)===null||r===void 0?void 0:r.entityProperties}else if(o(this._oAggregationAnnotationTarget)){var g;e=(g=this._oAggregationAnnotationTarget)===null||g===void 0?void 0:g.entityProperties}return e};r.getCustomAggregateDefinitions=function t(){const e=this._converterContext.getAnnotationsByTerm("Aggregation","Org.OData.Aggregation.V1.CustomAggregate",[this._oAggregationAnnotationTarget]);return e};r.getAllowedTransformations=function t(){var e,n,o,i;return((e=this.oTargetAggregationAnnotations)===null||e===void 0?void 0:(n=e.ApplySupported)===null||n===void 0?void 0:n.Transformations)||((o=this.oContainerAggregationAnnotation)===null||o===void 0?void 0:(i=o.ApplySupportedDefaults)===null||i===void 0?void 0:i.Transformations)};return t}();e.AggregationHelper=r;return e},false);
//# sourceMappingURL=Aggregation.js.map