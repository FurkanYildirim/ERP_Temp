/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/buildingBlocks/BuildingBlockSupport","sap/fe/core/buildingBlocks/RuntimeBuildingBlock","sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/ResourceModelHelper","sap/m/Button","sap/m/CustomListItem","sap/m/Dialog","sap/m/Label","sap/m/List","sap/m/Text","sap/m/VBox","sap/ui/core/CustomData","sap/ui/core/library","sap/fe/core/jsx-runtime/jsx","sap/fe/core/jsx-runtime/jsxs","sap/fe/core/jsx-runtime/Fragment"],function(e,t,o,i,s,n,a,r,l,c,u,d,p,D,f,g,h){"use strict";var L,T,_,m,v,A,S;var R={};var O=D.ValueState;var b=s.getResourceModel;var y=i.defineReference;var C=t.defineBuildingBlock;function F(e,t,o,i){if(!o)return;Object.defineProperty(e,t,{enumerable:o.enumerable,configurable:o.configurable,writable:o.writable,value:o.initializer?o.initializer.call(i):void 0})}function x(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function B(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;w(e,t)}function w(e,t){w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,o){t.__proto__=o;return t};return w(e,t)}function E(e,t,o,i,s){var n={};Object.keys(i).forEach(function(e){n[e]=i[e]});n.enumerable=!!n.enumerable;n.configurable=!!n.configurable;if("value"in n||n.initializer){n.writable=true}n=o.slice().reverse().reduce(function(o,i){return i(e,t,o)||o},n);if(s&&n.initializer!==void 0){n.value=n.initializer?n.initializer.call(s):void 0;n.initializer=undefined}if(n.initializer===void 0){Object.defineProperty(e,t,n);n=null}return n}function M(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}var k;(function(e){e["Save"]="draftDataLossOptionSave";e["Keep"]="draftDataLossOptionKeep";e["Discard"]="draftDataLossOptionDiscard"})(k||(k={}));let P=(L=C({name:"DraftDataLossDialog",namespace:"sap.fe.core.controllerextensions"}),T=y(),_=y(),L(m=(v=function(t){B(o,t);function o(e){var o;o=t.call(this,e)||this;F(o,"dataLossDialog",A,x(o));F(o,"optionsList",S,x(o));return o}R=o;var i=o.prototype;i.dataLossConfirmation=function e(){var t;const o=this.controller.getView();this.dataLossResourceModel=b(o);this.getContent();const i=()=>this.handleDataLossOk();(t=this.optionsList.current)===null||t===void 0?void 0:t.addEventDelegate({onsapenter:function(){i()}});o.addDependent(this.dataLossDialog.current);this.openDataLossDialog();this.selectAndFocusFirstEntry()};i.performAfterDiscardorKeepDraft=async function e(t,o,i,s){this.controller=i;this.skipBindingToView=s;this.dataLossConfirmation();return new Promise((e,i)=>{this.onDataLossConfirmationFollowUpFunction=o=>{const i=t(o);e(i)};this.onDataLossCancelFollowUpFunction=()=>{o();i()}})};i.handleDataLossOk=function t(){const o=this.getSelectedKey();if(o===k.Save){this.saveDocument(this.controller).then(this.onDataLossConfirmationFollowUpFunction).catch(function(t){e.error("Error while saving document",t)});this.closeDataLossDialog()}else if(o===k.Keep){this.onDataLossConfirmationFollowUpFunction();this.closeDataLossDialog()}else if(o===k.Discard){this.discardDraft(this.controller,this.skipBindingToView).then(this.onDataLossConfirmationFollowUpFunction).catch(function(t){e.error("Error while discarding draft",t)});this.closeDataLossDialog()}};i.handleDataLossCancel=function e(){this.onDataLossCancelFollowUpFunction();this.closeDataLossDialog()};i.selectAndFocusFirstEntry=function e(){var t,o;const i=(t=this.optionsList.current)===null||t===void 0?void 0:t.getItems()[0];(o=this.optionsList.current)===null||o===void 0?void 0:o.setSelectedItem(i);i===null||i===void 0?void 0:i.focus()};i.discardDraft=async function e(t,o){const i=t.getView().getBindingContext();const s={skipBackNavigation:true,skipDiscardPopover:true,skipBindingToView:o!==undefined?o:true};return t.editFlow.cancelDocument(i,s)};i.saveDocument=function e(t){const o=t.getView().getBindingContext();if(t.isA("sap.fe.templates.ObjectPage.ObjectPageController")){return t._saveDocument(o)}else{return t.editFlow.saveDocument(o,{})}};i.getSelectedKey=function e(){const t=this.optionsList.current;return t.getSelectedItem().data("itemKey")};i.openDataLossDialog=function e(){var t;(t=this.dataLossDialog.current)===null||t===void 0?void 0:t.open()};i.closeDataLossDialog=function e(){var t,o;(t=this.dataLossDialog.current)===null||t===void 0?void 0:t.close();(o=this.dataLossDialog.current)===null||o===void 0?void 0:o.destroy()};i.getConfirmButton=function e(){return f(n,{text:this.dataLossResourceModel.getText("C_COMMON_DIALOG_OK"),type:"Emphasized",press:()=>this.handleDataLossOk()})};i.getCancelButton=function e(){return f(n,{text:this.dataLossResourceModel.getText("C_COMMON_DIALOG_CANCEL"),press:()=>this.handleDataLossCancel()})};i.getContent=function e(){var t;const o=(t=this.controller.getView().getBindingContext())===null||t===void 0?void 0:t.getObject().HasActiveEntity;const i=o?this.dataLossResourceModel.getText("ST_DRAFT_DATALOSS_POPUP_MESSAGE_SAVE"):this.dataLossResourceModel.getText("ST_DRAFT_DATALOSS_POPUP_MESSAGE_CREATE");const s=o?this.dataLossResourceModel.getText("ST_DRAFT_DATALOSS_SAVE_DRAFT_RBL"):this.dataLossResourceModel.getText("ST_DRAFT_DATALOSS_CREATE_ENTITY_RBL");const n=o?this.dataLossResourceModel.getText("ST_DRAFT_DATALOSS_SAVE_DRAFT_TOL"):this.dataLossResourceModel.getText("ST_DRAFT_DATALOSS_CREATE_ENTITY_TOL");return f(r,{title:this.dataLossResourceModel.getText("WARNING"),state:O.Warning,type:"Message",contentWidth:"22rem",ref:this.dataLossDialog,children:{content:g(h,{children:[f(u,{text:i,class:"sapUiTinyMarginBegin sapUiTinyMarginTopBottom"}),g(c,{mode:"SingleSelectLeft",showSeparators:"None",includeItemInSelection:"true",backgroundDesign:"Transparent",class:"sapUiNoContentPadding",ref:this.optionsList,children:[f(a,{customData:[new p({key:"itemKey",value:"draftDataLossOptionSave"})],children:g(d,{class:"sapUiTinyMargin",children:[f(l,{text:s,design:"Bold"}),f(u,{text:n})]})}),f(a,{customData:[new p({key:"itemKey",value:"draftDataLossOptionKeep"})],children:g(d,{class:"sapUiTinyMargin",children:[f(l,{text:this.dataLossResourceModel.getText("ST_DRAFT_DATALOSS_KEEP_DRAFT_RBL"),design:"Bold"}),f(u,{text:this.dataLossResourceModel.getText("ST_DRAFT_DATALOSS_KEEP_DRAFT_TOL")})]})}),f(a,{customData:[new p({key:"itemKey",value:"draftDataLossOptionDiscard"})],children:g(d,{class:"sapUiTinyMargin",children:[f(l,{text:this.dataLossResourceModel.getText("ST_DRAFT_DATALOSS_DISCARD_DRAFT_RBL"),design:"Bold"}),f(u,{text:this.dataLossResourceModel.getText("ST_DRAFT_DATALOSS_DISCARD_DRAFT_TOL")})]})})]})]}),buttons:g(h,{children:["confirmButton = ",this.getConfirmButton(),"cancelButton = ",this.getCancelButton()]})}})};return o}(o),A=E(v.prototype,"dataLossDialog",[T],{configurable:true,enumerable:true,writable:true,initializer:null}),S=E(v.prototype,"optionsList",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),v))||m);R=P;return R},false);
//# sourceMappingURL=DraftDataLossDialog.block.js.map