/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/SemanticKeyHelper","sap/ui/core/routing/HashChanger","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,n,i,o,s){"use strict";let r;function l(e,t){const n=Object.keys(e);const i=n.filter(function(t){const n=e[t];return n!==undefined}).map(function(t){const n=e[t];return new o(t,s.EQ,n)});if(t){const e=new o({filters:[new o("SiblingEntity/IsActiveEntity",s.EQ,true)],and:false});i.push(e)}return new o(i,true)}function a(e,t,n){const i=e.getView().getBindingContext().getModel().bindList(`/${t}`,undefined,undefined,n,{$$groupId:"$auto.Heroes"});return i.requestContexts(0,2).then(function(e){if(e&&e.length){return e[0].getPath()}})}function c(e,t,n){const o=[];const s=[];let r=e.getModel().getMetaModel().getMetaPath(e.getPath());if(r.indexOf("/")===0){r=r.substring(1)}const c=r.split("/");const u=i.getInstance().getHash().split("?")[0];const g=u.split("/");const f={};const d=[];g.forEach(function(t){const n=t.substring(t.indexOf("(")+1,t.length-1).split(",");const i={};const o=t.split("(")[0];f[o]={};d.push(o);f[o]["bIsActiveEntityDefined"]=true;for(let o=0;o<n.length;o++){const s=n[o];const r=s.split("=");let l=r[1];let a=r[0];if(s.indexOf("=")===-1){const n=e.getModel().getMetaModel();const i=n.getObject(`/${d.join("/")}/$Type/$Key`);l=r[0];a=i[0];f[t.split("(")[0]]["bIsActiveEntityDefined"]=false}if(a!=="IsActiveEntity"){if(l.indexOf("'")===0&&l.lastIndexOf("'")===l.length-1){l=decodeURIComponent(l.substring(1,l.length-1))}i[a]=l}}f[o].mKeyValues=i});let p=n;c.forEach(function(t){const i={};const o=p.$NavigationPropertyBinding&&p.$NavigationPropertyBinding[t];if(o){i.pageEntityName=p.$NavigationPropertyBinding[t];p=e.getModel().getMetaModel().getObject(`/${o}`)||n}else{i.pageEntityName=t}i.mKeyValues=f[t].mKeyValues;i.bIsActiveEntityDefined=f[t].bIsActiveEntityDefined;s.push(i)});s.forEach(function(e){const n=l(e.mKeyValues,e.bIsActiveEntityDefined);o.push(a(t,e.pageEntityName,n))});return o}function u(t,n){const o=i.getInstance().getHash().split("?")[0];let s=o&&o.substr(0,o.indexOf("("));if(s.indexOf("/")===0){s=s.substring(1)}const r=t.getModel().getMetaModel().getObject(`/${s}`);const l=t;const a=c(t,n,r);if(a.length>0){return Promise.all(a).then(function(e){const t=[];let n=r;if(e[0].indexOf("/")===0){t.push(e[0].substring(1))}else{t.push(e[0])}for(let i=1;i<e.length;i++){let o=e[i];let s="";let a=o&&o.substr(0,o.indexOf("("));if(a.indexOf("/")===0){a=a.substring(1)}if(o.indexOf("/")===0){o=o.substring(1)}s=Object.keys(n.$NavigationPropertyBinding)[Object.values(n.$NavigationPropertyBinding).indexOf(a)];if(s){t.push(o.replace(a,s));n=l.getModel().getMetaModel().getObject(`/${a}`)||r}else{t.push(o)}}return t}).catch(function(t){e.info("Failed to retrieve one or more active context path's",t)})}else{return Promise.resolve()}}function g(e,o){let s,l;const a=i.getInstance().getHash().split("?")[0];if(e){const i=e.getModel();const o=i.getMetaModel();r=t.isStickySessionSupported(o);let s=a&&a.substr(0,a.indexOf("("));if(s.indexOf("/")===0){s=s.substring(1)}l=n.getSemanticKeys(o,s)}const c=o.getView().getViewData();if(e&&!r&&(c.viewLevel===1&&!l||c.viewLevel>=2)){s=u(e,o);return s}else{return Promise.resolve()}}function f(e,t,n){let o;const s=i.getInstance().getHash();const r=i.getInstance().hrefForAppSpecificHash?i.getInstance().hrefForAppSpecificHash(""):"";if(e&&!t&&n){o=r+n.join("/")}else{o=s?r+s:window.location.hash}return window.location.origin+window.location.pathname+window.location.search+o}function d(){const t=sap.ushell&&sap.ushell.Container;if(t){return t.getFLPUrlAsync(true).then(function(e){return e}).catch(function(t){e.error("Could not retrieve cFLP URL for the sharing dialog (dialog will not be opened)",t)})}else{return Promise.resolve(document.URL)}}function p(t,n,o){let s;const r=i.getInstance().getHash();const l=i.getInstance().hrefForAppSpecificHash?i.getInstance().hrefForAppSpecificHash(""):"";if(t&&!n&&o){s=l+o.join("/")}else{s=r?l+r:window.location.hash}if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.runningInIframe&&sap.ushell.Container.runningInIframe()){sap.ushell.Container.getFLPUrl(true).then(function(e){return e.substr(0,e.indexOf("#"))+s}).catch(function(t){e.error("Could not retrieve cFLP URL for the sharing dialog (dialog will not be opened)",t)})}else{return Promise.resolve(window.location.origin+window.location.pathname+s)}}const h={adaptShareMetadata:async function(t){const n=this.base.getView().getBindingContext();const i=this.base.getView().getModel("ui");const o=i.getProperty("/isEditable");try{var s,l;const e=this.base.getAppComponent().getManifest();const i=e===null||e===void 0?void 0:(s=e["sap.app"])===null||s===void 0?void 0:s.id;const a=e===null||e===void 0?void 0:(l=e["sap.app"])===null||l===void 0?void 0:l.title;const c=await g(n,this.base.getView().getController());const u=this.base.getView().getController()._getPageTitleInformation();const h=await Promise.all([p(o,r,c),f(o,r,c),d()]);let b=u.title;const y=u.subtitle?u.subtitle.toString():"";if(y){b=`${b} - ${y}`}t.tile={title:u.title,subtitle:y};t.email.title=b;t.title=b;t.jam.url=h[0];t.url=h[1];t.email.url=h[2];const v=this.base.getView().getModel("collaborationInfo");v.setProperty("/url",t.url);v.setProperty("/appTitle",a);v.setProperty("/subTitle",y);v.setProperty("/appId",i)}catch(t){e.error(t)}return t}};return h},false);
//# sourceMappingURL=Share.js.map