/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/CommonUtils", "sap/fe/core/converters/MetaModelConverter", "sap/fe/core/helpers/BindingToolkit", "sap/fe/core/helpers/ResourceModelHelper", "sap/ui/core/Core", "sap/ui/mdc/p13n/StateUtil", "./AnalyticalInsightsHelper", "./InsightsCardHelper"], function (CommonUtils, MetaModelConverter, BindingToolkit, ResourceModelHelper, Core, StateUtil, AnalyticalInsightsHelper, InsightsCardHelper) {
  "use strict";

  var _exports = {};
  var showErrorMessageForInsightsCard = InsightsCardHelper.showErrorMessageForInsightsCard;
  var IntegrationCardType = InsightsCardHelper.IntegrationCardType;
  var getMeasures = AnalyticalInsightsHelper.getMeasures;
  var getFeeds = AnalyticalInsightsHelper.getFeeds;
  var getDimensions = AnalyticalInsightsHelper.getDimensions;
  var getChartProperties = AnalyticalInsightsHelper.getChartProperties;
  var getResourceModel = ResourceModelHelper.getResourceModel;
  var pathInModel = BindingToolkit.pathInModel;
  var getExpressionFromAnnotation = BindingToolkit.getExpressionFromAnnotation;
  var concat = BindingToolkit.concat;
  var compileExpression = BindingToolkit.compileExpression;
  var getInvolvedDataModelObjects = MetaModelConverter.getInvolvedDataModelObjects;
  /**
   * Checks if the insights card creation is possible.
   *
   * @param control
   * @param insightsRelevantColumns
   * @returns True if the insights card can be created.
   */
  async function isInsightsCardCreationPossible(control, insightsRelevantColumns) {
    try {
      const filterBar = Core.byId(control.getFilter());
      const controlState = await StateUtil.retrieveExternalState(control);
      let isSemanticDateFilterApplied = false;
      let isControlLevelFilterApplied = false;
      if (filterBar !== undefined) {
        isSemanticDateFilterApplied = filterBar.getParent().isSemanticDateFilterApplied();
      }
      if (controlState.filter) {
        const controlLevelFilterKeys = Object.keys(controlState.filter);
        for (const key of controlLevelFilterKeys) {
          const controlStateFilter = controlState.filter[key];
          if (Array.isArray(controlStateFilter) && controlStateFilter.length) {
            isControlLevelFilterApplied = true;
            break;
          }
        }
      }
      if (isControlLevelFilterApplied || isSemanticDateFilterApplied || (insightsRelevantColumns ? insightsRelevantColumns.length === 0 : false)) {
        return false;
      }
      return true;
    } catch {
      throw Error("Error retrieving control states");
    }
  }

  /**
   * Filters the columns that can be shown on the insights card from the visible columns on the table.
   *
   * @param tableAPI
   * @returns A list of columns that can be shown on the insightsCard.
   */
  function getInsightsRelevantColumns(tableAPI) {
    var _table$getModel;
    const table = tableAPI.content;
    const visibleColumns = table.getColumns();
    const supportedColumnNames = [];
    const metaModel = (_table$getModel = table.getModel()) === null || _table$getModel === void 0 ? void 0 : _table$getModel.getMetaModel();
    const metaPath = table.data("metaPath");
    tableAPI.getTableDefinition().columns.forEach(function (column) {
      if (column.isInsightsSupported === true) {
        supportedColumnNames.push(column.name);
      }
    });
    return visibleColumns.filter(function (column) {
      return supportedColumnNames.includes(column.getDataProperty());
    }).map(function (supportedColumn) {
      const dataProperty = supportedColumn.getDataProperty(),
        propertyContext = metaModel === null || metaModel === void 0 ? void 0 : metaModel.getContext(metaPath + "/" + dataProperty),
        dataModel = getInvolvedDataModelObjects(propertyContext),
        propertyTargetObject = dataModel.targetObject,
        uomBinding = getUomBinding(propertyTargetObject, dataProperty),
        columnText = uomBinding ? uomBinding : getTextArrangementForColumn(propertyTargetObject, dataProperty);
      return {
        visible: false,
        name: columnText,
        label: supportedColumn.getProperty("header")
      };
    });
  }

  /**
   * Constructs the insights parameters from the table that is required to create the insights card.
   *
   * @param controlAPI
   * @param cardType
   * @param insightsRelevantColumns
   * @returns The insights parameters from the table.
   */
  _exports.getInsightsRelevantColumns = getInsightsRelevantColumns;
  async function createInsightsParams(controlAPI, cardType, insightsRelevantColumns) {
    let controlState;
    const control = controlAPI.content;
    const filterbarID = control.getFilter() !== "" ? control.getFilter() : undefined;
    const isCardCreationSupported = await isInsightsCardCreationPossible(control, insightsRelevantColumns);
    if (!isCardCreationSupported) {
      showErrorMessageForInsightsCard(cardType, getResourceModel(controlAPI));
      return;
    }
    try {
      controlState = await StateUtil.retrieveExternalState(control);
    } catch {
      throw Error("Error retrieving control states");
    }
    const entitySetPath = cardType === IntegrationCardType.table ? control.data("metaPath") : control.data("targetCollectionPath");
    const appComponent = CommonUtils.getAppComponent(control);
    const appManifest = appComponent.getManifestEntry("sap.app");
    const serviceUrl = control.getModel().getServiceUrl();
    let queryUrl = "";
    const insightsParams = {
      appComponent: appComponent,
      type: cardType,
      requestParameters: {
        serviceUrl: "",
        queryUrl: "",
        groupBy: undefined
      },
      content: {
        cardTitle: "",
        insightsRelevantColumns: []
      },
      parentAppId: appManifest.id,
      parameters: {
        filterbarID: filterbarID
      },
      entitySetPath: entitySetPath
    };
    if (cardType === IntegrationCardType.table) {
      insightsParams.content = {
        cardTitle: control.getHeader(),
        insightsRelevantColumns: insightsRelevantColumns ?? []
      };
      queryUrl = control.getRowBinding().getDownloadUrl();
      insightsParams.content.cardTitle = control.getHeader();
      insightsParams.parentAppId = appManifest.id;
      const groupProperty = Array.isArray(controlState.groupLevels) && controlState.groupLevels.length ? controlState.groupLevels[0].name : undefined;
      if (groupProperty !== undefined) {
        const groupPropertyName = groupProperty.includes("::") ? groupProperty.split("::")[1] : groupProperty;
        insightsParams.requestParameters.groupBy = {
          property: groupPropertyName
        };
      }
    } else {
      const chart = control;
      const innerChart = chart.getControlDelegate().getInnerChart(chart);
      const chartContent = {
        cardTitle: chart.getHeader(),
        legendVisible: false,
        chartType: chart.getChartType(),
        measures: getMeasures(innerChart),
        dimensions: getDimensions(innerChart),
        feeds: getFeeds(innerChart),
        allowedChartTypes: innerChart.getAvailableChartTypes().available,
        chartProperties: getChartProperties(innerChart)
      };
      insightsParams.content = chartContent;
      queryUrl = innerChart.getBindingInfo("data").binding.getDownloadUrl();
    }
    insightsParams.requestParameters.serviceUrl = serviceUrl;
    insightsParams.requestParameters.queryUrl = queryUrl.includes(serviceUrl) ? queryUrl.split(serviceUrl)[1] : queryUrl;
    return insightsParams;
  }
  _exports.createInsightsParams = createInsightsParams;
  function getTextArrangementForColumn(propertyTargetObject, property) {
    var _propertyTargetObject, _text$annotations, _text$annotations$UI, _text$annotations$UI$;
    const propertyParts = property.split("/");
    let navigationPath;
    if (propertyParts.length > 1) {
      propertyParts.pop();
      navigationPath = propertyParts.join();
    }
    const text = (_propertyTargetObject = propertyTargetObject.annotations.Common) === null || _propertyTargetObject === void 0 ? void 0 : _propertyTargetObject.Text;
    const textArrangement = text === null || text === void 0 ? void 0 : (_text$annotations = text.annotations) === null || _text$annotations === void 0 ? void 0 : (_text$annotations$UI = _text$annotations.UI) === null || _text$annotations$UI === void 0 ? void 0 : (_text$annotations$UI$ = _text$annotations$UI.TextArrangement) === null || _text$annotations$UI$ === void 0 ? void 0 : _text$annotations$UI$.valueOf();
    const propertyBinding = pathInModel(property);
    let columnBindingValue;
    if (text) {
      const textBinding = getExpressionFromAnnotation(text, navigationPath ? [navigationPath] : []);
      if (textArrangement === "UI.TextArrangementType/TextLast") {
        columnBindingValue = concat(propertyBinding, " (", textBinding, ")");
      } else if (textArrangement === "UI.TextArrangementType/TextOnly") {
        columnBindingValue = textBinding;
      } else if (textArrangement === "UI.TextArrangementType/TextSeparate") {
        columnBindingValue = propertyBinding;
      } else {
        columnBindingValue = concat(textBinding, " (", propertyBinding, ")");
      }
    } else {
      columnBindingValue = propertyBinding;
    }
    return compileExpression(columnBindingValue);
  }
  function getUomBinding(propertyTargetObject, property) {
    var _propertyTargetObject2, _propertyTargetObject3;
    const uom = ((_propertyTargetObject2 = propertyTargetObject.annotations.Measures) === null || _propertyTargetObject2 === void 0 ? void 0 : _propertyTargetObject2.ISOCurrency) || ((_propertyTargetObject3 = propertyTargetObject.annotations.Measures) === null || _propertyTargetObject3 === void 0 ? void 0 : _propertyTargetObject3.Unit);
    if (!uom) {
      return;
    } else {
      const propertyBinding = pathInModel(property);
      return compileExpression(concat(propertyBinding, " ", getExpressionFromAnnotation(uom)));
    }
  }
  return _exports;
}, false);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJpc0luc2lnaHRzQ2FyZENyZWF0aW9uUG9zc2libGUiLCJjb250cm9sIiwiaW5zaWdodHNSZWxldmFudENvbHVtbnMiLCJmaWx0ZXJCYXIiLCJDb3JlIiwiYnlJZCIsImdldEZpbHRlciIsImNvbnRyb2xTdGF0ZSIsIlN0YXRlVXRpbCIsInJldHJpZXZlRXh0ZXJuYWxTdGF0ZSIsImlzU2VtYW50aWNEYXRlRmlsdGVyQXBwbGllZCIsImlzQ29udHJvbExldmVsRmlsdGVyQXBwbGllZCIsInVuZGVmaW5lZCIsImdldFBhcmVudCIsImZpbHRlciIsImNvbnRyb2xMZXZlbEZpbHRlcktleXMiLCJPYmplY3QiLCJrZXlzIiwia2V5IiwiY29udHJvbFN0YXRlRmlsdGVyIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwiRXJyb3IiLCJnZXRJbnNpZ2h0c1JlbGV2YW50Q29sdW1ucyIsInRhYmxlQVBJIiwidGFibGUiLCJjb250ZW50IiwidmlzaWJsZUNvbHVtbnMiLCJnZXRDb2x1bW5zIiwic3VwcG9ydGVkQ29sdW1uTmFtZXMiLCJtZXRhTW9kZWwiLCJnZXRNb2RlbCIsImdldE1ldGFNb2RlbCIsIm1ldGFQYXRoIiwiZGF0YSIsImdldFRhYmxlRGVmaW5pdGlvbiIsImNvbHVtbnMiLCJmb3JFYWNoIiwiY29sdW1uIiwiaXNJbnNpZ2h0c1N1cHBvcnRlZCIsInB1c2giLCJuYW1lIiwiaW5jbHVkZXMiLCJnZXREYXRhUHJvcGVydHkiLCJtYXAiLCJzdXBwb3J0ZWRDb2x1bW4iLCJkYXRhUHJvcGVydHkiLCJwcm9wZXJ0eUNvbnRleHQiLCJnZXRDb250ZXh0IiwiZGF0YU1vZGVsIiwiZ2V0SW52b2x2ZWREYXRhTW9kZWxPYmplY3RzIiwicHJvcGVydHlUYXJnZXRPYmplY3QiLCJ0YXJnZXRPYmplY3QiLCJ1b21CaW5kaW5nIiwiZ2V0VW9tQmluZGluZyIsImNvbHVtblRleHQiLCJnZXRUZXh0QXJyYW5nZW1lbnRGb3JDb2x1bW4iLCJ2aXNpYmxlIiwibGFiZWwiLCJnZXRQcm9wZXJ0eSIsImNyZWF0ZUluc2lnaHRzUGFyYW1zIiwiY29udHJvbEFQSSIsImNhcmRUeXBlIiwiZmlsdGVyYmFySUQiLCJpc0NhcmRDcmVhdGlvblN1cHBvcnRlZCIsInNob3dFcnJvck1lc3NhZ2VGb3JJbnNpZ2h0c0NhcmQiLCJnZXRSZXNvdXJjZU1vZGVsIiwiZW50aXR5U2V0UGF0aCIsIkludGVncmF0aW9uQ2FyZFR5cGUiLCJhcHBDb21wb25lbnQiLCJDb21tb25VdGlscyIsImdldEFwcENvbXBvbmVudCIsImFwcE1hbmlmZXN0IiwiZ2V0TWFuaWZlc3RFbnRyeSIsInNlcnZpY2VVcmwiLCJnZXRTZXJ2aWNlVXJsIiwicXVlcnlVcmwiLCJpbnNpZ2h0c1BhcmFtcyIsInR5cGUiLCJyZXF1ZXN0UGFyYW1ldGVycyIsImdyb3VwQnkiLCJjYXJkVGl0bGUiLCJwYXJlbnRBcHBJZCIsImlkIiwicGFyYW1ldGVycyIsImdldEhlYWRlciIsImdldFJvd0JpbmRpbmciLCJnZXREb3dubG9hZFVybCIsImdyb3VwUHJvcGVydHkiLCJncm91cExldmVscyIsImdyb3VwUHJvcGVydHlOYW1lIiwic3BsaXQiLCJwcm9wZXJ0eSIsImNoYXJ0IiwiaW5uZXJDaGFydCIsImdldENvbnRyb2xEZWxlZ2F0ZSIsImdldElubmVyQ2hhcnQiLCJjaGFydENvbnRlbnQiLCJsZWdlbmRWaXNpYmxlIiwiY2hhcnRUeXBlIiwiZ2V0Q2hhcnRUeXBlIiwibWVhc3VyZXMiLCJnZXRNZWFzdXJlcyIsImRpbWVuc2lvbnMiLCJnZXREaW1lbnNpb25zIiwiZmVlZHMiLCJnZXRGZWVkcyIsImFsbG93ZWRDaGFydFR5cGVzIiwiZ2V0QXZhaWxhYmxlQ2hhcnRUeXBlcyIsImF2YWlsYWJsZSIsImNoYXJ0UHJvcGVydGllcyIsImdldENoYXJ0UHJvcGVydGllcyIsImdldEJpbmRpbmdJbmZvIiwiYmluZGluZyIsInByb3BlcnR5UGFydHMiLCJuYXZpZ2F0aW9uUGF0aCIsInBvcCIsImpvaW4iLCJ0ZXh0IiwiYW5ub3RhdGlvbnMiLCJDb21tb24iLCJUZXh0IiwidGV4dEFycmFuZ2VtZW50IiwiVUkiLCJUZXh0QXJyYW5nZW1lbnQiLCJ2YWx1ZU9mIiwicHJvcGVydHlCaW5kaW5nIiwicGF0aEluTW9kZWwiLCJjb2x1bW5CaW5kaW5nVmFsdWUiLCJ0ZXh0QmluZGluZyIsImdldEV4cHJlc3Npb25Gcm9tQW5ub3RhdGlvbiIsImNvbmNhdCIsImNvbXBpbGVFeHByZXNzaW9uIiwidW9tIiwiTWVhc3VyZXMiLCJJU09DdXJyZW5jeSIsIlVuaXQiXSwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIkNvbW1vbkluc2lnaHRzSGVscGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgUHJvcGVydHkgfSBmcm9tIFwiQHNhcC11eC92b2NhYnVsYXJpZXMtdHlwZXNcIjtcbmltcG9ydCB0eXBlIHsgSVNPQ3VycmVuY3ksIFVuaXQgfSBmcm9tIFwiQHNhcC11eC92b2NhYnVsYXJpZXMtdHlwZXMvdm9jYWJ1bGFyaWVzL01lYXN1cmVzXCI7XG5pbXBvcnQgdHlwZSB7IGRlZmF1bHQgYXMgQ2hhcnQgfSBmcm9tIFwic2FwL2NoYXJ0L0NoYXJ0XCI7XG5pbXBvcnQgQ29tbW9uVXRpbHMgZnJvbSBcInNhcC9mZS9jb3JlL0NvbW1vblV0aWxzXCI7XG5pbXBvcnQgeyBnZXRJbnZvbHZlZERhdGFNb2RlbE9iamVjdHMgfSBmcm9tIFwic2FwL2ZlL2NvcmUvY29udmVydGVycy9NZXRhTW9kZWxDb252ZXJ0ZXJcIjtcbmltcG9ydCB0eXBlIHsgQmluZGluZ1Rvb2xraXRFeHByZXNzaW9uIH0gZnJvbSBcInNhcC9mZS9jb3JlL2hlbHBlcnMvQmluZGluZ1Rvb2xraXRcIjtcbmltcG9ydCB7IGNvbXBpbGVFeHByZXNzaW9uLCBjb25jYXQsIGdldEV4cHJlc3Npb25Gcm9tQW5ub3RhdGlvbiwgcGF0aEluTW9kZWwgfSBmcm9tIFwic2FwL2ZlL2NvcmUvaGVscGVycy9CaW5kaW5nVG9vbGtpdFwiO1xuaW1wb3J0IHsgZ2V0UmVzb3VyY2VNb2RlbCB9IGZyb20gXCJzYXAvZmUvY29yZS9oZWxwZXJzL1Jlc291cmNlTW9kZWxIZWxwZXJcIjtcbmltcG9ydCB0eXBlIHsgQWxsb3dlZENoYXJ0VHlwZSwgSW5zaWdodHNDYXJkQ29sdW1uc1R5cGUgfSBmcm9tIFwic2FwL2luc2lnaHRzL0NhcmRIZWxwZXJcIjtcbmltcG9ydCBDb3JlIGZyb20gXCJzYXAvdWkvY29yZS9Db3JlXCI7XG5pbXBvcnQgU3RhdGVVdGlsIGZyb20gXCJzYXAvdWkvbWRjL3AxM24vU3RhdGVVdGlsXCI7XG5pbXBvcnQgdHlwZSBUYWJsZSBmcm9tIFwic2FwL3VpL21kYy9UYWJsZVwiO1xuaW1wb3J0IHR5cGUgTWV0YU1vZGVsIGZyb20gXCJzYXAvdWkvbW9kZWwvTWV0YU1vZGVsXCI7XG5pbXBvcnQgdHlwZSBDb250ZXh0IGZyb20gXCJzYXAvdWkvbW9kZWwvb2RhdGEvdjQvQ29udGV4dFwiO1xuaW1wb3J0IHR5cGUgT0RhdGFMaXN0QmluZGluZyBmcm9tIFwic2FwL3VpL21vZGVsL29kYXRhL3Y0L09EYXRhTGlzdEJpbmRpbmdcIjtcbmltcG9ydCB0eXBlIE9EYXRhTW9kZWwgZnJvbSBcInNhcC91aS9tb2RlbC9vZGF0YS92NC9PRGF0YU1vZGVsXCI7XG5pbXBvcnQgdHlwZSBDaGFydEFQSSBmcm9tIFwiLi4vY2hhcnQvQ2hhcnRBUElcIjtcbmltcG9ydCB0eXBlIEZpbHRlckJhckFQSSBmcm9tIFwiLi4vZmlsdGVyQmFyL0ZpbHRlckJhckFQSVwiO1xuaW1wb3J0IHR5cGUgVGFibGVBUEkgZnJvbSBcIi4uL3RhYmxlL1RhYmxlQVBJXCI7XG5pbXBvcnQgdHlwZSB7IElubmVyQ2hhcnRUeXBlIH0gZnJvbSBcIi4vQW5hbHl0aWNhbEluc2lnaHRzSGVscGVyXCI7XG5pbXBvcnQgeyBnZXRDaGFydFByb3BlcnRpZXMsIGdldERpbWVuc2lvbnMsIGdldEZlZWRzLCBnZXRNZWFzdXJlcyB9IGZyb20gXCIuL0FuYWx5dGljYWxJbnNpZ2h0c0hlbHBlclwiO1xuaW1wb3J0IHR5cGUgeyBDaGFydENvbnRlbnRUeXBlLCBJbnNpZ2h0c1BhcmFtc1R5cGUgfSBmcm9tIFwiLi9JbnNpZ2h0c0NhcmRIZWxwZXJcIjtcbmltcG9ydCB7IEludGVncmF0aW9uQ2FyZFR5cGUsIHNob3dFcnJvck1lc3NhZ2VGb3JJbnNpZ2h0c0NhcmQgfSBmcm9tIFwiLi9JbnNpZ2h0c0NhcmRIZWxwZXJcIjtcblxudHlwZSBHcm91cExldmVsID0ge1xuXHRuYW1lOiBzdHJpbmc7XG59O1xudHlwZSBDb250cm9sRGVsZWdhdGUgPSB7XG5cdGdldElubmVyQ2hhcnQ6IEZ1bmN0aW9uO1xufTtcbnR5cGUgRGF0YUJpbmRpbmcgPSB7XG5cdGJpbmRpbmc6IE9EYXRhTGlzdEJpbmRpbmc7XG59O1xudHlwZSBDaGFydFR5cGUgPSBDaGFydCAmIHsgZ2V0RmlsdGVyOiBGdW5jdGlvbjsgZ2V0Q29udHJvbERlbGVnYXRlOiBGdW5jdGlvbjsgZ2V0SGVhZGVyOiBGdW5jdGlvbjsgZ2V0TGVnZW5kVmlzaWJsZTogRnVuY3Rpb24gfTtcblxuLyoqXG4gKiBDaGVja3MgaWYgdGhlIGluc2lnaHRzIGNhcmQgY3JlYXRpb24gaXMgcG9zc2libGUuXG4gKlxuICogQHBhcmFtIGNvbnRyb2xcbiAqIEBwYXJhbSBpbnNpZ2h0c1JlbGV2YW50Q29sdW1uc1xuICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgaW5zaWdodHMgY2FyZCBjYW4gYmUgY3JlYXRlZC5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gaXNJbnNpZ2h0c0NhcmRDcmVhdGlvblBvc3NpYmxlKGNvbnRyb2w6IFRhYmxlIHwgQ2hhcnRUeXBlLCBpbnNpZ2h0c1JlbGV2YW50Q29sdW1ucz86IEluc2lnaHRzQ2FyZENvbHVtbnNUeXBlW10pIHtcblx0dHJ5IHtcblx0XHRjb25zdCBmaWx0ZXJCYXIgPSBDb3JlLmJ5SWQoKGNvbnRyb2wgYXMgVGFibGUpLmdldEZpbHRlcigpKTtcblx0XHRjb25zdCBjb250cm9sU3RhdGUgPSAoYXdhaXQgU3RhdGVVdGlsLnJldHJpZXZlRXh0ZXJuYWxTdGF0ZShjb250cm9sKSkgYXMgUmVjb3JkPHN0cmluZywgT2JqZWN0IHwgdW5kZWZpbmVkPjtcblx0XHRsZXQgaXNTZW1hbnRpY0RhdGVGaWx0ZXJBcHBsaWVkID0gZmFsc2U7XG5cdFx0bGV0IGlzQ29udHJvbExldmVsRmlsdGVyQXBwbGllZCA9IGZhbHNlO1xuXHRcdGlmIChmaWx0ZXJCYXIgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0aXNTZW1hbnRpY0RhdGVGaWx0ZXJBcHBsaWVkID0gKGZpbHRlckJhci5nZXRQYXJlbnQoKSBhcyBGaWx0ZXJCYXJBUEkpLmlzU2VtYW50aWNEYXRlRmlsdGVyQXBwbGllZCgpO1xuXHRcdH1cblxuXHRcdGlmIChjb250cm9sU3RhdGUuZmlsdGVyKSB7XG5cdFx0XHRjb25zdCBjb250cm9sTGV2ZWxGaWx0ZXJLZXlzID0gT2JqZWN0LmtleXMoY29udHJvbFN0YXRlLmZpbHRlcik7XG5cdFx0XHRmb3IgKGNvbnN0IGtleSBvZiBjb250cm9sTGV2ZWxGaWx0ZXJLZXlzKSB7XG5cdFx0XHRcdGNvbnN0IGNvbnRyb2xTdGF0ZUZpbHRlciA9IGNvbnRyb2xTdGF0ZS5maWx0ZXJba2V5IGFzIGtleW9mIE9iamVjdF07XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KGNvbnRyb2xTdGF0ZUZpbHRlcikgJiYgY29udHJvbFN0YXRlRmlsdGVyLmxlbmd0aCkge1xuXHRcdFx0XHRcdGlzQ29udHJvbExldmVsRmlsdGVyQXBwbGllZCA9IHRydWU7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoXG5cdFx0XHRpc0NvbnRyb2xMZXZlbEZpbHRlckFwcGxpZWQgfHxcblx0XHRcdGlzU2VtYW50aWNEYXRlRmlsdGVyQXBwbGllZCB8fFxuXHRcdFx0KGluc2lnaHRzUmVsZXZhbnRDb2x1bW5zID8gaW5zaWdodHNSZWxldmFudENvbHVtbnMubGVuZ3RoID09PSAwIDogZmFsc2UpXG5cdFx0KSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHRcdHJldHVybiB0cnVlO1xuXHR9IGNhdGNoIHtcblx0XHR0aHJvdyBFcnJvcihcIkVycm9yIHJldHJpZXZpbmcgY29udHJvbCBzdGF0ZXNcIik7XG5cdH1cbn1cblxuLyoqXG4gKiBGaWx0ZXJzIHRoZSBjb2x1bW5zIHRoYXQgY2FuIGJlIHNob3duIG9uIHRoZSBpbnNpZ2h0cyBjYXJkIGZyb20gdGhlIHZpc2libGUgY29sdW1ucyBvbiB0aGUgdGFibGUuXG4gKlxuICogQHBhcmFtIHRhYmxlQVBJXG4gKiBAcmV0dXJucyBBIGxpc3Qgb2YgY29sdW1ucyB0aGF0IGNhbiBiZSBzaG93biBvbiB0aGUgaW5zaWdodHNDYXJkLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0SW5zaWdodHNSZWxldmFudENvbHVtbnModGFibGVBUEk6IFRhYmxlQVBJKSB7XG5cdGNvbnN0IHRhYmxlID0gdGFibGVBUEkuY29udGVudCBhcyBUYWJsZTtcblx0Y29uc3QgdmlzaWJsZUNvbHVtbnMgPSB0YWJsZS5nZXRDb2x1bW5zKCk7XG5cdGNvbnN0IHN1cHBvcnRlZENvbHVtbk5hbWVzOiBzdHJpbmdbXSA9IFtdO1xuXHRjb25zdCBtZXRhTW9kZWw6IE1ldGFNb2RlbCB8IHVuZGVmaW5lZCA9IHRhYmxlLmdldE1vZGVsKCk/LmdldE1ldGFNb2RlbCgpO1xuXHRjb25zdCBtZXRhUGF0aCA9IHRhYmxlLmRhdGEoXCJtZXRhUGF0aFwiKSBhcyBzdHJpbmc7XG5cdHRhYmxlQVBJLmdldFRhYmxlRGVmaW5pdGlvbigpLmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0aWYgKGNvbHVtbi5pc0luc2lnaHRzU3VwcG9ydGVkID09PSB0cnVlKSB7XG5cdFx0XHRzdXBwb3J0ZWRDb2x1bW5OYW1lcy5wdXNoKGNvbHVtbi5uYW1lKTtcblx0XHR9XG5cdH0pO1xuXG5cdHJldHVybiB2aXNpYmxlQ29sdW1uc1xuXHRcdC5maWx0ZXIoZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdFx0cmV0dXJuIHN1cHBvcnRlZENvbHVtbk5hbWVzLmluY2x1ZGVzKGNvbHVtbi5nZXREYXRhUHJvcGVydHkoKSk7XG5cdFx0fSlcblx0XHQubWFwKGZ1bmN0aW9uIChzdXBwb3J0ZWRDb2x1bW4pIHtcblx0XHRcdGNvbnN0IGRhdGFQcm9wZXJ0eTogc3RyaW5nID0gc3VwcG9ydGVkQ29sdW1uLmdldERhdGFQcm9wZXJ0eSgpLFxuXHRcdFx0XHRwcm9wZXJ0eUNvbnRleHQgPSBtZXRhTW9kZWw/LmdldENvbnRleHQobWV0YVBhdGggKyBcIi9cIiArIGRhdGFQcm9wZXJ0eSkgYXMgQ29udGV4dCxcblx0XHRcdFx0ZGF0YU1vZGVsID0gZ2V0SW52b2x2ZWREYXRhTW9kZWxPYmplY3RzKHByb3BlcnR5Q29udGV4dCksXG5cdFx0XHRcdHByb3BlcnR5VGFyZ2V0T2JqZWN0ID0gZGF0YU1vZGVsLnRhcmdldE9iamVjdCBhcyBQcm9wZXJ0eSxcblx0XHRcdFx0dW9tQmluZGluZyA9IGdldFVvbUJpbmRpbmcocHJvcGVydHlUYXJnZXRPYmplY3QsIGRhdGFQcm9wZXJ0eSksXG5cdFx0XHRcdGNvbHVtblRleHQgPSB1b21CaW5kaW5nID8gdW9tQmluZGluZyA6IGdldFRleHRBcnJhbmdlbWVudEZvckNvbHVtbihwcm9wZXJ0eVRhcmdldE9iamVjdCwgZGF0YVByb3BlcnR5KTtcblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdHZpc2libGU6IGZhbHNlLFxuXHRcdFx0XHRuYW1lOiBjb2x1bW5UZXh0LFxuXHRcdFx0XHRsYWJlbDogc3VwcG9ydGVkQ29sdW1uLmdldFByb3BlcnR5KFwiaGVhZGVyXCIpIGFzIHN0cmluZ1xuXHRcdFx0fTtcblx0XHR9KTtcbn1cblxuLyoqXG4gKiBDb25zdHJ1Y3RzIHRoZSBpbnNpZ2h0cyBwYXJhbWV0ZXJzIGZyb20gdGhlIHRhYmxlIHRoYXQgaXMgcmVxdWlyZWQgdG8gY3JlYXRlIHRoZSBpbnNpZ2h0cyBjYXJkLlxuICpcbiAqIEBwYXJhbSBjb250cm9sQVBJXG4gKiBAcGFyYW0gY2FyZFR5cGVcbiAqIEBwYXJhbSBpbnNpZ2h0c1JlbGV2YW50Q29sdW1uc1xuICogQHJldHVybnMgVGhlIGluc2lnaHRzIHBhcmFtZXRlcnMgZnJvbSB0aGUgdGFibGUuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVJbnNpZ2h0c1BhcmFtcyhcblx0Y29udHJvbEFQSTogVGFibGVBUEkgfCBDaGFydEFQSSxcblx0Y2FyZFR5cGU6IEludGVncmF0aW9uQ2FyZFR5cGUsXG5cdGluc2lnaHRzUmVsZXZhbnRDb2x1bW5zPzogSW5zaWdodHNDYXJkQ29sdW1uc1R5cGVbXVxuKSB7XG5cdGxldCBjb250cm9sU3RhdGU7XG5cdGNvbnN0IGNvbnRyb2wgPSBjb250cm9sQVBJLmNvbnRlbnQ7XG5cdGNvbnN0IGZpbHRlcmJhcklEID0gKGNvbnRyb2wgYXMgVGFibGUpLmdldEZpbHRlcigpICE9PSBcIlwiID8gKGNvbnRyb2wgYXMgVGFibGUpLmdldEZpbHRlcigpIDogdW5kZWZpbmVkO1xuXHRjb25zdCBpc0NhcmRDcmVhdGlvblN1cHBvcnRlZCA9IGF3YWl0IGlzSW5zaWdodHNDYXJkQ3JlYXRpb25Qb3NzaWJsZShjb250cm9sIGFzIFRhYmxlLCBpbnNpZ2h0c1JlbGV2YW50Q29sdW1ucyk7XG5cdGlmICghaXNDYXJkQ3JlYXRpb25TdXBwb3J0ZWQpIHtcblx0XHRzaG93RXJyb3JNZXNzYWdlRm9ySW5zaWdodHNDYXJkKGNhcmRUeXBlLCBnZXRSZXNvdXJjZU1vZGVsKGNvbnRyb2xBUEkpKTtcblx0XHRyZXR1cm47XG5cdH1cblx0dHJ5IHtcblx0XHRjb250cm9sU3RhdGUgPSAoYXdhaXQgU3RhdGVVdGlsLnJldHJpZXZlRXh0ZXJuYWxTdGF0ZShjb250cm9sKSkgYXMgUmVjb3JkPHN0cmluZywgT2JqZWN0Pjtcblx0fSBjYXRjaCB7XG5cdFx0dGhyb3cgRXJyb3IoXCJFcnJvciByZXRyaWV2aW5nIGNvbnRyb2wgc3RhdGVzXCIpO1xuXHR9XG5cblx0Y29uc3QgZW50aXR5U2V0UGF0aCA9XG5cdFx0Y2FyZFR5cGUgPT09IEludGVncmF0aW9uQ2FyZFR5cGUudGFibGUgPyAoY29udHJvbC5kYXRhKFwibWV0YVBhdGhcIikgYXMgc3RyaW5nKSA6IChjb250cm9sLmRhdGEoXCJ0YXJnZXRDb2xsZWN0aW9uUGF0aFwiKSBhcyBzdHJpbmcpO1xuXHRjb25zdCBhcHBDb21wb25lbnQgPSBDb21tb25VdGlscy5nZXRBcHBDb21wb25lbnQoY29udHJvbCk7XG5cdGNvbnN0IGFwcE1hbmlmZXN0ID0gYXBwQ29tcG9uZW50LmdldE1hbmlmZXN0RW50cnkoXCJzYXAuYXBwXCIpO1xuXHRjb25zdCBzZXJ2aWNlVXJsID0gKGNvbnRyb2wuZ2V0TW9kZWwoKSBhcyBPRGF0YU1vZGVsKS5nZXRTZXJ2aWNlVXJsKCk7XG5cdGxldCBxdWVyeVVybCA9IFwiXCI7XG5cdGNvbnN0IGluc2lnaHRzUGFyYW1zOiBJbnNpZ2h0c1BhcmFtc1R5cGUgPSB7XG5cdFx0YXBwQ29tcG9uZW50OiBhcHBDb21wb25lbnQsXG5cdFx0dHlwZTogY2FyZFR5cGUsXG5cdFx0cmVxdWVzdFBhcmFtZXRlcnM6IHtcblx0XHRcdHNlcnZpY2VVcmw6IFwiXCIsXG5cdFx0XHRxdWVyeVVybDogXCJcIixcblx0XHRcdGdyb3VwQnk6IHVuZGVmaW5lZFxuXHRcdH0sXG5cdFx0Y29udGVudDoge1xuXHRcdFx0Y2FyZFRpdGxlOiBcIlwiLFxuXHRcdFx0aW5zaWdodHNSZWxldmFudENvbHVtbnM6IFtdXG5cdFx0fSxcblx0XHRwYXJlbnRBcHBJZDogYXBwTWFuaWZlc3QuaWQsXG5cdFx0cGFyYW1ldGVyczoge1xuXHRcdFx0ZmlsdGVyYmFySUQ6IGZpbHRlcmJhcklEXG5cdFx0fSxcblx0XHRlbnRpdHlTZXRQYXRoOiBlbnRpdHlTZXRQYXRoXG5cdH07XG5cblx0aWYgKGNhcmRUeXBlID09PSBJbnRlZ3JhdGlvbkNhcmRUeXBlLnRhYmxlKSB7XG5cdFx0aW5zaWdodHNQYXJhbXMuY29udGVudCA9IHtcblx0XHRcdGNhcmRUaXRsZTogKGNvbnRyb2wgYXMgVGFibGUpLmdldEhlYWRlcigpLFxuXHRcdFx0aW5zaWdodHNSZWxldmFudENvbHVtbnM6IGluc2lnaHRzUmVsZXZhbnRDb2x1bW5zID8/IFtdXG5cdFx0fTtcblx0XHRxdWVyeVVybCA9ICgoY29udHJvbCBhcyBUYWJsZSkuZ2V0Um93QmluZGluZygpIGFzIE9EYXRhTGlzdEJpbmRpbmcpLmdldERvd25sb2FkVXJsKCk7XG5cblx0XHRpbnNpZ2h0c1BhcmFtcy5jb250ZW50LmNhcmRUaXRsZSA9IChjb250cm9sIGFzIFRhYmxlKS5nZXRIZWFkZXIoKTtcblx0XHRpbnNpZ2h0c1BhcmFtcy5wYXJlbnRBcHBJZCA9IGFwcE1hbmlmZXN0LmlkO1xuXHRcdGNvbnN0IGdyb3VwUHJvcGVydHkgPVxuXHRcdFx0QXJyYXkuaXNBcnJheShjb250cm9sU3RhdGUuZ3JvdXBMZXZlbHMpICYmIGNvbnRyb2xTdGF0ZS5ncm91cExldmVscy5sZW5ndGhcblx0XHRcdFx0PyAoY29udHJvbFN0YXRlLmdyb3VwTGV2ZWxzWzBdIGFzIEdyb3VwTGV2ZWwpLm5hbWVcblx0XHRcdFx0OiB1bmRlZmluZWQ7XG5cdFx0aWYgKGdyb3VwUHJvcGVydHkgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29uc3QgZ3JvdXBQcm9wZXJ0eU5hbWUgPSBncm91cFByb3BlcnR5LmluY2x1ZGVzKFwiOjpcIikgPyBncm91cFByb3BlcnR5LnNwbGl0KFwiOjpcIilbMV0gOiBncm91cFByb3BlcnR5O1xuXHRcdFx0aW5zaWdodHNQYXJhbXMucmVxdWVzdFBhcmFtZXRlcnMuZ3JvdXBCeSA9IHtcblx0XHRcdFx0cHJvcGVydHk6IGdyb3VwUHJvcGVydHlOYW1lXG5cdFx0XHR9O1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHRjb25zdCBjaGFydCA9IGNvbnRyb2wgYXMgdW5rbm93biBhcyBDaGFydFR5cGU7XG5cdFx0Y29uc3QgaW5uZXJDaGFydDogSW5uZXJDaGFydFR5cGUgPSAoY2hhcnQuZ2V0Q29udHJvbERlbGVnYXRlKCkgYXMgQ29udHJvbERlbGVnYXRlKS5nZXRJbm5lckNoYXJ0KGNoYXJ0KSBhcyBJbm5lckNoYXJ0VHlwZTtcblxuXHRcdGNvbnN0IGNoYXJ0Q29udGVudDogQ2hhcnRDb250ZW50VHlwZSA9IHtcblx0XHRcdGNhcmRUaXRsZTogY2hhcnQuZ2V0SGVhZGVyKCkgYXMgc3RyaW5nLFxuXHRcdFx0bGVnZW5kVmlzaWJsZTogZmFsc2UsXG5cdFx0XHRjaGFydFR5cGU6IGNoYXJ0LmdldENoYXJ0VHlwZSgpLFxuXHRcdFx0bWVhc3VyZXM6IGdldE1lYXN1cmVzKGlubmVyQ2hhcnQpLFxuXHRcdFx0ZGltZW5zaW9uczogZ2V0RGltZW5zaW9ucyhpbm5lckNoYXJ0KSxcblx0XHRcdGZlZWRzOiBnZXRGZWVkcyhpbm5lckNoYXJ0KSxcblx0XHRcdGFsbG93ZWRDaGFydFR5cGVzOiAoaW5uZXJDaGFydC5nZXRBdmFpbGFibGVDaGFydFR5cGVzKCkgYXMgQWxsb3dlZENoYXJ0VHlwZSkuYXZhaWxhYmxlLFxuXHRcdFx0Y2hhcnRQcm9wZXJ0aWVzOiBnZXRDaGFydFByb3BlcnRpZXMoaW5uZXJDaGFydClcblx0XHR9O1xuXG5cdFx0aW5zaWdodHNQYXJhbXMuY29udGVudCA9IGNoYXJ0Q29udGVudDtcblxuXHRcdHF1ZXJ5VXJsID0gKGlubmVyQ2hhcnQuZ2V0QmluZGluZ0luZm8oXCJkYXRhXCIpIGFzIERhdGFCaW5kaW5nKS5iaW5kaW5nLmdldERvd25sb2FkVXJsKCk7XG5cdH1cblxuXHRpbnNpZ2h0c1BhcmFtcy5yZXF1ZXN0UGFyYW1ldGVycy5zZXJ2aWNlVXJsID0gc2VydmljZVVybDtcblx0aW5zaWdodHNQYXJhbXMucmVxdWVzdFBhcmFtZXRlcnMucXVlcnlVcmwgPSBxdWVyeVVybC5pbmNsdWRlcyhzZXJ2aWNlVXJsKSA/IHF1ZXJ5VXJsLnNwbGl0KHNlcnZpY2VVcmwpWzFdIDogcXVlcnlVcmw7XG5cblx0cmV0dXJuIGluc2lnaHRzUGFyYW1zO1xufVxuXG5mdW5jdGlvbiBnZXRUZXh0QXJyYW5nZW1lbnRGb3JDb2x1bW4ocHJvcGVydHlUYXJnZXRPYmplY3Q6IFByb3BlcnR5LCBwcm9wZXJ0eTogc3RyaW5nKSB7XG5cdGNvbnN0IHByb3BlcnR5UGFydHMgPSBwcm9wZXJ0eS5zcGxpdChcIi9cIik7XG5cdGxldCBuYXZpZ2F0aW9uUGF0aDtcblx0aWYgKHByb3BlcnR5UGFydHMubGVuZ3RoID4gMSkge1xuXHRcdHByb3BlcnR5UGFydHMucG9wKCk7XG5cdFx0bmF2aWdhdGlvblBhdGggPSBwcm9wZXJ0eVBhcnRzLmpvaW4oKTtcblx0fVxuXHRjb25zdCB0ZXh0ID0gcHJvcGVydHlUYXJnZXRPYmplY3QuYW5ub3RhdGlvbnMuQ29tbW9uPy5UZXh0O1xuXHRjb25zdCB0ZXh0QXJyYW5nZW1lbnQgPSB0ZXh0Py5hbm5vdGF0aW9ucz8uVUk/LlRleHRBcnJhbmdlbWVudD8udmFsdWVPZigpIGFzIHN0cmluZztcblxuXHRjb25zdCBwcm9wZXJ0eUJpbmRpbmcgPSBwYXRoSW5Nb2RlbChwcm9wZXJ0eSk7XG5cdGxldCBjb2x1bW5CaW5kaW5nVmFsdWU7XG5cdGlmICh0ZXh0KSB7XG5cdFx0Y29uc3QgdGV4dEJpbmRpbmcgPSBnZXRFeHByZXNzaW9uRnJvbUFubm90YXRpb24odGV4dCwgbmF2aWdhdGlvblBhdGggPyBbbmF2aWdhdGlvblBhdGhdIDogW10pIGFzIEJpbmRpbmdUb29sa2l0RXhwcmVzc2lvbjxzdHJpbmc+O1xuXHRcdGlmICh0ZXh0QXJyYW5nZW1lbnQgPT09IFwiVUkuVGV4dEFycmFuZ2VtZW50VHlwZS9UZXh0TGFzdFwiKSB7XG5cdFx0XHRjb2x1bW5CaW5kaW5nVmFsdWUgPSBjb25jYXQocHJvcGVydHlCaW5kaW5nLCBcIiAoXCIsIHRleHRCaW5kaW5nLCBcIilcIik7XG5cdFx0fSBlbHNlIGlmICh0ZXh0QXJyYW5nZW1lbnQgPT09IFwiVUkuVGV4dEFycmFuZ2VtZW50VHlwZS9UZXh0T25seVwiKSB7XG5cdFx0XHRjb2x1bW5CaW5kaW5nVmFsdWUgPSB0ZXh0QmluZGluZztcblx0XHR9IGVsc2UgaWYgKHRleHRBcnJhbmdlbWVudCA9PT0gXCJVSS5UZXh0QXJyYW5nZW1lbnRUeXBlL1RleHRTZXBhcmF0ZVwiKSB7XG5cdFx0XHRjb2x1bW5CaW5kaW5nVmFsdWUgPSBwcm9wZXJ0eUJpbmRpbmc7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbHVtbkJpbmRpbmdWYWx1ZSA9IGNvbmNhdCh0ZXh0QmluZGluZywgXCIgKFwiLCBwcm9wZXJ0eUJpbmRpbmcsIFwiKVwiKTtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0Y29sdW1uQmluZGluZ1ZhbHVlID0gcHJvcGVydHlCaW5kaW5nO1xuXHR9XG5cdHJldHVybiBjb21waWxlRXhwcmVzc2lvbihjb2x1bW5CaW5kaW5nVmFsdWUpO1xufVxuXG5mdW5jdGlvbiBnZXRVb21CaW5kaW5nKHByb3BlcnR5VGFyZ2V0T2JqZWN0OiBQcm9wZXJ0eSwgcHJvcGVydHk6IHN0cmluZykge1xuXHRjb25zdCB1b206IElTT0N1cnJlbmN5IHwgVW5pdCB8IHVuZGVmaW5lZCA9XG5cdFx0cHJvcGVydHlUYXJnZXRPYmplY3QuYW5ub3RhdGlvbnMuTWVhc3VyZXM/LklTT0N1cnJlbmN5IHx8IHByb3BlcnR5VGFyZ2V0T2JqZWN0LmFubm90YXRpb25zLk1lYXN1cmVzPy5Vbml0O1xuXHRpZiAoIXVvbSkge1xuXHRcdHJldHVybjtcblx0fSBlbHNlIHtcblx0XHRjb25zdCBwcm9wZXJ0eUJpbmRpbmcgPSBwYXRoSW5Nb2RlbChwcm9wZXJ0eSk7XG5cdFx0cmV0dXJuIGNvbXBpbGVFeHByZXNzaW9uKGNvbmNhdChwcm9wZXJ0eUJpbmRpbmcsIFwiIFwiLCBnZXRFeHByZXNzaW9uRnJvbUFubm90YXRpb24odW9tKSBhcyBCaW5kaW5nVG9vbGtpdEV4cHJlc3Npb248c3RyaW5nPikpO1xuXHR9XG59XG4iXSwibWFwcGluZ3MiOiI7QUFBQTtBQUFBO0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7O0VBbUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0EsZUFBZUEsOEJBQThCLENBQUNDLE9BQTBCLEVBQUVD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