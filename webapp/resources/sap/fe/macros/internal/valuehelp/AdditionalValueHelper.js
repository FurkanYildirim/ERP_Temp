/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/core/Core","sap/ui/model/Filter","sap/ui/model/FilterType","sap/ui/model/Sorter"],function(e,t,r,n){"use strict";var s={};var o;(function(e){e["recommendation"]="recommendation";e["recentValue"]="recentValue"})(o||(o={}));s.AdditionalValueGroupKey=o;const i={requestForAdditionalValueContextData:async function(e,t,r){const n=[...e].reverse();if(!t.isSuspended()){t.suspend()}if(r.parameters){t.changeParameters(r.parameters)}const s=r.parameters.$search;const o=this.getAdditionalValueFilters(n,[...this.getValueHelpBindingFilters(r)]);r.parameters.$search=s;const i=[this.getSorter()];const a=t.getModel().bindList(r.path,undefined,i,o,r.parameters);const l=await a.requestContexts();return l.map(e=>e.getObject())},getValueHelpBindingFilters:function(e){if(e.filters){if(Array.isArray(e.filters)){return e.filters}else{return[e.filters]}}return[]},resumeValueListBindingAndResetChanges:async function(e){if(e.isSuspended()){e.resume()}try{await e.resetChanges()}catch(e){}},sortAndFilterOthers:function(e,t,n){const s=this.createFiltersForOthersGroup(n,this.getValueHelpBindingFilters(t));e.filter([s],r.Application);e.sort(this.getSorter())},getAdditionalValueFilters:function(e,r){e.forEach(e=>{if(e.values.length>0){const n=e.values;const s=e.propertyPath;n.forEach(e=>{r.push(new t({path:s,value1:e,operator:"EQ"}))})}});return r},getSorter:function(){return new n("",false,this.getSorterFunction)},getSorterFunction:function(t){const r=e.getLibraryResourceBundle("sap.fe.macros");const n=t.getProperty("@$fe.additionalValueGroupKey");if(n===o.recommendation){return r.getText("M_ADDITIONALVALUEHELPER_RECOMMENDATIONS")}else if(n===o.recentValue){return r.getText("M_ADDITIONALVALUEHELPER_RECENTVALUE")}else{return r.getText("M_ADDITIONALVALUEHELPER_OTHERS")}},createAdditionalValueTransientContexts:function(e,t,r){if(e.length>0){t.forEach(t=>{const n=t.values;const s=t.propertyPath;const o=t.groupKey;this.sortAdditionalValueContextDataAndCreateContexts(e,n,s,r,o)})}},sortAdditionalValueContextDataAndCreateContexts:function(e,t,r,n,s){[...t].reverse().forEach(t=>{e.forEach(e=>{if(t===e[r]){e["@$fe.additionalValueGroupKey"]=s;n.create(e)}})})},removeDuplicateAdditionalValues:function(e,t){const r=[];t.forEach(e=>{const t=[...e.values];const n=e.propertyPath;const s=e.groupKey;r.push({values:t,propertyPath:n,groupKey:s})});e.forEach(e=>{let t=false;r.forEach(r=>{const n=r.values;const s=r.propertyPath;if(n.includes(e[s])){if(t){n.splice(n.indexOf(e[s]),1)}else{t=true}}})});return r},createFiltersForOthersGroup:function(e,r){const n=[];e.forEach(e=>{const r=e.values;const s=e.propertyPath;r.forEach(e=>{n.push(new t({path:s,value1:e,operator:"NE"}))})});const s=new t({filters:n,and:true});if(r.length>0){r.push(s);return new t({filters:r,and:true})}else{return s}},getRelevantRecommendations:function(e,t,r){const n=[];let s;if(Object.keys(e).length>0){r=this.getRecommendationPropertyPath(r);s=this.getAdditionalValueFromPropertyPath(r,e,t);if(Object.keys(s).length>0){s.additionalValues.forEach(e=>{n.push(e.value)});return n}else{return null}}},getAdditionalValueFromKeys:function(e,t){const r=t===null||t===void 0?void 0:t.getObject();let n={};if(t&&r){if(Array.isArray(e)){e.forEach(e=>{const t=e.keyProperties;let s=true;for(const e in t){if(t[e]!==r[e]){s=false;break}}if(s){n=e}})}}return n},getAdditionalValueFromPropertyPath:function(e,t,r){let n=Object.assign(t,{});if(Object.keys(t).includes(e)){return t[e]}else{while(Object.keys(n).length>0&&!Object.keys(n).includes(e)){const s=e.split("/");if(s.length>1){const o=s[0];s.splice(0,1);e=s.join("/");t=this.getAdditionalValueFromPropertyPath(o,t,r);t=this.getAdditionalValueFromKeys(t,r);if(Object.keys(t).length>0){n=Object.assign(t,{});t=this.getAdditionalValueFromPropertyPath(e,t,r)}else{return{}}}else{return{}}}return t}},getRecommendationPropertyPath:function(e){const t=e.split("/");t.splice(0,2);return t.join("/")},doesTransientContextsAlreadyExist:function(e,t){const r=e.getAllCurrentContexts();let n=false;t.forEach(e=>{const t=e.values;const s=e.propertyPath;r.forEach(e=>{const r=e.getObject();const o=e.isTransient();if(t.includes(r[s])&&o===true){n=true;return}})});return n}};s.additionalValueHelper=i;return s},false);
//# sourceMappingURL=AdditionalValueHelper.js.map