/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log", "sap/fe/core/ActionRuntime", "sap/fe/core/CommonUtils", "sap/fe/core/controllerextensions/BusyLocker", "sap/fe/core/helpers/DeleteHelper", "sap/fe/core/library", "sap/fe/macros/field/FieldRuntime", "sap/fe/macros/table/TableHelper", "sap/fe/macros/table/Utils"], function (Log, ActionRuntime, CommonUtils, BusyLocker, deleteHelper, FELibrary, FieldRuntime, TableHelper, TableUtils) {
  "use strict";

  const CreationMode = FELibrary.CreationMode;
  /**
   * Static class used by Table building block during runtime
   *
   * @private
   * @experimental This module is only for internal/experimental use!
   */
  const TableRuntime = {
    displayTableSettings: function (oEvent) {
      /*
      		 Temporary solution
      		 Wait for mdc Table to provide public api to either get button 'Settings' or fire event on this button
      		 */
      const oParent = oEvent.getSource().getParent(),
        oSettingsButton = sap.ui.getCore().byId(`${oParent.getId()}-settings`);
      CommonUtils.fireButtonPress(oSettingsButton);
    },
    executeConditionalActionShortcut: function (sButtonMatcher, oSource) {
      // Get the button related to keyboard shortcut
      const oMdcTable = oSource.getParent();
      if (sButtonMatcher !== CreationMode.CreationRow) {
        const oButton = oMdcTable.getActions().reduce(function (aActionButtons, oActionToolbarAction) {
          return aActionButtons.concat(oActionToolbarAction.getAction());
        }, []).find(function (oActionButton) {
          return oActionButton.getId().endsWith(sButtonMatcher);
        });
        CommonUtils.fireButtonPress(oButton);
      } else {
        const oCreationRow = oMdcTable.getAggregation("creationRow");
        if (oCreationRow && oCreationRow.getApplyEnabled() && oCreationRow.getVisible()) {
          oCreationRow.fireApply();
        }
      }
    },
    setContexts: function (oTable, sDeletablePath, draft, sCollection, sNavigationAvailableMap, sActionsMultiselectDisabled, sUpdatablePath) {
      BusyLocker.lock(oTable);
      return TableRuntime.setContextsAsync(oTable, sDeletablePath, draft, sCollection, sNavigationAvailableMap, sActionsMultiselectDisabled, sUpdatablePath).then(() => {
        Log.info("Selections updated");
      }).catch(error => {
        Log.error(error);
      }).finally(() => {
        BusyLocker.unlock(oTable);
      });
    },
    setContextsAsync: async function (oTable, sDeletablePath, draft, sCollection, sNavigationAvailableMap, sActionsMultiselectDisabled, sUpdatablePath) {
      const aActionsMultiselectDisabled = sActionsMultiselectDisabled ? sActionsMultiselectDisabled.split(",") : [];
      const oActionOperationAvailableMap = JSON.parse(sCollection);
      const oNavigationAvailableMap = sNavigationAvailableMap && sNavigationAvailableMap !== "undefined" && JSON.parse(sNavigationAvailableMap);
      let aSelectedContexts = oTable.getSelectedContexts();
      const aDeletableContexts = [];
      const bReadOnlyDraftEnabled = oTable.data("displayModePropertyBinding") === "true" && draft !== "undefined";
      const aUpdatableContexts = [];
      // oDynamicActions are bound actions that are available according to some property
      // in each item
      const oDynamicActions = {};
      const oIBN = {};
      const oInternalModelContext = oTable.getBindingContext("internal");
      if (!oInternalModelContext) {
        return;
      }
      //do not consider empty rows as selected context
      aSelectedContexts = aSelectedContexts.filter(function (oContext) {
        return !oContext.isInactive();
      });
      const oModelObject = Object.assign(oInternalModelContext.getObject() || {}, {
        selectedContexts: aSelectedContexts,
        numberOfSelectedContexts: aSelectedContexts.length,
        dynamicActions: oDynamicActions,
        ibn: oIBN,
        deleteEnabled: true,
        deletableContexts: aDeletableContexts,
        unSavedContexts: [],
        lockedContexts: [],
        draftsWithNonDeletableActive: [],
        draftsWithDeletableActive: [],
        controlId: "",
        updatableContexts: aUpdatableContexts,
        semanticKeyHasDraftIndicator: oInternalModelContext.getProperty("semanticKeyHasDraftIndicator") ? oInternalModelContext.getProperty("semanticKeyHasDraftIndicator") : undefined
      });
      for (const oSelectedContext of aSelectedContexts) {
        const oContextData = oSelectedContext.getObject();
        for (const key in oContextData) {
          if (key.indexOf("#") === 0) {
            let sActionPath = key;
            sActionPath = sActionPath.substring(1, sActionPath.length);
            oModelObject.dynamicActions[sActionPath] = {
              enabled: true
            };
            oInternalModelContext.setProperty("", oModelObject);
          }
        }
        // The updatable contexts with mass edit depend on the following:
        // 1. Update is dependendent on current entity property (sUpdatablePath).
        // 2. The table is read only and draft enabled(like LR), in this case only active contexts can be mass edited(not draft contexts).
        //    So, update depends on 'IsActiveEntity' value which needs to be checked.
        const bUpdatableByPath = sUpdatablePath.length === 0 || !!oSelectedContext.getProperty(sUpdatablePath);
        const bNotDraftInReadOnlyMode = !bReadOnlyDraftEnabled || oContextData.IsActiveEntity;
        if (bUpdatableByPath && bNotDraftInReadOnlyMode) {
          aUpdatableContexts.push(oSelectedContext);
        }
      }
      deleteHelper.updateDeleteInfoForSelectedContexts(oInternalModelContext, aSelectedContexts);
      if (!oTable.data("enableAnalytics")) {
        TableHelper.setIBNEnablement(oInternalModelContext, oNavigationAvailableMap, aSelectedContexts);
      }
      if (aSelectedContexts.length > 1) {
        this.disableAction(aActionsMultiselectDisabled, oDynamicActions);
      }
      if (oModelObject) {
        oModelObject["updatableContexts"] = aUpdatableContexts;
        oModelObject["controlId"] = oTable.getId();
        oInternalModelContext.setProperty("", oModelObject);
      }
      return ActionRuntime.setActionEnablement(oInternalModelContext, oActionOperationAvailableMap, aSelectedContexts, "table");
    },
    disableAction: function (aActionsMultiselectDisabled, oDynamicActions) {
      aActionsMultiselectDisabled.forEach(function (sAction) {
        oDynamicActions[sAction] = {
          bEnabled: false
        };
      });
    },
    onFieldChangeInCreationRow: function (oEvent, oCustomValidationFunction) {
      // CREATION ROW CASE
      const mField = FieldRuntime.getFieldStateOnChange(oEvent),
        oSourceField = mField.field,
        sFieldId = oSourceField.getId();
      const oInternalModelContext = oSourceField.getBindingContext("internal"),
        mFieldValidity = oInternalModelContext.getProperty("creationRowFieldValidity"),
        mNewFieldValidity = Object.assign({}, mFieldValidity);
      mNewFieldValidity[sFieldId] = mField.state;
      oInternalModelContext.setProperty("creationRowFieldValidity", mNewFieldValidity);

      // prepare Custom Validation
      if (oCustomValidationFunction) {
        const mCustomValidity = oInternalModelContext.getProperty("creationRowCustomValidity"),
          mNewCustomValidity = Object.assign({}, mCustomValidity);
        mNewCustomValidity[oSourceField.getBinding("value").getPath()] = {
          fieldId: oSourceField.getId()
        };
        oInternalModelContext.setProperty("creationRowCustomValidity", mNewCustomValidity);
        // Remove existing CustomValidation message
        const oMessageManager = sap.ui.getCore().getMessageManager();
        const sTarget = `${oSourceField.getBindingContext().getPath()}/${oSourceField.getBindingPath("value")}`;
        oMessageManager.getMessageModel().getData().forEach(function (oMessage) {
          if (oMessage.target === sTarget) {
            oMessageManager.removeMessages(oMessage);
          }
        });
      }
    },
    onTreeTableContextChanged: function (table, initialExpansionLevel) {
      // When the context of a TreeTable changes, we want to restore its expansion state to the default:
      //   - all expanded if there's a search parameter coming from the filterBar
      //   - otherwise initial expansion state coming from the PV (stored in the payload)
      //   - otherwise no expansion at all

      const rowBinding = table.getRowBinding();
      if (!rowBinding.getContext()) {
        return;
      }
      const aggregation = rowBinding.getAggregation() ?? {};
      const filterInfo = TableUtils.getAllFilterInfo(table);
      aggregation.expandTo = filterInfo.search ? 100 : initialExpansionLevel;
      rowBinding.setAggregation(aggregation);
    }
  };
  return TableRuntime;
}, false);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJDcmVhdGlvbk1vZGUiLCJGRUxpYnJhcnkiLCJUYWJsZVJ1bnRpbWUiLCJkaXNwbGF5VGFibGVTZXR0aW5ncyIsIm9FdmVudCIsIm9QYXJlbnQiLCJnZXRTb3VyY2UiLCJnZXRQYXJlbnQiLCJvU2V0dGluZ3NCdXR0b24iLCJzYXAiLCJ1aSIsImdldENvcmUiLCJieUlkIiwiZ2V0SWQiLCJDb21tb25VdGlscyIsImZpcmVCdXR0b25QcmVzcyIsImV4ZWN1dGVDb25kaXRpb25hbEFjdGlvblNob3J0Y3V0Iiwic0J1dHRvbk1hdGNoZXIiLCJvU291cmNlIiwib01kY1RhYmxlIiwiQ3JlYXRpb25Sb3ciLCJvQnV0dG9uIiwiZ2V0QWN0aW9ucyIsInJlZHVjZSIsImFBY3Rpb25CdXR0b25zIiwib0FjdGlvblRvb2xiYXJBY3Rpb24iLCJjb25jYXQiLCJnZXRBY3Rpb24iLCJmaW5kIiwib0FjdGlvbkJ1dHRvbiIsImVuZHNXaXRoIiwib0NyZWF0aW9uUm93IiwiZ2V0QWdncmVnYXRpb24iLCJnZXRBcHBseUVuYWJsZWQiLCJnZXRWaXNpYmxlIiwiZmlyZUFwcGx5Iiwic2V0Q29udGV4dHMiLCJvVGFibGUiLCJzRGVsZXRhYmxlUGF0aCIsImRyYWZ0Iiwic0NvbGxlY3Rpb24iLCJzTmF2aWdhdGlvbkF2YWlsYWJsZU1hcCIsInNBY3Rpb25zTXVsdGlzZWxlY3REaXNhYmxlZCIsInNVcGRhdGFibGVQYXRoIiwiQnVzeUxvY2tlciIsImxvY2siLCJzZXRDb250ZXh0c0FzeW5jIiwidGhlbiIsIkxvZyIsImluZm8iLCJjYXRjaCIsImVycm9yIiwiZmluYWxseSIsInVubG9jayIsImFBY3Rpb25zTXVsdGlzZWxlY3REaXNhYmxlZCIsInNwbGl0Iiwib0FjdGlvbk9wZXJhdGlvbkF2YWlsYWJsZU1hcCIsIkpTT04iLCJwYXJzZSIsIm9OYXZpZ2F0aW9uQXZhaWxhYmxlTWFwIiwiYVNlbGVjdGVkQ29udGV4dHMiLCJnZXRTZWxlY3RlZENvbnRleHRzIiwiYURlbGV0YWJsZUNvbnRleHRzIiwiYlJlYWRPbmx5RHJhZnRFbmFibGVkIiwiZGF0YSIsImFVcGRhdGFibGVDb250ZXh0cyIsIm9EeW5hbWljQWN0aW9ucyIsIm9JQk4iLCJvSW50ZXJuYWxNb2RlbENvbnRleHQiLCJnZXRCaW5kaW5nQ29udGV4dCIsImZpbHRlciIsIm9Db250ZXh0IiwiaXNJbmFjdGl2ZSIsIm9Nb2RlbE9iamVjdCIsIk9iamVjdCIsImFzc2lnbiIsImdldE9iamVjdCIsInNlbGVjdGVkQ29udGV4dHMiLCJudW1iZXJPZlNlbGVjdGVkQ29udGV4dHMiLCJsZW5ndGgiLCJkeW5hbWljQWN0aW9ucyIsImlibiIsImRlbGV0ZUVuYWJsZWQiLCJkZWxldGFibGVDb250ZXh0cyIsInVuU2F2ZWRDb250ZXh0cyIsImxvY2tlZENvbnRleHRzIiwiZHJhZnRzV2l0aE5vbkRlbGV0YWJsZUFjdGl2ZSIsImRyYWZ0c1dpdGhEZWxldGFibGVBY3RpdmUiLCJjb250cm9sSWQiLCJ1cGRhdGFibGVDb250ZXh0cyIsInNlbWFudGljS2V5SGFzRHJhZnRJbmRpY2F0b3IiLCJnZXRQcm9wZXJ0eSIsInVuZGVmaW5lZCIsIm9TZWxlY3RlZENvbnRleHQiLCJvQ29udGV4dERhdGEiLCJrZXkiLCJpbmRleE9mIiwic0FjdGlvblBhdGgiLCJzdWJzdHJpbmciLCJlbmFibGVkIiwic2V0UHJvcGVydHkiLCJiVXBkYXRhYmxlQnlQYXRoIiwiYk5vdERyYWZ0SW5SZWFkT25seU1vZGUiLCJJc0FjdGl2ZUVudGl0eSIsInB1c2giLCJkZWxldGVIZWxwZXIiLCJ1cGRhdGVEZWxldGVJbmZvRm9yU2VsZWN0ZWRDb250ZXh0cyIsIlRhYmxlSGVscGVyIiwic2V0SUJORW5hYmxlbWVudCIsImRpc2FibGVBY3Rpb24iLCJBY3Rpb25SdW50aW1lIiwic2V0QWN0aW9uRW5hYmxlbWVudCIsImZvckVhY2giLCJzQWN0aW9uIiwiYkVuYWJsZWQiLCJvbkZpZWxkQ2hhbmdlSW5DcmVhdGlvblJvdyIsIm9DdXN0b21WYWxpZGF0aW9uRnVuY3Rpb24iLCJtRmllbGQiLCJGaWVsZFJ1bnRpbWUiLCJnZXRGaWVsZFN0YXRlT25DaGFuZ2UiLCJvU291cmNlRmllbGQiLCJmaWVsZCIsInNGaWVsZElkIiwibUZpZWxkVmFsaWRpdHkiLCJtTmV3RmllbGRWYWxpZGl0eSIsInN0YXRlIiwibUN1c3RvbVZhbGlkaXR5IiwibU5ld0N1c3RvbVZhbGlkaXR5IiwiZ2V0QmluZGluZyIsImdldFBhdGgiLCJmaWVsZElkIiwib01lc3NhZ2VNYW5hZ2VyIiwiZ2V0TWVzc2FnZU1hbmFnZXIiLCJzVGFyZ2V0IiwiZ2V0QmluZGluZ1BhdGgiLCJnZXRNZXNzYWdlTW9kZWwiLCJnZXREYXRhIiwib01lc3NhZ2UiLCJ0YXJnZXQiLCJyZW1vdmVNZXNzYWdlcyIsIm9uVHJlZVRhYmxlQ29udGV4dENoYW5nZWQiLCJ0YWJsZSIsImluaXRpYWxFeHBhbnNpb25MZXZlbCIsInJvd0JpbmRpbmciLCJnZXRSb3dCaW5kaW5nIiwiZ2V0Q29udGV4dCIsImFnZ3JlZ2F0aW9uIiwiZmlsdGVySW5mbyIsIlRhYmxlVXRpbHMiLCJnZXRBbGxGaWx0ZXJJbmZvIiwiZXhwYW5kVG8iLCJzZWFyY2giLCJzZXRBZ2dyZWdhdGlvbiJdLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiVGFibGVSdW50aW1lLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBMb2cgZnJvbSBcInNhcC9iYXNlL0xvZ1wiO1xuaW1wb3J0IEFjdGlvblJ1bnRpbWUgZnJvbSBcInNhcC9mZS9jb3JlL0FjdGlvblJ1bnRpbWVcIjtcbmltcG9ydCBDb21tb25VdGlscyBmcm9tIFwic2FwL2ZlL2NvcmUvQ29tbW9uVXRpbHNcIjtcbmltcG9ydCBCdXN5TG9ja2VyIGZyb20gXCJzYXAvZmUvY29yZS9jb250cm9sbGVyZXh0ZW5zaW9ucy9CdXN5TG9ja2VyXCI7XG5pbXBvcnQgZGVsZXRlSGVscGVyIGZyb20gXCJzYXAvZmUvY29yZS9oZWxwZXJzL0RlbGV0ZUhlbHBlclwiO1xuaW1wb3J0IHR5cGUgeyBJbnRlcm5hbE1vZGVsQ29udGV4dCB9IGZyb20gXCJzYXAvZmUvY29yZS9oZWxwZXJzL01vZGVsSGVscGVyXCI7XG5pbXBvcnQgRkVMaWJyYXJ5IGZyb20gXCJzYXAvZmUvY29yZS9saWJyYXJ5XCI7XG5pbXBvcnQgRmllbGRSdW50aW1lIGZyb20gXCJzYXAvZmUvbWFjcm9zL2ZpZWxkL0ZpZWxkUnVudGltZVwiO1xuaW1wb3J0IFRhYmxlSGVscGVyIGZyb20gXCJzYXAvZmUvbWFjcm9zL3RhYmxlL1RhYmxlSGVscGVyXCI7XG5pbXBvcnQgVGFibGVVdGlscyBmcm9tIFwic2FwL2ZlL21hY3Jvcy90YWJsZS9VdGlsc1wiO1xuaW1wb3J0IEJ1dHRvbiBmcm9tIFwic2FwL20vQnV0dG9uXCI7XG5pbXBvcnQgdHlwZSBUYWJsZSBmcm9tIFwic2FwL3VpL21kYy9UYWJsZVwiO1xuaW1wb3J0IENvbnRleHQgZnJvbSBcInNhcC91aS9tb2RlbC9vZGF0YS92NC9Db250ZXh0XCI7XG5pbXBvcnQgdHlwZSBPRGF0YUxpc3RCaW5kaW5nIGZyb20gXCJzYXAvdWkvbW9kZWwvb2RhdGEvdjQvT0RhdGFMaXN0QmluZGluZ1wiO1xuXG5jb25zdCBDcmVhdGlvbk1vZGUgPSBGRUxpYnJhcnkuQ3JlYXRpb25Nb2RlO1xuLyoqXG4gKiBTdGF0aWMgY2xhc3MgdXNlZCBieSBUYWJsZSBidWlsZGluZyBibG9jayBkdXJpbmcgcnVudGltZVxuICpcbiAqIEBwcml2YXRlXG4gKiBAZXhwZXJpbWVudGFsIFRoaXMgbW9kdWxlIGlzIG9ubHkgZm9yIGludGVybmFsL2V4cGVyaW1lbnRhbCB1c2UhXG4gKi9cbmNvbnN0IFRhYmxlUnVudGltZSA9IHtcblx0ZGlzcGxheVRhYmxlU2V0dGluZ3M6IGZ1bmN0aW9uIChvRXZlbnQ6IGFueSkge1xuXHRcdC8qXG5cdFx0XHRcdCBUZW1wb3Jhcnkgc29sdXRpb25cblx0XHRcdFx0IFdhaXQgZm9yIG1kYyBUYWJsZSB0byBwcm92aWRlIHB1YmxpYyBhcGkgdG8gZWl0aGVyIGdldCBidXR0b24gJ1NldHRpbmdzJyBvciBmaXJlIGV2ZW50IG9uIHRoaXMgYnV0dG9uXG5cdFx0XHRcdCAqL1xuXHRcdGNvbnN0IG9QYXJlbnQgPSBvRXZlbnQuZ2V0U291cmNlKCkuZ2V0UGFyZW50KCksXG5cdFx0XHRvU2V0dGluZ3NCdXR0b24gPSBzYXAudWkuZ2V0Q29yZSgpLmJ5SWQoYCR7b1BhcmVudC5nZXRJZCgpfS1zZXR0aW5nc2ApO1xuXHRcdENvbW1vblV0aWxzLmZpcmVCdXR0b25QcmVzcyhvU2V0dGluZ3NCdXR0b24gYXMgQnV0dG9uKTtcblx0fSxcblx0ZXhlY3V0ZUNvbmRpdGlvbmFsQWN0aW9uU2hvcnRjdXQ6IGZ1bmN0aW9uIChzQnV0dG9uTWF0Y2hlcjogYW55LCBvU291cmNlOiBhbnkpIHtcblx0XHQvLyBHZXQgdGhlIGJ1dHRvbiByZWxhdGVkIHRvIGtleWJvYXJkIHNob3J0Y3V0XG5cdFx0Y29uc3Qgb01kY1RhYmxlID0gb1NvdXJjZS5nZXRQYXJlbnQoKTtcblx0XHRpZiAoc0J1dHRvbk1hdGNoZXIgIT09IENyZWF0aW9uTW9kZS5DcmVhdGlvblJvdykge1xuXHRcdFx0Y29uc3Qgb0J1dHRvbiA9IG9NZGNUYWJsZVxuXHRcdFx0XHQuZ2V0QWN0aW9ucygpXG5cdFx0XHRcdC5yZWR1Y2UoZnVuY3Rpb24gKGFBY3Rpb25CdXR0b25zOiBhbnksIG9BY3Rpb25Ub29sYmFyQWN0aW9uOiBhbnkpIHtcblx0XHRcdFx0XHRyZXR1cm4gYUFjdGlvbkJ1dHRvbnMuY29uY2F0KG9BY3Rpb25Ub29sYmFyQWN0aW9uLmdldEFjdGlvbigpKTtcblx0XHRcdFx0fSwgW10pXG5cdFx0XHRcdC5maW5kKGZ1bmN0aW9uIChvQWN0aW9uQnV0dG9uOiBhbnkpIHtcblx0XHRcdFx0XHRyZXR1cm4gb0FjdGlvbkJ1dHRvbi5nZXRJZCgpLmVuZHNXaXRoKHNCdXR0b25NYXRjaGVyKTtcblx0XHRcdFx0fSk7XG5cdFx0XHRDb21tb25VdGlscy5maXJlQnV0dG9uUHJlc3Mob0J1dHRvbik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnN0IG9DcmVhdGlvblJvdyA9IG9NZGNUYWJsZS5nZXRBZ2dyZWdhdGlvbihcImNyZWF0aW9uUm93XCIpO1xuXHRcdFx0aWYgKG9DcmVhdGlvblJvdyAmJiBvQ3JlYXRpb25Sb3cuZ2V0QXBwbHlFbmFibGVkKCkgJiYgb0NyZWF0aW9uUm93LmdldFZpc2libGUoKSkge1xuXHRcdFx0XHRvQ3JlYXRpb25Sb3cuZmlyZUFwcGx5KCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9LFxuXG5cdHNldENvbnRleHRzOiBmdW5jdGlvbiAoXG5cdFx0b1RhYmxlOiBUYWJsZSxcblx0XHRzRGVsZXRhYmxlUGF0aDogc3RyaW5nLFxuXHRcdGRyYWZ0OiBzdHJpbmcsXG5cdFx0c0NvbGxlY3Rpb246IHN0cmluZyxcblx0XHRzTmF2aWdhdGlvbkF2YWlsYWJsZU1hcDogc3RyaW5nLFxuXHRcdHNBY3Rpb25zTXVsdGlzZWxlY3REaXNhYmxlZDogc3RyaW5nLFxuXHRcdHNVcGRhdGFibGVQYXRoOiBzdHJpbmdcblx0KSB7XG5cdFx0QnVzeUxvY2tlci5sb2NrKG9UYWJsZSk7XG5cdFx0cmV0dXJuIFRhYmxlUnVudGltZS5zZXRDb250ZXh0c0FzeW5jKFxuXHRcdFx0b1RhYmxlLFxuXHRcdFx0c0RlbGV0YWJsZVBhdGgsXG5cdFx0XHRkcmFmdCxcblx0XHRcdHNDb2xsZWN0aW9uLFxuXHRcdFx0c05hdmlnYXRpb25BdmFpbGFibGVNYXAsXG5cdFx0XHRzQWN0aW9uc011bHRpc2VsZWN0RGlzYWJsZWQsXG5cdFx0XHRzVXBkYXRhYmxlUGF0aFxuXHRcdClcblx0XHRcdC50aGVuKCgpID0+IHtcblx0XHRcdFx0TG9nLmluZm8oXCJTZWxlY3Rpb25zIHVwZGF0ZWRcIik7XG5cdFx0XHR9KVxuXHRcdFx0LmNhdGNoKChlcnJvcikgPT4ge1xuXHRcdFx0XHRMb2cuZXJyb3IoZXJyb3IpO1xuXHRcdFx0fSlcblx0XHRcdC5maW5hbGx5KCgpID0+IHtcblx0XHRcdFx0QnVzeUxvY2tlci51bmxvY2sob1RhYmxlKTtcblx0XHRcdH0pO1xuXHR9LFxuXG5cdHNldENvbnRleHRzQXN5bmM6IGFzeW5jIGZ1bmN0aW9uIChcblx0XHRvVGFibGU6IFRhYmxlLFxuXHRcdHNEZWxldGFibGVQYXRoOiBzdHJpbmcsXG5cdFx0ZHJhZnQ6IHN0cmluZyxcblx0XHRzQ29sbGVjdGlvbjogc3RyaW5nLFxuXHRcdHNOYXZpZ2F0aW9uQXZhaWxhYmxlTWFwOiBzdHJpbmcsXG5cdFx0c0FjdGlvbnNNdWx0aXNlbGVjdERpc2FibGVkOiBzdHJpbmcsXG5cdFx0c1VwZGF0YWJsZVBhdGg6IHN0cmluZ1xuXHQpOiBQcm9taXNlPHZvaWRbXSB8IHVuZGVmaW5lZD4ge1xuXHRcdGNvbnN0IGFBY3Rpb25zTXVsdGlzZWxlY3REaXNhYmxlZCA9IHNBY3Rpb25zTXVsdGlzZWxlY3REaXNhYmxlZCA/IHNBY3Rpb25zTXVsdGlzZWxlY3REaXNhYmxlZC5zcGxpdChcIixcIikgOiBbXTtcblx0XHRjb25zdCBvQWN0aW9uT3BlcmF0aW9uQXZhaWxhYmxlTWFwID0gSlNPTi5wYXJzZShzQ29sbGVjdGlvbik7XG5cdFx0Y29uc3Qgb05hdmlnYXRpb25BdmFpbGFibGVNYXAgPVxuXHRcdFx0c05hdmlnYXRpb25BdmFpbGFibGVNYXAgJiYgc05hdmlnYXRpb25BdmFpbGFibGVNYXAgIT09IFwidW5kZWZpbmVkXCIgJiYgSlNPTi5wYXJzZShzTmF2aWdhdGlvbkF2YWlsYWJsZU1hcCk7XG5cdFx0bGV0IGFTZWxlY3RlZENvbnRleHRzID0gb1RhYmxlLmdldFNlbGVjdGVkQ29udGV4dHMoKSBhcyBDb250ZXh0W107XG5cdFx0Y29uc3QgYURlbGV0YWJsZUNvbnRleHRzOiBDb250ZXh0W10gPSBbXTtcblx0XHRjb25zdCBiUmVhZE9ubHlEcmFmdEVuYWJsZWQgPSBvVGFibGUuZGF0YShcImRpc3BsYXlNb2RlUHJvcGVydHlCaW5kaW5nXCIpID09PSBcInRydWVcIiAmJiBkcmFmdCAhPT0gXCJ1bmRlZmluZWRcIjtcblx0XHRjb25zdCBhVXBkYXRhYmxlQ29udGV4dHM6IENvbnRleHRbXSA9IFtdO1xuXHRcdC8vIG9EeW5hbWljQWN0aW9ucyBhcmUgYm91bmQgYWN0aW9ucyB0aGF0IGFyZSBhdmFpbGFibGUgYWNjb3JkaW5nIHRvIHNvbWUgcHJvcGVydHlcblx0XHQvLyBpbiBlYWNoIGl0ZW1cblx0XHRjb25zdCBvRHluYW1pY0FjdGlvbnM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+IHwgdW5kZWZpbmVkID0ge307XG5cdFx0Y29uc3Qgb0lCTiA9IHt9O1xuXHRcdGNvbnN0IG9JbnRlcm5hbE1vZGVsQ29udGV4dCA9IG9UYWJsZS5nZXRCaW5kaW5nQ29udGV4dChcImludGVybmFsXCIpIGFzIEludGVybmFsTW9kZWxDb250ZXh0O1xuXG5cdFx0aWYgKCFvSW50ZXJuYWxNb2RlbENvbnRleHQpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0Ly9kbyBub3QgY29uc2lkZXIgZW1wdHkgcm93cyBhcyBzZWxlY3RlZCBjb250ZXh0XG5cdFx0YVNlbGVjdGVkQ29udGV4dHMgPSBhU2VsZWN0ZWRDb250ZXh0cy5maWx0ZXIoZnVuY3Rpb24gKG9Db250ZXh0OiBDb250ZXh0KSB7XG5cdFx0XHRyZXR1cm4gIW9Db250ZXh0LmlzSW5hY3RpdmUoKTtcblx0XHR9KTtcblxuXHRcdGNvbnN0IG9Nb2RlbE9iamVjdCA9IE9iamVjdC5hc3NpZ24ob0ludGVybmFsTW9kZWxDb250ZXh0LmdldE9iamVjdCgpIHx8IHt9LCB7XG5cdFx0XHRzZWxlY3RlZENvbnRleHRzOiBhU2VsZWN0ZWRDb250ZXh0cyxcblx0XHRcdG51bWJlck9mU2VsZWN0ZWRDb250ZXh0czogYVNlbGVjdGVkQ29udGV4dHMubGVuZ3RoLFxuXHRcdFx0ZHluYW1pY0FjdGlvbnM6IG9EeW5hbWljQWN0aW9ucyxcblx0XHRcdGlibjogb0lCTixcblx0XHRcdGRlbGV0ZUVuYWJsZWQ6IHRydWUsXG5cdFx0XHRkZWxldGFibGVDb250ZXh0czogYURlbGV0YWJsZUNvbnRleHRzLFxuXHRcdFx0dW5TYXZlZENvbnRleHRzOiBbXSxcblx0XHRcdGxvY2tlZENvbnRleHRzOiBbXSxcblx0XHRcdGRyYWZ0c1dpdGhOb25EZWxldGFibGVBY3RpdmU6IFtdLFxuXHRcdFx0ZHJhZnRzV2l0aERlbGV0YWJsZUFjdGl2ZTogW10sXG5cdFx0XHRjb250cm9sSWQ6IFwiXCIsXG5cdFx0XHR1cGRhdGFibGVDb250ZXh0czogYVVwZGF0YWJsZUNvbnRleHRzLFxuXHRcdFx0c2VtYW50aWNLZXlIYXNEcmFmdEluZGljYXRvcjogb0ludGVybmFsTW9kZWxDb250ZXh0LmdldFByb3BlcnR5KFwic2VtYW50aWNLZXlIYXNEcmFmdEluZGljYXRvclwiKVxuXHRcdFx0XHQ/IG9JbnRlcm5hbE1vZGVsQ29udGV4dC5nZXRQcm9wZXJ0eShcInNlbWFudGljS2V5SGFzRHJhZnRJbmRpY2F0b3JcIilcblx0XHRcdFx0OiB1bmRlZmluZWRcblx0XHR9KTtcblxuXHRcdGZvciAoY29uc3Qgb1NlbGVjdGVkQ29udGV4dCBvZiBhU2VsZWN0ZWRDb250ZXh0cykge1xuXHRcdFx0Y29uc3Qgb0NvbnRleHREYXRhID0gb1NlbGVjdGVkQ29udGV4dC5nZXRPYmplY3QoKTtcblx0XHRcdGZvciAoY29uc3Qga2V5IGluIG9Db250ZXh0RGF0YSkge1xuXHRcdFx0XHRpZiAoa2V5LmluZGV4T2YoXCIjXCIpID09PSAwKSB7XG5cdFx0XHRcdFx0bGV0IHNBY3Rpb25QYXRoOiBzdHJpbmcgPSBrZXk7XG5cdFx0XHRcdFx0c0FjdGlvblBhdGggPSBzQWN0aW9uUGF0aC5zdWJzdHJpbmcoMSwgc0FjdGlvblBhdGgubGVuZ3RoKTtcblx0XHRcdFx0XHRvTW9kZWxPYmplY3QuZHluYW1pY0FjdGlvbnNbc0FjdGlvblBhdGhdID0geyBlbmFibGVkOiB0cnVlIH07XG5cdFx0XHRcdFx0b0ludGVybmFsTW9kZWxDb250ZXh0LnNldFByb3BlcnR5KFwiXCIsIG9Nb2RlbE9iamVjdCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdC8vIFRoZSB1cGRhdGFibGUgY29udGV4dHMgd2l0aCBtYXNzIGVkaXQgZGVwZW5kIG9uIHRoZSBmb2xsb3dpbmc6XG5cdFx0XHQvLyAxLiBVcGRhdGUgaXMgZGVwZW5kZW5kZW50IG9uIGN1cnJlbnQgZW50aXR5IHByb3BlcnR5IChzVXBkYXRhYmxlUGF0aCkuXG5cdFx0XHQvLyAyLiBUaGUgdGFibGUgaXMgcmVhZCBvbmx5IGFuZCBkcmFmdCBlbmFibGVkKGxpa2UgTFIpLCBpbiB0aGlzIGNhc2Ugb25seSBhY3RpdmUgY29udGV4dHMgY2FuIGJlIG1hc3MgZWRpdGVkKG5vdCBkcmFmdCBjb250ZXh0cykuXG5cdFx0XHQvLyAgICBTbywgdXBkYXRlIGRlcGVuZHMgb24gJ0lzQWN0aXZlRW50aXR5JyB2YWx1ZSB3aGljaCBuZWVkcyB0byBiZSBjaGVja2VkLlxuXHRcdFx0Y29uc3QgYlVwZGF0YWJsZUJ5UGF0aCA9IHNVcGRhdGFibGVQYXRoLmxlbmd0aCA9PT0gMCB8fCAhIW9TZWxlY3RlZENvbnRleHQuZ2V0UHJvcGVydHkoc1VwZGF0YWJsZVBhdGgpO1xuXHRcdFx0Y29uc3QgYk5vdERyYWZ0SW5SZWFkT25seU1vZGUgPSAhYlJlYWRPbmx5RHJhZnRFbmFibGVkIHx8IG9Db250ZXh0RGF0YS5Jc0FjdGl2ZUVudGl0eTtcblx0XHRcdGlmIChiVXBkYXRhYmxlQnlQYXRoICYmIGJOb3REcmFmdEluUmVhZE9ubHlNb2RlKSB7XG5cdFx0XHRcdGFVcGRhdGFibGVDb250ZXh0cy5wdXNoKG9TZWxlY3RlZENvbnRleHQpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGRlbGV0ZUhlbHBlci51cGRhdGVEZWxldGVJbmZvRm9yU2VsZWN0ZWRDb250ZXh0cyhvSW50ZXJuYWxNb2RlbENvbnRleHQsIGFTZWxlY3RlZENvbnRleHRzKTtcblxuXHRcdGlmICghb1RhYmxlLmRhdGEoXCJlbmFibGVBbmFseXRpY3NcIikpIHtcblx0XHRcdFRhYmxlSGVscGVyLnNldElCTkVuYWJsZW1lbnQob0ludGVybmFsTW9kZWxDb250ZXh0LCBvTmF2aWdhdGlvbkF2YWlsYWJsZU1hcCwgYVNlbGVjdGVkQ29udGV4dHMpO1xuXHRcdH1cblxuXHRcdGlmIChhU2VsZWN0ZWRDb250ZXh0cy5sZW5ndGggPiAxKSB7XG5cdFx0XHR0aGlzLmRpc2FibGVBY3Rpb24oYUFjdGlvbnNNdWx0aXNlbGVjdERpc2FibGVkLCBvRHluYW1pY0FjdGlvbnMpO1xuXHRcdH1cblxuXHRcdGlmIChvTW9kZWxPYmplY3QpIHtcblx0XHRcdG9Nb2RlbE9iamVjdFtcInVwZGF0YWJsZUNvbnRleHRzXCJdID0gYVVwZGF0YWJsZUNvbnRleHRzO1xuXHRcdFx0b01vZGVsT2JqZWN0W1wiY29udHJvbElkXCJdID0gb1RhYmxlLmdldElkKCk7XG5cdFx0XHRvSW50ZXJuYWxNb2RlbENvbnRleHQuc2V0UHJvcGVydHkoXCJcIiwgb01vZGVsT2JqZWN0KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gQWN0aW9uUnVudGltZS5zZXRBY3Rpb25FbmFibGVtZW50KG9JbnRlcm5hbE1vZGVsQ29udGV4dCwgb0FjdGlvbk9wZXJhdGlvbkF2YWlsYWJsZU1hcCwgYVNlbGVjdGVkQ29udGV4dHMsIFwidGFibGVcIik7XG5cdH0sXG5cblx0ZGlzYWJsZUFjdGlvbjogZnVuY3Rpb24gKGFBY3Rpb25zTXVsdGlzZWxlY3REaXNhYmxlZDogYW55LCBvRHluYW1pY0FjdGlvbnM6IGFueSkge1xuXHRcdGFBY3Rpb25zTXVsdGlzZWxlY3REaXNhYmxlZC5mb3JFYWNoKGZ1bmN0aW9uIChzQWN0aW9uOiBhbnkpIHtcblx0XHRcdG9EeW5hbWljQWN0aW9uc1tzQWN0aW9uXSA9IHsgYkVuYWJsZWQ6IGZhbHNlIH07XG5cdFx0fSk7XG5cdH0sXG5cdG9uRmllbGRDaGFuZ2VJbkNyZWF0aW9uUm93OiBmdW5jdGlvbiAob0V2ZW50OiBhbnksIG9DdXN0b21WYWxpZGF0aW9uRnVuY3Rpb246IGFueSkge1xuXHRcdC8vIENSRUFUSU9OIFJPVyBDQVNFXG5cdFx0Y29uc3QgbUZpZWxkID0gRmllbGRSdW50aW1lLmdldEZpZWxkU3RhdGVPbkNoYW5nZShvRXZlbnQpLFxuXHRcdFx0b1NvdXJjZUZpZWxkID0gbUZpZWxkLmZpZWxkLFxuXHRcdFx0c0ZpZWxkSWQgPSBvU291cmNlRmllbGQuZ2V0SWQoKTtcblxuXHRcdGNvbnN0IG9JbnRlcm5hbE1vZGVsQ29udGV4dCA9IG9Tb3VyY2VGaWVsZC5nZXRCaW5kaW5nQ29udGV4dChcImludGVybmFsXCIpLFxuXHRcdFx0bUZpZWxkVmFsaWRpdHkgPSBvSW50ZXJuYWxNb2RlbENvbnRleHQuZ2V0UHJvcGVydHkoXCJjcmVhdGlvblJvd0ZpZWxkVmFsaWRpdHlcIiksXG5cdFx0XHRtTmV3RmllbGRWYWxpZGl0eSA9IE9iamVjdC5hc3NpZ24oe30sIG1GaWVsZFZhbGlkaXR5KTtcblxuXHRcdG1OZXdGaWVsZFZhbGlkaXR5W3NGaWVsZElkXSA9IG1GaWVsZC5zdGF0ZTtcblx0XHRvSW50ZXJuYWxNb2RlbENvbnRleHQuc2V0UHJvcGVydHkoXCJjcmVhdGlvblJvd0ZpZWxkVmFsaWRpdHlcIiwgbU5ld0ZpZWxkVmFsaWRpdHkpO1xuXG5cdFx0Ly8gcHJlcGFyZSBDdXN0b20gVmFsaWRhdGlvblxuXHRcdGlmIChvQ3VzdG9tVmFsaWRhdGlvbkZ1bmN0aW9uKSB7XG5cdFx0XHRjb25zdCBtQ3VzdG9tVmFsaWRpdHkgPSBvSW50ZXJuYWxNb2RlbENvbnRleHQuZ2V0UHJvcGVydHkoXCJjcmVhdGlvblJvd0N1c3RvbVZhbGlkaXR5XCIpLFxuXHRcdFx0XHRtTmV3Q3VzdG9tVmFsaWRpdHkgPSBPYmplY3QuYXNzaWduKHt9LCBtQ3VzdG9tVmFsaWRpdHkpO1xuXHRcdFx0bU5ld0N1c3RvbVZhbGlkaXR5W29Tb3VyY2VGaWVsZC5nZXRCaW5kaW5nKFwidmFsdWVcIikuZ2V0UGF0aCgpXSA9IHtcblx0XHRcdFx0ZmllbGRJZDogb1NvdXJjZUZpZWxkLmdldElkKClcblx0XHRcdH07XG5cdFx0XHRvSW50ZXJuYWxNb2RlbENvbnRleHQuc2V0UHJvcGVydHkoXCJjcmVhdGlvblJvd0N1c3RvbVZhbGlkaXR5XCIsIG1OZXdDdXN0b21WYWxpZGl0eSk7XG5cdFx0XHQvLyBSZW1vdmUgZXhpc3RpbmcgQ3VzdG9tVmFsaWRhdGlvbiBtZXNzYWdlXG5cdFx0XHRjb25zdCBvTWVzc2FnZU1hbmFnZXIgPSBzYXAudWkuZ2V0Q29yZSgpLmdldE1lc3NhZ2VNYW5hZ2VyKCk7XG5cdFx0XHRjb25zdCBzVGFyZ2V0ID0gYCR7b1NvdXJjZUZpZWxkLmdldEJpbmRpbmdDb250ZXh0KCkuZ2V0UGF0aCgpfS8ke29Tb3VyY2VGaWVsZC5nZXRCaW5kaW5nUGF0aChcInZhbHVlXCIpfWA7XG5cdFx0XHRvTWVzc2FnZU1hbmFnZXJcblx0XHRcdFx0LmdldE1lc3NhZ2VNb2RlbCgpXG5cdFx0XHRcdC5nZXREYXRhKClcblx0XHRcdFx0LmZvckVhY2goZnVuY3Rpb24gKG9NZXNzYWdlOiBhbnkpIHtcblx0XHRcdFx0XHRpZiAob01lc3NhZ2UudGFyZ2V0ID09PSBzVGFyZ2V0KSB7XG5cdFx0XHRcdFx0XHRvTWVzc2FnZU1hbmFnZXIucmVtb3ZlTWVzc2FnZXMob01lc3NhZ2UpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0fVxuXHR9LFxuXHRvblRyZWVUYWJsZUNvbnRleHRDaGFuZ2VkOiBmdW5jdGlvbiAodGFibGU6IFRhYmxlLCBpbml0aWFsRXhwYW5zaW9uTGV2ZWw/OiBudW1iZXIpIHtcblx0XHQvLyBXaGVuIHRoZSBjb250ZXh0IG9mIGEgVHJlZVRhYmxlIGNoYW5nZXMsIHdlIHdhbnQgdG8gcmVzdG9yZSBpdHMgZXhwYW5zaW9uIHN0YXRlIHRvIHRoZSBkZWZhdWx0OlxuXHRcdC8vICAgLSBhbGwgZXhwYW5kZWQgaWYgdGhlcmUncyBhIHNlYXJjaCBwYXJhbWV0ZXIgY29taW5nIGZyb20gdGhlIGZpbHRlckJhclxuXHRcdC8vICAgLSBvdGhlcndpc2UgaW5pdGlhbCBleHBhbnNpb24gc3RhdGUgY29taW5nIGZyb20gdGhlIFBWIChzdG9yZWQgaW4gdGhlIHBheWxvYWQpXG5cdFx0Ly8gICAtIG90aGVyd2lzZSBubyBleHBhbnNpb24gYXQgYWxsXG5cblx0XHRjb25zdCByb3dCaW5kaW5nID0gdGFibGUuZ2V0Um93QmluZGluZygpIGFzIE9EYXRhTGlzdEJpbmRpbmc7XG5cdFx0aWYgKCFyb3dCaW5kaW5nLmdldENvbnRleHQoKSkge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdGNvbnN0IGFnZ3JlZ2F0aW9uID0gKHJvd0JpbmRpbmcgYXMgYW55KS5nZXRBZ2dyZWdhdGlvbigpID8/IHt9O1xuXHRcdGNvbnN0IGZpbHRlckluZm8gPSBUYWJsZVV0aWxzLmdldEFsbEZpbHRlckluZm8odGFibGUpO1xuXHRcdGFnZ3JlZ2F0aW9uLmV4cGFuZFRvID0gZmlsdGVySW5mby5zZWFyY2ggPyAxMDAgOiBpbml0aWFsRXhwYW5zaW9uTGV2ZWw7XG5cdFx0cm93QmluZGluZy5zZXRBZ2dyZWdhdGlvbihhZ2dyZWdhdGlvbik7XG5cdH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IFRhYmxlUnVudGltZTtcbiJdLCJtYXBwaW5ncyI6IjtBQUFBO0FBQUE7QUFBQTs7OztFQWVBLE1BQU1BLFlBQVksR0FBR0MsU0FBUyxDQUFDRCxZQUFZO0VBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNBLE1BQU1FLFlBQVksR0FBRztJQUNwQkMsb0JBQW9CLEVBQUUsVUFBVUMsTUFBVyxFQUFFO01BQzVDO0FBQ0Y7QUFDQTtBQUNBO01BQ0UsTUFBTUMsT0FBTyxHQUFHRCxNQUFNLENBQUNFLFNBQVMsRUFBRSxDQUFDQyxTQUFTLEVBQUU7UUFDN0NDLGVBQWUsR0FBR0MsR0FBRyxDQUFDQyxFQUFFLENBQUNDLE9BQU8sRUFBRSxDQUFDQyxJQUFJLENBQUUsR0FBRVAsT0FBTyxDQUFDUSxLQUFLLEVBQUcsV0FBVSxDQUFDO01BQ3ZFQyxXQUFXLENBQUNDLGVBQWUsQ0FBQ1AsZUFBZSxDQUFXO0lBQ3ZELENBQUM7SUFDRFEsZ0NBQWdDLEVBQUUsVUFBVUMsY0FBbUIsRUFBRUMsT0FBWSxFQUFFO01BQzlFO01BQ0EsTUFBTUMsU0FBUyxHQUFHRCxPQUFPLENBQUNY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