/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/buildingBlocks/BuildingBlockSupport","sap/fe/core/buildingBlocks/RuntimeBuildingBlock","sap/fe/core/CommonUtils","sap/fe/core/controls/CommandExecution","sap/fe/core/converters/helpers/BindingHelper","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/ClassSupport","sap/m/Menu","sap/m/MenuButton","sap/m/MenuItem","sap/suite/ui/commons/collaboration/CollaborationHelper","sap/suite/ui/commons/collaboration/ServiceContainer","sap/ui/core/CustomData","sap/ui/performance/trace/FESRHelper","sap/ushell/ui/footerbar/AddBookmarkButton","./ShareAPI","sap/fe/core/jsx-runtime/jsx"],function(e,t,i,n,r,o,a,s,l,u,c,d,p,m,v,f,b,h){"use strict";var g,S,y,A,M,O,I,_,T,w,B,E,C,z,P;var x={};var k=s.defineReference;var N=a.not;var D=a.constant;var R=a.compileExpression;var j=o.UI;var L=t.defineBuildingBlock;var H=t.blockAttribute;function F(e,t,i,n){if(!i)return;Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function U(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function J(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;V(e,t)}function V(e,t){V=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,i){t.__proto__=i;return t};return V(e,t)}function q(e,t,i,n,r){var o={};Object.keys(n).forEach(function(e){o[e]=n[e]});o.enumerable=!!o.enumerable;o.configurable=!!o.configurable;if("value"in o||o.initializer){o.writable=true}o=i.slice().reverse().reduce(function(i,n){return n(e,t,i)||i},o);if(r&&o.initializer!==void 0){o.value=o.initializer?o.initializer.call(r):void 0;o.initializer=undefined}if(o.initializer===void 0){Object.defineProperty(e,t,o);o=null}return o}function G(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}let K=(g=L({name:"Share",namespace:"sap.fe.macros.internal",publicNamespace:"sap.fe.macros",returnTypes:["sap.fe.macros.share.ShareAPI"]}),S=H({type:"string",required:true,isPublic:true}),y=H({type:"boolean",isPublic:true,bindable:true}),A=H({type:"object",isPublic:false}),M=k(),O=k(),I=k(),g(_=(T=function(t){J(i,t);function i(){var e;for(var i=arguments.length,n=new Array(i),r=0;r<i;r++){n[r]=arguments[r]}e=t.call(this,...n)||this;F(e,"id",w,U(e));F(e,"visible",B,U(e));F(e,"msTeamsOptions",E,U(e));F(e,"menuButton",C,U(e));F(e,"menu",z,U(e));F(e,"saveAsTileMenuItem",P,U(e));return e}x=i;var o=i.prototype;o._initializeMenuItems=async function e(t,i){const n=await d.isTeamsModeActive();if(n){var r,o;(r=this.menuButton.current)===null||r===void 0?void 0:r.unbindProperty("visible",true);(o=this.menuButton.current)===null||o===void 0?void 0:o.setVisible(false);return}const a=t.getController();const s=i.getShellServices();const l=await s.waitForPluginsLoad();if(!l){var u;const e=(u=this.menuButton.current)===null||u===void 0?void 0:u.getAggregation("_control");e===null||e===void 0?void 0:e.attachEventOnce("press",{},()=>this._initializeMenuItems,this)}if(this.menu.current){this.menu.current.addItem(h(c,{text:this.getTranslatedText("T_SEMANTIC_CONTROL_SEND_EMAIL"),icon:"sap-icon://email",press:()=>a.share._triggerEmail()}));this._addShellBasedMenuItems(a,s)}};o._addShellBasedMenuItems=async function e(t,i){var n,r,o;const a=i.hasUShell();const s=!!((n=(r=i.getUser()).isJamActive)!==null&&n!==void 0&&n.call(r));const l=await p.getServiceAsync();const u=l.getOptions({isShareAsCardEnabled:((o=this.msTeamsOptions)===null||o===void 0?void 0:o.enableCard)==="true"});if(a){if(s){var d,b;this===null||this===void 0?void 0:(d=this.menu)===null||d===void 0?void 0:(b=d.current)===null||b===void 0?void 0:b.addItem(h(c,{text:this.getTranslatedText("T_COMMON_SAPFE_SHARE_JAM"),icon:"sap-icon://share-2",press:()=>t.share._triggerShareToJam()}))}for(const e of u){var g,S,y,A;const t={text:e.text,icon:e.icon,visible:((g=e.subOptions)===null||g===void 0?void 0:g.length)===1&&e.subOptions[0].key==="COLLABORATION_MSTEAMS_CARD"?R(N(j.IsEditable)):undefined,items:[]};if(e!==null&&e!==void 0&&e.subOptions&&(e===null||e===void 0?void 0:(S=e.subOptions)===null||S===void 0?void 0:S.length)>0){t.items=[];e.subOptions.forEach(e=>{const i=new c({text:e.text,icon:e.icon,press:this.collaborationMenuItemPress,visible:e.key==="COLLABORATION_MSTEAMS_CARD"?R(N(j.IsEditable)):undefined,customData:new m({key:"collaborationData",value:e})});if(e.fesrStepName){v.setSemanticStepname(i,"press",e.fesrStepName)}t.items.push(i)})}else{t.press=this.collaborationMenuItemPress;t["customData"]=new m({key:"collaborationData",value:e})}const i=new c(t);if(t.press&&e.fesrStepName){v.setSemanticStepname(i,"press",e.fesrStepName)}this===null||this===void 0?void 0:(y=this.menu)===null||y===void 0?void 0:(A=y.current)===null||A===void 0?void 0:A.addItem(i)}const e=new f;if(e.getEnabled()){var M,O;this===null||this===void 0?void 0:(M=this.menu)===null||M===void 0?void 0:(O=M.current)===null||O===void 0?void 0:O.addItem(h(c,{ref:this.saveAsTileMenuItem,text:e.getText(),icon:e.getIcon(),press:()=>t.share._saveAsTile(this.saveAsTileMenuItem.current),children:{dependents:[e]}}))}else{e.destroy()}}};o.collaborationMenuItemPress=async function e(t){const i=t.getSource();const r=await p.getServiceAsync();const o=n.getTargetView(i);const a=o.getController();await a.share._adaptShareMetadata();const s=o.getModel("collaborationInfo").getData();r.share(i.data("collaborationData"),s)};o.getContent=function t(i,n){const o=h(b,{id:this.id,children:h(u,{ref:this.menuButton,icon:"sap-icon://action",visible:this.visible,tooltip:"{sap.fe.i18n>M_COMMON_SAPFE_ACTION_SHARE} (Ctrl+Shift+S)",children:h(l,{ref:this.menu})})});i.addDependent(h(r,{visible:this.visible,enabled:this.visible,command:"Share",execute:()=>{var e;return(e=this.menuButton.current)===null||e===void 0?void 0:e.getMenu().openBy(this.menuButton.current,true)}}));this.isInitialized=this._initializeMenuItems(i,n).catch(t=>{e.error(t)});return o};return i}(i),w=q(T.prototype,"id",[S],{configurable:true,enumerable:true,writable:true,initializer:null}),B=q(T.prototype,"visible",[y],{configurable:true,enumerable:true,writable:true,initializer:function(){return D(true)}}),E=q(T.prototype,"msTeamsOptions",[A],{configurable:true,enumerable:true,writable:true,initializer:null}),C=q(T.prototype,"menuButton",[M],{configurable:true,enumerable:true,writable:true,initializer:null}),z=q(T.prototype,"menu",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),P=q(T.prototype,"saveAsTileMenuItem",[I],{configurable:true,enumerable:true,writable:true,initializer:null}),T))||_);x=K;return x},false);
//# sourceMappingURL=Share.block.js.map