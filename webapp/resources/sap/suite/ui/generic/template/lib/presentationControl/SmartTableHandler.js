sap.ui.define(["sap/ui/base/Object","sap/base/util/extend","sap/ui/model/base/ManagedObjectModel","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/expressionHelper","sap/suite/ui/generic/template/genericUtilities/testableHelper"],function(e,t,n,r,i,a){"use strict";function o(e,t,o,u){var s=u.getTable();var l=r.isMTable(s);var g=r.isUiTable(s);var c=r.isTreeTable(s);var f=g?"rows":"items";function d(){return s.getBinding(f)}function v(){return u.getTableBindingPath()}function b(){return s.getColumns()}function h(){var e=[];if(l){e=s.getSelectedContexts()}else if(g){var t=s.getPlugins().filter(function(e){return e.isA("sap.ui.table.plugins.SelectionPlugin")})[0];var n=t?t.getSelectedIndices():s.getSelectedIndices();if(n){var r;for(var i=0;i<n.length;i++){r=s.getContextByIndex(n[i]);if(r){e.push(r)}}}}return e}function m(){var e=d();if(!e){return null}if(c){var t=e.getLength()>0?e.getLength():0;var n=[];for(var r=0;r<t;r++){var i=e.getContextByIndex(r);n.push(i)}return n}return g?e.getContexts():e.getCurrentContexts()}function p(){return u.getModel()}function I(){var e=[];var t=u.getCustomData().find(function(e){return e.getKey()==="TemplateSortOrder"});var n=t&&t.getValue();if(n){n.split(", ").forEach(function(t){var n=t.split(" ");e.push({Property:n[0],Descending:n.length>1})})}return e}function C(){return s.getAggregation(f)}function P(){return t.setEnabledToolbarButtons(u)}function T(){return t.setEnabledFooterButtons(u)}function x(e){u.attachAfterVariantInitialise(function(){u.setCurrentVariantId(e)});u.setCurrentVariantId(e)}function F(){return s.getBindingInfo(f)}function S(e,t,n){e(n)}function B(t,n){var r=F();if(r&&r.binding){return new Promise(function(i,a){var u=function(e){r.binding.detachDataReceived(u);S(i,a,e)};r.binding.attachDataReceived(u);if(t){r.binding.refresh(t)}else{r.binding.refresh()}if(!n&&e.getView().getModel("ui").getProperty("/editable")){o.messagesRefresh(t)}})}else{return y()}}function y(){return new Promise(function(e,t){var n=function(r){u.detachBeforeRebindTable(n);var i=r.getParameters().bindingParams;var a=i.events.dataReceived||Function.prototype;var o=function(n){a.call(this,n);S(e,t,n)};i.events.dataReceived=o};u.attachBeforeRebindTable(n);u.rebindTable()})}function w(t){var n=e.getOwnerComponent();var r=n.getModel().getMetaModel();var i=[];var a=r.getODataEntitySet(n.getEntitySet())["Org.OData.Capabilities.V1.SortRestrictions"];if(a&&a.NonSortableProperties){i=a.NonSortableProperties.map(function(e){return e.PropertyPath})}var o=t.filter(function(e){return!i.includes(e.Property)});var s=u.getUiState();var l=s.getPresentationVariant();if(!l.SortOrder){l.SortOrder=I()}l.SortOrder=l.SortOrder.concat(o);s.setPresentationVariant(l);u.setUiState(s)}function R(e){if(l){var t=s.getItems().findIndex(function(t){return t.getBindingContextPath()===e});if(t>-1){s.scrollToIndex(t)}}}function V(e){var t=e.getPath();var n=-2;for(var r=0;n===-2;r++){var i=s.getContextByIndex(r);var a=i&&i.getPath();if(a===t){n=r}else if(!i){n=-1}}return n}function O(e){var t=s.getFirstVisibleRow();var n=s.getVisibleRowCount();var r=e.getPath();for(var i=0;i<n;i++){if(s.getContextByIndex(t+i).getPath()===r){return s.getRows()[i]}}}function M(e){var t=e;var n,i;for(var a;t&&!n;t=n?t:a){var a=t.getParent();var i=r.isRow(a);n=(i||r.isColumnListItem(a))&&a}if(n){var o=n.indexOfCell(t);var u=s.getColumns();if(i){u=u.filter(function(e){return e.getVisible()})}return u[o]}}a.testable(O,"getGridTableRow");a.testable(V,"getGridTableRowIndexFromContext");function E(e){var t=r.searchInTree(e,function(e){return r.isSmartField(e)?r.getSmartFieldIsFocussableForInputPromise(e).then(function(t){return t&&e}):null});return Promise.resolve(t)}function U(e){E(e).then(function(t){r.focusUI5Control(t||e)})}function D(e){if(l){var t=s.getItems();var n=t.find(function(t){return e.getPath()===t.getBindingContext().getPath()});if(n){setTimeout(function(){U(n)},0)}}else{var r=V(e);if(r!==-1){s.setFirstVisibleRow(r);setTimeout(function(){var t=O(e);U(t)},0)}}}function A(){return new Promise(function(e,t){K(function(){Promise.resolve(r.searchInTree(s,function(e){if(r.isSmartField(e)){return r.getSmartFieldIsFocussableForInputPromise(e).then(function(t){return t&&e})}})).then(e)})})}function H(){return l?s.getGrowingThreshold():s.getThreshold()}function L(){return u.getDataStateIndicator()}function G(){return l}function N(){return u.getToolbar()}function j(e){var t=e.getModel();var n=u.getEntitySet();var r=u.getModel("@i18n");var a=r&&r.getResourceBundle();var o=i.getAnnotationFormatter(t,n,"/com.sap.vocabularies.UI.v1.HeaderInfo/Title/Value",a);var s=o.format(e);o.done();o=i.getAnnotationFormatter(t,n,"/com.sap.vocabularies.UI.v1.HeaderInfo/Description/Value",a);var l=o.format(e);o.done();return{title:s,subTitle:l}}function K(e){if(!s.getBusy()){e();return}var t=new n(s);var r=t.bindProperty("/busy");var i=function(){t.destroy();K(e)};r.attachChange(i)}function k(){return new Promise(function(e){K(e)})}function q(){return l||d().isLengthFinal()}function z(){var e=C(),t=l?e.length:d().getLength();for(var n=0;n<t;n++){var r=l?e.at(n).getBindingContext():s.getContextByIndex(n);if(r.isInactive()){return r}}}function J(){var e=z();if(e){D(e)}}return{getBinding:d,getBindingPath:v,getSelectedContexts:h,getCurrentContexts:m,getVisibleProperties:b,getItems:C,getBindingInfo:F,getModel:p,setEnabledToolbarButtons:P,setEnabledFooterButtons:T,setCurrentVariantId:x,setCurrentTableVariantId:x,setCurrentChartVariantId:Function.prototype,refresh:B,rebind:y,getUnbusyPromise:k,applyNavigationSortOrder:w,scrollToSelectedItemAsPerChildContext:R,getColumnForCell:M,getFirstFocussableEditableCellPromise:A,setFocusOnFirstEditableFieldInTableRow:D,getThreshold:H,getDataStateIndicator:L,getToolbar:N,getTitleInfoForItem:j,isLengthFinal:q,focusOnFirstTransientRow:J,isMTable:G}}return e.extend("sap.suite.ui.generic.template.lib.presentationControl.SmartTableHandler",{constructor:function(e,n,r,i){t(this,o(e,n,r,i))}})});
//# sourceMappingURL=SmartTableHandler.js.map