/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/base/Object","sap/base/util/extend","sap/base/util/isEmptyObject","sap/ui/core/routing/HashChanger","sap/ui/core/routing/History","sap/ui/core/library","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/suite/ui/generic/template/genericUtilities/jsonHelper","sap/suite/ui/generic/template/genericUtilities/oDataModelHelper","sap/suite/ui/generic/template/genericUtilities/ProcessObserver","sap/suite/ui/generic/template/genericUtilities/Queue","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/lib/CRUDHelper","sap/suite/ui/generic/template/lib/MessageUtils","sap/suite/ui/generic/template/lib/navigation/routingHelper","sap/suite/ui/generic/template/lib/navigation/startupParameterHelper","sap/suite/ui/generic/template/lib/TemplateComponent","sap/base/strings/whitespaceReplacer"],function(e,t,r,n,a,o,i,s,u,l,d,p,c,f,v,g,y,m,h){"use strict";var b="lib.navigation.NavigationController";var C=new s(b).getLogger();var N=o.routing.HistoryDirection;var P=a.getInstance();var k=function(){};function R(e){e=e||P.getDirection();return e===N.Backwards}var H=g.getCrossAppNavService();var S="sap-iapp-state--create";var T="sap-iapp-state--history";function L(e){var t=e.substring(e.length-5,e.length);if(t==="query"){return e.substring(0,e.length-5)}return e}function I(e){if(e.indexOf("/")===0){return e}return"/"+e}function B(e){var t="";var r="";var n=Object.keys(e).sort();n.forEach(function(n){var a=e[n];if(Array.isArray(a)){var o=a.sort();for(var i=0;i<o.length;i++){var s=o[i];r=r+t+n+"="+s;t="&"}}else{r=r+t+n+"="+a;t="&"}});return r}function A(e,t){e=e||"";var r=e.charAt(e.length-1)==="/"?"?":"/?";return e+(t?r+t:"")}function x(e,a){var o=[];var s,b;var x;var D;var w;var O;var F,M;var E;var j;var U;var K;var z=["-","-","-"];var V=Promise.resolve();var _=(new p).start();function q(t,r,n){var a=t.iHashChangeCount+1;M={iHashChangeCount:a,backTarget:t.iHashChangeCount,componentsDisplayed:Object.create(null),LeaveByBack:true,backSteps:1};if(r){E.followUpNeeded={mode:r.mode,displayMode:r.displayMode,identity:{treeNode:e.mRoutingTree[r.route],keys:r.keys,appStates:r.appStates}};De(null)}if(n){e.oApplicationProxy.setNextFocus(function(){setTimeout(function(){i.focusControl(n)},0)})}}function Q(r){j=false;e.oBusyHelper.setBusyReason("HashChange",true,undefined,undefined,true);U={};x=R();var n=[];if(x){e.oBusyHelper.getUnbusy().then(function(){x=false});E={mode:-1};if(o.length){var i=o.pop();w=i.isInitialNavigation;D=i.myIntentPromise;O=i.previousHashes;O.push(i.currentHash);q(i.currentHash,i.serializedBackOption,i.focus);return}}else{var s=H.isInitialNavigationAsync().then(function(e){w=e});n.push(s)}var u=sap.ushell&&sap.ushell.renderers&&sap.ushell.Container&&new Promise(function(e){sap.ushell.Container.getServiceAsync("AppLifeCycle").then(function(t){var n=t.getCurrentApplication();var a=function(){n=n||t.getCurrentApplication();var a=r&&(n.disableKeepAliveAppRouterRetrigger&&n.disableKeepAliveAppRouterRetrigger.bind(n,false)||t.disableKeepAliveAppRouterRetrigger&&t.disableKeepAliveAppRouterRetrigger.bind(t,false));(a||Function.prototype)();var o=n.getIntent();e(o)};if(n){a()}else{t.attachAppLoaded(null,a)}})});D=u?Promise.all([u,sap.ushell.Container.getServiceAsync("URLParsing")]).then(function(e){var r=t({},e[0]);var n=e[1];r.appSpecificRoute="&/";var a=n.constructShellHash(r);return"#"+a}):Promise.resolve("");var l=e.oAppComponent.getComponentData();e.myIntentPromise=l&&l.feEnvironment&&l.feEnvironment.getIntent&&Promise.resolve(l.feEnvironment.getIntent())||u||Promise.resolve({semanticObject:"",action:""});Z();var d=r?a.initialize:Function.prototype;var p=!x&&!a.oHashChanger.getHash()&&l;var c=p&&p.startupParameters;if(c){y.parametersToNavigation(e,c).then(function(t){if(t){F={treeNode:e.mRoutingTree.root,keys:[],appStates:Object.create(null)};yt(t)}d(!!t)})}else{d()}return Promise.all(n)}var G=Promise.resolve();var W=Promise.resolve();var J=new d;function X(){var e=R();if(!e){var t=Y();o.push({isInitialNavigation:w,myIntentPromise:D,currentHash:M,previousHashes:O,serializedBackOption:t.serializedBackOption,focus:t.focus})}D=null;M=null;O=null;F=null;K=null;U=null}function Y(e){var t=s.getData();if(t.focus){return t}if(!e){var r=i.getControlWithFocus();e=r&&r.getId()}if(e){t.focus=e;s.setData(t);s.save()}return t}function Z(e){M={iHashChangeCount:0,backTarget:0,componentsDisplayed:Object.create(null)};F=e?F:null;O=[];if(!x){E=null}K=null}function $(){Lt(e.mRoutingTree.root.sRouteName);return e.mRoutingTree.root.componentCreated}function ee(){return a.oAppComponent.getManifestEntry("sap.app").title}function te(){return a.oAppComponent.getProperty("draftDiscardConfirmationSettings").enabled}function re(){var e=sap.ushell&&sap.ushell.Container;return e&&e.getServiceAsync("URLParsing")}function ne(r,n,a){if(!r){return Promise.resolve()}var o=r&&e.componentRegistry[r];var i=[];var s=o&&o.methods.getUrlParameterInfo;if(s){i.push(o.viewRegistered.then(function(){var e=n&&I(n);return s(e,M.componentsDisplayed[o.route]===1).then(function(e){t(a,e)})}))}i.push(o.oStatePreserverPromise.then(function(e){var r=n&&I(n);return e.getUrlParameterInfo(r,M.componentsDisplayed[o.route]===1).then(function(e){t(a,e)})}));return Promise.all(i)}function ae(e){var t=e.treeNode.componentId;var r=e.treeNode.getPath(2,e.keys);var n=e.appStates;return ne(t,r,n)}function oe(t,r){if(t.treeNode===r.treeNode){r.appStates=t.appStates;return Promise.resolve()}r.appStates=Object.create(null);if(r.treeNode.fCLLevel===0||r.treeNode.fCLLevel===3){return ae(r)}return e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForNavigation(F,r)}function ie(t,r,n){var a=e.mRoutingTree[t];return ne(a.componentId,n,r)}function se(t,r){var n;if(!t&&r instanceof m){var a=r&&e.componentRegistry[r.getId()];var o=a&&a.methods.getTitle;n=o&&o()}else if(!t&&r&&r.title){n=r.title}n=n||ee();e.oShellServicePromise.then(function(e){e.setTitle(n)}).catch(function(){C.warning("No ShellService available")})}function ue(t){var n=[e.oPagesDataLoadedObserver.getProcessFinished(true)];var a=null;var o=M.iHashChangeCount;delete F.componentsDisplayed;var i=-1;var s=[];for(var u in e.componentRegistry){var l=e.componentRegistry[u];var d=l.oControllerUtils&&l.oControllerUtils.oServices.oTemplateCapabilities.oMessageButtonHelper;var p=M.componentsDisplayed[l.route]===1;var c=l.utils.getTemplatePrivateModel();c.setProperty("/generic/isActive",p);if(p){if(l.viewLevel>0){var f=e.mRoutingTree[l.route];if(f.isDraft){s.push(c)}}n.push(l.oViewRenderedPromise);if(l.viewLevel>i){i=l.viewLevel;a=l.oComponent}}else{l.utils.suspendBinding()}if(d){d.setEnabled(p)}}var v=r(M.componentsDisplayed)||e.oFlexibleColumnLayoutHandler&&e.oFlexibleColumnLayoutHandler.isAppTitlePrefered();se(v,t||a);Promise.all(n).then(function(){if(o===M.iHashChangeCount&&r(U)){e.oAppComponent.firePageDataLoaded()}var t=s.some(function(e){return e.getProperty("/objectPage/displayMode")>1});var n=e.oAppComponent.getModel();n.setTransitionMessagesOnlyForGroup("Changes",t)})}var le=ue.bind(null,null);c.testable(function(e){F=e;O.push(M);M={backTarget:0,componentsDisplayed:Object.create(null)}},"setCurrentIdentity");c.testable(function(e){b=e},"setHistoryKey");function de(){return F}function pe(e,t){if(Array.isArray(e)&&e.length<2){e=e[0]}if(Array.isArray(t)&&t.length<2){t=t[0]}if(Array.isArray(e)){if(Array.isArray(t)){if(e.length===t.length){e=e.sort();t=t.sort();return e.every(function(e,r){return e===t[r]})}return false}return false}return t===e}function ce(n,a){if(!n||n.treeNode!==a.treeNode){return false}for(var o=a.treeNode;o.level>0;o=e.mRoutingTree[o.parentRoute]){if(!o.noKey&&a.keys[o.level]!==n.keys[o.level]){return false}}if(r(n.appStates)){return r(a.appStates)}var i=t(Object.create(null),a.appStates,n.appStates);for(var s in i){var u=s===T?b:a.appStates[s];if(!pe(u,n.appStates[s])){return false}}return true}function fe(e){return ce(F,e)}function ve(t,n,a){var o=Object.create(null);for(var i=t;i.level>0;i=e.mRoutingTree[i.parentRoute]){if(!i.noKey){o["keys"+i.level]=n[i.level]}}var s=!r(a);var u=t.sRouteName+(s?"query":"");if(s){o["query"]=a}return{route:u,parameters:o}}function ge(t){var r=ve(E.identity.treeNode,E.identity.keys,E.identity.appStates);if(!e.ghostapp){a.oRouter.navTo(r.route,r.parameters,t)}}function ye(t){if(!t||!E.identity){return}var r=function(r,n,a){a=n?n.getId():a;var o=e.componentRegistry[a];(o.methods.presetDisplayMode||Function.prototype)(t,r)};for(var n=E.identity.treeNode;n;n=n.parentRoute&&e.mRoutingTree[n.parentRoute]){if(n.componentId){r(M.componentsDisplayed[n.sRouteName]===1,null,n.componentId)}else{n.componentCreated.then(r.bind(null,false))}if(n.fCLLevel===0||n.fCLLevel===3){break}}}function me(e){if(!E||E.identity){return Promise.resolve(e)}var t=M;for(var r=0;r>e;r--){if(t.backTarget===0){return Promise.resolve(e)}t=O[t.backTarget]}E.mode=e;while(fe(t.identity)){E.mode--;if(t.backTarget===0){return Promise.resolve(E.mode)}t=O[t.backTarget]}if(t.identity.treeNode.level===0){E.identity=t.identity;return Promise.resolve(E.mode)}return St(t.identity).then(function(e){if(!e){E.identity=t.identity;return Promise.resolve(E.mode)}if(fe(e.identity)){E.mode--;return me(E.mode)}E.identity=e.identity;E.followUpNeeded=true;return Promise.resolve(E.mode)})}function he(t){var r;if(t){if(t.identity){t.identity.appStates[T]=b}if(E){if(t.identity){E={identity:t.identity,followUpNeeded:true,mode:E?E.mode:0};ye(t.displayMode)}return}if(t.identity&&fe(t.identity)){return}r=t.mode;if(r===1&&t.identity&&M.backTarget&&ce(O[M.backTarget],t.identity)){r=-1}E={identity:t.identity,mode:r};ye(t.displayMode)}else{r=1}E.followUpNeeded=E.identity&&r<0;if(E.identity||r===-1&&M.backTarget){e.oBusyHelper.setBusyReason("HashChange",!e.ghostapp,undefined,undefined,true);_.stop()}else{E=null}if(r>=0){ge(r===1)}else if(!e.ghostapp){return me(r).then(function(e){window.history.go(e)})}}function be(e,t){e.text=e.headerTitle!==t&&t||"";if(K&&K.linkInfos.length>e.level){K.adjustNavigationHierarchy()}}function Ce(t,r){var o=Object.create(null);if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.adaptBreadCrumbUrlParameters(o,t)}var i={treeNode:t};var s={treeNode:t,keys:F.keys.slice(0,t.level+1),appStates:o};var u;var l=ae(s).then(function(){var e=ve(t,F.keys,o);u=a.oRouter.getURL(e.route,e.parameters);o[T]=b;e=ve(t,F.keys,o);i.fullLink=a.oRouter.getURL(e.route,e.parameters)});r.push(l);i.navigate=function(r,n){if(e.oFlexibleColumnLayoutHandler&&!n){var a;for(var i=O[M.backTarget];i.backTarget>0&&!a;i=O[i.backTarget]){if(i.identity.treeNode===t){a=i.identity}}e.oFlexibleColumnLayoutHandler.adaptPreferredLayout(o,t,a)}e.oBusyHelper.setBusy(l.then(function(){return je(s,false,r)}),undefined,undefined,true)};i.adaptBreadCrumbLink=function(e){l.then(function(){var t=n.getInstance();var r=t.hrefForAppSpecificHash?t.hrefForAppSpecificHash(u):"#/"+u;e.setHref(r)})};return i}function Ne(e,t){var r={title:h(t.treeNode.headerTitle||""),icon:t.treeNode.titleIconUrl||"",subtitle:h(t.treeNode.text),intent:e+t.fullLink};return r}function Pe(){var t=[];var r=[D];var n=e.oFlexibleColumnLayoutHandler&&e.oFlexibleColumnLayoutHandler.hasNavigationMenuSelfLink(F);for(var a=n?F.treeNode:e.mRoutingTree[F.treeNode.parentRoute];a;a=e.mRoutingTree[a.parentRoute]){var o=Ce(a,r);t[a.level]=o}var i=Promise.all(r);var s=function(){e.oShellServicePromise.then(function(e){e.setHierarchy([]);i.then(function(r){var n=r[0];var a=[];for(var o=t.length-1;o>=0;o--){a.push(Ne(n,t[o]))}e.setHierarchy(a)})}).catch(function(){C.warning("No ShellService available")})};K={linkInfos:t,adjustNavigationHierarchy:s};s()}function ke(){return K.linkInfos}function Re(t,r){var n=Object.create(null);var a=L(t);n.treeNode=e.mRoutingTree[a];n.appStates=r["?query"]||Object.create(null);n.keys=[""];for(var o=n.treeNode;o.level>0;o=e.mRoutingTree[o.parentRoute]){n.keys[o.level]=o.noKey?"":r["keys"+o.level]}return n}function He(e){var t=F;if(E&&E.identity&&!E.followUpNeeded){F=E.identity}else{var r=e.getParameter("config");F=Re(r.name,e.getParameter("arguments"))}F.previousIdentity=t;F.componentsDisplayed=Object.create(null);F.componentsDisplayed[F.treeNode.sRouteName]=1;if(F.treeNode.level===0){Te=null}Pe()}function Se(r,n){var a={identity:{treeNode:F.treeNode,keys:F.keys,appStates:t(Object.create(null),F.appStates)},mode:1};if(Array.isArray(n)&&n.length<2){n=n[0]}if(n){a.identity.appStates[r]=n}else{delete a.identity.appStates[r]}var o=J.getProcessFinished(true).then(function(){he(a)});e.oBusyHelper.setBusy(o,undefined,undefined,true);return o}var Te;function Le(t,r,n,a,o,i){var s=t.then(function(t){t.appStates=i||Object.create(null);var s;if(t.treeNode.fCLLevel===0||t.treeNode.fCLLevel===3){s=ae(t)}else{s=e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForNavigation(F,t)}if(!r&&o&&o.bIsCreate&&o.bIsDraft&&!o.bIsDraftModified){Te={index:O.length,path:a.getPath(),identity:t,displayMode:Ze()}}return s.then(function(){return je(t,r,n)})});e.oBusyHelper.setBusy(s,undefined,undefined,true);return s}function Ie(t,r,n,a,o){if(!t||Array.isArray(t)&&t.length===0){return lt(r)}var i=Array.isArray(t)?t:[t];var s=i.length===1&&(!F||F.treeNode.level>0)&&l.analyseContext(i[0]);var u=s&&e.mEntityTree[s.entitySet];var d=u&&(u.level===1?["",s.key]:e.oApplicationProxy.getIdentityKeyForContext(i[0]));var p=d?Promise.resolve({treeNode:u,keys:d}):new Promise(function(e,t){var r=0,n;var a=function(){if(r==i.length){e(n)}else{var t=i[r];var o=qe(n,t,true,true);o.promise.then(function(e){r++;n=e;a()})}};a()});var c=!u||_e(u);e.oBusyHelper.setBusy(p,undefined,undefined,c);return Le(p,r,n,i[0],a,o)}function Be(t,r,n,a){var o=qe(null,t,true,true);var i=o.promise;e.oBusyHelper.setBusy(i,undefined,undefined,o.willShowPlaceholder);return Le(i,r,n,t,a).then(Function.prototype,Function.prototype)}function Ae(r){var n=r.getPath();if(!Te||Te.path!==n){if(n===F.treeNode.getPath(2,F.keys)&&r.getObject().HasActiveEntity){return e.oApplicationProxy.getSiblingPromise(n).then(function(e){var t={treeNode:F.treeNode,keys:["",l.analyseContext(e).key],appStates:F.appStates};return{identity:t,mode:1,displayMode:1}},function(){var t={treeNode:e.mRoutingTree.root,keys:[""],appStates:Object.create(null)};var r=ae(t);return r.then(function(){return{identity:t,mode:1,displayMode:1}})})}return null}var a;var o=function(e,t){return e!==a.identity.keys[t]};for(var i=Te.index+1;i<O.length;i++){a=O[i];if(!a.identity.treeNode||a.identity.treeNode.level<Te.identity.treeNode.level||Te.identity.keys.some(o)){return null}}var s=0;for(var u=M;u.iHashChangeCount!==Te.index;u=O[u.backTarget]){if(u.iHashChangeCount<Te.index){return null}s--}var d=O[Te.index].identity;var p={treeNode:d.treeNode,keys:d.keys,appStates:Object.create(null)};var c={identity:p,mode:s,displayMode:Te.displayMode};if(d.treeNode.fCLLevel===0||d.treeNode.fCLLevel===3){t(p.appStates,d.appStates);return Promise.resolve(c)}return e.oFlexibleColumnLayoutHandler.getSpecialDraftCancelPromise(F,d,p.appStates).then(function(){return c})}function xe(e){return he.bind(null,e)}function De(e){var t=s.getData();if(!t){if(!e){return}t={}}t.serializedBackOption=e&&{mode:e.mode,displayMode:e.displayMode,route:e.identity.treeNode.sRouteName,keys:e.identity.keys,appStates:e.identity.appStates};s.setData(t);s.save()}function we(t){var r=[];var n=Object.create(null);return e.oApplicationProxy.fillSiblingKeyPromise(F.treeNode,F.keys,r,t).then(function(e){return Qe(e,n,r).then(function(){return{treeNode:e,keys:r,appStates:n}})})}function Oe(e,t){var r=1+e;return we(t).then(function(e){return _.makeQueuable(je.bind(null,e,true,r,false))})}function Fe(r,n,a,o){var i=l.analyseContext(r);var s={keys:["",i.key],appStates:Object.create(null)};var u=o?s:_.makeQueuable(je.bind(null,s,true,n,false));if(F.treeNode.level===1){s.treeNode=F.treeNode;t(s.appStates,F.appStates);return Promise.resolve(u)}if(a){a.keys.forEach(function(e){if(e){s.keys.push(e)}});s.treeNode=a.treeNode}if(s.treeNode===F.treeNode){t(s.appStates,F.appStates);return Promise.resolve(u)}var d=e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForNavigation(F,s);return d.then(function(){return u})}function Me(t,r){if((t&&t.treeNode)!==r.treeNode){return Promise.resolve(false)}if(e.oFlexibleColumnLayoutHandler&&!e.oFlexibleColumnLayoutHandler.areIdentitiesLayoutEquivalent(t,r)){return Promise.resolve(false)}var n=true;var a=t.treeNode.sRouteName;for(var o=t.treeNode;o.level>0;o=e.mRoutingTree[o.parentRoute]){var i=o.noKey||t.keys[o.level]===r.keys[o.level];if(!i&&o.noOData){return Promise.resolve(false)}n=n&&i;if(o.noOData){a=o.parentRoute}}if(n){return Promise.resolve(true)}var s=e.mRoutingTree[a];var u=t.keys.slice(0,s.level+1);var l=r.keys.slice(0,s.level+1);var d=s.getPath(2,u);var p=s.getPath(2,l);return e.oApplicationProxy.areTwoKnownPathesIdentical(d,p,s.level===1,t,r)}function Ee(t){var r=O[M.backTarget];var n=-1;if(r&&(t.level===0||e.oFlexibleColumnLayoutHandler&&t.fCLLevel===0)){for(;r.backTarget>0&&r.identity.treeNode&&r.identity.treeNode.level>t.level;n--){r=O[r.backTarget]}}return r&&{candidateHash:r,candidateCount:n}}function je(t,r,n,a){var o=Ee(t.treeNode);var i=Me(o&&o.candidateHash.identity,t);var s=i.then(function(e){var i=e?o.candidateCount:0+!!r;var s={identity:t,mode:i,displayMode:n};if(a){return s}he(s)});e.oBusyHelper.setBusy(s,undefined,undefined,true);return s}function Ue(e){if(x){return lt(true)}var t=Ke();yt({title:t.dataLoadFailedTitle,text:t.dataLoadFailedText,description:"",viewLevel:e.fCLLevel});return Promise.resolve()}function Ke(){return{dataLoadFailedTitle:e.getText("ST_ERROR"),dataLoadFailedText:e.getText("ST_GENERIC_ERROR_LOAD_DATA_TEXT")}}function ze(t,r,n,a){if(!r){return{treeNode:e.mRoutingTree.root,key:""}}var o=l.analyseContext(r);var i=t.level&&t.entitySet===o.entitySet?t:t.children.indexOf(o.entitySet)>=0&&e.mEntityTree[o.entitySet];if(i){return{treeNode:i,key:o.key}}if(n){var s=e.oAppComponent.getModel();var u=s.getMetaModel();var d=u.getODataEntitySet(o.entitySet);var p=u.getODataEntityType(d.entityType);var c;var f=t.children.some(function(t){i=e.mEntityTree[t];c=i.navigationProperty;if(!c){return false}var r=u.getODataAssociationEnd(p,c);return!!r&&r.multiplicity.endsWith("1")});if(f){return{treeNode:i,navigationProperty:c}}}if(a&&t.level>0){var v=e.mRoutingTree[t.parentRoute];return ze(v,r,n,true)}}function Ve(e,t,r,n){if(n.navigationProperty){return new Promise(function(a,o){var i=r.getModel();i.createBindingContext(n.navigationProperty,r,null,function(r){var i=r&&Ve(e,t,r,{treeNode:n.treeNode,key:l.analyseContext(r).key});if(i){i.then(a,o)}else{o()}})})}var a=t.slice(0,n.treeNode.level);a.push(n.key);return Promise.resolve({treeNode:n.treeNode,keys:a})}function _e(e){return e.componentId!==z[Math.min(e.fCLLevel,2)]&&(e.level>0||!e.componentId)&&(e.behaviour&&e.behaviour.getPlaceholderInfo())}function qe(t,r,n,a){var o=t&&t.treeNode||F&&F.treeNode||e.mRoutingTree.root;var i=t&&t.keys||F&&F.keys||[""];var s=ze(o,r,n,a);var u=s&&s.treeNode;return u?{promise:Ve(o,i,r,s),targetNode:u,willShowPlaceholder:_e(u)}:{promise:Promise.reject()}}function Qe(t,r,n){var a={treeNode:t,keys:n||F.keys.slice(0,t.level+1),appStates:r};if(t.fCLLevel===0||t.fCLLevel===3){return ae(a)}return e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForNavigation(F,a)}function Ge(t,r){var n=qe({treeNode:e.mRoutingTree.root},t,false,true);var a=n.promise;var o=a.then(function(e){e.appStates=Object.create(null);if(e.treeNode===F.treeNode){Object.assign(e.appStates,F.appStates);var t={identity:e,mode:1,displayMode:1};if(r){return t}he(t);return null}var n=Qe(e.treeNode,e.appStates);return n.then(je.bind(null,e,true,1,r))});e.oBusyHelper.setBusy(o,undefined,undefined,n.willShowPlaceholder);return o}function We(t){var r;var n=0;for(r=M;r.backTarget>0&&(!r.identity||!r.identity.treeNode||r.identity.treeNode.level>t);n++){r=O[r.backTarget]}if(!w&&(n===0||!r.identity.treeNode||r.identity.treeNode.level>t)){window.history.go(-n-1);return Promise.resolve()}var a=-n||1;var o=Nt(t);var i={treeNode:o,keys:F.keys.slice(0,o.level+1),appStates:Object.create(null)};var s=Qe(i.treeNode,i.appStates).then(function(){if(a<0&&(i.treeNode.fCLLevel===1||i.treeNode.fCLLevel===2)&&r.identity.treeNode===i.treeNode){for(;r.backTarget>0&&!e.oFlexibleColumnLayoutHandler.areIdentitiesLayoutEquivalent(r.identity,i);a--){r=O[r.backTarget];if(r.identity.treeNode!==i.treeNode){break}}}var t={identity:i,mode:a,displayMode:i.treeNode.isDraft?6:1};he(t)});e.oBusyHelper.setBusy(s,undefined,undefined,true);return s}var Je;function Xe(t,r,n,a){var o=e.mEntityTree[t];var i=e.componentRegistry[o.componentId];var s;if(r){s=H.createEmptyAppStateAsync(e.oAppComponent).then(function(e){e.setData(u.getStringifiable(r));e.save();return e.getKey()})}else{s=Promise.resolve()}var l=F?F.keys.slice(0,o.level):[""];l.push("-");a=a||Object.create(null);var d=Qe(o,a,l);var p=Promise.all([s,d]).then(function(e){var t=e[0];if(t){a[S]=t}var r={treeNode:o,keys:l,appStates:a};Je=n;if(fe(r)){var s={componentsDisplayed:M.componentsDisplayed,isNonDraftCreate:true};return kt("-",s,i.oComponent)}else{var u=!F||!!(i&&i.nonDraftCreateContext);return je(r,u,4)}});e.oBusyHelper.setBusy(p,undefined,undefined,true);return p}function Ye(r){var n=qe(null,r,false,false);var a=n.promise;var o=a.then(function(e){e.appStates=Object.create(null);t(e.appStates,F.appStates);delete e.appStates[S];var r={identity:e,mode:1};he(r)});e.oBusyHelper.setBusy(o,undefined,undefined,n.willShowPlaceholder);return o}function Ze(){var t=e.componentRegistry[F.treeNode.componentId];var r=t.utils.getTemplatePrivateModel();var n=r.getProperty("/objectPage/displayMode")||0;return n}function $e(t,r,n,a,o){var i=F.keys.slice(0,t.level);i.push(r?n:"");var s=Object.create(null);var u=Qe(t,s,i);var l=u.then(function(){var e={treeNode:t,keys:i,appStates:s};return je(e,a,o)});e.oBusyHelper.setBusy(l,undefined,undefined,true);return l}function et(t,r,n,a,o,i){var s;var u=true;for(var l=0;l<t.children.length&&!s;l++){var d=t.children[l];var p=e.mEntityTree[d];if(p[t.level?"navigationProperty":"sRouteName"]===r){s=p.sRouteName;u=!p.noKey}}var c=!s&&n&&t.embeddedComponents[n];if(c){for(var f=0;f<c.pages.length&&!s;f++){var v=c.pages[f];if(v.navigationProperty===r){s=t.sRouteName+"/"+n+"/"+r;u=!(v.routingSpec&&v.routingSpec.noKey)}}}if(s){var g=e.mRoutingTree[s];if(!i){i=Ze()}return $e(g,u,a,o,i)}if(!n&&t.level>0){return et(e.mRoutingTree[t.parentRoute],r,null,a,o,i)}return Promise.reject()}function tt(t,r,n,a){var o=qe({treeNode:t},r,true,false);var i=o.promise;var s=i.then(function(e){e.appStates=Object.create(null);var t=Qe(e.treeNode,e.appStates,e.keys);return t.then(je.bind(null,e,a,n,false))});e.oBusyHelper.setBusy(s,undefined,undefined,o.willShowPlaceholder);return s}function rt(r,n){var a=e.oAppComponent.getModel();var o;var i=n.lastIndexOf("/");if(i>0){var s=n.substring(i);if(s.indexOf("(")<0){o=n.substring(0,i)}else{o=n}}else{o=n}var u=[];var d,p;var c;var f;var g=function(){c=c.substring(0,c.length-f.length-2);c=c.substring(0,c.lastIndexOf("/"));p=p&&e.mRoutingTree[p.parentRoute]};for(c=o;c&&(!p||p.level>0);g()){var y=l.analyseContextPath(c,a);f=y.key||"";if(!d){d=e.mEntityTree[y.entitySet];p=d}if(p){if(p.noOData||p.noKey||!p.isDraft){return null}u.push(f)}}if(!d){return null}u.push("");u.reverse();var m=d.getPath(2,u);if(!n.startsWith(m)){return null}var h={treeNode:d,keys:u,appStates:Object.create(null)};var b={identity:h,mode:0,displayMode:6};var C;if(d===F.treeNode){if(u.every(function(e,t){return e===F.keys[t]})){return null}t(h.appStates,F.appStates);C=Promise.resolve()}else{C=ae(h).then(function(){if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.adaptBreadCrumbUrlParameters(h.appStates,d)}})}var N=function(t,n){var a=sap.ui.getCore().getMessageManager();var o=a.getMessageModel();var i=o.bindList("/");var s=r.aTargets;var u;i.getAllCurrentContexts().some(function(e){var t=e.getObject();var r=t.aTargets;if(s.length===r.length&&s.every(function(e){return r.indexOf(e)>=0})){u=t;return true}});if(u){var l=e.componentRegistry[d.componentId];var p=l.oControllerUtils;v.prepareForMessageHandling([u],p);v.navigateFromMessageTitleEvent(p,u,l.oComponent,false,m);return}n()};var P=C.then(function(){he(b);return true});e.oBusyHelper.setBusy(Promise.all([P,d.componentCreated]));e.oApplicationProxy.setNextFocus(N);return P}function nt(){return!!E}function at(t){C.info("Navigate back");if(M.backTarget&&I(P.getPreviousHash()||"")!==I(M.hash)){e.oBusyHelper.setBusyReason("HashChange",true,undefined,undefined,true)}M.LeaveByBack=!M.forwardingInfo;if(M.LeaveByBack){M.backSteps=t}window.history.go(-t)}function ot(t,r){t=I(t||"");C.info("Navigate to hash: "+t);if(t===M.hash){C.info("Navigation suppressed since hash is the current hash");return}M.targetHash=t;if(M.backTarget&&I(P.getPreviousHash()||"")===t){a.navigateBack();return}e.oBusyHelper.setBusyReason("HashChange",true,undefined,undefined,true);M.LeaveByReplace=r;if(r){a.oHashChanger.replaceHash(t)}else{a.oHashChanger.setHash(t)}}function it(t,r,n,a){var o=r.then(function(e){t=A(t,e);if(a){M.backwardingInfo={count:a.count,index:a.index,targetHash:I(t)};at(a.count)}else{ot(t,n)}return t});e.oBusyHelper.setBusy(o,undefined,undefined,true);return o}function st(e,t,r){var n=O[M.backTarget];return n&&n.hash&&I(n.hash.split("?")[0])===I(t)&&{count:1,index:M.backTarget}}function ut(){var t={treeNode:e.mRoutingTree.root,keys:[""],appStates:Object.create(null)};var r=ae(t);return r.then(function(){return t})}function lt(t){if(F.treeNode.level===0){return Promise.resolve()}var r=ut();var n=r.then(function(e){je(e,t)});e.oBusyHelper.setBusy(n,undefined,undefined,true);return n}function dt(t,r){var n=M.componentsDisplayed;var a=function(t){var a=e.componentRegistry[t.getId()];(a.methods.presetDisplayMode||Function.prototype)(r,n[a.route]===1)};for(var o=0;o<t.length;o++){var i=t[o];i.then(a)}}function pt(t,r,n,a){var o={};var i=e.oFlexibleColumnLayoutHandler&&e.oFlexibleColumnLayoutHandler.getFCLAppStatesPromise(t,o);var s=ie(t,o,r);var u=(i?Promise.all([i,s]):s).then(B.bind(null,o));var l=st(a,r,n);var d=it(r,u,a,l);e.oBusyHelper.setBusy(d,undefined,undefined,true);return d}function ct(e,t,r,n){if(typeof e==="string"){var a=e;var o=I(a);if(o==="/"){return lt(r)}var i=o.split("/");var s=i.length-1;var u=[];var l;switch(s){case 1:l=i[1].split("(")[0];break;default:l="";var d="";for(var p=0;p<s;p++){var c=i[p+1];var f=c.indexOf("(");if(f>0){c=c.substring(0,f)}l=l+d+c;d="/"}l=l.replace(g.getEmbeddedComponentsPatternDelimiter(),"/")}dt(u,n||0);return pt(l,a,s,r)}return Ie(e,r,n)}function ft(t,r){M.componentsDisplayed[t]=r;var n=e.mRoutingTree[t];var a=n.componentId;if(a){var o=e.componentRegistry[a];var i=o.utils.getTemplatePrivateModel();i.setProperty("/generic/isActive",r===1)}}function vt(t){var r,n,o,i,s,u=null,l,d;if(t){r=t.entitySet;n=t.text;u=t.icon;d=t.description}if(r){l=e.oAppComponent.getModel().getMetaModel();if(l){o=l.getODataEntitySet(r);i=l.getODataEntityType(o.entityType);s=i["com.sap.vocabularies.UI.v1.HeaderInfo"]}if(s&&s.TypeImageUrl&&s.TypeImageUrl.String){u=s.TypeImageUrl.String}}e.oTemplatePrivateGlobalModel.setProperty("/generic/messagePage",{text:n,icon:u,description:d});if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.displayMessagePage(t,M.componentsDisplayed)}else{var p=a.oRouter.getTargets();if(!e.ghostapp){p.display("messagePage")}for(var c in M.componentsDisplayed){ft(c,5)}}ue(t)}function gt(){if(!r(U)){var e=null;for(var t=0;!e;t++){e=U[t]}U={};vt(e)}}function yt(t){if(e.oAppComponent.isDestroyed()){return}if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.hidePlaceholder();t.viewLevel=t.viewLevel||0;U[t.viewLevel]=t;var r=Promise.all([W,e.oPagesDataLoadedObserver.getProcessFinished(true)]);r.then(gt);r.then(e.oBusyHelper.setBusyReason.bind(null,"HashChange",false,undefined,undefined,true));return}e.oNavigationHost.hidePlaceholder();vt(t);e.oBusyHelper.setBusyReason("HashChange",false,undefined,undefined,true)}function mt(){var t=[];if(F){var r=F.componentsDisplayed||M.componentsDisplayed;for(var n in e.componentRegistry){var a=e.componentRegistry[n];if(r[a.route]===1){t.push(n)}}}return t.sort(function(t,r){return e.componentRegistry[t].viewLevel-e.componentRegistry[r].viewLevel})}function ht(){var t=[];for(var r in e.componentRegistry){t.push(r)}return t}function bt(e){return F.keys.slice(0,e+1)}function Ct(){var t=F.treeNode.componentId;var r=e.componentRegistry[t];var n=!!r.nonDraftCreateContext;if(n){var a=Object.assign({},M);a.isNonDraftCreate=n;return a}return M}function Nt(t){return e.oApplicationProxy.getAncestralNode(F.treeNode,t)}function Pt(t,r){return t?new Promise(function(n,a){var o=H.getAppState(e.oAppComponent,t);o.done(function(e){var t=e.getData();if(t===undefined){a(undefined);return}if(r){t=u.deStringify(t)}n(t)});o.fail(a.bind(null,undefined))}):Promise.reject()}function kt(t,r,n){var a=n.getId();var o=e.componentRegistry[a];var i=bt(o.viewLevel);var s=o.route;var u=r.componentsDisplayed[s];var l=u===1;var d=function(t){o.sCurrentBindingPath=t;var r=function(){o.utils.bindComponent(o.sCurrentBindingPath,l);if(a===F.treeNode.componentId){var r=Object.create(null);r.root=true;for(var n=F.treeNode;n.level>0;n=e.mRoutingTree[n.parentRoute]){r[n.sRouteName]=true;n.bindElement(e.oNavigationHost,null,true);if(n.contextTargets){for(var i=0;i<n.contextTargets.length;i++){var s=n.contextTargets[i];n.bindElement(s,null,false)}}}for(var u in e.mRoutingTree){if(!r[u]){var d=e.mRoutingTree[u];d.unbindElement(e.oNavigationHost,true);if(d.contextTargets){d.contextTargets.forEach(d.unbindElement)}}}}o.utils.refreshBinding();o.oStatePreserverPromise.then(function(e){e.applyAppState(t,l)});return(o.methods.onActivate||Function.prototype)(t,l)};var n=o.fnViewRegisteredResolve?o.viewRegistered.then(r):r()||Promise.resolve();return Promise.all([n,o.viewRegistered]).then(function(){o.aKeys=i;var e=o.reactivate;if(e){delete o.reactivate;e.then(function(e){e()})}})};M.componentsDisplayed[s]=1;var p=e.mRoutingTree[s];z[Math.min(p.fCLLevel,2)]=a;if(r.isNonDraftCreate&&t==="-"){var c=e.mRoutingTree[p.parentRoute];var v=c.getPath(2,i);var g=e.oAppComponent.getModel();var y=v?new Promise(function(t){var r={canonicalRequest:!e.bCreateRequestsCanonical};g.createBindingContext(v,null,r,t)}):Promise.resolve();return y.then(function(t){var r=t?p.navigationProperty:"/"+n.getEntitySet();var a=F.appStates[S];var i=Pt(a,true);var s=function(n){o.nonDraftCreateContext=Je||o.nonDraftCreateContext||f.createNonDraft(t,r,g,n,e.oApplicationProxy.mustRequireRequestsCanonical());Je=null;return d(o.nonDraftCreateContext.getPath())};return i.then(s,s)})}delete o.nonDraftCreateContext;return d(t)}function Rt(e,t,r){return kt(e,t,r).then(le)}function Ht(t,r,n){var a={};if(r||n){var o=t.level;for(var i=0;i<o;i++){a[i]=e.oPaginatorInfo[i]}}e.oPaginatorInfo=a}function St(t){return e.oApplicationProxy.getAlternativeIdentityPromise(t)}var Tt=Object.create(null);function Lt(t,r){if(Tt[t.sRouteName]||e.oAppComponent.isDestroyed()){return}C.debug("Prepare host view for route "+t.sRouteName);var n=a.createHostView();Tt[t.sRouteName]=n;var o=a.oRouter.getViews();o.setView(t.sRouteName,n);var i=n.byId("host");_t(i,t.sRouteName,r)}function It(t){var r=e.mRoutingTree;if(r[t]){C.debug("Start preloading of component for route "+t);Lt(r[t],true)}}function Bt(t){j=false;_.stop();J.startProcess();He(t);Lt(F.treeNode);F.treeNode.display();if(e.oFlexibleColumnLayoutHandler){V=e.oFlexibleColumnLayoutHandler.handleBeforeRouteMatched(F)}}function At(){var e={isInitialNavigation:w,historicalEntries:[]};for(var r=M;r.iHashChangeCount>0;r=O[r.backTarget]){var n=r===M?F:r.identity;var a=n.treeNode&&{sRouteName:n.treeNode.sRouteName,keys:n.keys,appStates:n.appStates};e.historicalEntries.push(a)}s.setData(e);s.save();var o=F.appStates[T];if(o===b||!(o||M.backTarget||w)){return false}E=null;he({identity:{treeNode:F.treeNode,keys:F.keys,appStates:t(Object.create(null),F.appStates)},mode:1});return true}function xt(){J.stopProcess();var t=I(a.oHashChanger.getHash()||"");var r;if(E&&E.followUpNeeded){if(E.identity){if(!fe(E.identity)){he();return}}else{var n=E.followUpNeeded;r=M;r.LeaveByBack=E.mode===-1;O.push(r);M={iHashChangeCount:r.iHashChangeCount+1,identity:F,hash:t,backTarget:r.LeaveByBack?O[r.backTarget].backTarget:r.iHashChangeCount,componentsDisplayed:Object.create(null)};E=null;he(n);return}}e.oBusyHelper.setBusyReason("HashChange",false,undefined,undefined,true);var o=F.treeNode.level;C.info("Route matched with hash "+t);if(M.backwardingInfo){r=M;r.identity=F.previousIdentity;delete F.previousIdentity;O.push(r);var i=r.iHashChangeCount+1;M={iHashChangeCount:i,forwardingInfo:{bIsProgrammatic:true,bIsBack:true,iHashChangeCount:i,targetHash:r.backwardingInfo.targetHash,componentsDisplayed:r.componentsDisplayed},backTarget:O[r.backwardingInfo.index].backTarget,componentsDisplayed:Object.create(null)}}if(M.forwardingInfo&&M.forwardingInfo.targetHash&&M.forwardingInfo.targetHash!==t){M.hash=t;var s=M.forwardingInfo.targetHash;delete M.forwardingInfo.targetHash;ot(s,true);return}var u=false;for(var l=0;l<e.aStateChangers.length;l++){var d=e.aStateChangers[l];if(d.isStateChange(F.appStates)){u=true}}if(u){E=null;M.hash=t;if(!At()){_.start()}return}e.oTemplatePrivateGlobalModel.setProperty("/generic/routeLevel",o);var p=M.forwardingInfo;delete M.forwardingInfo;if(!p){p={componentsDisplayed:M.componentsDisplayed,isNonDraftCreate:!F.treeNode.isDraft&&F.keys[F.treeNode.level]==="-"};var c=M.iHashChangeCount;p.iHashChangeCount=c+1;var f=P.getDirection();if(E){p.bIsProgrammatic=!!E.identity;p.bIsBack=E.mode<0;if(p.bIsBack){M.backSteps=0-E.mode}p.bIsForward=!p.bIsBack&&f===N.Forwards;M.LeaveByReplace=E.mode===1}else{p.bIsProgrammatic=t===M.targetHash;p.bIsBack=!!(M.LeaveByBack||!p.bIsProgrammatic&&f===N.Backwards);p.bIsForward=!p.bIsBack&&f===N.Forwards;M.LeaveByReplace=p.bIsProgrammatic&&M.LeaveByReplace;if(!p.bIsProgrammatic&&F.previousIdentity&&F.previousIdentity.treeNode.level>0&&!F.previousIdentity.treeNode.isDraft){var v=F.treeNode!==F.previousIdentity.treeNode;for(var g=1;!v&&g<F.keys.length;g++){v=F.keys[g]!==F.previousIdentity.keys[g]}if(v){var y=e.componentRegistry[F.previousIdentity.treeNode.componentId];var m=y.oComponent.getModel("ui");if(m.getProperty("/editable")){y.utils.cancelEdit()}}}}M.LeaveByBack=p.bIsBack;r=M;r.identity=F.previousIdentity;delete F.previousIdentity;O.push(r);M={iHashChangeCount:p.iHashChangeCount,componentsDisplayed:Object.create(null)};if(r.LeaveByReplace){M.backTarget=r.backTarget}else if(p.bIsBack){var h=r.backTarget;for(var b=r.backSteps||1;b>0;b--){h=O[h].backTarget}M.backTarget=h}else{M.backTarget=c}}M.hash=t;var k=function(t){E=null;if(t){var n,a;if(ce(r.identity,t.identity)){n=M.backTarget&&O[M.backTarget];a=-1}else if(t.identity.treeNode.level===0){lt();return}else{n=t.identity;var o=M.backTarget&&O[M.backTarget];a=o&&o.treeNode===n.treeNode?-1:1}var i={identity:n,mode:a,displayMode:t.displayMode};he(i);return}if(At()){return}Ht(F.treeNode,p.bIsProgrammatic,p.bIsBack);if(e.oFlexibleColumnLayoutHandler){W=e.oFlexibleColumnLayoutHandler.handleRouteMatched(p)}else{W=F.treeNode.componentCreated.then(function(e){return Rt(p.isNonDraftCreate?"-":F.treeNode.getPath(2,F.keys),p,e)})}e.oBusyHelper.setBusy(W,undefined,undefined,true);W.then(_.start)};if(p.bIsBack&&!(E&&E.identity)){e.oBusyHelper.setBusy(St(F).then(k),undefined,undefined,true)}else{k()}}function Dt(){var t=Promise.all([V,G.then(function(){return e.oStatePreserversAvailablePromise})]);var r=t.then(xt,e.oBusyHelper.setBusyReason.bind(null,"HashChange",false,undefined,undefined,true));e.oBusyHelper.setBusy(r,undefined,undefined,true);Et()}function wt(t){O.push(M);var r;var n;var a;if(t){w=t.isInitialNavigation;n=t.serializedBackOption;a=t.focus;for(var o=t.historicalEntries.length;o>0;o--){var i=t.historicalEntries[o-1];r={iHashChangeCount:O.length,backTarget:O.length-1};if(i){r.identity={treeNode:e.mRoutingTree[i.sRouteName],keys:i.keys,appStates:i.appStates}}O.push(r)}}else{r={iHashChangeCount:1,backTarget:0,identity:F};O.push(r)}q(r,n,a);Dt()}function Ot(){if(R()){Ft()}if(x&&!O.length){var e=F.appStates[T];var t=Pt(e);t.then(wt,wt);return}Dt()}function Ft(){if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.hidePlaceholder()}else{e.oNavigationHost.hidePlaceholder()}}function Mt(){F={appStates:Object.create(null),keys:[]};yt({title:e.getText("ST_ERROR"),text:e.getText("ST_GENERIC_UNKNOWN_NAVIGATION_TARGET"),description:""});e.oBusyHelper.setBusyReason("HashChange",false,undefined,undefined,true)}function Et(){var t=function(e){if(!e.selectionInfo){return false}for(var t=1;t<=e.level;t++){if(e.selectionInfo.keys[t]!==F.keys[t]){return false}}return true};var r=function(e,t,r,n){if(e.selectionInfo===t){r.setProperty("/generic/currentActiveChildContext",n)}};for(var n,a=F.treeNode;a;a=n){n=a.parentRoute&&e.mRoutingTree[a.parentRoute];if(n){n.selectionInfo={pageEntitySet:a.entitySet,path:a.getPath(3,F.keys),keys:F.keys.slice(0,a.level+1)}}var o=a.componentId&&e.componentRegistry[a.componentId];if(o){var i=o.utils.getTemplatePrivateModel();if(t(a)){var s=a.selectionInfo;i.setProperty("/generic/currentActiveChildContext",s.path);if(o.oController.onChildOpenedExtension){o.oController.onChildOpenedExtension(s,r.bind(null,a,s,i))}}else{a.selectionInfo=null;i.setProperty("/generic/currentActiveChildContext","")}}}}a.oRouter.attachBeforeRouteMatched(Bt);a.oRouter.attachRouteMatched(Ot);a.oRouter.attachBypassed(Mt);var jt=[];function Ut(e,t){a[e]=t;jt.push(e)}function Kt(){jt.forEach(function(e){a[e]=_.makeQueuable(a[e])});a.routerInitialized=Function.prototype}function zt(e){G=Promise.all([G,e.componentCreated])}function Vt(e,t){for(var r in t){var n=t[r];e.setModel(n,r||undefined)}}function _t(r,n,a){C.debug("Create TemplateComponent for route "+n);var o=e.mRoutingTree[n];var i=o.page.component.name;var s=o.entitySet;var u=o.fCLLevel-(o.fCLLevel===3||!e.oFlexibleColumnLayoutHandler);var l=u<0?e.oNavigationObserver:e.aNavigationObservers[u];var p=new d;var c=u<0?e.oHeaderLoadingObserver:e.aHeaderLoadingObservers[u];c.addObserver(p);var f=new k;var v={appComponent:e.oAppComponent,isLeaf:!o.page.pages||!o.page.pages.length,entitySet:s,navigationProperty:o.navigationProperty,componentData:{registryEntry:{oAppComponent:e.oAppComponent,route:n,routeConfig:o.page,viewLevel:o.level,routingSpec:o.page.routingSpec,oNavigationObserver:l,oHeaderLoadingObserver:p,preprocessorsData:f}}};if(o.page.component.settings){t(v,o.page.component.settings)}e.oAppComponent.runAsOwner(function(){var t=e.oAppComponent.createId(v.componentData.registryEntry.routeConfig.component.name+"::"+v.componentData.registryEntry.routeConfig.entitySet);C.debug("Start to create component "+t+" for route "+n);var o=sap.ui.core.Component.create({name:i,settings:v,handleValidation:true,manifest:true,id:t});e.oAppComponent.registerForDestroy(o);return o.then(function(t){C.debug("Component for route "+n+" was created");if(a){Vt(r,e.oAppComponent.oModels);r.setComponent(t);t.onBeforeRendering()}else{r.setComponent(t)}})})}function qt(){j=true}function Qt(e){if(j){j=false;return false}if(E){return false}if(e.isCrossAppNavigation){return true}var t=a.oRouter.getRouteInfoByHash(e.innerAppRoute);var r=Re(t.name,t.arguments);return r.treeNode!==F.treeNode||r.keys.some(function(e,t){return e!==F.keys[t]})}function Gt(t){return t.isDraft?e.oApplicationProxy.getAncestralNode(t,1):t}function Wt(){if(F.treeNode.level===0){return false}var t=s.getData().historicalEntries;if(t.length===1||t[1].sRouteName==="root"){return true}if(t[0].keys.length===2&&t[1].keys.length===2){var r=[],n=[];t[0].keys[1].split(",").forEach(function(e){r.push(e.split("=")[0])});t[1].keys[1].split(",").forEach(function(e){n.push(e.split("=")[0])});if(JSON.stringify(r)===JSON.stringify(n)){return true}}var a=Gt(F.treeNode);var o=e.mRoutingTree[t[1].sRouteName];var i=Gt(o);return a!==i}function Jt(t,r){if(!r){return t.viewLevel>0}if(t.viewLevel>0&&t.entitySet===r){return false}var n=e.mEntityTree[r];if(!n){return false}if(n.fCLLevel===0||n.level<=t.level){return true}return e.oFlexibleColumnLayoutHandler.willBeOpenedInFullscreen(n)}a.routerInitialized=Kt;a.treeNodeFirstDisplay=zt;a.navigate=ot;Ut("navigateBack",he.bind(null,{mode:-1}));a.activateOneComponent=kt;a.afterActivation=le;a.addUrlParameterInfoForRoute=ie;a.getApplicableStateForIdentityAddedPromise=ae;a.adaptAppStates=oe;a.setVisibilityOfRoute=ft;a.getActiveComponents=mt;a.getAllComponents=ht;a.getRootComponentPromise=$;a.getActivationInfo=Ct;a.navigationWillLeavePage=Jt;a.getCurrentKeys=bt;a.getAppTitle=ee;a.getParsedShellHashFromFLP=re;a.isDiscardDraftConfirmationNeeded=te;Ut("navigateByExchangingQueryParam",Se);Ut("navigateToSubContext",Ie);Ut("navigateToDetailContextIfPossible",Be);a.getSwitchToSiblingFunctionPromise=Oe;a.getSwitchToSiblingPromise=Fe;a.getNavigationFunction=xe;a.getSpecialDraftCancelOptionPromise=Ae;a.getRootIdentityPromise=ut;a.setBackNavigationOption=De;a.getCurrentIdentity=de;Ut("navigateToIdentity",je);Ut("navigateAfterActivation",Ge);Ut("navigateUpAfterDeletion",We);Ut("navigateForNonDraftCreate",Xe);Ut("adaptUrlAfterNonDraftCreateSaved",Ye);Ut("navigateToChildInHierarchy",et);Ut("navigateFromNodeAccordingToContext",tt);a.isNavigating=nt;a.getLinksToUpperLayers=ke;a.setTextForTreeNode=be;Ut("navigationContextNotFound",Ue);Ut("navigateToMessageTarget",rt);a.clearHistory=_.makeQueuable(Z.bind(null,true));a.suspend=X;a.restore=Q.bind(null,false);a.leave=Y;a.prepareHostView=Lt;a.preloadComponent=It;a.navigateToMessagePage=yt;a.getAppStateFromShell=Pt;a.userHasAcceptedDataLoss=qt;a.unwantedDataLossPossible=Qt;a.isBackLeavingTheEditScope=Wt;var _t=c.testable(_t,"createTemplateComponent");var re=c.testable(re,"getParsedShellHashFromFLP");var It=c.testable(It,"preloadComponent");c.testable(function(e){a.createHostView=e},"setCreateHostView");c.testable(function(e){Lt=e},"setPrepareHostView");e.oBusyHelper.setBusy((re()||Promise.resolve()).then(function(t){var r=t&&t.parseParameters(document.location.search);e.bEnablePlaceholder=!(r&&r["sap-ui-xx-placeholder"]&&r["sap-ui-xx-placeholder"][0]==="false");var n=H.createEmptyAppStateAsync(e.oAppComponent,true).then(function(e){s=e;b=s.getKey()});return n.then(function(){return g.generateRoutingStructure(e).then(Q.bind(null,true))})}),undefined,undefined,true);return{navigateToRoot:_.makeQueuable(lt),navigateToContext:_.makeQueuable(ct),navigateToMessagePage:yt,navigateBack:function(){a.navigateBack()}}}function D(e,r){var n=r.oAppComponent.getRouter();var a={oAppComponent:r.oAppComponent,oRouter:n,oHashChanger:n.getHashChanger(),oTemplateContract:r};r.oNavigationControllerProxy=a;var o=new Promise(function(e){a.initialize=function(t){n.initialize(t);e();a.routerInitialized()};a.fnInitializationResolve=e});r.oBusyHelper.setBusy(o,undefined,undefined,true);t(e,x(r,a))}var w=e.extend("sap.suite.ui.generic.template.lib.navigation.NavigationController",{metadata:{library:"sap.suite.ui.generic.template"},constructor:function(t){e.apply(this,arguments);c.testableStatic(D,"NavigationController")(this,t)}});w._sChanges="Changes";return w});
//# sourceMappingURL=NavigationController.js.map