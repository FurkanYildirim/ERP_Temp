sap.ui.define(["sap/ui/base/Object","sap/ui/Device","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/ActionSheet","sap/m/Dialog","sap/m/Popover","sap/suite/ui/generic/template/lib/deletionHelper","sap/suite/ui/generic/template/lib/navigation/routingHelper","sap/suite/ui/generic/template/lib/ContextBookkeeping","sap/suite/ui/generic/template/lib/CRUDHelper","sap/suite/ui/generic/template/lib/FocusHelper","sap/suite/ui/generic/template/lib/MessageUtils","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/suite/ui/generic/template/genericUtilities/oDataModelHelper","sap/ui/core/syncStyleClass","sap/base/util/extend","sap/ui/core/Fragment","sap/ui/generic/app/navigation/service/NavigationHandler","sap/suite/ui/generic/template/lib/KeepAliveHelper","sap/m/MessageBox"],function(e,t,n,r,o,i,a,s,u,l,g,c,f,v,p,m,d,y,C,P,h,x){"use strict";var N={storeInnerAppStateWithImmediateReturn:function(){return{promise:{fail:Function.prototype}}},parseNavigation:function(){return{done:function(e){setTimeout(e.bind(null,{},{},sap.ui.generic.app.navigation.service.NavType.initial),0)},fail:Function.prototype}}};var b=new p("lib.Application").getLogger();var S=v.testableStatic(function(e,t){var n="sapUiSizeCozy",r="sapUiSizeCompact";if(t&&(t.classList.contains(n)||t.classList.contains(r))){return""}else{return e?n:r}},"Application_determineContentDensityClass")(t.support.touch,document.body);function T(){return S}function D(e,t){d(S,t,e);t.addDependent(e)}var M=false;var D=v.testableStatic(D,"Application_attachControlToParent");function A(e){var t=new c(e);var u=new l(e);var v=Object.create(null);var p=Object.create(null);var d=new h(e);function y(t){var n=e.oNavigationControllerProxy.getActiveComponents();return n.indexOf(t.getId())>=0}var S=false;function A(t){e.fnAddSideEffectPromise(t)}function F(e,t){return Promise.resolve().then(R.bind(null,e,t))}function R(t,n){if(S){return Promise.reject()}var r=e.aRunningSideEffectExecutions.filter(function(e){return!!e});if(r.length){S=true;return Promise.all(r).then(function(){S=false;return R(t,n)})}if(n&&e.oBusyHelper.isBusy()){return Promise.reject(typeof n==="function"?n():undefined)}return t()}function I(t){var n;if(t instanceof i){n="open"}else if(t instanceof a||t instanceof o){n="openBy"}if(n){var r=t[n];t[n]=function(){var n=arguments;F(function(){if(!e.oBusyHelper.isBusy()){e.oBusyHelper.getUnbusy().then(function(){r.apply(t,n)})}})}}}var B={};function w(t,r,o,i,a){t=t||e.oNavigationHost;var s=t.getId();var u=B[s]||(B[s]={});var l=u[r];if(!l){return C.load({id:s,name:r,controller:o}).then(function(e){D(e,t);var o;if(i){o=new n;e.setModel(o,i)}(a||Function.prototype)(l,o);u[r]=e;I(e);return e})}return Promise.resolve(l)}function E(t,r,o,i,a,s,u){return new Promise(function(l){t=t||e.oNavigationHost;var g=t.getId();var c=B[g]||(B[g]={});var f=c[r];if(!f||s){if(f){f.destroy()}C.load({id:g,name:r,controller:o,type:"XML"}).then(function(e){f=e;D(e,t);var o;if(i){o=new n;e.setModel(o,i)}(a||Function.prototype)(e,o);c[r]=e;if(!u){I(e)}l(f)});return}l(f)})}function H(){return new Promise(function(t){e.oNavigationObserver.getProcessFinished(true).then(function(){e.oBusyHelper.getUnbusy().then(t)})})}function L(){if(e.oNavigationControllerProxy.isBackLeavingTheEditScope()){var t=e.oNavigationControllerProxy.getCurrentIdentity();var n=t.treeNode.isDraft?e.oPageLeaveHandler.performAfterDiscardOrKeepDraft:e.oDataLossHandler.performIfNoDataLoss;n(e.oNavigationControllerProxy.navigateBack,Function.prototype,"LeavePage")}else{F(e.oNavigationControllerProxy.navigateBack,true)}}function O(t,n,r){var o=g.createNonDraft(null,"/"+t,e.oAppComponent.getModel(),n,ye());if(r){r.aCreateContexts=r.aCreateContexts||[];r.aCreateContexts.push({entitySet:t,context:o,predefinedValues:n})}return o}function k(t){e.oNavigationControllerProxy.navigateForNonDraftCreate(t.entitySet,t.predefinedValues,t.context)}function j(t){var n=e.oNavigationControllerProxy.getActiveComponents();for(var r=0;r<n.length;r++){var o=e.componentRegistry[n[r]];o.utils.onBeforeDraftTransfer(t)}}function U(e,t){j(t);u.activationStarted(e,t)}function K(e,t,n,r){j(t);u.cancellationStarted(e,t,n,r)}function q(e,t){j(t);u.editingStarted(e,t)}function V(e){return u.checkmPath2ContextData(e)}function z(t){e.aStateChangers.push(t)}function Q(e,t){t.then(function(){u.adaptAfterObjectDeleted(e)},Function.prototype)}function _(){return e.oNavigationControllerProxy.getLinksToUpperLayers()}function J(){var t=e.oNavigationControllerProxy.getActiveComponents();var n=0;var r;for(var o=0;o<t.length;o++){var i=e.componentRegistry[t[o]];if(i.viewLevel>0&&(n===0||i.viewLevel<n)){n=i.viewLevel;r=i.oComponent}}var a=r?Promise.resolve(r):e.oNavigationControllerProxy.getRootComponentPromise();return a.then(function(e){return e.getModel("i18n").getResourceBundle()})}function W(){return e.oNavigationControllerProxy.getAppTitle()}function X(t){return e.oNavigationControllerProxy.getCurrentKeys(t)}function G(t,n){var r=e.oNavigationControllerProxy.getCurrentIdentity();var o=r.treeNode;if(o.level!==1||o.entitySet!==t||r.keys[1]!==n){return false}var i=e.componentRegistry[o.componentId];var a=i.oComponent.getModel("ui");return a.getProperty("/editable")}function Y(t,n){var r=t;for(;r.level>n;){r=e.mRoutingTree[r.parentRoute]}return r}var Z;function $(t,n){var r=n||0;if(r>0){return null}var o=t.getId();var i=e.componentRegistry[o];var a=e.mRoutingTree[i.route];var s=a.communicationObject;for(;r<0&&s;){a=e.mRoutingTree[a.parentRoute];if(a.communicationObject!==s){r++;s=a.communicationObject}}if(r<0||s){return s}Z=Z||{};return Z}function ee(t){for(var n in e.mEntityTree){if(e.mEntityTree[n].navigationProperty&&e.mEntityTree[n].level===t+1){return e.mEntityTree[n].navigationProperty}}}function te(){var t=e.oNavigationControllerProxy.getCurrentIdentity();for(var n=t.treeNode;n.level>0;n=e.mRoutingTree[n.parentRoute]){if(n.level===1&&n.isDraft){var r=n.getPath(3,t.keys);u.markDraftAsModified(r);return}}}function ne(t){if(v[t]===undefined){var n=e.oAppComponent.getModel();var r=n.getMetaModel();var o=r.getODataEntitySet(t);if(o){var i=n.mContexts;var a;for(a in i){var s=i[a];var u=m.analyseContext(s).entitySet;if(u===t){var l=s.getPath();var g=n.getProperty(l);var c=n.getETag(undefined,undefined,g);v[t]=!!c;break}}}}return v[t]||v[t]===undefined}function re(t){var n,r,o;var i=e.oNavigationControllerProxy.getAllComponents();for(n=0;n<i.length;n++){r=i[n];if(!t||!t[r]){o=e.componentRegistry[r];o.utils.refreshBinding(true)}}}function oe(t){if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.setStoredTargetLayoutToFullscreen(t)}}function ie(){e.oPaginatorInfo={}}function ae(t,n){var r=p[t];if(!r){r=Object.create(null);p[t]=r;var o=e.oAppComponent.getModel();var i=o.getMetaModel();var a=i.getODataEntitySet(t);var s=a&&i.getODataEntityType(a.entityType);var u=s&&s.navigationProperty||[];for(var l=0;l<u.length;l++){var g=u[l];r[g.name]=g}}return r[n]}function se(t,n){var r=e.oNavigationControllerProxy.getSwitchToSiblingPromise(t,2,n);e.oBusyHelper.setBusy(r.then(function(e){e()}))}function ue(t,n){var r=e.oNavigationControllerProxy.getSpecialDraftCancelOptionPromise(t);if(r){return n?r:r.then(function(t){return e.oNavigationControllerProxy.getNavigationFunction(t)})}var o=u.getDraftSiblingPromise(t);var i=e.oNavigationControllerProxy.getCurrentIdentity();var a=e.componentRegistry[i.treeNode.componentId];var l=a&&a.utils.getTargetKeyFromLevel(2);return Promise.all([o,l]).then(function(t){var r=t[0];var o=r&&r.getObject();var i=o&&o.IsActiveEntity;if(!i){if(n){var a=e.oNavigationControllerProxy.getRootIdentityPromise();return a.then(function(e){return{identity:e,mode:1,displayMode:1}})}return s.getNavigateAfterDeletionOfCreateDraft(e)}return e.oNavigationControllerProxy.getSwitchToSiblingPromise(r,1,t[1],n).then(function(e){return n?{identity:e,mode:1,displayMode:1}:function(){var t=r.getModel();t.invalidateEntry(r);return e()}})})}function le(t,n){var r=[];for(var o=t;o.level>=n;o=e.mRoutingTree[o.parentRoute]){r.push(o);if(o.level===0){break}}return r.reverse()}function ge(t,n,r,o){if(r.length===0){r.push("")}if(t.level<r.length){r.splice(t.level+1,r.length-t.level-1);return Promise.resolve(t)}var i=le(t,r.length);var a=i.map(function(e){if(e.noKey||e.level===0){return Promise.resolve(true)}if(!e.isDraft){return Promise.resolve(n[e.level])}var t=e.getPath(3,n);var r=u.getSiblingPromise(t,o);return r.then(function(e){var t=e&&m.analyseContext(e);return t&&t.key},Function.prototype)});return Promise.all(a).then(function(t){var n=e.mRoutingTree[i[0].parentRoute];t.every(function(e,t){if(e){r.push(e===true?"":e);n=i[t]}return e});return n})}function ce(t,n){return e.oNavigationControllerProxy.getSwitchToSiblingFunctionPromise(t,n)}function fe(t,n){return e.oNavigationControllerProxy.navigateAfterActivation(t,n)}function ve(t,n,r,o){e.oNavigationControllerProxy.navigateToSubContext(t,n,r,o)}function pe(t,n,r,o){return e.oNavigationControllerProxy.navigateToDetailContextIfPossible(t,n,r,o)}function me(t,n){e.oNavigationControllerProxy.navigateByExchangingQueryParam(t,n)}function de(){return!e.bCreateRequestsCanonical}function ye(){return!e.bCreateRequestsCanonical}function Ce(e){return u.checkIfObjectIsADraftInstance(e)}function Pe(e){return u.getContextForPath(e)}function he(){var t=e.oAppComponent.getStatePreservationMode();if(t==="auto"){return e.oFlexibleColumnLayoutHandler?"persistence":"discovery"}return t}var xe;function Ne(){if(!xe){xe=new P(e.oAppComponent);if(xe.registerNavigateCallback){xe.registerNavigateCallback(function(t){var n=function(){e.oBusyHelper.setBusyReason("exiting",false)};t.then?t.then(n):t.done(n)})}}return e.ghostapp?N:xe}function be(n,r,o,i,a,s,u){var l=Ne();if(l===N){return}e.oNavigationControllerProxy.leave();var g=function(){t.setNextFocus(Function.prototype);e.oBusyHelper.setBusyReason("exiting",false);if(a){a.apply(this,arguments)}};e.oBusyHelper.setBusyReason("exiting",true);l.navigate(n,r,o,i,g,s,u)}function Se(e){M=e}function Te(){return M}function De(){return e.mRoutingTree.root.page.component.settings&&e.mRoutingTree.root.page.component.settings.editFlow}function Me(t,n){var r=t.getId();var o=e.componentRegistry[r];return Promise.resolve(o.methods.prepareForControlNavigation&&o.methods.prepareForControlNavigation(n))}function Ae(t,n){return e.oNavigationControllerProxy.navigateToMessageTarget(t,n)}var Fe;var Re=sap.ui.getCore().getMessageManager().getMessageModel();function Ie(e,t,n){Be();var r;if(!t||!Re.getProperty("/").some(function(e,n){if(t===e){var o="/"+n+"/controllIds";r=Re.bindProperty(o);return true}})){return}Fe={};var o=function(){Be();f.navigateFromMessageTitleEvent(e,t,n,false)};r.attachChange(o);Fe.deregister=function(){r.detachChange(o);r.destroy();Fe=null}}function Be(){if(Fe){Fe.deregister()}}var we=[];function Ee(e){we.push(e)}function He(e){return!we.some(function(t){return t.isCustomMessage(e)})}function Le(){f.removeTransientMessages(He)}function Oe(){return f.getTransientMessages(false,He)}function ke(){return e.myIntentPromise}function je(t){var n=e.oNavigationControllerProxy.getActiveComponents();var r=n.map(function(n){var r=e.componentRegistry[n];return r.oStatePreserverPromise.then(function(e){e.setState(t)})});e.oBusyHelper.setBusy(Promise.all(r))}function Ue(t){var n=e.mEntityTree[t];var r=n&&n.componentId&&e.componentRegistry[n.componentId];return r&&r.utils}function Ke(t){e.oNavigationControllerProxy.preloadComponent(t)}e.oApplicationProxy={getDraftSiblingPromise:u.getDraftSiblingPromise,getSiblingPromise:u.getSiblingPromise,fillSiblingKeyPromise:ge,getAlternativeIdentityPromise:u.getAlternativeIdentityPromise,getPathOfLastShownDraftRoot:u.getPathOfLastShownDraftRoot,areTwoKnownPathesIdentical:u.areTwoKnownPathesIdentical,getIdentityKeyForContext:u.getIdentityKeyForContext,getNavigateAfterDraftCancelPromise:ue,navigateAfterActivation:fe,getAncestralNode:Y,getResourceBundleForEditPromise:J,getContentDensityClass:T,getDialogFragment:w.bind(null,null),getDialogFragmentAsync:E.bind(null,null),destroyView:function(e){delete B[e]},markCurrentDraftAsModified:te,prepareDeletion:Q,performAfterSideEffectExecution:F,onBackButtonPressed:L,mustRequireRequestsCanonical:ye,cancellationStarted:K,checkIfObjectIsADraftInstance:Ce,getContextForPath:Pe,invalidatePaginatorInfo:ie,deregisterForMessageNavigation:Be,isTransientMessageNoCustomMessage:He,removeTransientMessages:Le,getTransientMessages:Oe,setNextFocus:t.setNextFocus,setStates:je};return{createNonDraft:O,navigateToNonDraftCreateContext:k,getContentDensityClass:T,attachControlToParent:D,getDialogFragmentForView:w,getDialogFragmentForViewAsync:E,getBusyHelper:function(){return e.oBusyHelper},addSideEffectPromise:A,performAfterSideEffectExecution:F,isComponentActive:y,showMessageToast:function(){var t=arguments;var n=function(){b.info("Show message toast");r.show.apply(r,t)};Promise.all([H(true),e.oBusyHelper.getUnbusy()]).then(n)},showMessageBox:function(){var t=arguments;var n=function(){b.info("Show message box");x.show.apply(x,t)};Promise.all([H(true),e.oBusyHelper.getUnbusy()]).then(n)},registerStateChanger:z,getDraftSiblingPromise:u.getDraftSiblingPromise,registerContext:u.registerContext,activationStarted:U,cancellationStarted:K,editingStarted:q,checkContextData:V,getLinksToUpperLayers:_,getAppTitle:W,getCurrentKeys:X,isObjectInEditMode:G,getCommunicationObject:$,getForwardNavigationProperty:ee,markCurrentDraftAsModified:te,checkEtags:ne,refreshAllComponents:re,getIsDraftModified:u.getIsDraftModified,prepareDeletion:s.prepareDeletion.bind(null,e),setStoredTargetLayoutToFullscreen:oe,invalidatePaginatorInfo:ie,getNavigationProperty:ae,switchToDraft:se,getNavigateAfterDraftCancelPromise:ue,getSwitchToSiblingFunctionPromise:ce,navigateAfterActivation:fe,navigateToSubContext:ve,navigateToDetailContextIfPossible:pe,navigateByExchangingQueryParam:me,navigateToMessageTarget:Ae,registerForMessageNavigation:Ie,onBackButtonPressed:L,needsToSuppressTechnicalStateMessages:de,mustRequireRequestsCanonical:ye,getNavigationHandler:Ne,navigateExternal:be,getStatePreservationMode:he,setObjectInEditMode:Se,getObjectInEditMode:Te,getEditFlowOfRoot:De,getLeaveAppPromise:function(){return e.leaveAppPromise},getComponentRefreshBehaviour:function(e){return d.getComponentRefreshBehaviour(e)},getChevronNavigationRefreshBehaviour:function(e){return d.getChevronNavigationRefreshBehaviour(e)},prepareForControlNavigation:Me,registerCustomMessageProvider:Ee,isTransientMessageNoCustomMessage:He,removeTransientMessages:Le,getTransientMessages:Oe,setNextFocus:t.setNextFocus,getIntentPromise:ke,getComponentUtilsIfLoaded:Ue,preloadComponent:Ke}}return e.extend("sap.suite.ui.generic.template.lib.Application",{constructor:function(e){y(this,A(e))}})});
//# sourceMappingURL=Application.js.map