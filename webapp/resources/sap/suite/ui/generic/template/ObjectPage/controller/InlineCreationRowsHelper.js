sap.ui.define(["sap/ui/base/Object","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/base/util/extend"],function(e,t,n){"use strict";function i(e,n,i){var r="@$ui5.context.isTransient",a={INLINE_CREATION_ROWS:"creationRows",INLINE_CREATION_ROWS_HIDDEN_IN_EDIT_MODE:"creationRowsHiddenInEditMode"};var o={creationRows:new Set,creationRowsHiddenInEditMode:new Set};var c={creationRows:"/editable",creationRowsHiddenInEditMode:"/createMode"};var u;var l=new Map;var s=new Set;var d=new Map;var f=2;function g(){o.creationRows.clear();o.creationRowsHiddenInEditMode.clear()}function v(e){var t=e.data("isCreationAllowedByBoolAndPathRestrictions");return["true",true].includes(t)}function I(e){return e.getAllCurrentContexts().some(function(e){return e.isInactive()})}function E(e){return n.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(e)}function R(e){if(!n.oComponentUtils.isDraftEnabled()){return}var r=e.getSource();var o=r.getTable();if(t.isAnalyticalTable(o)||t.isTreeTable(o)){return}var c=i(r);var u=[a.INLINE_CREATION_ROWS,a.INLINE_CREATION_ROWS_HIDDEN_IN_EDIT_MODE].includes(c);if(!u){return}var l=e.getParameters().bindingParams;var s=l.events.dataReceived||Function.prototype;l.events.dataReceived=function(e){s.call(this,e);var t=E(r),n=t.getBinding();if(I(n)){P(r.getTable());return}b(r);h(r)}}function b(t){var n=e.getModel("ui"),r=i(t),a=c[r];o[r].add(t.getId());if(n.getProperty(a)){C(t)}if(!s.has(a)){n.bindProperty(a).attachChange(p.bind(null,r));s.add(a)}}function p(e,t){if(t.getSource().getValue()){var n=o[e];n.forEach(function(e){var t=sap.ui.getCore().byId(e);C(t)})}}function C(e){O(e).then(function(t){T(e,t)})}function h(t){var n=e.getBindingContext(),i=t.getId();if(d.get(i)===n){return}var r=t.data("creatablePath"),a=r.creatable;if(typeof a==="boolean"){return}e.getModel().bindProperty(a,n).attachChange(function(e){var n=!!e.getSource().getValue();n=r.negate?!n:n;if(n){b(t)}else{N(t)}});d.set(i,n)}function N(e){var t=E(e),n=t.getBinding();if(n.isResolved()&&n.isLengthFinal()){n.getAllCurrentContexts().forEach(function(e){if(e.isInactive()){e.delete()}})}}function T(e,t){var n=e.getTable();var r=i(e);var a=E(e);var c=a.isMTable();var l=a.getBinding();var s=a.isLengthFinal();var d=v(e);var g=I(l);if(s&&l.isResolved()&&d&&!g){var R;for(R=0;R<f;R++){w(l,t,c?R!==0:true)}o[r].delete(e.getId())}var b=P.bind(null,n);D(n,b);u=u||new Set;if(!u.has(l)){_(e,l);u.add(l)}}function _(e,t){t.attachCreateActivate(function(){O(e).then(function(n){w(t,n,true);P(e.getTable())});var i=e.getBindingContext(),r=e.getTableBindingPath();n.oServices.oApplicationController.executeSideEffects(i,[],[r])})}function w(e,t,n){e.create(t,n,{inactive:true})}function O(e){return new Promise(function(t){var i=n.oServices.oCRUDManager.getDefaultValues(e,null,true);if(i instanceof Promise){i.then(function(e){var n=e[0];t(n)}).catch(function(){t(null)})}else{t(null)}})}function D(e,t){var n;if(e.getDomRef()){t()}else{n=e.addEventDelegate({onAfterRendering:function(){t();e.removeEventDelegate(n)}})}}function P(e){if(t.isMTable(e)){S(e)}}function S(e){var t,n=e.getId(),i=e.getItems().filter(function(e){var t=e.getBindingContext().isTransient();var n=e.getBinding("type")&&e.getBinding("type").getPath()===r;return t&&!n});if(i.length===0){return}if(l.get(n)){t=l.get(n)}else{t=i.at(0).getProperty("type");l.set(n,t)}i.forEach(function(e){var n=y.bind(null,e,t);D(e,n)})}function y(e,t){var i=e.getDeleteControl();e.bindProperty("type",{path:r,formatter:function(e){return e?"Inactive":t}});i&&i.bindProperty("visible",{path:r,formatter:function(e){return!e}});var a=e.getBindingContext().created();a&&a.then(function(){e.isSelected()&&n.oCommonUtils.setEnabledToolbarButtons(e)})}function m(e){var t=E(e),n=i(e);if(n===a.INLINE_CREATION_ROWS){t.focusOnFirstTransientRow()}else if(n===a.INLINE_CREATION_ROWS_HIDDEN_IN_EDIT_MODE){if(!I(t.getBinding())){C(e)}else{t.focusOnFirstTransientRow()}}}return{onBeforeRebindObjectPage:g,addCreationRowsImpl:T,onBeforeRebindControl:R,handleAddEntry:m}}return e.extend("sap.suite.ui.generic.template.ObjectPage.controller.InlineCreationRowsHelper",{constructor:function(e,t,r){n(this,i(e,t,r))}})});
//# sourceMappingURL=InlineCreationRowsHelper.js.map