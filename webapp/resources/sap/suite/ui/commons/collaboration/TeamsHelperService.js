/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/base/Log","sap/ui/core/Core","sap/base/security/URLListValidator","./CollaborationHelper","./BaseHelperService","sap/ui/core/Element","./ContactHelper","sap/ui/Device"],function(e,t,r,i,n,a,o,s){"use strict";var l=n.extend("sap.suite.ui.commons.collaboration.TeamsHelperService",{constructor:function(e){this._providerConfig=e;this._providerConfig.shareAsLinkUrl="https://teams.microsoft.com/share";this._getShareAsTabUrl().then(function(e){this._providerConfig.shareAsTabUrl=e}.bind(this))}});var p="db5b69c6-0430-4ae1-8d6e-a65c2220b50c";var d=e.getLogger("sap.suite.ui.commons.collaboration.TeamsHelperService");var h=t.getLibraryResourceBundle("sap.suite.ui.commons");var u="sap-ui-xx-cardTitle";var f;l.prototype.getOptions=function(e){var t={isShareAsLinkEnabled:e&&typeof e.isShareAsLinkEnabled!=="undefined"?e.isShareAsLinkEnabled:true,isShareAsTabEnabled:e&&typeof e.isShareAsTabEnabled!=="undefined"?e.isShareAsTabEnabled:true,isShareAsCardEnabled:e&&typeof e.isShareAsCardEnabled!=="undefined"?e.isShareAsCardEnabled:false};var r=[];var i=[];if(s.system.desktop){if(t.isShareAsLinkEnabled){if(this._providerConfig.isShareAsLinkEnabled){r.push({text:h.getText("COLLABORATION_MSTEAMS_CHAT"),key:"COLLABORATION_MSTEAMS_CHAT",icon:"sap-icon://post",fesrStepName:"MST:ShareAsLink"})}else{d.info("Share as Chat option is not enabled in the tenant")}}else{d.info("Consumer disable Share as Chat option")}}else{d.info("Share as Chat option is not supported in Phone and Tablet")}if(s.system.desktop){if(t.isShareAsTabEnabled){if(this._providerConfig.isShareAsTabEnabled){r.push({text:h.getText("COLLABORATION_MSTEAMS_TAB"),key:"COLLABORATION_MSTEAMS_TAB",icon:"sap-icon://image-viewer",fesrStepName:"MST:ShareAsTab"})}else{d.info("Share as Tab option is not enabled in the tenant")}}else{d.info("Consumer disable Share as Tab option")}}else{d.info("Share as Tab option is not supported in Phone and Tablet")}if(s.system.desktop){if(t.isShareAsCardEnabled){if(this._isFeatureFlagEnabled()){r.push({text:h.getText("COLLABORATION_MSTEAMS_CARD"),key:"COLLABORATION_MSTEAMS_CARD",icon:"sap-icon://ui-notifications",fesrStepName:"MST:ShareAsCard"})}else{d.info("Share as Card option is not enabled in the tenant")}}else{d.info("Consumer disable Share as Card option")}}else{d.info("Share as Card option is not supported in Phone and Tablet")}if(r.length===1){i=r;if(i[0].key==="COLLABORATION_MSTEAMS_CHAT"){i[0].text=h.getText("COLLABORATION_MSTEAMS_CHAT_SINGLE")}else if(i[0].key==="COLLABORATION_MSTEAMS_TAB"){i[0].text=h.getText("COLLABORATION_MSTEAMS_TAB_SINGLE")}else if(i[0].key==="COLLABORATION_MSTEAMS_CARD"){i[0].text=h.getText("COLLABORATION_MSTEAMS_CARD_SINGLE")}return i}if(r.length>1){i.push({type:"microsoft",text:h.getText("COLLABORATION_MSTEAMS_SHARE"),icon:"sap-icon://collaborate",subOptions:r})}return i};l.prototype.share=function(e,t){if(!t.url){d.error("url is not supplied in object so terminating Click");return}if(!r.validate(t.url)){d.error("Invalid URL supplied");return}if(e.key==="COLLABORATION_MSTEAMS_CHAT"){this._shareAsChat(t);return}if(e.key==="COLLABORATION_MSTEAMS_TAB"){this._shareAsTab(t);return}if(e.key==="COLLABORATION_MSTEAMS_CARD"){this._shareAsCard(t);return}};l.prototype._shareAsChat=function(e){var t=window.open("","_blank","width=700,height=600");var r=e.appTitle;if(e.subTitle.length>0){r+=": "+e.subTitle}t.opener=null;if(e.minifyUrlForChat){i.compactHash(e.url,[]).then(function(e){t.location=this._providerConfig.shareAsLinkUrl+"?msgText="+encodeURIComponent(r)+"&href="+encodeURIComponent(e.url)}.bind(this))}else{t.location=this._providerConfig.shareAsLinkUrl+"?msgText="+encodeURIComponent(r)+"&href="+encodeURIComponent(e.url)}};l.prototype._shareAsTab=function(e){var t=e.url;var r=t.indexOf("#");if(r!==-1){var n=t.substring(0,r);var a=n.indexOf("?",0);var o="appState=lean&sap-collaboration-teams=true";if(a!==-1){n=n.substring(0,a+1)+o+"&"+n.substring(a+1)}else{n+="?"+o}t=n+t.substring(r);f=undefined;t=this._addNavmodeInUrl(t)}var s={subEntityId:{url:t,appTitle:e.appTitle,subTitle:e.subTitle,mode:"tab"}};if(e.minifyUrlForChat){i.compactHash(t,[]).then(function(e){s.subEntityId.url=this._addNavmodeInUrl(e.url);var t=this._providerConfig.shareAsTabUrl+"?&context="+encodeURIComponent(JSON.stringify(s));sap.m.URLHelper.redirect(t,true)}.bind(this))}else{var l=this._providerConfig.shareAsTabUrl+"?&context="+encodeURIComponent(JSON.stringify(s));sap.m.URLHelper.redirect(l,true)}};l.prototype._addNavmodeInUrl=function(e){var t=sap.ushell&&sap.ushell.Container;var r=t&&t.getService("URLParsing");var i=e;var n=i.indexOf("#");var a=r.parseShellHash(i.substring(n));if(!f){f=a}f.params["sap-ushell-navmode"]="explace";f.params["sap-ushell-next-navmode"]="explace";a.params=f.params;var o=r.constructShellHash(a);i=i.substring(0,n)+"#"+o;return i};l.prototype._shareAsCard=function(e){var t=window.open("","_blank","width=700,height=600");t.opener=null;if(e.minifyUrlForChat){i.compactHash(e.url,[]).then(function(r){t.location=this._addCardTitleInUrl(r.url,e.appTitle)}.bind(this))}else{t.location=this._addCardTitleInUrl(e.url,e.appTitle)}};l.prototype._addCardTitleInUrl=function(e,t){e=e+"&"+u+"="+t;e=this._providerConfig.shareAsLinkUrl+"?href="+encodeURIComponent(e);return e};l.prototype._getShareAsTabUrl=function(){return this._getApplicationID().then(function(e){return"https://teams.microsoft.com/l/entity/"+e+"/tab"})};l.prototype._getApplicationID=function(){var e=sap.ushell&&sap.ushell.Container;var t=e&&e.getService("URLParsing");return i._getCurrentUrl().then(function(e){var r=e.split("#")[0];if(r.indexOf("?")!==-1){var i=t&&t.parseParameters(r.substring(r.indexOf("?")));if(i&&i["sap-collaboration-xx-TeamsAppId"]&&i["sap-collaboration-xx-TeamsAppId"][0]&&i["sap-collaboration-xx-TeamsAppId"][0].length>0){return Promise.resolve(i["sap-collaboration-xx-TeamsAppId"][0])}return Promise.resolve(p)}else{return Promise.resolve(p)}})};l.prototype._isFeatureFlagEnabled=function(){if(window["sap-ushell-config"]&&window["sap-ushell-config"].renderers&&window["sap-ushell-config"].renderers.fiori2&&window["sap-ushell-config"].renderers.fiori2.componentData&&window["sap-ushell-config"].renderers.fiori2.componentData.config&&window["sap-ushell-config"].renderers.fiori2.componentData.config.sapHorizonEnabled){return true}return false};l.prototype.isContactsCollaborationSupported=function(){return true};l.prototype.enableContactsCollaboration=function(e){if(this._providerConfig.applicationId&&this._providerConfig.tenantId&&e){if(!this.oContactHelper){this.oContactHelper=new o(this._providerConfig)}return this.oContactHelper.loadContactPopover(e)}};return l});
//# sourceMappingURL=TeamsHelperService.js.map