/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/base/Log","sap/ui/core/routing/HashChanger","sap/ui/base/Object"],function(e,t,r){"use strict";var n="sap-url-hash";var i="&sap-ui-xx-cardTitle";var a="transient";var s=e.getLogger("sap.suite.ui.commons.collaboration.CollaborationHelper");var o=r.extend("sap.suite.ui.commons.collaboration.CollaborationHelper");o.compactHash=function(e){var t=sap.ushell&&sap.ushell.Container;if(!t){return{url:e}}return t.getServiceAsync("AppState").then(function(t){var r=t.createEmptyAppState(undefined,false);var i=this._getNextKey(r);if(!this._isEligibleForBackendPersistency(t)){s.warning("Transient flag is true. URL will not be shortened");return{url:e}}var a=this._extractURLBeforeHash(e);var o=this._extractSemanticObjectAndAction(e);if(!o){return{url:e}}return this._storeUrl(e,r).then(function(){return{url:a+"#"+o+"&/"+n+"="+i}}).catch(function(t){s.warning("URL is not shortened due to an error."+t.toString());return{url:e}})}.bind(this))};o._getCurrentUrl=function(){var e=sap.ushell&&sap.ushell.Container;return e?new Promise(function(t){e.getFLPUrlAsync(true).done(function(e){t(e)})}):Promise.resolve(document.URL)};o.processAndExpandHash=function(){this._hideAvatarFromShellbar();return this._getCurrentUrl().then(function(e){if(e.indexOf(n)>-1){var t;if(e.indexOf(i)>0){t=e.split(n)[1].split("=")[1].split(i)[0]}else{t=e.split(n)[1].split("=")[1]}return this._retrieveURL(t).then(function(t){if(t.getData()){window.location.replace(t.getData())}else{var r=e.split(n)[0];window.location.replace(r)}return Promise.resolve()})}else if(e.indexOf(i)>-1){var r=e.split(i)[0];window.location.replace(r)}return Promise.resolve()}.bind(this))};o._hideAvatarFromShellbar=function(){this.isTeamsModeActive().then(function(e){if(e){var t=sap.ui.getCore().byId("userActionsMenuHeaderButton");if(t){t.setVisible(false)}}})};o.isTeamsModeActive=function(){var e=false;var t=sap.ushell&&sap.ushell.Container;var r=t&&t.getService("URLParsing");return this._getCurrentUrl().then(function(t){var n=t.split("#")[0];if(n.indexOf("?")!==-1){var i=r&&r.parseParameters(n.substring(n.indexOf("?")));if(i&&i["sap-collaboration-teams"]&&i["sap-collaboration-teams"][0]&&i["sap-collaboration-teams"][0]==="true"){e=true}var a=false;if(i&&i["appState"]&&i["appState"][0]&&i["appState"][0]==="lean"){a=true}return Promise.resolve(e&&a)}else{return Promise.resolve(false)}})};o._retrieveURL=function(e){if(sap.ushell&&sap.ushell.Container){return sap.ushell.Container.getServiceAsync("AppState").then(function(t){return t.getAppState(e)})}};o._isEligibleForBackendPersistency=function(e){return e&&e._oConfig&&a in e._oConfig&&!e._oConfig[a]};o._getNextKey=function(e){return e.getKey()};o._extractSemanticObjectAndAction=function(e){var t=sap.ushell&&sap.ushell.services&&new sap.ushell.services.URLParsing;if(t){var r=t.parseShellHash(this._extractURLHash(e));if(r){return r.contextRaw?r.semanticObject+"-"+r.action+"~"+r.contextRaw:r.semanticObject+"-"+r.action}}return undefined};o._extractURLBeforeHash=function(e){var t=e.split("#")[0];return t};o._extractURLHash=function(e){var t=e.substring(e.indexOf("#"));return t};o._storeUrl=function(e,t){t.setData(e);return t.save()};return o});
//# sourceMappingURL=CollaborationHelper.js.map