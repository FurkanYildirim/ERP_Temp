/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/suite/ui/commons/library","./ElementBase","./layout/Geometry","./Coordinate","./Utils","sap/ui/core/RenderManager"],function(t,e,o,i,r,s){"use strict";var n=t.networkgraph.LineArrowPosition,a=t.networkgraph.LineType,h=t.networkgraph.LineArrowOrientation,g=t.networkgraph.NodeShape,p=t.networkgraph.Orientation;var u=6,l=5,d=.45,c=15,f={Apex:{x:5.5,y:0},Second:{x:-5.5,y:-7.5},Third:{x:-5.5,y:7.5}},y={Apex:{x:16,y:0},Second:{x:5,y:-7.5},Third:{x:5,y:7.5}},m={Apex:{x:-12,y:0},Second:{x:-1,y:-7.5},Third:{x:-1,y:7.5}},_=5;var C=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");var v=e.extend("sap.suite.ui.commons.networkgraph.Line",{apiVersion:2,metadata:{library:"sap.suite.ui.commons",properties:{selected:{type:"boolean",group:"Misc",defaultValue:false},from:{type:"string",group:"Misc",defaultValue:null},to:{type:"string",group:"Misc",defaultValue:null},lineType:{type:"sap.suite.ui.commons.networkgraph.LineType",group:"Appearance",defaultValue:a.Solid},arrowPosition:{type:"sap.suite.ui.commons.networkgraph.LineArrowPosition",group:"Appearance",defaultValue:n.End},arrowOrientation:{type:"sap.suite.ui.commons.networkgraph.LineArrowOrientation",group:"Appearance",defaultValue:h.ParentOf},stretchToCenter:{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{coordinates:{type:"sap.suite.ui.commons.networkgraph.Coordinate",multiple:true,singularName:"coordinate"},actionButtons:{type:"sap.suite.ui.commons.networkgraph.ActionButton",multiple:true,singularName:"actionButton"}},events:{hover:{},press:{parameters:{point:"Object",opener:"Object"}}}},renderer:function(t,e){var o=e._render({renderManager:t});this.oRm=t;if(o){t.unsafeHtml(o)}},onAfterRendering:function(){this._afterRenderingBase()},init:function(){this._oFrom=null;this._oTo=null;this._bFocusRendered=false;this._sKey="";this._bIsHidden=false}});v.prototype.aProcessRequiredProperties=["from","to"];v.prototype._afterRendering=function(){this._setupEvents();if(this.getFromNode()._bIsHidden||this.getToNode()._bIsHidden){this.$().hide()}this._removeFromInvalidatedControls()};v.prototype._render=function(t){var o=t.renderManager;var i=this.getSelected()?" "+this.SELECT_CLASS+" ":"",r=this._getElementId(t&&t.idSufix),s;var a=this._getStatusStyle({stroke:e.ColorType.Border,"stroke-width":e.ColorType.BorderWidth,"stroke-dasharray":e.ColorType.BorderStyle});var g=this._getStatusStyle({fill:e.ColorType.Background,stroke:e.ColorType.Border});var u=function(t,e,i){return this._renderControl("path",{d:s,class:t||this._getLineClass(),style:i?"":a,from:this.getFromNode().getKey(),to:this.getToNode().getKey(),id:r?r+"-"+e:""},null,o)}.bind(this);var l=function(t,e,o){return{id:r+"-"+o,class:"sapSuiteUiCommonsNetworkLineArrow",style:g,d:"M "+e[t+0].x+","+e[t+0].y+" L "+e[t+1].x+","+e[t+1].y+" L "+e[t+2].x+","+e[t+2].y+" Z"}};var d=function(t,e,i){var r=this._getArrowPoints(t,e);this._renderControl("path",l(0,r,i||"arrow"),null,o);if(this._isBothMiddleArrow()){this._renderControl("path",l(3,r,"arrow1"),null,o)}}.bind(this);var c=function(t,e,o){var i=t,r=e,s=" 0 0 0 ";if(o===p.LeftRight||o===p.RightLeft){e-=_;r+=_}if(o===p.TopBottom||o===p.BottomTop){t-=_;i+=_}if(o===p.BottomTop||o===p.LeftRight){s=" 0 0 1 "}return"M"+t+" "+e+"A"+_+" "+_+s+" "+i+" "+r};this._bFocusRendered=false;if(this._isIgnored()){return""}if(!this.getVisible()){o.openStart("g",r);o.style("display","none");o.attr("data-sap-ui",r);o.openEnd();o.close("g");return}s=this._createPath();this._renderControl("g",{class:"sapSuiteUiCommonsNetworkLine "+this._getStatusClass()+i,id:r,"data-sap-ui":r},false,o);u("sapSuiteUiCommonsNetworkLineInvisibleWrapper","invisibleWrapper",true);u("","path");if(this.getArrowOrientation()!==h.None&&this.getCoordinates().length>=2){if(this.getArrowOrientation()===h.Both){if(this.getArrowPosition()===n.Middle){d(h.ParentOf,n.Middle)}else{d(h.ChildOf,n.Start,"arrow");d(h.ParentOf,n.End,"arrow1")}}else{d()}}if(this._aNipples){var f=g?g:"";this._aNipples.forEach(function(t){o.openStart("path");this.applyStyles(o,this.getStyleObject(f));o.class("sapSuiteUiCommonsNetworkLineNipple");o.attr("d",c(t.x,t.y,t.orientation));o.openEnd();o.close("path")}.bind(this))}o.close("g")};v.prototype._renderFocusWrapper=function(){var t=function(t){var e=this._createElement("path",{d:this._createPath(t),class:"sapSuiteUiCommonsNetworkLineFocus"});this.$()[0].appendChild(e)}.bind(this);if(!this._bFocusRendered){t(l);t(-l);this._bFocusRendered=true}};v.prototype._resetLayoutData=function(){this._aNipples=null};v.prototype._createPath=function(t){if(!this.getSource()||!this.getTarget()){return}var e=[{x:this.getSource().getX(),y:this.getSource().getY()}],i="M"+this.getSource().getX()+","+this.getSource().getY(),r,s,n=this._isTopBottom(),a=n?"x":"y",h=n?"getX":"getY",g=this.getBends().concat([this.getTarget()]);for(var p=0;p<g.length;p++){r=e[p-1]?e[p-1][a]:NaN;s=g[p][h]();if(Math.abs(r-g[p][h]())<2){e.pop();s=r}e.push({x:n?s:g[p].getX(),y:!n?s:g[p].getY()})}for(var l=1;l<e.length;l++){i+=" L"+e[l].x+","+e[l].y}return o.getBezierPathCorners(i,u,t)};v.prototype._getLineClass=function(){var t=function(){switch(this.getLineType()){case a.Dashed:return"sapSuiteUiCommonsNetworkDashedLine";case a.Dotted:return"sapSuiteUiCommonsNetworkDottedLine";default:return""}}.bind(this);return"sapSuiteUiCommonsNetworkLinePath "+t()};v.prototype._getArrowFragmentVector=function(t){var e=this.getCoordinates(),i=e.length-1,r=0,s=function(t){return Math.abs(e[t].getX()-e[t+1].getX())+Math.abs(e[t].getY()-e[t+1].getY())};t=t||this.getArrowPosition();if(this.getBends().length===0){r=0}else if(t===n.Start){while(r<i-1&&this._doesLineFragmentCrossCollapsedGroup(r)){r++}if(s(r)<c){r++}if(this._doesLineFragmentCrossCollapsedGroup(r)){r=0}}else if(t===n.End){r=i-1;while(r>0&&this._doesLineFragmentCrossCollapsedGroup(r)){r--}if(s(r)<c){r--}}else{var a=[],h=0;for(var g=0;g<i;g++){if(e[g].getX()===e[g+1].getX()){h+=Math.abs(e[g+1].getY()-e[g].getY())}else if(e[g].getY()===e[g+1].getY()){h+=Math.abs(e[g+1].getX()-e[g].getX())}else{h+=o.getPointsDistance({x:e[g].getX(),y:e[g].getY()},{x:e[g+1].getX(),y:e[g+1].getY()})}a.push(h)}h=h/2;for(g=0;g<i&&r===0;g++){if(a[g]>=h&&!this._doesLineFragmentCrossCollapsedGroup(g)){r=g}}}if(r<0||r>i-1){r=0}return{center:{x:e[r].getX(),y:e[r].getY()},apex:{x:e[r+1].getX(),y:e[r+1].getY()}}};v.prototype._doesLineFragmentCrossCollapsedGroup=function(t){var e=this.getParent(),i=this.getCoordinates()[t],r=this.getCoordinates()[t+1];return e.getGroups().some(function(t){return t.getCollapsed()&&o.doLineRectangleIntersect({p1:{x:Math.min(i.getX(),r.getX())+1,y:Math.min(i.getY(),r.getY())+1},p2:{x:Math.max(i.getX(),r.getX())-1,y:Math.max(i.getY(),r.getY())-1}},{p1:{x:t.getX(),y:t.getY()},p2:{x:t.getX()+t._iWidth,y:t.getY()+t._iHeight}})})};v.prototype._getArrowPoints=function(t,e){var i,r,s,a,p=[];t=t||this.getArrowOrientation();e=e||this.getArrowPosition();var u=function(u){var l=c;if(e===n.Middle){s={x:(r.apex.x-r.center.x)*d+r.center.x,y:(r.apex.y-r.center.y)*d+r.center.y}}else{if(!(this.getToNode()._oGroup&&this.getToNode()._oGroup.getCollapsed())&&this.getToNode().getShape()===g.Circle&&e===n.End){l+=this.getToNode()._getCircleSize()/2}else if(!(this.getFromNode()._oGroup&&this.getFromNode()._oGroup.getCollapsed())&&this.getFromNode().getShape()===g.Circle&&e===n.Start){l+=this.getFromNode()._getCircleSize()/2}i=o.getNormalizedVector(r,l);if(e===n.Start){s=r.center}else if(e===n.End){i=o.getRotatedVector(i,Math.PI);s=r.apex}s=o.getPointSum(s,i.apex)}a=o.getAngleOfVector(r);if(t===h.ChildOf){a+=Math.PI}p.push(o.getPointSum(s,o.getRotatedPoint(u,a)))}.bind(this);r=this._getArrowFragmentVector(e);if(this._isBothMiddleArrow()){u(y.Apex);u(y.Second);u(y.Third);u(m.Apex);u(m.Second);u(m.Third)}else{u(f.Apex);u(f.Second);u(f.Third)}return p};v.prototype._getAccessibilityLabel=function(){var t=this.getFromNode().getTitle();var e=t?t:this.getFromNode().getAltText();var o=this.getToNode().getTitle();var i=o?o:this.getToNode().getAltText();return C.getText("NETWORK_GRAPH_ACCESSIBILITY_LINE_LABEL",[e,i])+" "+this.getTitle()};v.prototype.getFromNode=function(){this._checkForProcessData();if(!this._oFrom&&this.getParent()){this._oFrom=this.getParent().getNodeByKey(this.getFrom())}return this._oFrom};v.prototype.getToNode=function(){this._checkForProcessData();if(!this._oTo&&this.getParent()){this._oTo=this.getParent().getNodeByKey(this.getTo())}return this._oTo};v.prototype.setSource=function(t){var e;if(this.getCoordinates().length===0){e=new i;this.addAggregation("coordinates",e,true)}e=this.getCoordinates()[0];if(t.x||t.x===0){e.setX(t.x)}if(t.y||t.y===0){e.setY(t.y)}};v.prototype.getSource=function(){return this.getCoordinates()[0]};v.prototype.getTarget=function(){return this.getCoordinates().length>0?this.getCoordinates()[this.getCoordinates().length-1]:null};v.prototype.setTarget=function(t){var e;if(this.getCoordinates().length<2){e=new i;this.addAggregation("coordinates",e,true)}e=this.getCoordinates()[this.getCoordinates().length-1];if(t.x||t.x===0){e.setX(t.x)}if(t.y||t.y===0){e.setY(t.y)}};v.prototype.getBends=function(){return this.getCoordinates().filter(function(t,e){return e>0&&e<this.getCoordinates().length-1},this)};v.prototype.clearBends=function(){this.getBends().forEach(function(t){this.removeAggregation("coordinates",t,true)},this)};v.prototype.addBend=function(t){var e=new i;e.setX(t.x);e.setY(t.y);this.insertAggregation("coordinates",e,this.getCoordinates().length-1,true);return e};v.prototype.isHidden=function(){return this._bIsHidden};v.prototype.getKey=function(){return this._getLineId()};v.prototype.setHidden=function(t){this.$()[t?"hide":"show"]()};v.prototype._isIgnored=function(){var t=this.getFromNode(),e=this.getToNode(),o=t._oGroup&&t._oGroup.getCollapsed()&&e._oGroup&&e._oGroup.getCollapsed()&&t._oGroup===e._oGroup,i=!t._useInLayout()||!e._useInLayout();return!this._useInLayout||o||this._isLoop()||i};v.prototype._isLoop=function(){return this.getFromNode().getId()===this.getToNode().getId()};v.prototype._getLineId=function(){return this._sKey?this._sKey:"line_"+this.getFrom()+"-"+this.getTo()};v.prototype._setupEvents=function(){var t=this.$().find(".sapSuiteUiCommonsNetworkLineInvisibleWrapper");t.on("click",function(t){this._click({ctrlKey:t.ctrlKey,clientX:t.clientX,clientY:t.clientY})}.bind(this));t.on("mouseover",function(t){this._mouseOver()}.bind(this));t.on("mouseout",function(t){this._mouseOut()}.bind(this))};v.prototype._mouseOut=function(){this.$().removeClass(this.HIGHLIGHT_CLASS);if(!this.getSelected()){this._setStatusColors("")}};v.prototype._mouseOver=function(){var t=this.fireEvent("hover",{},true);if(!this.getSelected()&&t){this._setStatusColors("Hover");this.$().addClass(this.HIGHLIGHT_CLASS)}};v.prototype._setStatusColors=function(t){var o=this.$().find(".sapSuiteUiCommonsNetworkLineArrow"),i=this._getColor(e.ColorType[t+"Border"]),r=this._getColor(e.ColorType[t+"Background"]);o.css("fill",r);o.css("stroke",i);this.$("path").css("stroke",i);if(this.getParent()&&this.getParent()._isSwimLane()){var s=this.$().find(".sapSuiteUiCommonsNetworkLineNipple");s.css("fill",r);s.css("stroke",i)}};v.prototype._showActionButtons=function(t){var e=function(t,e,o){var r=i(t,e,o);if(r){t._setNodeOpacity(true);a._aShadedNodes.push(t)}return r};var i=function(t,e,i){return o.hasRectangleRectangleIntersection({p1:{x:v,y:C},p2:{x:i,y:e}},t._getContentRect())};var r=function(t,e){return{p1:{x:t.x,y:t.y},p2:{x:e.x,y:e.y}}};var s=0;var n=function(t,e){if(s<2){var o=jQuery("<div></div>",{class:t,css:{top:e.top,left:e.left,right:e.right,bottom:e.bottom}});g.append(o);s++}};var a=this.getParent(),h=a.$("divlinebuttons"),g=a.$("linetooltip"),p=a.$("linetooltipbuttons");var u=this.getFromNode(),l=this.getToNode();var d=10;a._aShadedNodes=[];var c=u.getTitle();var f=c?c:u.getAltText();var y='<span class="sapSuiteUiCommonsNetworkGraphLineTooltipText">'+f+"</span>";if(this._isBothArrow()){y+='<span class="sapSuiteUiCommonsNetworkGraphLineTooltipArrow sapSuiteUiCommonsNetworkGraphLineTooltipDualArrow"></span>'}var m=l.getTitle();var _=m?m:l.getAltText();y+='<span class="sapSuiteUiCommonsNetworkGraphLineTooltipArrow"></span>'+"</br>"+'<span class="sapSuiteUiCommonsNetworkGraphLineTooltipText">'+_+"</span>";g.html(y);p.html("");this.getActionButtons().forEach(function(t){this._appendActionButton({icon:t.getIcon(),enable:t.getEnabled(),title:t.getTitle(),id:t.getId(),click:function(e){t.firePress({buttonElement:e.target})}},p)}.bind(this));h.show();var C=t.y-g.outerHeight()/2,v=t.x-g.outerWidth()/2,S=C+g.outerHeight(),T=v+g.outerWidth();e(l,S,v+h.width());var x=e(u,C+g.height(),v),w=e(l,S,v+g.outerWidth()+d);if(a._isLayered()){var A={x:v,y:C};var N={x:T,y:C};var L={x:T,y:S};var P={x:v,y:S};var F=this.getCoordinates();for(var b=0;b<F.length-1&&s<2;b++){var B=F[b],k=F[b+1];var I={x:B.getX(),y:B.getY()};var Y={x:k.getX(),y:k.getY()};var X=r(I,Y);var O=o.getSegmentsIntersection(X,r(A,P));if(O&&!x){n("sapSuiteUiCommonsNetworkGraphTooltipLeftArrow",{top:O.y-C-d})}O=o.getSegmentsIntersection(X,r(N,L));if(O&&!w){n("sapSuiteUiCommonsNetworkGraphTooltipRightArrow",{top:O.y-C-d})}O=o.getSegmentsIntersection(X,r(P,L));if(O){n("sapSuiteUiCommonsNetworkGraphTooltipBottomArrow",{left:O.x-v-d})}O=o.getSegmentsIntersection(X,r(A,N));if(O){n("sapSuiteUiCommonsNetworkGraphTooltipTopArrow",{left:O.x-v-d})}}h.css("top",C+"px");h.css("left",v+"px")}};v.prototype._hasVisibleActionButtons=function(){return this.getParent().$().find(".sapSuiteUiCommonsNetworkGraphLineButtons").is(":visible")};v.prototype._getEnabledActionButtons=function(){var t=[];this.getActionButtons().forEach(function(e){if(e.getEnabled()&&e.getDomRef()){t.push(e.getDomRef())}});return t};v.prototype._setActionButtonFocus=function(t,e){var o=this.getParent().$("divlinebuttons");o.removeClass(this.FOCUS_CLASS);o.find("."+this.FOCUS_CLASS).removeClass(this.FOCUS_CLASS);jQuery(t).toggleClass(this.FOCUS_CLASS,e)};v.prototype._click=function(t){var e=this.getParent(),o=t.skipConversion?{x:t.clientX,y:t.clientY}:e.getCorrectMousePosition({x:t.clientX,y:t.clientY}),i=e._tooltip._getOpener(this,o),r;e._selectLine({element:this,forceFocus:true,preventDeselect:t.ctrlKey});r=this.fireEvent("press",{opener:i,point:o},true);if(this.getSelected()&&r){this.getActionButtons().length===0?e._tooltip.openDetail({item:this,opener:i,point:o}):this._showActionButtons(o)}};v.prototype._setFocus=function(t){e.prototype._setFocus.call(this,t);if(t){this._renderFocusWrapper()}};v.prototype._isEndPosition=function(){return this.getArrowPosition()===n.End&&this.getArrowOrientation()===h.ParentOf||this.getArrowPosition()===n.Start&&this.getArrowOrientation()===h.ChildOf};v.prototype._moveToEnd=function(){return this._isEndPosition()||this.getArrowPosition()===n.Middle&&this.getArrowOrientation()===h.ParentOf};v.prototype._hideShow=function(t){if(t){this.$().hide();this._bIsHidden=true}else if(!this.getToNode()._bIsHidden&&!this.getFromNode()._bIsHidden){this.$().show();this._bIsHidden=false}};v.prototype._shift=function(t){this.getBends().forEach(function(e){e.setX(e.getX()+t.x);e.setY(e.getY()+t.y)});if(this.getSource()){this.setSource({x:this.getSource().getX()+t.x,y:this.getSource().getY()+t.y})}if(this.getTarget()){this.setTarget({x:this.getTarget().getX()+t.x,y:this.getTarget().getY()+t.y})}if(this._aNipples){this._aNipples.forEach(function(e){e.x+=t.x;e.y+=t.y})}};v.prototype._normalizePath=function(){var t,e;t=this.getFromNode().getCenterPosition();this.setSource({x:t.x,y:t.y});e=this.getToNode().getCenterPosition();this.setTarget({x:e.x,y:e.y});this.clearBends()};v.prototype._validateLayout=function(){return(!this.getSource()||isFinite(this.getSource().getX())&&isFinite(this.getSource().getY()))&&(!this.getTarget()||isFinite(this.getTarget().getX())&&isFinite(this.getTarget().getY()))&&!this.getBends().some(function(t){return!isFinite(t.getX())||!isFinite(t.getY())})};v.prototype.setSelected=function(t){var e=this.getParent(),o=t?"addClass":"removeClass";this._setStatusColors(t?"Selected":"");this.setProperty("selected",t,true);this.$()[o](this.SELECT_CLASS);if(e){if(t){e._mSelectedLines[this._getLineId()]=this}else{this._setStatusColors("");delete e._mSelectedLines[this._getLineId()]}}return this};v.prototype.setFrom=function(t){var e=this.getParent();this.setProperty("from",t,true);if(e){e.invalidate()}return this};v.prototype.setTo=function(t){var e=this.getParent();this.setProperty("to",t,true);if(e){e.invalidate()}return this};v.prototype._isTopBottom=function(){var t=this.getParent();return t&&t._isTopBottom()};v.prototype.getFocusDomRef=function(){return this.getDomRef("invisibleWrapper")};v.prototype._createSuggestionHelpText=function(){var t=25;var e=this.getTitle()?this.getTitle()+" ":"";var o=this.getFromNode().getTitle();var i=o?o:this.getFromNode().getAltText();var s=this.getToNode().getTitle();var n=s?s:this.getToNode().getAltText();return e+"("+r.trimText(i,t)+" -> "+r.trimText(n,t)+")"};v.prototype._isInCollapsedGroup=function(){var t=this.getFromNode(),e=this.getToNode();return t._oGroup===e._oGroup&&t._isInCollapsedGroup()};v.prototype._isBothMiddleArrow=function(){return this.getArrowOrientation()===h.Both&&this.getArrowPosition()===n.Middle};v.prototype._isBothArrow=function(){return this.getArrowOrientation()===h.Both};v.prototype._isOnScreen=function(t,o,i,r){var s=this.getCoordinates(),n,a;for(n=1;n<s.length;n++){a=e._isRectOnScreen(s[n-1].getX(),s[n].getX(),s[n-1].getY(),s[n].getY(),t,o,i,r);if(a){return true}}return false};return v});
//# sourceMappingURL=Line.js.map