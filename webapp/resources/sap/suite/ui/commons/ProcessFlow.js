/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/m/library","sap/m/ImageHelper","sap/ui/core/Control","sap/suite/ui/commons/ProcessFlowConnection","sap/suite/ui/commons/ProcessFlowLaneHeader","sap/ui/Device","sap/ui/core/ResizeHandler","sap/base/Log","sap/ui/events/KeyCodes","./ProcessFlowRenderer","sap/ui/core/date/UI5Date"],function(jQuery,e,t,i,o,s,a,n,r,l,c,h,u){"use strict";var g=o.extend("sap.suite.ui.commons.ProcessFlow",{metadata:{library:"sap.suite.ui.commons",properties:{foldedCorners:{type:"boolean",group:"Misc",defaultValue:false},scrollable:{type:"boolean",group:"Misc",defaultValue:true},wheelZoomable:{type:"boolean",group:"Behavior",defaultValue:true},showLabels:{type:"boolean",group:"Appearance",defaultValue:false}},defaultAggregation:"lanes",aggregations:{_connections:{type:"sap.suite.ui.commons.ProcessFlowConnection",multiple:true,singularName:"_connection",visibility:"hidden"},nodes:{type:"sap.suite.ui.commons.ProcessFlowNode",multiple:true,singularName:"node"},lanes:{type:"sap.suite.ui.commons.ProcessFlowLaneHeader",multiple:true,singularName:"lane"},ariaProperties:{type:"sap.suite.ui.commons.AriaProperties",multiple:false,group:"Misc"}},events:{nodeTitlePress:{deprecated:true,parameters:{oEvent:{type:"object"}}},nodePress:{parameters:{oEvent:{type:"object"}}},labelPress:{parameters:{oEvent:{type:"object"}}},headerPress:{parameters:{oEvent:{type:"object"}}},onError:{parameters:{oEvent:{type:"object"}}}},dnd:{draggable:false,droppable:true}}});g.prototype._resBundle=null;g._cellEdgeConstants={LU:"tl",LD:"lb",DU:"tb",LR:"rl",DR:"rt",UR:"rb"};g._constants={scrollContainer:"scrollContainer",counterLeft:"counterLeft",counterRight:"counterRight",arrowScrollRight:"arrowScrollRight",arrowScrollRightMinus:"-arrowScrollRight",arrowScrollLeft:"arrowScrollLeft",arrowScrollLeftMinus:"-arrowScrollLeft",top:"top",px:"px",parents:"parents",left:"left",right:"right"};g._mouseEvents={mouseMove:"mousemove",mouseDown:"mousedown",mouseUp:"mouseup",mouseLeave:"mouseleave",mouseEnter:"mouseenter",touchStart:"touchstart",sapTouchStart:"saptouchstart",touchEnd:"touchend",sapTouchCancel:"saptouchcancel"};g._enumMoveDirection={LEFT:"left",RIGHT:"right",UP:"up",DOWN:"down"};g.prototype._zoomLevel=e.ProcessFlowZoomLevel.Two;g.prototype._wheelTimeout=null;g.prototype._isFocusChanged=false;g.prototype._wheelTimestamp=null;g.prototype._wheelCalled=false;g.prototype._internalCalcMatrix=false;g.prototype._internalConnectionMap=null;g.prototype._internalLanes=false;g.prototype._jumpOverElements=5;g.prototype._lastNavigationFocusElement=null;g.prototype._bHighlightedMode=false;g.prototype._isLayoutOptimized=false;g.prototype._defaultCursorClass="sapSuiteUiDefaultCursorPF";if(n.browser.edge){g.prototype._grabCursorClass="sapSuiteUiGrabCursorIEPF";g.prototype._grabbingCursorClass="sapSuiteUiGrabbingCursorIEPF"}else{g.prototype._grabCursorClass="sapSuiteUiGrabCursorPF";g.prototype._grabbingCursorClass="sapSuiteUiGrabbingCursorPF"}g.prototype._mousePreventEvents="contextmenu dblclick";g.prototype._mouseEvents="contextmenu mousemove mouseleave mousedown mouseup mouseenter";g.prototype._mouseWheelEvent=n.browser.mozilla?"DOMMouseScroll MozMousePixelScroll":"mousewheel wheel";g.prototype._headerHasFocus=false;g.prototype._isInitialZoomLevelNeeded=true;g.prototype._bDoScroll=!n.system.desktop||n.os.windows&&n.os.version>=8;g.prototype._scrollStep=192;g.prototype._bPreviousScrollForward=false;g.prototype._bPreviousScrollBack=false;g.prototype._iInitialArrowTop=undefined;g.prototype._iInitialCounterTop=undefined;g.prototype._bRtl=false;g.prototype._arrowScrollable=null;g.prototype._iTouchStartScrollTop=undefined;g.prototype._iTouchStartScrollLeft=undefined;g.prototype._bSetFocusOnce=true;g.prototype.init=function(){this._bRtl=sap.ui.getCore().getConfiguration().getRTL();if(!this._resBundle){this._resBundle=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons")}this._internalLanes=[];if(this._getScrollContainer()){this._getScrollContainer().on("keydown",jQuery.proxy(this.onkeydown,this))}};g.prototype.exit=function(){var e=this.getNodes(),t;if(e){for(t=0;t<e.length;t++){if(e[t]){e[t].destroy()}}e=null}if(this._internalLanes){for(t=0;t<this._internalLanes.length;t++){this._internalLanes[t].destroy()}this._internalLanes=null}var i=this.getAggregation("_connections");if(i){for(t=0;t<i.length;t++){i[t].destroy()}i=null}if(this._oArrowLeft){this._oArrowLeft.destroy()}if(this._oArrowRight){this._oArrowRight.destroy()}if(this._resizeRegId){r.deregister(this._resizeRegId)}if(this._internalCalcMatrix){delete this._internalCalcMatrix;this._internalCalcMatrix=null}if(this._getScrollContainer()){this._getScrollContainer().off(this._mousePreventEvents,this._handlePrevent);this._getScrollContainer().off(this._mouseEvents,jQuery.proxy(this._registerMouseEvents,this));this._getScrollContainer().off(this._mouseWheelEvent,jQuery.proxy(this._registerMouseWheel,this));this._getScrollContainer().off("keydown",jQuery.proxy(this.onkeydown,this));this._getScrollContainer().off("scroll",jQuery.proxy(this._onScroll,this))}};g.prototype.onBeforeRendering=function(){if(this._getScrollContainer()){this._getScrollContainer().off(this._mousePreventEvents,this._handlePrevent);this._getScrollContainer().off(this._mouseEvents,jQuery.proxy(this._registerMouseEvents,this));this._getScrollContainer().off(this._mouseWheelEvent,jQuery.proxy(this._registerMouseWheel,this));this._getScrollContainer().off("keydown",jQuery.proxy(this.onkeydown,this));this._getScrollContainer().off("scroll",jQuery.proxy(this._onScroll,this))}};g.prototype.onAfterRendering=function(){var e=false,t=this.$("scroll-content"),i,o,s,a;this._checkOverflow(this._getScrollContainer().get(0),this.$());this.iCursorPositionX=0;this.iCursorPositionY=0;if(t&&t.length){this._getScrollContainer().find(".sapSuiteUiCommonsProcessFlowNode .sapUiIcon").css("cursor","inherit");if(this.getScrollable()){i=parseInt(this._getScrollContainer().css("height").slice(0,-2),10);o=parseInt(this._getScrollContainer().css("width").slice(0,-2),10);a=t[0].scrollHeight;s=t[0].scrollWidth;if(a<=i&&s<=o){this._clearHandlers(this._getScrollContainer());this._switchCursors(this._getScrollContainer(),this._grabCursorClass,this._defaultCursorClass)}else{this._switchCursors(this._getScrollContainer(),this._defaultCursorClass,this._grabCursorClass);e=true}}else{this._clearHandlers(this._getScrollContainer());this._switchCursors(this._getScrollContainer(),this._grabCursorClass,this._defaultCursorClass);t.css("position","static")}if(e){if(!this._iInitialArrowTop||!this._iInitialCounterTop){this._iInitialArrowTop=parseInt(this.$(g._constants.arrowScrollRight).css(g._constants.top),10);this._iInitialCounterTop=parseInt(this.$(g._constants.counterRight).css(g._constants.top),10)}if(n.os.windows&&n.system.combi&&n.browser.chrome){this._getScrollContainer().bind(this._mouseEvents,jQuery.proxy(this._registerMouseEvents,this));this._getScrollContainer().css("overflow","auto")}else if(n.os.windows&&n.browser.edge){this._getScrollContainer().bind(this._mouseEvents,jQuery.proxy(this._registerMouseEvents,this));this._getScrollContainer().css("overflow","auto");this._getScrollContainer().css("-ms-overflow-style","none")}else if(!n.support.touch){this._getScrollContainer().bind(this._mouseEvents,jQuery.proxy(this._registerMouseEvents,this))}else{this._clearHandlers(this._getScrollContainer());this._getScrollContainer().css("overflow","auto")}}else if(this._bDoScroll){this._getScrollContainer().css("overflow","auto")}else{this._getScrollContainer().css("overflow","hidden")}if(n.browser.mozilla){this._getScrollContainer().css("scrollbar-width","none")}if(this.getWheelZoomable()&&n.system.desktop&&!this._isHeaderMode()){this._getScrollContainer().bind(this._mouseWheelEvent,jQuery.proxy(this._registerMouseWheel,this))}if(this._bDoScroll){this._getScrollContainer().on("scroll",jQuery.proxy(this._onScroll,this))}this._resizeRegId=r.register(this,jQuery.proxy(g.prototype._onResize,this));if(this._isInitialZoomLevelNeeded){this._initZoomLevel()}if(this._headerHasFocus){var l=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();if(l[0]){var c=sap.ui.getCore().byId(l[0].id);this._changeNavigationFocus(null,c);this._headerHasFocus=false}}}};g.prototype.ontouchend=function(e){if(e.target&&e.target.id.indexOf("arrowScroll")!==-1){this._onArrowClick(e)}else{if(!n.support.touch){this.onAfterRendering()}else{this._adjustAndShowArrow()}if(e===null||e.oSource===undefined){return}e.preventDefault();if(this._isHeaderMode()){this._internalLanes=[];this.fireHeaderPress(this)}}};g.prototype._handlePrevent=function(e){if(e&&!e.isDefaultPrevented()){e.preventDefault()}if(e&&!e.isPropagationStopped()){e.stopPropagation()}if(e&&!e.isImmediatePropagationStopped()){e.stopImmediatePropagation()}};g.prototype._onResize=function(){var e=Date.now();if(!this._iLastResizeEventTime||e-this._iLastResizeEventTime<50){if(!this._iLastResizeHandlingTime||e-this._iLastResizeHandlingTime>500){this.onAfterRendering();this._iLastResizeHandlingTime=e}}else{this._iLastResizeHandlingTime=null}this._iLastResizeEventTime=e};g.prototype._registerMouseEvents=function(e){if(e&&!e.isDefaultPrevented()){e.preventDefault()}switch(e.type){case g._mouseEvents.mouseMove:if(this._getScrollContainer().hasClass(this._grabbingCursorClass)){if(sap.ui.getCore().getConfiguration().getRTL()){this._getScrollContainer().scrollLeftRTL(this.iCursorPositionX-e.pageX)}else{this._getScrollContainer().scrollLeft(this.iCursorPositionX-e.pageX)}this._getScrollContainer().scrollTop(this.iCursorPositionY-e.pageY);this._adjustAndShowArrow()}break;case g._mouseEvents.mouseDown:this._switchCursors(this._getScrollContainer(),this._defaultCursorClass,this._grabbingCursorClass);if(sap.ui.getCore().getConfiguration().getRTL()){this.iCursorPositionX=this._getScrollContainer().scrollLeftRTL()+e.pageX}else{this.iCursorPositionX=this._getScrollContainer().scrollLeft()+e.pageX}this.iCursorPositionY=this._getScrollContainer().scrollTop()+e.pageY;if(n.system.combi){this._iTouchStartScrollLeft=this._getScrollContainer().scrollLeft();if(this.getScrollable()){this._iTouchStartScrollTop=this._getScrollContainer().scrollTop()}}break;case g._mouseEvents.mouseUp:this._switchCursors(this._getScrollContainer(),this._grabbingCursorClass,this._grabCursorClass);break;case g._mouseEvents.mouseLeave:this._getScrollContainer().removeClass(this._grabbingCursorClass);this._getScrollContainer().removeClass(this._grabCursorClass);this._getScrollContainer().addClass(this._defaultCursorClass);break;case g._mouseEvents.mouseEnter:this._getScrollContainer().removeClass(this._defaultCursorClass);if(e.buttons===null){if(e.which===1){this._getScrollContainer().addClass(this._grabbingCursorClass)}else{this._getScrollContainer().addClass(this._grabCursorClass)}}else if(e.buttons===0){this._getScrollContainer().addClass(this._grabCursorClass)}else if(e.buttons===1){this._getScrollContainer().addClass(this._grabbingCursorClass)}break;default:}if(e.target&&e.target.parentElement&&e.target.parentElement.parentElement&&e.target.parentElement.parentElement.getMetadata&&e.target.parentElement.parentElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnectionLabel"){if(e&&!e.isPropagationStopped()){e.stopPropagation()}if(e&&!e.isImmediatePropagationStopped()){e.stopImmediatePropagation()}}};g.prototype.onfocusin=function(e){var t;if(e&&e.target&&e.target.id){t=sap.ui.getCore().byId(e.target.id)}if(this._isHeaderMode()||this._checkNodesVisibility()){this._setFocusOnHeader(true)}else if(this._bSetFocusOnce&&!(t&&e.target.id.indexOf("arrowScroll"))){this._bSetFocusOnce=false;if(t&&t.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnectionLabel"){this._changeNavigationFocus(null,t)}else if(!this._lastNavigationFocusElement){var i=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var o=sap.ui.getCore().byId(i[0].id);this._changeNavigationFocus(null,o)}else if(this._lastNavigationFocusElement){this._changeNavigationFocus(null,this._lastNavigationFocusElement)}}};g.prototype._checkNodesVisibility=function(){var e=true;this.getNodes().forEach(function(t){if(t.getVisible()){e=false}});return e};g.prototype.onfocusout=function(){this._bSetFocusOnce=true;if(this._lastNavigationFocusElement&&this._lastNavigationFocusElement._getNavigationFocus()){this._lastNavigationFocusElement._setNavigationFocus(false);if(this._lastNavigationFocusElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){this._lastNavigationFocusElement.rerender()}}};g.prototype.onsapplus=function(){this._isFocusChanged=true;this.zoomIn()};g.prototype.onsapminus=function(){this._isFocusChanged=true;this.zoomOut()};g.prototype.onsaptabnext=function(e){var t=true;var i=e.target;var o=sap.ui.getCore().byId(i.id);if(!o&&i&&i.childElementCount>0){i=i.childNodes[0];o=sap.ui.getCore().byId(i.id)}if(!o||o.getMetadata().getName()!=="sap.suite.ui.commons.ProcessFlowNode"&&o.getMetadata().getName()!=="sap.suite.ui.commons.ProcessFlowConnectionLabel"){if(!this._isHeaderMode()&&!this._lastNavigationFocusElement&&!this._checkNodesVisibility()){var s=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var a=sap.ui.getCore().byId(s[0].id);this._changeNavigationFocus(null,a);t=false}else if(this._lastNavigationFocusElement){this._changeNavigationFocus(null,this._lastNavigationFocusElement);t=false}}if((this._isHeaderMode()||this._checkNodesVisibility())&&t){if(!this._headerHasFocus){this._setFocusOnHeader(true)}else{this._setFocusOnHeader(false)}}else if(this._lastNavigationFocusElement&&this._lastNavigationFocusElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){this._lastNavigationFocusElement.rerender()}var n;if(t){n=this.$().nextAll(":focusable").first();if(n.length===0){n=this.$().nextAll().find(":focusable").first();if(n.length===0){r.apply(this)}}n.focus();l.debug("saptabnext: Keyboard focus has been changed to element:  id='"+n.id+"' outerHTML='"+n.outerHTML+"'");n=null}e.preventDefault();function r(){var e=this.$().parent();do{n=e.next(":focusable");if(n.length===0){n=e.nextAll().find(":focusable").first()}e=e.parent()}while(e.length!==0&&n.length===0);if(n.length===0){n=jQuery(":focusable")[0]}}};g.prototype.onsaptabprevious=function(e){var t=null;var i=e.target;if((!this._lastNavigationFocusElement||!this._lastNavigationFocusElement._getNavigationFocus())&&e.target&&e.target.childElementCount>0){i=e.target.childNodes[0]}var o=sap.ui.getCore().byId(i.id);if(o&&(o.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"||o.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode")){if(!this._isHeaderMode()&&!this._lastNavigationFocusElement){var s=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var a=sap.ui.getCore().byId(s[0].id);this._changeNavigationFocus(null,a)}else if(this._lastNavigationFocusElement){this._changeNavigationFocus(null,this._lastNavigationFocusElement);e.preventDefault();return}}if(this._isHeaderMode()){if(!this._headerHasFocus){this._setFocusOnHeader(true)}else{this._setFocusOnHeader(false);t=this.$().prevAll().find(":focusable").last()}}else{t=this.$().prev(":focusable");if(t.length===0){t=this.$().prevAll().find(":focusable").last()}if(this._lastNavigationFocusElement){this._lastNavigationFocusElement._setNavigationFocus(false)}if(this._lastNavigationFocusElement&&this._lastNavigationFocusElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){this._lastNavigationFocusElement.rerender()}}if(t){if(t.length===0){n.apply(this)}else if(t.first().length!==0){t=jQuery(t.first())}t.focus();l.debug("saptabnext: Keyboard focus has been set on element:  id='"+t.id+"' outerHTML='"+t.outerHTML+"'");t=null}e.preventDefault();function n(){var e=this.$();do{t=e.prev(":focusable");if(t.length===0){t=e.prevAll().find(":focusable").last()}e=e.parent()}while(e.length!==0&&t.length===0)}};g.prototype._handleKeySelect=function(e){if(this._isHeaderMode()){this._internalLanes=[];this.fireHeaderPress(this);var t=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var i=sap.ui.getCore().byId(t[0].id);this._changeNavigationFocus(null,i)}else if(this._lastNavigationFocusElement&&this._lastNavigationFocusElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&this._lastNavigationFocusElement._getNavigationFocus()){var o=this._lastNavigationFocusElement;o._handleEvents(e)}};g.prototype.onkeyup=function(e){var t=e.keyCode?e.keyCode:e.which;switch(t){case c.ENTER:case c.SPACE:var i=this._lastNavigationFocusElement;if(i){this.fireNodePress(this._lastNavigationFocusElement);i._handleEvents(e)}break;default:break}};g.prototype.onkeydown=function(e){var t=e.keyCode?e.keyCode:e.which;l.debug("ProcessFlow::keyboard input has been catched and action going to start: keycode="+t);var i=false;var o=e.ctrlKey;var s=e.altKey;var a=this._lastNavigationFocusElement;switch(t){case c.ARROW_RIGHT:i=this._moveToNextElement(g._enumMoveDirection.RIGHT);break;case c.ARROW_LEFT:i=this._moveToNextElement(g._enumMoveDirection.LEFT);break;case c.ARROW_DOWN:i=this._moveToNextElement(g._enumMoveDirection.DOWN);break;case c.ARROW_UP:i=this._moveToNextElement(g._enumMoveDirection.UP);break;case c.PAGE_UP:i=this._moveOnePage(g._enumMoveDirection.UP,s);break;case c.PAGE_DOWN:i=this._moveOnePage(g._enumMoveDirection.DOWN,s);break;case c.HOME:i=this._moveHomeEnd(g._enumMoveDirection.LEFT,o);break;case c.END:i=this._moveHomeEnd(g._enumMoveDirection.RIGHT,o);break;case c.NUMPAD_0:case c.DIGIT_0:this._initZoomLevel();break;case c.ENTER:case c.SPACE:this._handleKeySelect(e);e.preventDefault();return;default:return}e.preventDefault();if(i){this._changeNavigationFocus(a,this._lastNavigationFocusElement)}};g.prototype._onArrowClick=function(e){var t=e.target.id;if(t){var i=this.getId();e.preventDefault();if(t===i+g._constants.arrowScrollLeftMinus&&n.system.desktop){this._scroll(-this._scrollStep,500)}else if(t===i+g._constants.arrowScrollRightMinus&&n.system.desktop){this._scroll(this._scrollStep,500)}}};g.prototype._onScroll=function(){var e=this._getScrollContainer().scrollLeft();var t=Math.abs(e-this._iTouchStartScrollLeft);if(t>this._scrollStep/4&&!this._isFocusChanged){this._adjustAndShowArrow();this._iTouchStartScrollLeft=e}else if(this.getScrollable()){var i=this._getScrollContainer().scrollTop();var o=Math.abs(i-this._iTouchStartScrollTop);if(o>10){this._moveArrowAndCounterVertical();this._iTouchStartScrollTop=i}}};g.prototype.ontouchstart=function(){this._iTouchStartScrollLeft=this._getScrollContainer().scrollLeft();if(this.getScrollable()){this._iTouchStartScrollTop=this._getScrollContainer().scrollTop()}};g.prototype.ontouchmove=function(e){e.setMarked()};g.prototype._handleLabelClick=function(e){if(e){var t=e.getSource();if(t&&t.getMetadata().getName()==="sap.ui.core.Icon"){t=t.getParent()}if(t&&t.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnectionLabel"){var i=this._getConnectionMapEntries(t);var o=this._createLabelPressEventArgs(t,i);this.fireLabelPress(o)}}};g.prototype._onFocusChanged=function(){var e=this._lastNavigationFocusElement,t=e?e.$():null,i,o,s,a,n,r,c,h,u,g,d,_,f,p,m,v,C=500;if(e&&this.getScrollable()){l.debug("The actually focused element is "+e.getId());if(e.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnectionLabel"){h=t.parent().parent().parent().outerWidth();u=t.parent().parent().parent().outerHeight();g=t.parent().parent().parent().position()}else{h=t.outerWidth();u=t.outerHeight();g=t.position()}l.debug("Element outer width x height ["+h+" x "+u+"]");l.debug("Position of element in the content is ["+g.left+", "+g.top+"]");n=this.$("scroll-content");i=this._getScrollContainer().innerWidth();o=this._getScrollContainer().innerHeight();l.debug("Scroll container inner width x height ["+i+" x "+o+"]");s=this._getScrollContainer().scrollLeft();a=this._getScrollContainer().scrollTop();l.debug("Current scroll offset is ["+s+", "+a+"]");r=n.innerWidth();c=n.innerHeight();l.debug("Scroll content inner width x height ["+r+" x "+c+"]");d=-s+g.left;f=d+h;_=-a+g.top;p=_+u;if(f>i||d<0||p>o||_<0){m=Math.round((i-h)/2);m=Math.max(i-r+g.left,m);m=Math.min(g.left,m);v=Math.round((o-u)/2);v=Math.max(o-c+g.top,v);v=Math.min(g.top,v);l.debug("Element lies outside the scroll container, scrolling from ["+d+","+_+"] to ["+m+","+v+"]");this._isFocusChanged=true;this._getScrollContainer().animate({scrollTop:g.top-v,scrollLeft:g.left-m},C,"swing",jQuery.proxy(this._adjustAndShowArrow,this))}else{l.debug("Element lies inside the scroll container, no scrolling happens.");this._setFocusToNode(e)}}else{this._setFocusToNode(e);this._adjustAndShowArrow()}};g.prototype._setScrollWidth=function(){switch(this.getZoomLevel()){case e.ProcessFlowZoomLevel.One:this._scrollStep=240;break;case e.ProcessFlowZoomLevel.Two:this._scrollStep=192;break;case e.ProcessFlowZoomLevel.Three:this._scrollStep=168;break;case e.ProcessFlowZoomLevel.Four:this._scrollStep=128;break;default:this._scrollStep=192}};g.prototype._getLastNavigationFocusElement=function(){return this._lastNavigationFocusElement};g.prototype._getNode=function(e,t){for(var i=0;i<t.length;i++){if(t[i].getNodeId()===e.toString()){return t[i]}}};g.prototype._getLane=function(e){for(var t=0;t<this._internalLanes.length;t++){if(this._internalLanes[t].getLaneId()===e){return this._internalLanes[t]}}};g.prototype.destroyLanes=function(){this.removeAllAggregation("lanes");for(var e=0;e<this._internalLanes.length;e++){this._internalLanes[e].destroy()}this._internalLanes=[];return this};g._getChildIdByElement=function(e){if(typeof e==="object"){return e.nodeId}else{return e}};g.prototype._isHeaderMode=function(){var e=this.getNodes();return!e||e.length===0};g.prototype._getScrollContainer=function(){return this.$(g._constants.scrollContainer)};g.prototype._handleException=function(e){var t=this._resBundle.getText("PF_ERROR_INPUT_DATA");this.fireOnError({text:t});l.error("Error loading data for the process flow with id : "+this.getId());if(e instanceof Array){for(var i=0;i<e.length;i++){l.error("Detailed description ("+i+") :"+e[i])}}else{l.error("Detailed description  :"+e)}};g.prototype._getAriaText=function(){return this._resBundle.getText("PF_ARIA_PROCESS_FLOW")};g.prototype._updateLanesFromNodes=function(){g.NodeElement._createNodeElementsFromProcessFlowNodes(this.getNodes(),this.getLanes());var e=this._arrangeNodesByParentChildRelation(this.getNodes());this._internalLanes=g.NodeElement._updateLanesFromNodes(this.getLanes(),e).lanes};g.prototype._getOrCreateLaneMap=function(){if(!this._internalLanes||this._internalLanes.length<=0){this._updateLanesFromNodes()}return g.NodeElement._createMapFromLanes(this._internalLanes,jQuery.proxy(this.ontouchend,this),this._isHeaderMode()).positionMap};g.prototype._arrangeNodesByParentChildRelation=function(e){var t=e?e.length:0;var i=[];var o,s;if(t>0){this._setParentForNodes(e);for(o=0;o<t;o++){i=e[o].getChildren();if(i){var a=i.length;for(s=0;s<a;s++){i[s]=g._getChildIdByElement(i[s]).toString()}}for(s=0;s<o;s++){if(i&&Array.prototype.indexOf.call(i,e[s].getNodeId())>-1&&e[s].getLaneId()===e[o].getLaneId()){e.splice(s,0,e[o]);e.splice(o+1,1);e=this._arrangeNodesByParentChildRelation(e);break}}}}return e};g.prototype._getOrCreateProcessFlow=function(){if(!this._internalLanes||this._internalLanes.length<=0){this._updateLanesFromNodes()}else if(this._isLanesUpdated()){this._resetLanesFromModel();this._updateLanesFromNodes()}this.applyNodeDisplayState();var e=this.getNodes();var t=g.NodeElement._createNodeElementsFromProcessFlowNodes(e,this._internalLanes);var i=t.elementById;var o=t.elementsByLane;var s=this._calculateMatrix(i);s=this._addFirstAndLastColumn(s);g.NodeElement._calculateLaneStatePieChart(o,this._internalLanes,e,this);for(var a=0;a<s.length;a++){for(var n=0;n<s[a].length;n++){if(s[a][n]instanceof g.NodeElement){s[a][n]=i[s[a][n].nodeId].oNode}}}this._internalCalcMatrix=s;return s};g.prototype._isLanesUpdated=function(){var e=this.getLanes();if(e.length!=this._internalLanes.length){return true}var t;for(var i=0;i<e.length;i++){var o=e[i];t=false;for(var s=0;s<this._internalLanes.length;s++){var a=this._internalLanes[s];if(a.getLaneId()===o.getLaneId()){t=true;break}}if(!t){return true}}return false};g.prototype._resetLanesFromModel=function(){var e=this.getNodes();e.forEach(function(e){e._mergedLaneId=false});var t=this.getLanes();t.forEach(function(e){e._mergedLanePosition=false});this._internalLanes=[];if(this._isHeaderMode()){var i=this.getBindingInfo("lanes");if(i&&i.model){this.getModel(i.model).refresh()}}else{var o=this.getBindingInfo("nodes");if(o&&o.model){this.getModel(o.model).refresh()}}};g.prototype._addFirstAndLastColumn=function(e){if(!e||e.length<=0){return[]}var t=e.length;for(var i=0;i<t;i++){e[i].unshift(null);e[i].push(null)}return e};g.prototype._calculateMatrix=function(e){var t,i,o,s,a;if(!e||e.length===0){return[]}t=new g.InternalMatrixCalculation(this);t.checkInputNodeConsistency(e);i=t._retrieveInfoFromInputArray(e);t._resetPositions();o=i.highestLanePosition+1;s=Math.max(Object.keys(e).length,2);a=t._createMatrix(s,o);for(var n=0;n<i.rootElements.length;n++){t.iPositionY=i.rootElements[n].lane;a=t.processCurrentElement(i.rootElements[n],e,a)}if(this._isLayoutOptimized){t._optimizeMatrix(a,e)}a=t._doubleColumnsInMatrix(a);a=t._calculatePathInMatrix(a);a=t._removeEmptyLines(a);return a};g.NodeElement=function(e,t,i,o){this.nodeId=e;this.lane=t;this.state=i.getState();this.displayState=i._getDisplayState();this.isProcessed=false;if(Array.isArray(o)){this.aParent=o}else{this.oParent=o}this.oNode=i};g.NodeElement._initNodeElement=function(e,t,i,o){return new g.NodeElement(e,t,i,o)};g.NodeElement.prototype={toString:function(){return this.nodeId},containsChildren:function(e){if(!e){return false}if(!(e instanceof g.NodeElement)){return false}if(this.oNode.getChildren()&&e.oNode.getChildren()&&this.oNode.getChildren().length&&e.oNode.getChildren().length){for(var t=0;t<this.oNode.getChildren().length;t++){if(e.oNode.getChildren().indexOf(this.oNode.getChildren()[t])>=0){return true}}}return false}};g.NodeElement._calculateLaneStatePieChart=function(t,i,o,s){if(!t||!i||!o){return}var a;for(a=0;a<o.length;a++){s._bHighlightedMode=o[a].getHighlighted();if(s._bHighlightedMode){break}}var n,r,l,c,h;for(a=0;a<i.length;a++){var u=i[a];var g=t[u.getLaneId()];if(!g){continue}n=0;r=0;l=0;c=0;h=0;for(var d=0;d<g.length;d++){if(!s._bHighlightedMode||(g[d].oNode._getDisplayState()===e.ProcessFlowDisplayState.Highlighted||g[d].oNode._getDisplayState()===e.ProcessFlowDisplayState.HighlightedFocused||g[d].oNode._getDisplayState()===e.ProcessFlowDisplayState.SelectedHighlighted||g[d].oNode._getDisplayState()===e.ProcessFlowDisplayState.SelectedHighlightedFocused)){switch(g[d].oNode.getState()){case e.ProcessFlowNodeState.Positive:n++;break;case e.ProcessFlowNodeState.Negative:case e.ProcessFlowNodeState.PlannedNegative:r++;break;case e.ProcessFlowNodeState.Planned:c++;break;case e.ProcessFlowNodeState.Critical:h++;break;case e.ProcessFlowNodeState.Neutral:default:l++}}}var _=[{state:e.ProcessFlowNodeState.Positive,value:n},{state:e.ProcessFlowNodeState.Negative,value:r},{state:e.ProcessFlowNodeState.Neutral,value:l},{state:e.ProcessFlowNodeState.Planned,value:c},{state:e.ProcessFlowNodeState.Critical,value:h}];u.setState(_)}};g.NodeElement._updateLanesFromNodes=function(e,t){var i=g.NodeElement._createMapFromLanes(e,null,false);var o=i.positionMap;var s=i.idMap;var a={};var n=e.slice();var r;var l={};var c=0;var h;for(h=0;h<t.length;h++){a[t[h].getNodeId()]=t[h]}for(h=0;h<t.length;h++){var u=t[h];var d=u.getChildren()||[];var _=1;var f=null;var p=null;for(var m=0;m<d.length;m++){var v=g._getChildIdByElement(d[m]);var C=a[v];if(C){if(u.getLaneId()===C.getLaneId()){f=C.getLaneId()+_;p=s[f];if(!p){var N=s[u.getLaneId()];p=g.NodeElement._createNewProcessFlowElement(N,f,N.getPosition()+_);s[p.getLaneId()]=p;n.splice(p.getPosition(),0,p)}C._setMergedLaneId(p.getLaneId())}g.NodeElement._changeLaneOfChildren(u.getLaneId(),C,a)}}if(p){l={};r=false;for(var M in o){if(p.getLaneId()===o[M].getLaneId()){r=true;break}if(parseInt(M,10)>=p.getPosition()){var F=o[M];l[F.getPosition()+_]=F}}if(!r){for(var b in l){c=parseInt(b,10);l[c]._setMergedPosition(c)}l[p.getPosition()]=p;for(var w=0;w<p.getPosition();w++){l[w]=o[w]}o=l}}}return{lanes:n,nodes:t}};g.NodeElement._changeLaneOfChildren=function(e,t,i){var o=t.getChildren();if(o){for(var s=0;s<o.length;s++){var a=g._getChildIdByElement(o[s]);var n=i[a];if(n&&n.getLaneId()===e){n._setMergedLaneId(t.getLaneId());g.NodeElement._changeLaneOfChildren(e,n,i)}}}};g.NodeElement._createNewProcessFlowElement=function(e,t,i){return new a({laneId:t,iconSrc:e.getIconSrc(),text:e.getText(),state:e.getState(),position:i,zoomLevel:e.getZoomLevel()})};g.NodeElement._createMapFromLanes=function(e,t,i){var o,s={},a={},n=e?e.length:0,r=0;if(!n){return{}}else{while(r<n){o=e[r];if(o&&o.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowLaneHeader"){s[o.getPosition()]=o;a[o.getLaneId()]=o;if(t){o.attachPress(t)}o._setHeaderMode(i)}r++}return{positionMap:s,idMap:a}}};g.NodeElement._createNodeElementsFromProcessFlowNodes=function(e,t){var i={},o={},s={},a,n=e?e.length:0,r,l,c=t?t.length:0,h,u=[],d,_,f,p,m,v,C={};if(n===0){return{elementById:{},elementsByLane:{}}}if(c===0){throw["No lane definition although there is a node definition."]}m=0;while(m<c){l=t[m];h=l.getLaneId();d=l.getPosition();if(i[h]){throw["The lane with id: "+h+" is defined at least twice. (Lane error)"]}i[h]=d;if(u&&Array.prototype.indexOf.call(u,d)>-1){throw["The position "+d+" is defined at least twice. (Lane error)."]}else{u.push(d)}o[h]=[];m++}m=0;while(m<n){a=e[m];if(a&&a.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){r=a.getNodeId();h=a.getLaneId();_=a.getChildren()||[];p=_.length;v=0;while(v<p){f=g._getChildIdByElement(_[v]);s[f]=s[f]||[];s[f].push(r);v++}}m++}m=0;while(m<n){a=e[m];if(a&&a.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){r=a.getNodeId();if(!r){throw["There is a node which has no node id defined. (Title="+a.getTitle()+") and array position: "+m]}h=a.getLaneId();d=i[h];if(jQuery.type(d)!=="number"){throw["For the node "+r+" position (lane) is not defined."]}if(!C[r]){C[r]=g.NodeElement._initNodeElement(r,d,a,s[r]);o[h].push(C[r])}else{throw["The node id "+r+" is used second time."]}}m++}return{elementById:C,elementsByLane:o}};g.InternalMatrixCalculation=function(){this.iPositionX=0;this.iPositionY=0;this.nodePositions={};this.mapChildToNode={}};g.InternalMatrixCalculation.prototype._optimizeMatrix=function(e,t){var i;do{i=false;for(var o=0;o<e[0].length;o++){for(var s=0;s<e.length-1;s++){if(!e[s][o]){var a=false;for(var n=s+1;n<e.length;n++){if(e[n][o]){a=true;break}}if(!a){break}if(this._optimizeLane(e,s,o,t)){i=true}}}}}while(i)};g.InternalMatrixCalculation.prototype._optimizeLane=function(e,t,i,o){for(var s=t+1;s<e.length;s++){if(e[s][i]){var a=e[s][i];if(this._verifyOptimizeLane(e,t,s,i,o)){e[t][i]=a;this.nodePositions[a.nodeId].x=t;e[s][i]=null;return true}else{return false}}}return false};g.InternalMatrixCalculation.prototype._verifyOptimizeLane=function(e,t,i,o,s){var a=e[i][o].oNode;var n,r,l,c;if(a&&a.getChildren()){l=e[i][o].oNode.getChildren();for(n=0;n<l.length;n++){c=g._getChildIdByElement(l[n]);var h=s[c].lane;for(r=o+1;r<h;r++){if(e[t][r]){return false}}}}var u=e[i][o].nodeId;var d=this.nodePositions[u];var _=e[i][o].aParent;if(_){for(n=0;n<_.length;n++){c=g._getChildIdByElement(_[n]);if(o-1!==s[c].lane){return false}var f=this.nodePositions[c];if(f.x>=d.x){return false}}}for(n=0;n<o;n++){for(r=0;r<e.length;r++){if(e[r][n]&&e[r][n].oNode){c=e[r][n].nodeId;var p=this.nodePositions[c];l=e[r][n].oNode.getChildren();if(l){for(var m=0;m<l.length;m++){var v=g._getChildIdByElement(l[m]);var C=this.nodePositions[v];if(s[v].lane>o&&!(p.x<t&&C.x<t||p.x>t&&C.x>t)){return false}}}}}}if(a._hasChildren()){for(n=0;n<t;n++){if(e[n][o]){l=e[n][o].oNode.getChildren();if(l){for(r=0;r<l.length;r++){c=g._getChildIdByElement(l[r]);var N=s[c];var M=this.nodePositions[c];if(N.lane>o&&M.x>=t&&!a._hasChildrenWithNodeId(c)){return false}}}}}}return true};g.InternalMatrixCalculation.prototype._resetPositions=function(){this.iPositionX=0;this.iPositionY=0;delete this.nodePositions;delete this.mapChildToNode;this.nodePositions={};this.mapChildToNode={}};g.InternalMatrixCalculation.prototype._createMatrix=function(e){e=parseInt(e,10);var t=new Array(e||0);var i=e;if(arguments.length>1){var o=Array.prototype.slice.call(arguments,1);while(i--){t[e-1-i]=this._createMatrix.apply(this,o)}}return t};g.InternalMatrixCalculation.prototype._retrieveInfoFromInputArray=function(e){var t=0,i=[],o;Object.keys(e).forEach(function(s){o=e[s];if(!o.oParent&&!o.aParent){i.push(o)}if(t<o.lane){t=o.lane}});return{highestLanePosition:t,rootElements:i}};g.InternalMatrixCalculation.prototype._doubleColumnsInMatrix=function(e){var t=0,i;for(i=0;i<e.length;i++){t=t>e[i].length?t:e[i].length}var o=new Array(e.length||0);for(i=0;i<o.length;i++){o[i]=new Array(t*2-1);for(var s=0;s<t;s++){if(e[i][s]){o[i][2*s]=e[i][s]}}}return o};g.InternalMatrixCalculation.prototype._removeEmptyLines=function(e){var t=0,i,o;for(i=0;i<e.length;i++){for(o=0;o<e[i].length;o++){if(e[i][o]){t++;break}}}var s=this._createMatrix(t,e[0].length);for(i=0;i<t;i++){for(o=0;o<e[i].length;o++){s[i][o]=null;if(e[i][o]){s[i][o]=e[i][o]}}}return s};g.InternalMatrixCalculation.prototype._sortBasedOnChildren=function(e,t){var i={},o,s=null,a,n,r,l=[],c,h,u;if(e){e.forEach(function(e){var s=g._getChildIdByElement(e);o=i[t[s].lane];if(!o){i[t[s].lane]=o=[]}o.push(t[s])})}else{return[]}var d=function(e,t){n=(e.oNode.getChildren()||[]).length;r=(t.oNode.getChildren()||[]).length;return r-n};a=[];for(s in i){a.push(s);i[s].sort(d)}a=a.sort(function(e,t){return t-e});var _=function(e){if(u.containsChildren(e)){h.push(e)}};a.forEach(function(e){c=i[e];if(c.length>1){h=[];u=c.shift();while(u){if(h.indexOf(u)<0){h.push(u)}c.forEach(_);u=c.shift()}l=l.concat(h)}else{l=l.concat(c)}});return l};g.InternalMatrixCalculation.prototype._calculatePathInMatrix=function(e){var t=null;for(var i in this.nodePositions){if(this.nodePositions.hasOwnProperty(i)){t=this.nodePositions[i];var o=t.c.oNode.getChildren();for(var s=0;o&&s<o.length;s++){var a=g._getChildIdByElement(o[s]);var n=this.nodePositions[a];e=this._calculateSingleNodeConnection(t,n,t.x,t.y,n.x,n.y,e)}}}return e};g.InternalMatrixCalculation.prototype._calculateSingleNodeConnection=function(e,t,i,o,s,a,n){var r=a-o;var l=s-i;if(r<0){throw["Problem with negative horizontal movement","Parent node is "+e.c.toString(),"Children node is "+t.c.toString(),"Coordinates : '"+i+"','"+o+"','"+s+"','"+a+"'"]}else if(l<=-1){var c=this._checkIfHorizontalLinePossible(n,s,o+2,a);var h=a-1;if(c){h=o+1}var u=i;if(c){u=s}n[i][h]=this._createConnectionElement(n[i][h],g._cellEdgeConstants.LU,e,t,false);n=this._writeVerticalLine(n,i,s,h,e,t);n[s][h]=this._createConnectionElement(n[s][h],g._cellEdgeConstants.UR,e,t,h===a-1);var d=o+2;var _=a;if(!c){d=o+1;_=h+1}n=this._writeHorizontalLine(n,u,d,_,e,t)}else if(l===0){n=this._writeHorizontalLine(n,i,o+1,a,e,t)}else if(l===1){n[i][o+1]=this._createConnectionElement(n[i][o+1],g._cellEdgeConstants.LD,e,t,false);n[s][o+1]=this._createConnectionElement(n[s][o+1],g._cellEdgeConstants.DR,e,t,o+1===a-1);n=this._writeHorizontalLine(n,s,o+2,a,e,t)}else{n[i][o+1]=this._createConnectionElement(n[i][o+1],g._cellEdgeConstants.LD,e,t,false);n=this._writeVerticalLine(n,s,i,o+1,e,t);n[s][o+1]=this._createConnectionElement(n[s][o+1],g._cellEdgeConstants.DR,e,t,o+1===a-1);n=this._writeHorizontalLine(n,s,o+2,a,e,t)}return n};g.InternalMatrixCalculation.prototype._writeVerticalLine=function(e,t,i,o,s,a){for(var n=t-1;n>i;n--){e[n][o]=this._createConnectionElement(e[n][o],g._cellEdgeConstants.DU,s,a,false)}return e};g.InternalMatrixCalculation.prototype._checkIfHorizontalLinePossible=function(e,t,i,o){var s=true;for(var a=i;a<o;a++){if(e[t][a]instanceof g.NodeElement){s=false;break}}return s};g.InternalMatrixCalculation.prototype._writeHorizontalLine=function(e,t,i,o,s,a){var n=t===a.x;if(!n){o--}for(var r=i;r<o;r++){e[t][r]=this._createConnectionElement(e[t][r],g._cellEdgeConstants.LR,s,a,r===o-1&&n)}return e};g.InternalMatrixCalculation.prototype._createConnectionElement=function(e,t,i,o,a){var n=e;if(!n){n=new s}if(n.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){var r=this._calculateConnectionDisplayStateBySourceAndTargetNode(i.c.oNode,o.c.oNode);var l={flowLine:t,targetNodeState:o.c.state,displayState:r,hasArrow:a};n.addConnectionData(l)}return n};g.InternalMatrixCalculation.prototype._calculateConnectionDisplayStateBySourceAndTargetNode=function(t,i){var o=t.getHighlighted();var s=t.getSelected();var a=t._getDimmed();var n=i.getHighlighted();var r=i.getSelected();var l=i._getDimmed();var c=e.ProcessFlowDisplayState.Regular;if(s&&r){c=e.ProcessFlowDisplayState.Selected}else if(o&&n){c=e.ProcessFlowDisplayState.Highlighted}else if(a||l||o&&r||s&&n){c=e.ProcessFlowDisplayState.Dimmed}return c};g.prototype.addNode=function(e){return this.addAggregation("nodes",e,false)};g.prototype._switchCursors=function(e,t,i){if(e.hasClass(t)){e.removeClass(t)}if(!e.hasClass(i)){e.addClass(i)}};g.prototype._clearHandlers=function(e){e.bind(this._mousePreventEvents,jQuery.proxy(this._handlePrevent,this))};g.prototype._initZoomLevel=function(){if(this.$()){var i=this.$().width();if(i){if(i<t.ScreenSizes.tablet){this.setZoomLevel(e.ProcessFlowZoomLevel.Four)}else if(i<t.ScreenSizes.desktop){this.setZoomLevel(e.ProcessFlowZoomLevel.Three)}else{this.setZoomLevel(e.ProcessFlowZoomLevel.Two)}}}};g.prototype._registerMouseWheel=function(e){var t=e.originalEvent.wheelDelta||-e.originalEvent.detail;if(t===0){t=-e.originalEvent.deltaY}if(e&&!e.isDefaultPrevented()){e.preventDefault();e.originalEvent.returnValue=false}var i=300;var o=function(){var e=Date.now()-this._wheelTimestamp;if(e<i){this._wheelTimeout=setTimeout(function(){var e=o.bind(this);if(typeof e==="string"||e instanceof String){e=this[e]}e.apply(this,[])}.bind(this),i-e)}else{this._wheelTimeout=null;this._wheelCalled=false}};if(!this._wheelCalled){this._wheelCalled=true;if(t<0){this._isFocusChanged=true;this.zoomOut()}else{this._isFocusChanged=true;this.zoomIn()}}if(!this._wheelTimeout){this._wheelTimestamp=Date.now();this._wheelTimeout=setTimeout(function(){var e=o.bind(this);if(typeof e==="string"||e instanceof String){e=this[e]}e.apply(this,[])}.bind(this),i)}if(e&&!e.isPropagationStopped()){e.stopPropagation()}if(e&&!e.isImmediatePropagationStopped()){e.stopImmediatePropagation()}};g.prototype._setFocusToNode=function(e){if(e){if(e.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){jQuery(document.getElementById(e.sId)).parent().focus();e._setNavigationFocus(true);e.rerender()}else if(e.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnectionLabel"){e.$().focus();e._setNavigationFocus(true)}}else if(this._lastNavigationFocusElement){if(this._lastNavigationFocusElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){jQuery(document.getElementById(this._lastNavigationFocusElement.sId)).parent().focus();this._lastNavigationFocusElement._setNavigationFocus(true);this._lastNavigationFocusElement.rerender()}else if(this._lastNavigationFocusElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnectionLabel"){this._lastNavigationFocusElement.$().focus();this._lastNavigationFocusElement._setNavigationFocus(true)}}};g.prototype._changeNavigationFocus=function(e,t){if(e&&t&&e.getId()!==t.getId()){l.debug("Rerendering PREVIOUS node with id '"+e.getId()+"' navigation focus : "+e._getNavigationFocus());e._setNavigationFocus(false);if(e.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){e.invalidate()}}if(t){l.debug("Rerendering CURRENT node with id '"+t.getId()+"' navigation focus : "+t._getNavigationFocus());t._setNavigationFocus(true);if(t.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){t.rerender()}this._lastNavigationFocusElement=t;this._onFocusChanged()}};g.prototype._moveOnePage=function(e,t){e=e||g._enumMoveDirection.UP;t=t||false;var i=0,o=0;var s=0,a=0;var n=0;var r=false,l,c,h;for(l=0;l<this._internalCalcMatrix.length;l++){for(c=0;c<this._internalCalcMatrix[l].length;c++){if(this._internalCalcMatrix[l][c]&&this._internalCalcMatrix[l][c].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&this._internalCalcMatrix[l][c]._getNavigationFocus()){i=l;o=c;break}else if(this._internalCalcMatrix[l][c]&&this._internalCalcMatrix[l][c].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){h=this._internalCalcMatrix[l][c]._getVisibleLabel();if(h&&h._getNavigationFocus()){i=l;o=c;break}}}}if(t){if(e===g._enumMoveDirection.UP){for(c=o-1;c>=0&&n<this._jumpOverElements;c--){if(this._internalCalcMatrix[i][c]&&this._internalCalcMatrix[i][c].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[i][c].getHighlighted())){n++;s=i;a=c;r=true}else if(this._internalCalcMatrix[i][c]&&this._internalCalcMatrix[i][c].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){h=this._internalCalcMatrix[i][c]._getVisibleLabel();if(this._labelCanGetFocus(h)){n++;s=i;a=c;r=true}}}}else if(e===g._enumMoveDirection.DOWN){for(c=o+1;c<this._internalCalcMatrix[i].length&&n<this._jumpOverElements;c++){if(this._internalCalcMatrix[i][c]&&this._internalCalcMatrix[i][c].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[i][c].getHighlighted())){n++;s=i;a=c;r=true}else if(this._internalCalcMatrix[i][c]&&this._internalCalcMatrix[i][c].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){h=this._internalCalcMatrix[i][c]._getVisibleLabel();if(this._labelCanGetFocus(h)){n++;s=i;a=c;r=true}}}}}else if(e===g._enumMoveDirection.UP){for(l=i-1;l>=0&&n<this._jumpOverElements;l--){if(this._internalCalcMatrix[l][o]&&this._internalCalcMatrix[l][o].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[l][o].getHighlighted())){n++;s=l;a=o;r=true}else if(this._internalCalcMatrix[l][o]&&this._internalCalcMatrix[l][o].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){h=this._internalCalcMatrix[l][o]._getVisibleLabel();if(this._labelCanGetFocus(h)){n++;s=l;a=o;r=true}}}}else if(e===g._enumMoveDirection.DOWN){for(l=i+1;l<this._internalCalcMatrix.length&&n<this._jumpOverElements;l++){if(this._internalCalcMatrix[l][o]&&this._internalCalcMatrix[l][o].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[l][o].getHighlighted())){n++;s=l;a=o;r=true}else if(this._internalCalcMatrix[l][o]&&this._internalCalcMatrix[l][o].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){h=this._internalCalcMatrix[l][o]._getVisibleLabel();if(this._labelCanGetFocus(h)){n++;s=l;a=o;r=true}}}}if(r){if(this._internalCalcMatrix[i][o]&&this._internalCalcMatrix[i][o].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){this._internalCalcMatrix[i][o]._getVisibleLabel()._setNavigationFocus(false)}else{this._internalCalcMatrix[i][o]._setNavigationFocus(false)}if(this._internalCalcMatrix[s][a]&&this._internalCalcMatrix[s][a].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){h=this._internalCalcMatrix[s][a]._getVisibleLabel();h._setNavigationFocus(true);this._lastNavigationFocusElement=h}else{this._internalCalcMatrix[s][a]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[s][a]}}return r};g.prototype._moveHomeEnd=function(e,t){e=e||g._enumMoveDirection.RIGHT;t=t||false;var i=0,o=0;var s=0,a=0;var n=false,r,l,c;for(r=0;r<this._internalCalcMatrix.length;r++){for(l=0;l<this._internalCalcMatrix[r].length;l++){if(this._internalCalcMatrix[r][l]&&this._internalCalcMatrix[r][l].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&this._internalCalcMatrix[r][l]._getNavigationFocus()){i=r;o=l;break}else if(this._internalCalcMatrix[r][l]&&this._internalCalcMatrix[r][l].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){c=this._internalCalcMatrix[r][l]._getVisibleLabel();if(c&&c._getNavigationFocus()){i=r;o=l;break}}}}if(t){if(e===g._enumMoveDirection.LEFT){for(r=0;r<i;r++){if(this._internalCalcMatrix[r][o]&&this._internalCalcMatrix[r][o].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[r][o].getHighlighted())){s=r;a=o;n=true;break}else if(this._internalCalcMatrix[r][o]&&this._internalCalcMatrix[r][o].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){c=this._internalCalcMatrix[r][o]._getVisibleLabel();if(this._labelCanGetFocus(c)){s=r;a=o;n=true;break}}}}else if(e===g._enumMoveDirection.RIGHT){for(r=this._internalCalcMatrix.length-1;r>i;r--){if(this._internalCalcMatrix[r][o]&&this._internalCalcMatrix[r][o].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[r][o].getHighlighted())){s=r;a=o;n=true;break}else if(this._internalCalcMatrix[r][o]&&this._internalCalcMatrix[r][o].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){c=this._internalCalcMatrix[r][o]._getVisibleLabel();if(this._labelCanGetFocus(c)){s=r;a=o;n=true;break}}}}}else if(e===g._enumMoveDirection.LEFT){for(l=0;l<o;l++){if(this._internalCalcMatrix[i][l]&&this._internalCalcMatrix[i][l].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[i][l].getHighlighted())){s=i;a=l;n=true;break}else if(this._internalCalcMatrix[i][l]&&this._internalCalcMatrix[i][l].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){c=this._internalCalcMatrix[i][l]._getVisibleLabel();if(this._labelCanGetFocus(c)){s=i;a=l;n=true;break}}}}else if(e===g._enumMoveDirection.RIGHT){for(l=this._internalCalcMatrix[i].length-1;l>o;l--){if(this._internalCalcMatrix[i][l]&&this._internalCalcMatrix[i][l].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[i][l].getHighlighted())){s=i;a=l;n=true;break}else if(this._internalCalcMatrix[i][l]&&this._internalCalcMatrix[i][l].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){c=this._internalCalcMatrix[i][l]._getVisibleLabel();if(this._labelCanGetFocus(c)){s=i;a=l;n=true;break}}}}if(n){if(this._internalCalcMatrix[i][o]&&this._internalCalcMatrix[i][o].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){this._internalCalcMatrix[i][o]._getVisibleLabel()._setNavigationFocus(false)}else{this._internalCalcMatrix[i][o]._setNavigationFocus(false)}if(this._internalCalcMatrix[s][a]&&this._internalCalcMatrix[s][a].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){c=this._internalCalcMatrix[s][a]._getVisibleLabel();c._setNavigationFocus(true);this._lastNavigationFocusElement=c}else{this._internalCalcMatrix[s][a]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[s][a]}}return n};g.prototype._moveToNextElement=function(e,t){e=e||g._enumMoveDirection.RIGHT;if(sap.ui.getCore().getConfiguration().getRTL()){if(e===g._enumMoveDirection.RIGHT){e=g._enumMoveDirection.LEFT}else if(e===g._enumMoveDirection.LEFT){e=g._enumMoveDirection.RIGHT}}t=t||1;var i=false;var o=false;var s=0,a=1,n,r,l;if(!this._internalCalcMatrix){return false}var c=0,h=0;for(n=0;n<this._internalCalcMatrix.length;n++){for(r=0;r<this._internalCalcMatrix[n].length;r++){if(this._internalCalcMatrix[n][r]){if(this._internalCalcMatrix[n][r]&&this._internalCalcMatrix[n][r].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&this._internalCalcMatrix[n][r]._getNavigationFocus()){s=c=n;a=h=r;i=true;break}else if(this._internalCalcMatrix[n][r]&&this._internalCalcMatrix[n][r].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){l=this._internalCalcMatrix[n][r]._getVisibleLabel();if(l&&l._getNavigationFocus()&&l.getEnabled()){s=c=n;a=h=r;i=true;break}}}}if(i){break}}if(e===g._enumMoveDirection.RIGHT){for(n=c;n<this._internalCalcMatrix.length;n++){for(r=h+1;r<this._internalCalcMatrix[n].length;r++){if(this._internalCalcMatrix[n][r]&&this._internalCalcMatrix[n][r].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){if(i&&(!this._bHighlightedMode||this._internalCalcMatrix[n][r].getHighlighted())){this._internalCalcMatrix[n][r]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[n][r];o=true;break}}else if(this._internalCalcMatrix[n][r]&&this._internalCalcMatrix[n][r].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){l=this._internalCalcMatrix[n][r]._getVisibleLabel();if(i&&this._labelCanGetFocus(l)){l._setNavigationFocus(true);this._lastNavigationFocusElement=l;o=true;break}}}h=0;if(o){break}}}if(e===g._enumMoveDirection.LEFT){for(n=c;n>=0;n--){for(r=h-1;r>=0;r--){if(this._internalCalcMatrix[n][r]&&this._internalCalcMatrix[n][r].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){if(i&&(!this._bHighlightedMode||this._internalCalcMatrix[n][r].getHighlighted())){this._lastNavigationFocusElement=this._internalCalcMatrix[n][r]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[n][r];o=true;break}}else if(this._internalCalcMatrix[n][r]&&this._internalCalcMatrix[n][r].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){l=this._internalCalcMatrix[n][r]._getVisibleLabel();if(i&&this._labelCanGetFocus(l)){l._setNavigationFocus(true);this._lastNavigationFocusElement=l;o=true;break}}}if(n>0){h=this._internalCalcMatrix[n-1].length}if(o){break}}}var u,d,_;if(e===g._enumMoveDirection.UP){for(n=c-1;n>=0;n--){u=0;while(!o){d=h-u;_=h+u;if(d>=0&&this._internalCalcMatrix[n][d]&&this._internalCalcMatrix[n][d].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){if(i&&(!this._bHighlightedMode||this._internalCalcMatrix[n][d].getHighlighted())){this._internalCalcMatrix[n][d]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[n][d];o=true;break}}else if(d>=0&&this._internalCalcMatrix[n][d]&&this._internalCalcMatrix[n][d].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){l=this._internalCalcMatrix[n][d]._getVisibleLabel();if(i&&this._labelCanGetFocus(l)){l._setNavigationFocus(true);this._lastNavigationFocusElement=l;o=true;break}}if(_<this._internalCalcMatrix[n].length&&this._internalCalcMatrix[n][_]&&this._internalCalcMatrix[n][_].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){if(i&&(!this._bHighlightedMode||this._internalCalcMatrix[n][_].getHighlighted())){this._internalCalcMatrix[n][_]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[n][_];o=true;break}}else if(_>=0&&this._internalCalcMatrix[n][_]&&this._internalCalcMatrix[n][_].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){l=this._internalCalcMatrix[n][_]._getVisibleLabel();if(i&&this._labelCanGetFocus(l)){l._setNavigationFocus(true);this._lastNavigationFocusElement=l;o=true;break}}if(d<0&&_>this._internalCalcMatrix[n].length){break}u++}}}if(e===g._enumMoveDirection.DOWN){for(n=c+1;n<this._internalCalcMatrix.length;n++){u=0;while(!o){d=h-u;_=h+u;if(d>=0&&this._internalCalcMatrix[n][d]&&this._internalCalcMatrix[n][d].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){if(i&&(!this._bHighlightedMode||this._internalCalcMatrix[n][d].getHighlighted())){this._lastNavigationFocusElement=this._internalCalcMatrix[n][d]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[n][d];o=true;break}}else if(d>=0&&this._internalCalcMatrix[n][d]&&this._internalCalcMatrix[n][d].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){l=this._internalCalcMatrix[n][d]._getVisibleLabel();if(i&&this._labelCanGetFocus(l)){l._setNavigationFocus(true);this._lastNavigationFocusElement=l;o=true;break}}if(_<this._internalCalcMatrix[n].length&&this._internalCalcMatrix[n][_]&&this._internalCalcMatrix[n][_].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){if(i&&(!this._bHighlightedMode||this._internalCalcMatrix[n][_].getHighlighted())){this._lastNavigationFocusElement=this._internalCalcMatrix[n][_]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[n][_];o=true;break}}else if(_>=0&&this._internalCalcMatrix[n][_]&&this._internalCalcMatrix[n][_].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){l=this._internalCalcMatrix[n][_]._getVisibleLabel();if(i&&this._labelCanGetFocus(l)){l._setNavigationFocus(true);this._lastNavigationFocusElement=l;o=true;break}}if(d<0&&_>this._internalCalcMatrix[n].length){break}u++}}}if(o){if(this._internalCalcMatrix[s][a]&&this._internalCalcMatrix[s][a].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){this._internalCalcMatrix[s][a]._setNavigationFocus(false)}else{this._internalCalcMatrix[s][a]._getVisibleLabel()._setNavigationFocus(false)}}return o};g.prototype._getScrollContainerOnZoomChanged=function(e,t){e.scrollLeft=Math.round(t.get()[0].scrollWidth/e.scrollWidth*e.scrollLeft);e.scrollTop=Math.round(t.get()[0].scrollHeight/e.scrollHeight*e.scrollTop);e.scrollWidth=t.get()[0].scrollWidth;e.scrollHeight=t.get()[0].scrollHeight;return e};g.prototype._mergeLaneIdNodeStates=function(t){var i=0;var o=0;var s=0;var a=0;var n=0;for(var r=0;r<5;r++){for(var l=0;l<t.length;l++){switch(t[l][r].state){case e.ProcessFlowNodeState.Positive:i=i+t[l][r].value;break;case e.ProcessFlowNodeState.Negative:o=o+t[l][r].value;break;case e.ProcessFlowNodeState.Neutral:s=s+t[l][r].value;break;case e.ProcessFlowNodeState.Planned:a=a+t[l][r].value;break;case e.ProcessFlowNodeState.PlannedNegative:o=o+t[l][r].value;break;case e.ProcessFlowNodeState.Critical:n=n+t[l][r].value;break;default:break}}}return[{state:e.ProcessFlowNodeState.Positive,value:i},{state:e.ProcessFlowNodeState.Negative,value:o},{state:e.ProcessFlowNodeState.Neutral,value:s},{state:e.ProcessFlowNodeState.Planned,value:a},{state:e.ProcessFlowNodeState.Critical,value:n}]};g.prototype._setFocusOnHeader=function(e){var t=this.$("thead");if(e){t.focus();t.addClass("sapSuiteUiCommonsPFHeaderFocused");this._headerHasFocus=true}else{t.removeClass("sapSuiteUiCommonsPFHeaderFocused");this._headerHasFocus=false}};g.prototype._scroll=function(e,t){var i=this._getScrollContainer().get(0);var o=i.scrollLeft;if(!n.browser.edge&&this._bRtl){e=-e}var s=o+e;jQuery(i).stop(true,true).animate({scrollLeft:s},t,jQuery.proxy(this._adjustAndShowArrow,this))};g.prototype._adjustAndShowArrow=function(){this._checkOverflow(this._getScrollContainer().get(0),this.$());if(this.getScrollable()){this._moveArrowAndCounterVertical()}if(this._isFocusChanged){this._setFocusToNode(this._lastNavigationFocusElement);this._isFocusChanged=false}};g.prototype._getScrollingArrow=function(e){var t;if(n.system.desktop){t="sap-icon://navigation-"+e+"-arrow"}else{t="sap-icon://slim-arrow-"+e}var o={src:t};var s="sapPFHArrowScrollLeft";var a="sapPFHArrowScrollRight";var r=["sapPFHArrowScroll",s];var l=["sapPFHArrowScroll",a];if(e===g._constants.left){if(!this._oArrowLeft){this._oArrowLeft=i.getImageControl(this.getId()+g._constants.arrowScrollLeftMinus,null,this,o,r)}return this._oArrowLeft}if(e===g._constants.right){if(!this._oArrowRight){this._oArrowRight=i.getImageControl(this.getId()+g._constants.arrowScrollRightMinus,null,this,o,l)}return this._oArrowRight}};g.prototype._checkScrolling=function(e,t){var i=false;if(e){if(e.scrollWidth>e.clientWidth){i=true}}if(this._arrowScrollable!==i){t.toggleClass("sapPFHScrollable",i);t.toggleClass("sapPFHNotScrollable",!i);this._arrowScrollable=i}return i};g.prototype._updateLeftCounter=function(){var e;if(!this._bRtl){e=this._getScrollContainer().scrollLeft()}else{e=this._getScrollContainer().scrollRightRTL()}var t=Math.round(e/this._scrollStep);this.$(g._constants.counterLeft).text(t.toString());return t};g.prototype._updateRightCounter=function(e,t){var i;var o;if(!this._bRtl){i=this._getScrollContainer().scrollLeft();o=Math.round((t-i-e)/this._scrollStep)}else{i=this._getScrollContainer().scrollLeftRTL();o=Math.round(i/this._scrollStep)}this.$(g._constants.counterRight).text(o.toString());return o};g.prototype._moveArrowAndCounterVertical=function(){var e=this._getScrollContainer().scrollTop();if(e>0){var t=this._iInitialArrowTop-e;var i=this._iInitialCounterTop-e;var o=this._iInitialCounterTop-this._iInitialArrowTop;if(t>0){this.$(g._constants.arrowScrollRight).css(g._constants.top,t+g._constants.px);this.$(g._constants.arrowScrollLeft).css(g._constants.top,t+g._constants.px)}else{this.$(g._constants.arrowScrollRight).css(g._constants.top,"0px");this.$(g._constants.arrowScrollLeft).css(g._constants.top,"0px")}if(i>o){this.$(g._constants.counterRight).css(g._constants.top,i+g._constants.px);this.$(g._constants.counterLeft).css(g._constants.top,i+g._constants.px)}else{this.$(g._constants.counterRight).css(g._constants.top,o+g._constants.px);this.$(g._constants.counterLeft).css(g._constants.top,o+g._constants.px)}}else{this.$(g._constants.arrowScrollRight).css(g._constants.top,this._iInitialArrowTop+g._constants.px);this.$(g._constants.arrowScrollLeft).css(g._constants.top,this._iInitialArrowTop+g._constants.px);this.$(g._constants.counterRight).css(g._constants.top,this._iInitialCounterTop+g._constants.px);this.$(g._constants.counterLeft).css(g._constants.top,this._iInitialCounterTop+g._constants.px)}};g.prototype._checkOverflow=function(e,t){if(this._checkScrolling(e,t)&&e){this._setScrollWidth();var i=false;var o=false;var s=20;var a=this._getScrollContainer().scrollLeft();var n=e.scrollWidth;var r=e.clientWidth;if(Math.abs(n-r)===1){n=r}if(!this._bRtl){if(a>s){i=true}if(n>r&&a+r+s<n){o=true}}else{var l=jQuery(e);if(l.scrollLeftRTL()>s){o=true}if(l.scrollRightRTL()>s){i=true}}this._updateLeftCounter();this._updateRightCounter(r,n);if(o!==this._bPreviousScrollForward||i!==this._bPreviousScrollBack){this._bPreviousScrollForward=o;this._bPreviousScrollBack=i;t.toggleClass("sapPFHScrollBack",i);t.toggleClass("sapPFHNoScrollBack",!i);t.toggleClass("sapPFHScrollForward",o);t.toggleClass("sapPFHNoScrollForward",!o)}}else{this._bPreviousScrollForward=false;this._bPreviousScrollBack=false}};g.prototype._setParentForNodes=function(e){var t=e?e.length:0;var i;var o,s;for(var a in e){e[a].removeAllAssociation(g._constants.parents,true)}for(o=0;o<t;o++){i=e[o].getChildren();if(i){for(s=0;s<i.length;s++){var n=this._getNode(g._getChildIdByElement(i[s]),e);if(n){n.addAssociation(g._constants.parents,e[o],true)}}}}};g.prototype._getConnectionsMap=function(){var e=[];var t=this.getNodes();for(var i=0;i<t.length;i++){var o=this._getPositionOfNodeInMatrix(this._internalCalcMatrix,t[i]);var s=t[i].getChildren();if(s){for(var a=0;a<s.length;a++){var n={};n.sourceNode=t[i];var r=g._getChildIdByElement(s[a]);var l=this._getNode(r,t);if(l){if(typeof s[a]==="object"){n.label=s[a].connectionLabel}n.targetNode=l;var c=this._getPositionOfNodeInMatrix(this._internalCalcMatrix,n.targetNode);n.connectionParts=this._calculateConnectionParts(o,c);e.push(n)}}}}this._internalConnectionMap=e;return e};g.prototype._getPositionOfNodeInMatrix=function(e,t){var i={};for(var o=0;o<e.length;o++){var s=e[o];for(var a=0;a<s.length;a++){var n=s[a];if(n&&n.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&n.getNodeId()===t.getNodeId()){i.y=o;i.x=a;return i}}}return i};g.prototype._calculateConnectionParts=function(e,t){var i=[];var o=e.y;var s=e.x;s++;i.push({x:s,y:o});if(t.y>=e.y){while(o<t.y){o++;i.push({x:s,y:o})}}else{while(o>t.y){o--;i.push({x:s,y:o})}}while(s<t.x-1){s++;i.push({x:s,y:o})}return i};g.prototype._getConnectionMapEntries=function(e){var t=[];var i=null;var o=null;if(this._internalConnectionMap){for(var s=0;s<this._internalConnectionMap.length;s++){o=this._internalConnectionMap[s];if(o.label&&o.label.getId()===e.getId()){i=o;break}}o=null;for(var a=0;a<this._internalConnectionMap.length;a++){o=this._internalConnectionMap[a];if(o.targetNode&&o.targetNode.getNodeId()===i.targetNode.getNodeId()){t.push(o)}}}return t};g.prototype._createLabelPressEventArgs=function(e,t){var i={};var o=[];if(t){for(var s=0;s<t.length;s++){var a={sourceNode:t[s].sourceNode,targetNode:t[s].targetNode,label:t[s].label};o.push(a)}}i.selectedLabel=e;i.connections=o;return i};g.prototype.applyNodeDisplayState=function(){var e=this.getNodes(),t=e?e.length:0,i=0;if(t!==0){while(i<t){e[i]._setRegularState();i++}i=0;while(i<t&&!e[i].getHighlighted()&&!e[i].getSelected()){i++}if(i<t){i=0;while(i<t){if(!e[i].getHighlighted()&&!e[i].getSelected()){e[i]._setDimmedState()}i++}}}};g.InternalMatrixCalculation.prototype.checkInputNodeConsistency=function(e){var t=[],i,o,s,a,n,r=0;Object.keys(e).forEach(function(l){n=e[l];a=n.oNode.getChildren();s=a?a.length:0;if(n.oNode.getFocused()){r++}i=0;while(i<s){o=g._getChildIdByElement(a[i]);if(!e[o]){t.push("Node identificator "+o+" used in children definition is not presented as the node itself. Element : "+n.nodeId)}i++}});if(t.length>0){throw t}return r>1};g.InternalMatrixCalculation.prototype.processCurrentElement=function(e,t,i){var o,s,a=true,n=true;if(e.isProcessed){return i}this.nodePositions[e.nodeId]={c:e,x:this.iPositionX,y:this.iPositionY*2};i[this.iPositionX][this.iPositionY++]=e;o=e.oNode.getChildren();e.isProcessed=true;s=this._sortBasedOnChildren(o,t);if(s){s.forEach(function(e){if(!e.isProcessed){n=false;while(this.iPositionY<e.lane){i[this.iPositionX][this.iPositionY++]=null}i=this.processCurrentElement(e,t,i)}else if(a&&n){this.iPositionX++;a=false}}.bind(this))}if(!o||n){if(a){this.iPositionX++}this.iPositionY=0}return i};g.prototype.getZoomLevel=function(){return this._zoomLevel};g.prototype.setZoomLevel=function(t){if(!this._getScrollContainer()){return}var i=this._getScrollContainer();var o=null;var s;if(i.get().length){o={scrollWidth:i.get()[0].scrollWidth,scrollHeight:i.get()[0].scrollHeight,scrollLeft:i.get()[0].scrollLeft,scrollTop:i.get()[0].scrollTop};s=o;if(this._zoomLevel===t){this._isInitialZoomLevelNeeded=false;return}}if(!(t in e.ProcessFlowZoomLevel)){this._handleException('"'+t+'" is not a valid entry of the enumeration for property zoom level of ProcessFlow');return}this._zoomLevel=t;if(this._isInitialZoomLevelNeeded){this._isInitialZoomLevelNeeded=false;this.invalidate()}else{this.rerender()}if(o){if(n.support.touch){var a=parseInt(this._getScrollContainer().css("height").slice(0,-2),10);var r=parseInt(this._getScrollContainer().css("width").slice(0,-2),10);var l=this._getScrollContainer()[0].scrollHeight;var c=this._getScrollContainer()[0].scrollWidth;if(this.getScrollable()&&(l>a||c>r)){this._switchCursors(this._getScrollContainer(),this._defaultCursorClass,this._grabCursorClass);this._getScrollContainer().css("overflow","auto")}}i=this._getScrollContainer();s=this._getScrollContainerOnZoomChanged(o,i);i.scrollLeft(s.scrollLeft);i.scrollTop(s.scrollTop);this._adjustAndShowArrow();if(this._isFocusChanged){this._setFocusToNode();this._isFocusChanged=false}}};g.prototype.zoomOut=function(){var t=this.getZoomLevel();var i=t;switch(t){case e.ProcessFlowZoomLevel.One:i=e.ProcessFlowZoomLevel.Two;break;case e.ProcessFlowZoomLevel.Two:i=e.ProcessFlowZoomLevel.Three;break;case e.ProcessFlowZoomLevel.Three:i=e.ProcessFlowZoomLevel.Four;break;default:break}this.setZoomLevel(i);return this.getZoomLevel()};g.prototype.zoomIn=function(){var t=this.getZoomLevel();var i=t;switch(t){case e.ProcessFlowZoomLevel.Four:i=e.ProcessFlowZoomLevel.Three;break;case e.ProcessFlowZoomLevel.Three:i=e.ProcessFlowZoomLevel.Two;break;case e.ProcessFlowZoomLevel.Two:i=e.ProcessFlowZoomLevel.One;break;default:break}this.setZoomLevel(i);return this.getZoomLevel()};g.prototype.updateModel=function(){this._lastNavigationFocusElement=null;var e=this.getNodes();e.forEach(function(e){e._mergedLaneId=false});var t=this.getLanes();t.forEach(function(e){e._mergedLanePosition=false});this._internalLanes=[];if(this._isHeaderMode()){var i=this.getBindingInfo("lanes");this.getModel(i.model).refresh()}else{var o=this.getBindingInfo("nodes");this.getModel(o.model).refresh()}this.rerender()};g.prototype.optimizeLayout=function(e){if(e===undefined){e=true}if(this._isLayoutOptimized!==e){this._isLayoutOptimized=e;this.updateModel()}return this};g.prototype.getFocusedNode=function(){return this._lastNavigationFocusElement&&this._lastNavigationFocusElement.sId};g.prototype.updateNodesOnly=function(){var e=this.getBindingInfo("nodes");this.getModel(e.model).refresh();this.rerender()};g.prototype.setSelectedPath=function(e,t){var i=this.getNodes(),o;if(i){if(e&&t){var s=0;for(o=0;o<i.length;o++){if(i[o].getNodeId()===e||i[o].getNodeId()===t){i[o].setSelected(true);s++}else{i[o].setSelected(false)}}if(s===2){this.rerender()}}else if(!e&&!t){for(o=0;o<i.length;o++){i[o].setSelected(false)}this.rerender()}}};g.prototype.setShowLabels=function(e){var t=this.getShowLabels();if(t&&!e){this.setProperty("showLabels",e,true);if(!this.getShowLabels()){this.setSelectedPath(null,null)}}else{this.setProperty("showLabels",e)}return this};g.prototype.setFocusToLabel=function(e){this._changeNavigationFocus(this._lastNavigationFocusElement,e)};g.prototype._labelCanGetFocus=function(e){return e&&e.getEnabled()&&(!this._bHighlightedMode||e._bHighlighted)};g.prototype.getNode=function(e){var t=this.getNodes();for(var i=0;i<t.length;i++){if(t[i].getProperty("nodeId")===e){return t[i]}}};g.prototype.getFocusInfo=function(){var e=document.activeElement;if(e&&e.nodeName){return{sFocusId:e.id,oFocusedElement:e,oFocusInfo:{}}}else{return{}}};g.prototype.applyFocusInfo=function(e){if(e.sFocusId){var t=this._lastNavigationFocusElement;this._changeNavigationFocus(null,t)}};g.prototype.getLane=function(e){var t=this.getLanes();for(var i=0;i<t.length;i++){if(t[i].getProperty("laneId")===e){return t[i]}}};g.prototype.removeAllLanes=function(){this.removeAllAggregation("lanes");this._internalLanes=[]};return g});
//# sourceMappingURL=ProcessFlow.js.map