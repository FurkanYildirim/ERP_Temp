/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 * This code handles S/4 cards in SAP Start and SAP Mobile Start
 */
sap.ui.define(["sap/ushell/utils/UrlParsing","sap/ui/core/Core","sap/base/Log"],function(a,t,e){"use strict";var r="(runtimeURL)";var n=t.getConfiguration().getSAPLogonLanguage();var i=function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";var t="";var e=new window.Uint32Array(40);window.crypto.getRandomValues(e);var r=function(t){var r=e[t]%a.length;return a[r]};while(t.length<40){t+=r(t.length)}return t};var s=function(t,e){var r=JSON.parse(JSON.stringify(t)),n="",i={};if(r.ibnParams&&r.ibnParams["sap-xapp-state-data"]){delete r.ibnParams["sap-xapp-state-data"]}i={target:r.ibnTarget,params:r.ibnParams};if(e){i.appStateKey=e}n=a.constructShellHash(i);n=encodeURI(n);n="#"+n;return n};var o=function(a){var t;if(a){var e=a.getHostInstance();if(e){t=e.getDestination(r,a)}}if(!t){t=Promise.reject("S/4 runtime destination URL could not be determined!")}return t};var u=function(a){var t=a;if(t.indexOf("?")<0){t+="?"}else{t+="&"}t+="sap-language="+n;return t};var p=function(a,t,r){var n={id:t,sessionKey:"",component:"",appName:"",value:r.replaceAll("{","\\{")};return a.request({url:"{{destinations.service}}/sap/opu/odata/UI2/INTEROP/GlobalContainers",method:"POST",parameters:n,headers:{Accept:"application/json","X-CSRF-Token":"{{csrfTokens.token1}}","content-type":"application/json"}}).then(function(a){return}).catch(function(a){e.error("FAILED to save sap-xapp-state-data in S/4")})};var c=function(a){if(a.getParameter("type")!=="Navigation"){return}var t=this.getCard();var r=a.getParameter("parameters");if(r&&r.url){return}var n=r&&r.ibnParams&&r.ibnParams["sap-xapp-state-data"];var c=n?i():"";var v=s(r,c);var l=Promise.resolve();if(v){a.preventDefault(true);if(n){l=p(t,c,r.ibnParams["sap-xapp-state-data"])}l.then(function(){return o(this._oCard)}.bind(this)).then(function(a){if(a){var t=u(a);t+=v;this.getCard().triggerAction({type:"Navigation",parameters:{url:t,target:"_blank"}})}}.bind(this)).catch(function(a){e.error(a)})}};var v=function(a){a.attachAction(c.bind(a))};return{initialize:v,_:{createAppStateId:i,getIntent:s,getRuntimeDestinationUrl:o,addQueryParameter:u,saveXAppState:p,handleAction:c}}});
//# sourceMappingURL=HandleNonS4Environment.js.map