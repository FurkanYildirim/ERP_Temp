/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["../utils/SelectionVariantHelper","sap/fe/navigation/SelectionVariant","sap/m/DynamicDateUtil","sap/ui/comp/util/DateTimeUtil","sap/ui/core/format/DateFormat","../utils/AppConstants","sap/ui/model/odata/v2/ODataModel","sap/ui/core/date/UI5Date"],function(e,t,a,r,i,n,o,l){function u(a,r,i){var n=a.descriptorContent["sap.card"].configuration.parameters;var u=a.descriptorContent["sap.card"]["data"]["request"];var v=false,m={},d={};if(u&&u.batch){v=true;m=u.batch.header||{};d=u.batch.content||{}}var T=a&&n._headerDataUrl,E=a&&n._contentDataUrl;var g=new t;var D=n._relevantODataFilters.value;var h=n._relevantODataParameters.value;var S=n._semanticDateRangeSetting,y=[];if(S){S=JSON.parse(S.value);y=Object.keys(S)||[]}D.forEach(function(e){var a=new t(n[e].value);var r=a.getSelectOption(e);var i=[];if(r&&r.length){if(y.includes(e)){i=p(r[0],"Filter");if(i.length){r[0].Low=i[0];r[0].High=i[1]?i[1]:null;if(r[0].Low&&r[0].High&&r[0].Option!=="BT"){r[0].Option="BT"}g.massAddSelectOption(e,r)}else if(o&&o.prototype.formatValue&&r[0]){r[0].Low=o.prototype.formatValue(r[0].Low,"Edm.DateTime");if(r[0].High){r[0].High=o.prototype.formatValue(r[0].High,"Edm.DateTime")}g.massAddSelectOption(e,r)}}else{if(o&&o.prototype.formatValue&&r[0]&&n[e].type==="datetime"){r[0].Low=o.prototype.formatValue(r[0].Low,"Edm.DateTime");if(r[0].High){r[0].High=o.prototype.formatValue(r[0].High,"Edm.DateTime")}g.massAddSelectOption(e,r)}g.massAddSelectOption(e,r)}}});h.forEach(function(e){var t="";if(n[e].value){if(n[e].value.value){t=n[e].value.value.toString()}else if(n[e].value instanceof Date){t=n[e].value}else{t=n[e].value.toString()}}if(n[e].type==="datetime"&&!y.includes(e)&&!t.includes("datetime")){if(o&&o.prototype.formatValue){t=o.prototype.formatValue(t,"Edm.DateTime");g.addParameter(e,t)}}else if(n[e].type==="datetime"&&y.includes(e)){t=typeof n[e].value==="string"&&Date.parse(n[e].value)?p(l.getInstance(t),"Parameter"):p(t,"Parameter");g.addParameter(e,t[0])}else{g.addParameter(e,t)}});var A=n._entitySet.value;var O=A;if(h.length){var I={};h.forEach(function(e){I[e]=n[e].type});O+=e.getParameterQueryFromSV(g,I);var M=O;if(M&&Array.isArray(M.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm))&&M.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length){O=c(M)}}if(n._urlSuffix.value){O+=n._urlSuffix.value}var H={};D.forEach(function(e){H[e]=n[e].type});var R=e.getFilterQueryFromSV(g,H);var N=R;if(N&&Array.isArray(N.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm))&&N.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length){R=c(N)}var L="",Q="",_="",F="",x={header:"",content:""};if(v){L=f(n,"_header",R,a.descriptorContent["sap.card"].type);Q=L?O+"?"+L:O;if(T&&T.value){var P=s(y,Q);if(P){m.url="{= extension.formatters.formatHeaderDataUrlForSemanticDate() }";T.value=""}else{T.value=Q;if(r){r._headerDataUrl=T.value}}}else if(T){x.header=Q}}if(n._contentDataUrl){_=f(n,"_content",R,a.descriptorContent["sap.card"].type);F=_?O+"?"+_:O;if(n._contentDataUrl.value){var U=s(y,F);if(U){if(v){d.url="{= extension.formatters.formatContentDataUrlForSemanticDate() }"}else{u.url="{= extension.formatters.formatContentDataUrlForSemanticDate() }"}E.value=""}else{E.value=F;if(r){r._contentDataUrl=E.value}}}else{x.content=F;return x}if(i){x.header=Q;x.content=F;return x}}}function s(e,t){var a=e.length?e:[];if(a.length&&t){return a.some(function(e){return t&&t.indexOf(e)>-1})}}function f(e,t,a,r){var i=[];if(a){i.push(a)}if(e[t+"SelectQuery"]&&e[t+"SelectQuery"].value){i.push(e[t+"SelectQuery"].value)}if(e[t+"ExpandQuery"]&&e[t+"ExpandQuery"].value){i.push(e[t+"ExpandQuery"].value)}if(e[t+"SortQuery"]&&e[t+"SortQuery"].value){var n=e[t+"SortQuery"].value;i.push(decodeURI(n)===n?encodeURI(n):n)}if(r==="Table"||r==="List"){i.push("$inlinecount=allpages");i.push("$skip=0&$top=13")}else{if(e[t+"TopQuery"]&&e[t+"TopQuery"].value){i.push(e[t+"TopQuery"].value)}if(e[t+"SkipQuery"]&&e[t+"SkipQuery"].value){i.push(e[t+"SkipQuery"].value)}}return i.length?i.join("&"):null}function c(e){var t=e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length;var a=function(){var t=e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm)[0];var a=t;a=a.replace("%27","");var r=a.lastIndexOf("%27");var i=a.substr(0,r)+a.substr(r+3,a.length-1);return i};for(var r=0;r<t;r++){e=e.replace(e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm)[0],a)}return e}function p(e,t){var r,i=[],o=[],l=false;if(t==="Parameter"){r=e}else if(t==="Filter"){e=typeof e==="string"?JSON.parse(e):e;r=e.Low;if(n.DATE_OPTIONS.SPECIAL_RANGE.includes(r)){i=e.High.split(",")}}var u;if(n.DATE_OPTIONS.RANGE_OPTIONS.includes(r)||n.DATE_OPTIONS.SINGLE_OPTIONS.includes(r)){if(t==="Filter"){u=a.toDates({values:i,operator:r});o.push(u[0].oDate);o.push(u[1].oDate)}else{u=a.toDates({values:i,operator:r});o.push(u[0].oDate)}}if(["DATETIMERANGE","FROMDATETIME","TODATETIME","DATETIME"].includes(r)){l=true}if(o.length){o=v(o,true,l);return o}else if(Date(e)instanceof Date||e instanceof Date||Date.parse(e)){return v([e],true,l)}return[]}function v(e,t,a){var n;e.forEach(function(o,u){if(o.match){if(o.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3})Z?$/gm)&&o.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3})Z?$/gm).length){o=l.getInstance(o)}}o=r.localToUtc(o);if(!a){o=r.normalizeDate(o,true)}if(t){n=i.getDateInstance({pattern:"'datetime'''yyyy-MM-dd'T'HH:mm:ss''",calendarType:"Gregorian"});e[u]=n.format(o,true)}else{var s=i.getDateInstance({pattern:"''yyyy-MM-dd'T'HH:mm:ss.SSS''",calendarType:"Gregorian"});var f=o instanceof Date?o:l.getInstance(o);var c=s.format(f);e[u]=String(c).replace(/'/g,"")}});return e}function m(e,t,r){var i=r;if(e&&t){var n=e.operator;if(n!=="DATE"){return n}else{return e.values[0]}}if(!t){var o=e.operator;var l=e.values;var u="";if(o){switch(o){case"DATE":case"DATERANGE":case"SPECIFICMONTH":case"DATETIMERANGE":case"DATETIME":u="";if(typeof i==="string"){u=i}var s=a.toDates(e);l=s;var f=v(l,false,o==="DATETIMERANGE"||o==="DATETIME");if(!f[1]){f[1]=""}var c={Low:f[0],High:f[1],Option:"BT",Text:u};if(c){c.Text=u;return c}break;case"FROM":case"TO":case"FROMDATETIME":case"TODATETIME":u="";if(typeof i==="string"){u=i}var p=v(l,false,o==="FROMDATETIME"||o==="TODATETIME"),m;m=o==="FROM"||o==="FROMDATETIME"?"GE":"LE";var d={Low:p[0],High:"",Option:m,Text:u};if(d){d.Text=u;return d}break;case"LASTDAYS":case"LASTWEEKS":case"LASTMONTHS":case"LASTQUARTERS":case"LASTYEARS":case"NEXTDAYS":case"NEXTWEEKS":case"NEXTMONTHS":case"NEXTQUARTERS":case"NEXTYEARS":u="";if(typeof i==="string"){u=i}return{Low:o,High:l[0].toString(),Option:"BT",Text:u};case"TODAYFROMTO":u="";if(typeof i==="string"){u=i}var T=l&&l[0];var E=l&&l[1];return{Low:o,High:T.toString()+","+E.toString(),Option:"BT",Text:u};default:u="";if(typeof i==="string"){u=i.substring(0,i.indexOf("(")-1)}return{Low:o,High:null,Option:"EQ",Text:u}}}}}return{processPrivateParams:u,formatSemanticDateTime:p,getDateRangeValue:m}});
//# sourceMappingURL=UrlGenerateHelper.js.map