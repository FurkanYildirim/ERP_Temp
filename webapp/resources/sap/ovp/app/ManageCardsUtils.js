/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/model/json/JSONModel","sap/ui/fl/write/api/ControlPersonalizationWriteAPI","sap/ui/core/Fragment","sap/ovp/cards/PersonalizationUtils","sap/ovp/cards/CommonUtils"],function(a,e,r,t,i,s){"use strict";return a.extend("sap.ovp.app.ManageCardsUtils",{constructor:function(a){if(!a){throw new Error("Main Controller is required to initialize ManageCardsUtil")}},onManageCardsMenuButtonPress:function(){this.aManageCardsDialogModelState=[];var a=s.getApp();var d=this;var o={onManageCardOkButtonPressed:function(e){if(e.getParameters().reason==="Ok"){var r=a.byId("manageCardsSelectionPanel").getP13nData();var t=a.getUIModel().getProperty("/aOrderedCards");var s=[];var o=r.length;for(var n=0;n<o;n++){if(r[n].visible!==t[n].visible){s.push({changeType:"visibility",content:{cardId:r[n].id,visibility:r[n].visible},isUserDependent:true})}r[n].visibility=r[n].visible}a.createOrDestroyCards.apply(a,[d.aManageCardsDialogModelState,r,false]);a.getUIModel().setProperty("/aOrderedCards",r);a.updateDashboardLayoutCards(r);a.updateLayoutWithOrderedCards();i.savePersonalization(s,a.getView());for(var n=0;n<r.length;n++){var l=r[n];var g=a.aErrorCards.indexOf(l.id);if(g>-1&&l.visibility==false){a.aErrorCards.splice(g,1)}}document.querySelector(".sapFAvatar").focus()}var v=a.byId("manageCardsSelectionPanel");var p=a.byId("manageCardsDialog");if(v&&p){v.destroy();p.destroy()}},onManageCardResetButtonPressed:function(){var e=a.getLayout().getMetadata().getName();var t=a.getUIModel();var i=t.getProperty("/aOrderedCards");a.createOrDestroyCards.apply(a,[i,a.aManifestOrderedCards,e==="sap.ovp.ui.DashboardLayout"?true:false]);t.setProperty("/aOrderedCards",a.aManifestOrderedCards);a.resetDashboardLayout();a.updateDashboardLayoutCards(a.aManifestOrderedCards);a.updateLayoutWithOrderedCards();d.manageCardsDialog.getModel().setProperty("/cards",a.aManifestOrderedCards);var s=[];for(var o=0;o<i.length;o++){s.push(a.getView().byId(i[o].id))}var n=d.enhanceOrderedCardsForP13NDialog(i);var l=a.byId("manageCardsSelectionPanel");l.setP13nData(n);r.reset({selectors:s}).finally(function(){document.querySelector(".sapFAvatar").focus()})}};this.oManageCardsFragment=t.load({id:a.getView().getId(),name:"sap.ovp.app.ManageCard",controller:o}).then(function(r){d.manageCardsDialog=r;var t=a.getUIModel().getProperty("/aOrderedCards");var i=Object.assign([],t);d.aManageCardsDialogModelState=d.getManageCardsDialogModelState(t);var s=new e({cards:i});d.manageCardsDialog.setModel(s);a.getView().addDependent(d.manageCardsDialog);d.openManageCardsDialog(t)})},openManageCardsDialog:function(a){var e=s.getApp();var r=this.enhanceOrderedCardsForP13NDialog(a);var t=e.byId("manageCardsDialog");var i=e.byId("manageCardsSelectionPanel");i.setP13nData(r);t.open()},enhanceOrderedCardsForP13NDialog:function(a){var e=[];var r=s.getApp();a.forEach(function(a){e.push(a["id"])});var t=r._getCardsModel();var i=[];var d=r.getLayout().getMetadata().getName();if(d==="sap.ovp.ui.DashboardLayout"){var o=r._getCardArrayAsVariantFormatDashboard();o.forEach(function(a){var r=t.find(function(e){return e.id===a.id});if(e.indexOf(a.id)!=-1){i.push({id:a.id,visibility:a.visibility,visible:a.visibility,name:a.id,label:r.settings.title})}});a=i}else if(d==="sap.ovp.ui.EasyScanLayout"){var n=r.getLayout().getContent();var t=r._getCardsModel();n.forEach(function(a){var r=a.getId();var s=r.split("--").pop();var d=t.find(function(a){return a.id===s});if(e.indexOf(s)!=-1){i.push({id:s,visibility:a.getVisible(),visible:a.getVisible(),name:s,label:d.settings.title})}});a=i}this.aManageCardsDialogModelState=this.getManageCardsDialogModelState(a);r.getUIModel().setProperty("/aOrderedCards",a);this.manageCardsDialog.getModel().setProperty("/cards",a);return a},getManageCardsDialogModelState:function(a){var e=[];for(var r=0;r<a.length;r++){e.push({id:a[r].id,visibility:a[r].visibility})}return e}})});
//# sourceMappingURL=ManageCardsUtils.js.map