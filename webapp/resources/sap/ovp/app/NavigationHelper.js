/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/fe/navigation/PresentationVariant","sap/ovp/cards/AnnotationHelper","sap/ovp/cards/CommonUtils","sap/ovp/cards/Integration/Helpers/Filters","sap/ovp/helpers/ODataAnnotationHelper","sap/ovp/cards/NavigationHelper"],function(t,e,a,r,i,n){"use strict";function o(t){if(t.startsWith("#")){t=t.slice(1)}var e=t.split("-");var a=e[0]||"";var r=e[1]?e[1].split("?")[0]:"";var i={};var n=e[1]?e[1].split("?")[1]:undefined;if(n){var o=n.split("&");for(var s=0;s<o.length;s++){var c=o[s];var l=c.split("=")[0];var v=c.split("=")[1];i[l]=v}}return{semanticObject:a,action:r,parameters:i}}function s(t){if(!t){return false}var e=t.getEntityType();var a=t.getCardPropertiesModel();if(e&&a){var r=a.getProperty("/identificationAnnotationPath");var o=i.getRecords(e,r,t.getView().getModel());var s=t.getModel();if(n.isNavigationInAnnotation(s,o)){return true}}var c=a&&a.getProperty("/template");var l=["sap.ovp.cards.table","sap.ovp.cards.list","sap.ovp.cards.v4.table","sap.ovp.cards.v4.list"];return l.indexOf(c)>-1&&n.checkLineItemNavigation(t.getModel(),t.getEntityType(),a)}function c(t,e){var a=t.getCardPropertiesModel();var r=n.getEntityNavigationEntries(null,t.getModel(),t.getEntityType(),a)||[];var i=r.length>0?r[0]:{};if(e.cardComponentName==="List"||e.cardComponentName==="Table"){var o=t.getCardItemsBinding(),s=o&&o.getAllCurrentContexts(),c=s&&s[0],v=n.getEntityNavigationEntries(c,t.getModel(),t.getEntityType(),a,a.getProperty("/annotationPath")),p=v.length>0?v[0]:{};var u={};var f={};if(i&&i.type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){f=l(t,i)}else if(i&&i.type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){f=g(t,i)}if(p&&p.type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){u=l(t,p)}else if(p&&p.type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){u=g(t,p)}if(u.semanticObject&&u.action&&f.semanticObject&&f.action){f["lineItemSemanticObject"]=u.semanticObject;f["lineItemAction"]=u.action}else if(u.semanticObject&&u.action){u["lineItemSemanticObject"]=u.semanticObject;u["lineItemAction"]=u.action;u.semanticObject="";u.action="";return u}return f}if(i&&i.type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){return l(t,i)}if(i&&i.type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){return g(t,i)}}function l(t,e){if(!sap.ushell.Container){return}var a=sap.ushell.Container.getService("URLParsing");if(!a.isIntentUrl(e.url)){return{type:"url",url:e.url}}else{var r=g(t,e);if(r.semanticObject){return r}else{var i=a.parseShellHash(e.url);return g(t,i)}}}function v(t){var e=u(t);var i=e&&e["sNavPresentationVariant"];if(i&&!a.isJSONData(i)){e["sNavPresentationVariant"]=r.removeExtraInfoVariant(i)}return e}function p(t){var e=[];for(var a=0;a<t.property.length;a++){if(t.property[a]["com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"]&&t.property[a]["com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"].Bool){e.push(t.property[a].name)}}return e}function u(r){var i=r.getCardPropertiesModel(),n=i&&i.getProperty("/staticContent");var o,s;var c=r.getModel();var l=a.isODataV4(c);if(!n){var v=e.getCardSorters(r.getCardPropertiesModel(),l);var u=r.getEntityType();s=v&&new t(v);o=i&&i.getProperty("/staticParameters")}var g=p(u);return{sensitiveProperties:g,staticPropertyMap:o,sNavPresentationVariant:s?s.toJSONObject():null}}function g(t,e){return{type:"intent",semanticObject:e.semanticObject,action:e.action,staticParams:v(t)}}function f(t,e){if(t&&t.length){var r=a.isODataV4(e);for(var i=0;i<t.length;i++){var n=t[i];if(r&&n.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){return true}else if(!r&&n.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){return true}}}return false}function d(t,e,a){if(e&&t){var r=t.getProperty("/identificationAnnotationPath");var n=i.getRecords(e,r,a);return f(n,a)}return false}function m(t,e){if(e&&t){if(t.getProperty("/template")==="sap.ovp.cards.charts.analytical"){var a=t.getProperty("/kpiAnnotationPath");if(a){var r=e[a];if(r&&r.Detail){var i=r.Detail.SemanticObject&&r.Detail.SemanticObject.String;var n=r.Detail.Action&&r.Detail.Action.String;if(i&&n){return true}}}}}return false}function y(t,e,a){if(e&&t){var r=t.getProperty("/annotationPath");var n=i.getRecords(e,r,a);return f(n,a)}return false}return{getNavigationIntentFromAuthString:o,bCheckNavigationForCard:s,getNavigationParameters:c,checkLineItemNavigation:y,checkIdentificationAnnotationNavigation:d,checkKPIAnnotationNavigation:m}},true);
//# sourceMappingURL=NavigationHelper.js.map