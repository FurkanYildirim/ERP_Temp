/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 * @fileOverview Library to Manage rendering of Viz Charts.
 * Any function that needs to be exported(used outside this file) via namespace should be defined as
 * a function and then added to the return statement at the end of this file
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ovp/cards/charts/Utils","sap/ui/model/odata/CountMode","sap/ovp/cards/AnnotationHelper","sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/viz/ui5/api/env/Format","sap/viz/ui5/controls/VizTooltip","sap/ovp/cards/CommonUtils","sap/ovp/cards/OVPCardAsAPIUtils","sap/viz/ui5/data/DimensionDefinition","sap/viz/ui5/data/MeasureDefinition","sap/viz/ui5/controls/common/feeds/FeedItem","sap/ui/core/Element","sap/ovp/app/resources","sap/ovp/app/OVPUtils","sap/base/util/each","sap/base/util/merge","sap/ovp/app/OVPLogger","sap/base/util/isEmptyObject","sap/ovp/cards/Integration/Helpers/AnalyticalCard","sap/ovp/cards/NavigationHelper","sap/ovp/cards/Constants","sap/ovp/cards/MetadataAnalyser"],function(jQuery,e,t,r,a,i,n,o,s,l,u,f,c,v,p,m,g,A,d,h,P,E,C,y){"use strict";var _={LABEL_KEY:"sap:label",LABEL_KEY_V4:"com.sap.vocabularies.Common.v1.Label",TEXT_KEY:"sap:text",TEXT_KEY_V4:"com.sap.vocabularies.Common.v1.Text",TEXT_ARRANGEMENT_ANNO:"com.sap.vocabularies.UI.v1.TextArrangement",TYPE_KEY:"type",DISPLAY_FORMAT_KEY:"sap:display-format",SEMANTICS_KEY:"sap:semantics",UNIT_KEY:"sap:unit",UNIT_KEY_V4_ISOCurrency:"Org.OData.Measures.V1.ISOCurrency",UNIT_KEY_V4_Unit:"Org.OData.Measures.V1.Unit",CURRENCY_CODE:"currency-code",NAME_KEY:"name",NAME_CAP_KEY:"Name",EDM_TYPE:"type",EDM_INT32:"Edm.Int32",EDM_INT64:"Edm.Int64",SCATTER_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Scatter",BUBBLE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bubble",LINE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Line",COLUMNSTACKED_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/ColumnStacked",VERTICALBULLET_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/VerticalBullet",COLUMN_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Column",BAR_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bar",COMBINATION_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Combination",DONUT_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Donut"};var I={CARD_WARNING:"OVP-AC: Analytic card: Warning: ",CARD_ERROR:"OVP-AC: Analytic card Error: ",DATA_ANNO_ERROR:"OVP-AC: Analytic card Error:",CARD_ANNO_ERROR:"OVP-AC: Analytic card: Error ",CHART_ANNO_ERROR:"OVP-AC: Analytic card: Error ",INVALID_CHART_ANNO:"OVP-AC: Analytic Cards: Invalid Chart Annotation.",ANALYTICAL_CONFIG_ERROR:"Analytic card configuration error",CACHING_ERROR:"no model defined while caching OdataMetaData",INVALID_MAXITEMS:"maxItems is Invalid. ",NO_DATASET:"OVP-AC: Analytic Cards: Could not obtain dataset.",SORTORDER_WARNING:"SortOrder is present in PresentationVariant, but it is empty or not well formed.",BOOLEAN_ERROR:"Boolean value is not present in PresentationVariant.",IS_MANDATORY:"is mandatory.",IS_MISSING:"is missing.",NOT_WELL_FORMED:"is not found or not well formed)",MISSING_CHARTTYPE:"Missing ChartType in ",CHART_ANNO:"Chart Annotation.",DATA_ANNO:"Data Annotation",CARD_ANNO:"card annotation.",CARD_CONFIG:"card configuration.",CARD_CONFIG_ERROR:"Could not obtain configuration for ",CARD_CONTAINER_ERROR:"Could not obtain card container. ",DATA_UNAVAIALABLE:"No data available.",CONFIG_LOAD_ERROR:"Failed to load config.json. Reason: ",INVALID_CHARTTYPE:"Invalid ChartType given for ",INVALID_CONFIG:"No valid configuration given for ",CONFIG_JSON:"in config.json",ENTER_INTEGER:"Please enter an Integer.",NO_CARD_MODEL:"Could not obtain Cards model.",ANNO_REF:"com.sap.vocabularies.UI.v1 annotation.",INVALID_REDUNDANT:"Invalid/redundant role configured for ",CHART_IS:"chart is/are ",CARD_CONFIG_JSON:"card from config.json",ALLOWED_ROLES:"Allowed role(s) for ",DIMENSIONS_MANDATORY:"DimensionAttributes are mandatory.",MEASURES_MANDATORY:"MeasureAttributes are mandatory.",CARD_LEAST:"card: Enter at least ",CARD_MOST:"card: Enter at most ",FEEDS:"feed(s).",MIN_FEEDS:"Minimum number of feeds required for ",FEEDS_OBTAINED:"card is not configured. Obtained ",FEEDS_REQUIRED:"feed(s), Required: ",INVALID_SEMANTIC_MEASURES:"More than one measure is being semantically coloured",INVALID_IMPROVEMENT_DIR:"No Improvement Direction Found",INVALID_CRITICALITY:"Invalid criticality values",INVALID_DIMMEAS:"Invalid number of Measures or Dimensions",INVALID_FORECAST:"Invalid/Redundant Datapoint or Forecast measure",INVALID_TARGET:"Invalid/Redundant Datapoint or Target measure",ERROR_MISSING_AXISSCALES:"Minimum and Maximum values are mandatory for AxisScale MinMax to work"};var T=["year","yearweek","yearmonth","yearquarter"];var N=[_.COLUMNSTACKED_CHARTTYPE,_.DONUT_CHARTTYPE,_.COLUMN_CHARTTYPE,_.BAR_CHARTTYPE,_.VERTICALBULLET_CHARTTYPE,_.LINE_CHARTTYPE,_.COMBINATION_CHARTTYPE,_.BUBBLE_CHARTTYPE];var R=[_.COLUMNSTACKED_CHARTTYPE];var D;var b=new d("OVP.charts.VizAnnotationManager");function S(a,i,n,o,s,l,u){var f="{";if(!a||!a.getSetting("ovpCardProperties")){b.error(I.ANALYTICAL_CONFIG_ERROR);f+="}";return f}var c=a.getSetting("dataModel");var v;if(u&&u.EnumMember){v=u.EnumMember.split("/");if(v&&v[1]==="Donut"){c.setDefaultCountMode(t.Inline)}if(v&&v[1]!="Donut"&&s===undefined){return null}}var p=[];var m=[];var d=[];var h=[];var P=[];var E=[];var C=[];var T=n&&n.Parameters;var N=o&&o.SortOrder;var R=o&&o.MaxItems,D=null;var S;var L;var V;var Y=null;var x=_.TEXT_KEY;var F=_.TEXT_KEY_V4;var U=_.UNIT_KEY;var K=_.UNIT_KEY_V4_ISOCurrency;var B=_.UNIT_KEY_V4_Unit;var w={};if(R){D=R.Int32?R.Int32:R.Int}if(D){if(D==="0"){b.error("OVP-AC: Analytic card Error: maxItems is configured as "+D);f+="}";return f}if(!/^\d+$/.test(D)){b.error("OVP-AC: Analytic card Error: maxItems is Invalid. Please enter an Integer.");f+="}";return f}}var k=a.getSetting("ovpCardProperties"),z=k.getProperty("/parameters"),j=k.getProperty("/metaModel");T=T||!!z;if(T){var W=y.resolveParameterizedEntitySet(c,i,n,z);f+="path: '"+W+"'"}else{f+="path: '/"+i.name+"'"}var X=[];Y=a.getSetting("ovpCardProperties").getProperty("/entitySet");if(!c||!Y){return f}var q=ve(c,Y);var Q=a.getSetting("ovpCardProperties").getProperty("/cardLayout");var Z=1,J;var $=H();var ee;var te;if(s&&Q&&Q.colSpan&&Q.colSpan>1){J=Q.colSpan-Z;for(var re in $){if((te=$[re].reference)&&$[te]){var ae=A({},$[te]);$[re]=ae}if(re===v[1]||$[re].time&&$[re].time.type===v[1].toLowerCase()){ee=$[re];break}}var ie=G(s,ee,c,Y);if(ie){ee=ee.time}else{ee=ee.default}var ne=a.getSetting("ovpCardProperties").getProperty("/dataStep");if(!ne){if(ee.resize&&ee.resize.hasOwnProperty("dataStep")&&!isNaN(ee.resize.dataStep)){ne=ee.resize.dataStep}}ne=parseInt(ne,10);if(J>0&&ne&&!isNaN(ne)){D=parseInt(D,10)+ne*J}}if(n){var k=a.getSetting("ovpCardProperties");X=r.getFilters(k,n)}if(X.length>0){f+=", filters: "+JSON.stringify(X)}if(N){var oe=o.SortOrder;if(!oe.length){oe=e.getSortAnnotationCollection(c,o,i)}if(oe.length<1){b.warning(I.CARD_WARNING+I.SORTORDER_WARNING)}else{var se="";var le;var ue;var fe;for(var ce=0;ce<oe.length;ce++){le=oe[ce];fe=le.Property.PropertyPath;C.push(fe);if(typeof le.Descending==="undefined"){ue="true"}else{var pe=le.Descending.Bool||le.Descending.Boolean;if(!pe){b.warning(I.CARD_WARNING+I.BOOLEAN_ERROR);ue="true"}else{ue=pe.toLowerCase()==="true"?"true":"false"}}se=se+"{path: '"+fe+"',descending: "+ue+"},"}f+=", sorter: ["+se.substring(0,se.length-1)+"]"}}var me=a.getSetting("ovpCardProperties").getProperty("/entityType");g(l,function(e,t){S=t.Measure.PropertyPath;if(t.DataPoint&&t.DataPoint.AnnotationPath){var r=me[t.DataPoint.AnnotationPath.substring(1)];if(r.ForecastValue&&(r.ForecastValue.PropertyPath||r.ForecastValue.Path)){var a=r.ForecastValue.PropertyPath||r.ForecastValue.Path;P.push(a);if(q&&q[a]){var i;if(q[a][K]){i=q[a][K].Path?q[a][K].Path:undefined}else if(q[a][B]){i=q[a][B].Path?q[a][B].Path:undefined}else if(q[a][U]){i=q[a][U]}if(i){if((P?Array.prototype.indexOf.call(P,i):-1)===-1){P.push(i)}}}}if(r.TargetValue&&(r.TargetValue.PropertyPath||r.TargetValue.Path)){var n=r.TargetValue.PropertyPath||r.TargetValue.Path;P.push(n);if(q&&q[n]){var i;if(q[n][K]){i=q[n][K].Path?q[n][K].Path:undefined}else if(q[n][B]){i=q[n][B].Path?q[n][B].Path:undefined}else if(q[n][U]){i=q[n][U]}if(i){if((P?Array.prototype.indexOf.call(P,i):-1)===-1){P.push(i)}}}}}P.push(S);if(q&&q[S]){if(q[S][F]){if(q[S][F].String&&S!=q[S][F].String){P.push(q[S][F].String?q[S][F].String:S)}else if(q[S][F].Path&&S!=q[S][F].Path){P.push(q[S][F].Path?q[S][F].Path:S)}}else if(q[S][x]&&S!=q[S][x]){P.push(q[S][x]?q[S][x]:S)}}if(q&&q[S]){var i;if(q[S][K]){i=q[S][K].Path?q[S][K].Path:undefined}else if(q[S][B]){i=q[S][B].Path?q[S][B].Path:undefined}else if(q[S][U]){i=q[S][U]}if(i){if((P?Array.prototype.indexOf.call(P,i):-1)===-1){P.push(i)}}}});g(s,function(e,t){S=t.Dimension.PropertyPath;p.push(S);if(q&&q[S]){if(q[S][F]){if(q[S][F].String&&S!=q[S][F].String){p.push(q[S][F].String?q[S][F].String:S)}else if(q[S][F].Path&&S!=q[S][F].Path){V=q[S][F].Path;var r=V.split("/");if(r.length>1){L=O(j,me,V);if(L!==""){p.push(V);m.push(L);h=M(j,me,V);if(h.length>0){d=d.concat(h)}}}else{p.push(V?V:S)}}}else if(q[S][x]&&S!=q[S][x]){p.push(q[S][x]?q[S][x]:S)}}});if(d.length>0){var ge=0;while(ge<d.length){if(p.indexOf(d[ge])!==-1){d.splice(ge,1)}else{ge++}}}if(P.length>0){g(P,function(e,t){w[t]=true})}if(p.length>0){g(p,function(e,t){w[t]=true})}f+=", parameters: {select:'"+[].concat(p,P).join(",");var Ae=j.getODataEntityType(i.entityType);if(Ae){var de=r.getRequestFields(o);if(de&&de.length>0){g(de,function(e,t){if(!w.hasOwnProperty(t)){w[t]=true;E.push(t)}});if(E.length>0){f+=","+E.join(",")}}}if(C.length>0){var he=[];g(C,function(e,t){if(!w.hasOwnProperty(t)){he.push(t)}});if(he.length>0){f+=","+he.join(",")}}if(m.length>0){f+="'"+","+" expand:'"+m.join(",")}var Pe=r.checkFilterPreference(a.getSetting("ovpCardProperties"));if(Pe){f+="', custom: {cardId: '"+a.getSetting("ovpCardProperties").getProperty("/cardId")+"', _requestFrom: 'ovp_internal'}}"}else{f+="', custom: {_requestFrom: 'ovp_internal'}}"}if(v&&v[1]==="Donut"&&s===undefined){f+=", length: 1"}else if(v&&v[1]==="Donut"&&s&&D){f+=", length: "+(parseInt(D,10)+1)}else if(D){f+=", length: "+D}f+="}";return f}S.requiresIContext=true;function O(e,t,r){var a="";var i=r.split("/");if(i.length>1){for(var n=0;n<i.length-1;n++){var o=e.getODataAssociationEnd(t,i[n]);if(o){t=e.getODataEntityType(o.type);if(a){a=a+"/"}a=a+i[n]}else{return a}}}return a}function M(e,t,r){var a=[];var i=[];var n;var o=r.split("/");if(o.length>1){for(var s=0;s<o.length-1;s++){var l=e.getODataAssociationEnd(t,o[s]);if(l){t=e.getODataEntityType(l.type);if(t){i=t&&t.key&&t.key.propertyRef;for(var u=0;u<i.length;u++){n=o[s]+"/"+i[u].name;a.push(n)}}}}}return a}function L(e,t){var r=false;var a;if(e.DataPoint&&e.DataPoint.AnnotationPath){var i=t[e.DataPoint.AnnotationPath.substring(1)];if(i&&i.ForecastValue&&(i.ForecastValue.PropertyPath||i.ForecastValue.Path)){r=true;a=e}}if(r===true){return a}else{b.warning(I.CARD_WARNING+I.INVALID_FORECAST);return undefined}}function V(e,t){var r=false;var a;if(e.DataPoint&&e.DataPoint.AnnotationPath){var i=t[e.DataPoint.AnnotationPath.substring(1)];if(i&&i.TargetValue&&(i.TargetValue.PropertyPath||i.TargetValue.Path)){r=true;a=e}}if(r===true){return a}else{b.warning(I.CARD_WARNING+I.INVALID_TARGET);return undefined}}function Y(e,t){var r;g(t,function(t,a){if(a.name===e){if(a["com.sap.vocabularies.Common.v1.Label"]){r=a["com.sap.vocabularies.Common.v1.Label"].String?a["com.sap.vocabularies.Common.v1.Label"].String:a["com.sap.vocabularies.Common.v1.Label"].Path}else if(a["sap:label"]){r=a["sap:label"]}return false}});return r}function x(e,t){var r=true;if(t==="line"||t==="column"||t==="bar"){g(e,function(e,t){if(t.getUid()==="valueAxis"||t.getUid()==="categoryAxis"){if(t.getValues().length!=1){r=false;b.warning(I.CARD_WARNING+I.INVALID_DIMMEAS);return false}}})}else if(t==="vertical_bullet"){g(e,function(e,t){if(t.getUid()==="actualValues"||t.getUid()==="categoryAxis"){if(t.getValues().length!=1){r=false;b.warning(I.CARD_WARNING+I.INVALID_DIMMEAS);return false}}})}if(r===true){return true}}function F(e,t,r){var a=_.TYPE_KEY;if(!e||!e[t]||!e[t][a]){return r}var i=["Edm.Int","Edmt.Int16","Edm.Int32","Edm.Int64","Edm.Decimal"];var n=e[t][a];if((i?Array.prototype.indexOf.call(i,n):-1)!==-1){return Number(r)}return r}function U(e){if(e){return e}return""}function K(){var e={locale:function(){},format:function(e,t){var r="";if(t){r=t.split("/")}if(r.length>0){var n,o;if(r.length===3){n=Number(r[1]);o=Number(r[2]);if(isNaN(n)){n=-1}if(isNaN(o)){o=0}}else{n=2;o=0}if(r[0]==="ShortFloat_MFD2"){var l;l=a.getFloatInstance({style:"short",maxFractionDigits:2});return l.format(Number(e))}if(r[0]==="axisFormatter"||r[0]==="ShortFloat"){var l;l=a.getFloatInstance({style:"short",minFractionDigits:n,maxFractionDigits:n?n:1});if(r[0]==="ShortFloat"){l=a.getFloatInstance({style:"short",minFractionDigits:n,maxFractionDigits:n})}if(n===-1){l=a.getFloatInstance({style:"short"})}return l.format(Number(e))}else if(r[0]==="tooltipNoScaleFormatter"){var u=a.getFloatInstance({style:"short",currencyCode:false,shortRefNumber:o,showScale:false,minFractionDigits:n,maxFractionDigits:n});if(n===-1){u=a.getFloatInstance({minFractionDigits:0,currencyCode:false})}return u.format(Number(e))}else if(r[0]==="CURR"){var f=a.getCurrencyInstance({style:"short",currencyCode:false,minFractionDigits:n,maxFractionDigits:n});if(n===-1){f=a.getCurrencyInstance({style:"short",currencyCode:false})}return f.format(Number(e))}else if(r[0].search("%")!==-1){var c=a.getPercentInstance({style:"short",minFractionDigits:n,maxFractionDigits:n});if(n===-1){c=a.getPercentInstance({style:"short",minFractionDigits:1,maxFractionDigits:1})}e=c.format(Number(e));return e}}if(e.constructor===Date){var v=i.getDateTimeInstance({pattern:t});if(t==="YearMonthDay"){v=i.getDateInstance({style:"medium"})}if(t==="YearMonth"||t==="MMM"){v=i.getDateTimeInstance({format:"MMM"})}if(t==="YearQuarter"||t==="Quarter"){v=i.getDateTimeInstance({format:"QQQ"})}if(t==="YearWeek"||t==="Week"){v=i.getDateTimeInstance({format:"www"})}var p=s.getApp();var m=p&&p.bResetChartAxisFormatter;if(m&&t==="hh:mm"){var g=e.toLocaleTimeString();var A=g.split(":");e=A[0]+":"+A[1];return e}var d=m?false:true;e=v.format(new Date(e),d)}return e}};n.numericFormatter(e)}function B(e,t){var r=e.getModel();var a=e.getVizType();if(a!="line"&&a!="bubble"){return}if(!t){t=a==="line"?"categoryAxis":"valueAxis"}var i=e.getModel("ovpCardProperties").getProperty("/entitySet");if(!r||!i){return}var n=ve(r,i);var o=e.getFeeds();for(var s=0;s<o.length;s++){if(o[s].getUid()===t){var l=o[s].getValues();if(!l){return}for(var u=0;u<l.length;u++){if(n[l[u][_.TYPE_KEY]]!="Edm.DateTime"){return}}e.setVizProperties({categoryAxis:{title:{visible:false}}});var f=e&&e.getModel("ovpCardProperties");if(f&&f.getProperty("/bInsightEnabled")){var c=e&&e.getId();P.setVizPropertyMap(c,{categoryAxis:{title:{visible:false}}})}return}}}function w(e,t,r,a,i,n){a=typeof a==="undefined"?false:a;var o=false;var s;if(!e&&a){b.error(i+I.CARD_ERROR+r+I.IS_MANDATORY);return o}if(!e){b.warning(i+I.CARD_WARNING+r+I.IS_MISSING);o=true;return o}s=t[e];if(!s||typeof s!=="object"){var l=a?b.error:b.warning;l(i+I.CARD_ERROR+"in "+r+". ("+e+" "+I.NOT_WELL_FORMED);return o}if(n&&n==="sap.ovp.cards.charts.analytical.analyticalChart"&&r==="Chart Annotation"&&(!s.ChartType||!s.ChartType.EnumMember)){b.error(i+I.CARD_ERROR+I.MISSING_CHARTTYPE+I.CHART_ANNO);return o}o=true;return o}function k(e){var t=false;if(!e){return t}var r;var a;var i;var n;var o;var s;var l;var u="";var f;var c=e.getView();if(c){u="["+c.getId()+"] "}if(!(f=e.getCardPropertiesModel())){b.error(u+I.CARD_ERROR+"in "+I.CARD_CONFIG+I.NO_CARD_MODEL);return t}l=f.getProperty("/entityType");if(!l||h(l)){b.error(u+I.CARD_ERROR+"in "+I.CARD_ANNO);return t}r=f.getProperty("/selectionAnnotationPath");a=f.getProperty("/chartAnnotationPath");n=f.getProperty("/presentationAnnotationPath");o=f.getProperty("/identificationAnnotationPath");s=f.getProperty("/dataPointAnnotationPath");i=f.getProperty("/contentFragment");t=w(r,l,"Selection Variant",false,u);t=w(a,l,"Chart Annotation",true,u,i)&&t;t=w(n,l,"Presentation Variant",false,u)&&t;t=w(o,l,"Identification Annotation",true,u)&&t;t=w(s,l,"Data Point",false,u)&&t;return t}function z(e,t,r){}function H(t){return e.getConfig(t)}function G(e,t,r,a){var i=false;var n;var o;var s;var l;var u;var f;if(!t.time||h(t.time)){return i}if(!e){return i}for(var c=0;c<e.length;c++){if(!e[c].Dimension||!(o=e[c].Dimension.PropertyPath)){return i}n=ve(r,a);if(n&&n[o]){s=n[o][_.TYPE_KEY];l=n[o][_.DISPLAY_FORMAT_KEY];u=n[o][_.SEMANTICS_KEY];f=n[o]["com.sap.vocabularies.Common.v1.IsCalendarYear"]||n[o]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]||n[o]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]||n[o]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]}if(s&&s.lastIndexOf("Edm.Date",0)===0){if(s.toLowerCase()==="edm.datetime"){if(l&&l.toLowerCase()==="date"){i=true}}else{i=true}}if(s==="Edm.String"&&(f||u&&T.indexOf(u)>-1)){i=true}if(i){e.unshift(e.splice(c,1)[0]);break}}return i}function j(e,t,r){var a="";var i=H(t);var n,o;if(!i){return a}a=i.default.type;n=e.getSetting("dataModel");o=e.getSetting("ovpCardProperties").getProperty("/entitySet");if(G(r,i,n,o)){a=i.time.type}return a}j.requiresIContext=true;function W(e,t,r){if(!e.length){return}var a=r==="dimension"?"Dimension":"Measure";var i=[];g(e,function(e,t){if(!t||!t[a]||!t[a].PropertyPath){b.error(I.INVALID_CHART_ANNO);return false}i.push(t[a].PropertyPath)});var n=jQuery.map(t.feeds,function(e){if(e.type===r){if(e.role){return e.role.split("|")}return[]}});n=jQuery.grep(n,function(e,t){return(n?Array.prototype.indexOf.call(n,e):-1)===t}).join(", ");b.error(I.CARD_ERROR+I.INVALID_REDUNDANT+r+"(s) "+i.join(", ")+". "+I.ALLOWED_ROLES+t.type+I.CHART_IS+n)}function X(e,t){var r;if(e){if(e.String){r=e.String}else if(e.Boolean||e.Bool){r=q(e)}else{r=Q(e,t)}}return r}function q(e,t){if(e&&e.Boolean){if(e.Boolean.toLowerCase()==="true"){return true}else if(e.Boolean.toLowerCase()==="false"){return false}}else if(e&&e.Bool){if(e.Bool.toLowerCase()==="true"){return true}else if(e.Bool.toLowerCase()==="false"){return false}}return t}function Q(e,t){var r;if(e){if(e.String){r=Number(e.String)}else if(e.Int){r=Number(e.Int)}else if(e.Decimal){r=Number(e.Decimal)}else if(e.Double){r=Number(e.Double)}else if(e.Single){r=Number(e.Single)}}if(t){var i=a.getFloatInstance({style:"short",minFractionDigits:2,maxFractionDigits:2});if(r){r=i.format(Number(r))}}return r}function Z(e,t){function a(e){if(e){if(e.Path){return"{path:'"+e.Path+"'}"}else{return X(e)}}else{return""}}var i=e[e.measureNames];if(t&&t.CriticalityCalculation&&t.CriticalityCalculation.ImprovementDirection){var n=t.CriticalityCalculation.ImprovementDirection.EnumMember;var o=a(t.CriticalityCalculation.DeviationRangeLowValue);var s=a(t.CriticalityCalculation.DeviationRangeHighValue);var l=a(t.CriticalityCalculation.ToleranceRangeLowValue);var u=a(t.CriticalityCalculation.ToleranceRangeHighValue);return r._calculateCriticalityState(i,n,o,s,l,u,C.Criticality.StateValues)}else{var f=t.Criticality.EnumMember;var c=f?f.split("/"):[];if(c){return c[1]}}}function J(e,t,r){var a,i;g(t,function(t,r){if(r["com.sap.vocabularies.Common.v1.Label"]&&r["com.sap.vocabularies.Common.v1.Label"].String===e.measureNames){a=r.name;return false}else if(r["com.sap.vocabularies.Common.v1.Label"]&&r["com.sap.vocabularies.Common.v1.Label"].Path===e.measureNames){a=r.name;return false}else if(r["sap:label"]===e.measureNames){a=r.name;return false}});g(r,function(e,t){if(t.Measure.PropertyPath===a){if(!t.DataPoint||!t.DataPoint.AnnotationPath){return false}i=t.DataPoint.AnnotationPath;return false}});return i}function $(e,t){if(e){if(e.Path){return e.Path}else{return X(e,t)}}else{return""}}function ee(e,t){function r(e,t){return e&&e.indexOf(t,e.length-t.length)!==-1}var a=false;g(e,function(e,i){if(i.DataPoint&&i.DataPoint.AnnotationPath){var n=t[i.DataPoint.AnnotationPath.substring(1)];if(n&&n.CriticalityCalculation&&n.CriticalityCalculation.ImprovementDirection&&n.CriticalityCalculation.ImprovementDirection.EnumMember){var o=n.CriticalityCalculation.ImprovementDirection.EnumMember;var s=$(n.CriticalityCalculation.DeviationRangeLowValue);var l=$(n.CriticalityCalculation.DeviationRangeHighValue);var u=$(n.CriticalityCalculation.ToleranceRangeLowValue);var f=$(n.CriticalityCalculation.ToleranceRangeHighValue);if(r(o,"Minimize")||r(o,"Minimizing")){if(f&&l){a=true;return false}else{b.warning(I.CARD_WARNING+I.INVALID_CRITICALITY)}}else if(r(o,"Maximize")||r(o,"Maximizing")){if(u&&s){a=true;return false}else{b.warning(I.CARD_WARNING+I.INVALID_CRITICALITY)}}else if(r(o,"Target")){if(u&&s&&f&&l){a=true;return false}else{b.warning(I.CARD_WARNING+I.INVALID_CRITICALITY)}}}else if(n&&n.Criticality){a=true;return false}else{b.warning(I.CARD_WARNING+I.INVALID_IMPROVEMENT_DIR)}}});if(a===true&&e.length>1){b.warning(I.CARD_WARNING+I.INVALID_SEMANTIC_MEASURES)}return a}function te(e,t,r,a){function i(e,t){return e&&e.indexOf(t,e.length-t.length)!==-1}var n=[null,null];var o=true;var s=e.Measure.PropertyPath;if(r[s]){if(r[s][_.LABEL_KEY_V4]){s=ce(r[s][_.LABEL_KEY_V4].String?r[s][_.LABEL_KEY_V4].String:r[s][_.LABEL_KEY_V4].Path,a,r)}else if(r[s][_.LABEL_KEY]){s=r[s][_.LABEL_KEY]}else if(s){s=s}}var l=e.DataPoint.AnnotationPath;var u=t[l.substring(1)];if(!u.CriticalityCalculation||!u.CriticalityCalculation.ImprovementDirection||!u.CriticalityCalculation.ImprovementDirection.EnumMember){return n}var f=u.CriticalityCalculation.ImprovementDirection.EnumMember;var c=$(u.CriticalityCalculation.DeviationRangeLowValue,o);var v=$(u.CriticalityCalculation.DeviationRangeHighValue,o);var m=$(u.CriticalityCalculation.ToleranceRangeLowValue,o);var g=$(u.CriticalityCalculation.ToleranceRangeHighValue,o);if(i(f,"Minimize")||i(f,"Minimizing")){if(g&&v){n[0]=p.getText("MINIMIZING_LESS",[s,g]);n[1]=p.getText("MINIMIZING_MORE",[s,v]);n[2]=p.getText("MINIMIZING_CRITICAL",[g,s,v])}}else if(i(f,"Maximize")||i(f,"Maximizing")){if(m&&c){n[0]=p.getText("MAXIMISING_MORE",[s,m]);n[1]=p.getText("MAXIMISING_LESS",[s,c]);n[2]=p.getText("MAXIMIZING_CRITICAL",[c,s,m])}}else if(i(f,"Target")){if(m&&c&&g&&v){n[0]=p.getText("TARGET_BETWEEN",[m,s,g]);n[1]=p.getText("TARGET_AROUND",[s,c,v]);n[2]=p.getText("TARGET_CRITICAL",[c,s,m,g,v])}}return n}function re(e,t,r){if(t&&t.DataPoint&&t.DataPoint.AnnotationPath){var a=r[t.DataPoint.AnnotationPath.substring(1)];var i,n;if(a&&a.ValueFormat){i=a.ValueFormat}else if(a&&a.NumberFormat){i=a.NumberFormat}if(i&&i.NumberOfFractionalDigits&&i.NumberOfFractionalDigits.Int){n=i.NumberOfFractionalDigits.Int;if(e<Number(n)){e=Number(n)}}}return e}function ae(e,t,r){if(t&&t.DataPoint&&t.DataPoint.AnnotationPath){var a=r[t.DataPoint.AnnotationPath.substring(1)];var i,n;if(a&&a.ValueFormat){i=a.ValueFormat}else if(a&&a.NumberFormat){i=a.NumberFormat}if(i){if(i.ScaleFactor&&i.ScaleFactor.Decimal){n=Number(i.ScaleFactor.Decimal)}else if(i.ScaleFactor&&i.ScaleFactor.Int){n=Number(i.ScaleFactor.Int)}if(!isNaN(n)){if(e===undefined){e=Number(n)}else if(e>Number(n)){e=Number(n)}}}}return e}function ie(e,t){if(e&&e[t]&&(e[t]["Org.OData.Measures.V1.ISOCurrency"]||e[t][_.SEMANTICS_KEY]&&e[t][_.SEMANTICS_KEY]===_.CURRENCY_CODE)){return true}return false}function ne(e,t,r){if(e[t[r].PropertyPath][_.EDM_TYPE]===_.EDM_INT32){return true}return false}function oe(e,t,r){if(e[t[r].PropertyPath][_.EDM_TYPE]===_.EDM_INT64){return true}return false}function se(e,t,r){var a,i,n,s,v;var m,d,h,E,y,T=false;var S;var O,M,F;var U,K=[],B=[];var w;var k;var z=r&&r.getView();var j,X;var q=z&&z.getModel("ui");var Q=q&&q.getProperty("/chartSettings");a=e.getModel("ovpCardProperties");if(l.checkIfAPIIsUsed(r)){T=a&&a.getData()&&a.getData().showDataLabel}v=Q?Q.showDataLabel:T;m=e.getVizType();d=H();for(var $ in d){if((k=d[$].reference)&&d[k]){var se=A({},d[k]);d[$]=se}if(d[$].default.type===m||d[$].time&&d[$].time.type===m){h=d[$];break}}if(!h){b.error(I.CARD_ERROR+"in "+I.CARD_CONFIG+I.CARD_CONFIG_ERROR+m+" "+I.CARD_CONFIG_JSON);return}if(!a){b.error(I.CARD_ERROR+"in "+I.CARD_CONFIG+I.NO_CARD_MODEL);return}var fe=e.getModel();var ge=a.getProperty("/entitySet");if(!fe||!ge){return}i=a.getProperty("/entityType");if(!i){b.error(I.CARD_ANNO_ERROR+"in "+I.CARD_ANNO);return}var Ae=ve(fe,ge);n=a.getProperty("/chartAnnotationPath");if(!n||!(s=i[n])){b.error(I.CARD_ANNO_ERROR+"in "+I.CARD_ANNO);return}var de=le(i,n,e);if(!(E=s.DimensionAttributes)||!E.length){b.error(I.CHART_ANNO_ERROR+"in "+I.CHART_ANNO+" "+I.DIMENSIONS_MANDATORY);return}var he;if(!(y=s.MeasureAttributes)||!y.length){b.error(I.CHART_ANNO_ERROR+"in "+I.CHART_ANNO+" "+I.MEASURES_MANDATORY);return}else{var Pe=y[0].DataPoint?i[y[0].DataPoint.AnnotationPath.substring(1)]:null;var Ee=Pe&&Pe.ValueFormat&&Pe.ValueFormat.NumberOfFractionalDigits&&Pe.ValueFormat.NumberOfFractionalDigits.Int;he=Ee?Ee:0}w=G(E,h,fe,ge);if(w){h=h.time}else{h=h.default}var Ce=a.getProperty("/ChartProperties")||a.getProperty("/chartProperties");if(a&&a.getProperty("/tabs")&&Ce===undefined){j=z.byId("ovp_card_dropdown");X=parseInt(j.getSelectedKey(),10);Ce=a.getProperty("/tabs")&&a.getProperty("/tabs")[X-1]&&(a.getProperty("/tabs")[X-1]["ChartProperties"]||a.getProperty("/tabs")[X-1]["chartProperties"])}var ye=false;var _e=he>0?"tooltipNoScaleFormatter/"+he.toString()+"/":"tooltipNoScaleFormatter/-1/";var Re=new o({formatString:_e});Re.connect(e.getVizUid());Re.connect(e.getVizUid());e._oOvpVizFrameTooltip=Re;[h.dimensions,h.measures].forEach(function(e,t){var r=t?y:E;var a=t?"measure(s)":"dimension(s)";if(e.min&&r.length<e.min){b.error(I.CARD_ERROR+"in "+m+" "+I.CARD_LEAST+e.min+" "+a);ye=true}if(e.max&&r.length>e.max){b.error(I.CARD_ERROR+"in "+m+I.CARD_MOST+e.max+" "+a);ye=true}});if(ye){return}var De=true;if(h.properties&&h.properties.hasOwnProperty("hideLabel")&&!h.properties["hideLabel"]){De=false}var be=true;var Se=false;if(m==="donut"){Se=true}e.removeAllAggregation();S={legend:{isScrollable:false},title:{visible:true},interaction:{noninteractiveMode:be?false:true,selectability:{legendSelection:Se?true:false,axisLabelSelection:false,mode:"EXCLUSIVE",plotLassoSelection:false,plotStdSelection:true},zoom:{enablement:"disabled"}},plotArea:{window:{start:"firstDataPoint",end:"lastDataPoint"},dataLabel:{visible:v||Se?true:false,type:"value"},dataPoint:{invalidity:"ignore"},alignment:{vertical:"top"}},categoryAxis:{label:{truncatedLabelRatio:.15}},general:{groupData:false,showAsUTC:true}};if(h.properties&&h.properties.semanticColor===true&&ee(y,i)){var Oe=p.getText("GOOD");var Me=p.getText("BAD");var Le=p.getText("CRITICAL");var Ve=p.getText("OTHERS");if(y.length===1){var Ye=te(y[0],i,Ae,e);var Oe=Ye[0]||Oe,Me=Ye[1]||Me,Le=Ye[2]||Le,Ve=p.getText("OTHERS")}S.plotArea.dataPointStyle={rules:[{callback:function(e){var t=J(e,Ae,y);if(!t){return false}var r=i[t.substring(1)];var a=Z(e,r);if(a===C.Criticality.StateValues.Positive){return true}else if(a==="Positive"){return true}},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},displayName:Oe},{callback:function(e){var t=J(e,Ae,y);if(!t){return false}var r=i[t.substring(1)];var a=Z(e,r);if(a===C.Criticality.StateValues.Critical){return true}else if(a==="Critical"){return true}},properties:{color:"sapUiChartPaletteSemanticCriticalLight1"},displayName:Le},{callback:function(e){var t=J(e,Ae,y);if(!t){return false}var r=i[t.substring(1)];var a=Z(e,r);if(a===C.Criticality.StateValues.Negative){return true}else if(a==="Negative"){return true}},properties:{color:"sapUiChartPaletteSemanticBadLight1"},displayName:Me},{callback:function(e){var t=J(e,Ae,y);if(!t){return false}var r=i[t.substring(1)];var a=Z(e,r);if(a===C.Criticality.StateValues.None){return true}else if(a==="Neutral"){return true}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},displayName:Ve}]}}var xe=a.getProperty("/bEnableStableColors");var Fe=a.getProperty("/colorPalette");var Ue;if(!xe&&N.indexOf(s.ChartType.EnumMember)>=0&&Fe&&Object.keys(Fe).length>=2&&Object.keys(Fe).length<=4){g(E,function(e,t){if(t&&t.Role&&t.Role.EnumMember==="com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Series"){Ue=t.Dimension&&t.Dimension.PropertyPath;return}});var Ke;if(Ue){if(Ae&&Ae[Ue]){if(Ae[Ue][_.LABEL_KEY_V4]){Ke=ce(Ae[Ue][_.LABEL_KEY_V4].String?Ae[Ue][_.LABEL_KEY_V4].String:Ae[Ue][_.LABEL_KEY_V4].Path,e,Ae)}else if(Ae[Ue][_.LABEL_KEY]){Ke=Ae[Ue][_.LABEL_KEY]}else if(Ue){Ke=Ue}}if(Fe instanceof Array){var Be=Fe.map(function(e){return e.color});var we=Fe.map(function(e){return e.legendText});var ke=we[0]!=undefined?we[0]:p.getText("OTHERS");var ze=we[1]!=undefined?we[1]:p.getText("BAD");var He=we[2]!=undefined?we[2]:p.getText("CRITICAL");var Ge=we[3]!=undefined?we[3]:p.getText("GOOD")}S.plotArea.dataPointStyle={rules:[{callback:function(e){if(e&&(e[Ke]==="3"||e[Ke]===3)){if(Fe instanceof Array){if(Fe.length<4){return false}}else if(Fe&&!Fe.hasOwnProperty(3)){return false}return true}},properties:{color:Fe instanceof Array&&Be.length?Be[3]:Fe[3]&&Fe[3]["color"]},displayName:Ge||Fe[3]&&Fe[3]["legendText"]},{callback:function(e){if(e&&(e[Ke]==="2"||e[Ke]===2)){if(Fe instanceof Array){if(Fe.length<3){return false}}else if(Fe&&!Fe.hasOwnProperty(2)){return false}return true}},properties:{color:Fe instanceof Array&&Be.length?Be[2]:Fe[2]&&Fe[2]["color"]},displayName:He||Fe[2]&&Fe[2]["legendText"]},{callback:function(e){if(e&&(e[Ke]==="1"||e[Ke]===1)){return true}},properties:{color:Fe instanceof Array&&Be.length?Be[1]:Fe[1]&&Fe[1]["color"]},displayName:ze||Fe[1]&&Fe[1]["legendText"]},{callback:function(e){if(e&&(e[Ke]==="0"||e[Ke]===0)){return true}},properties:{color:Fe instanceof Array&&Be.length?Be[0]:Fe[0]&&Fe[0]["color"]},displayName:ke||Fe[0]&&Fe[0]["legendText"]}]};var je;if(a&&a.getProperty("/bInsightEnabled")){je=A({},S.plotArea.dataPointStyle);var We=Ae&&Ae[Ue]&&Ae[Ue].type||"";je.rules.forEach(function(e,t,r){delete e["callback"];e.dataContext={};if(We){e.dataContext[Ke]=We==="Edm.String"?r.length-1-t+"":r.length-1-t}else{e.dataContext[Ke]=r.length-1-t+""}})}}}var Xe=false;var qe=false;if(s.ChartType.EnumMember===_.SCATTER_CHARTTYPE||s.ChartType.EnumMember===_.BUBBLE_CHARTTYPE||s.ChartType.EnumMember===_.LINE_CHARTTYPE){if(s&&s.AxisScaling&&s.AxisScaling.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"){var Qe=s.AxisScaling;if(Qe.AutoScaleBehavior&&Qe.AutoScaleBehavior.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisAutoScaleBehaviorType"){var Ze=Qe.AutoScaleBehavior;if(Ze.ZeroAlwaysVisible&&Ze.ZeroAlwaysVisible.Bool=="true"){S.plotArea.adjustScale=false;Xe=true}else if(Ze.DataScope){S.plotArea.adjustScale=true;Xe=true}}else if(Qe.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"&&Qe.ScaleBehavior&&Qe.ScaleBehavior.EnumMember){var Je=Qe.ScaleBehavior.EnumMember;var $e=Je.substring(Je.lastIndexOf("/")+1,Je.length);if($e=="FixedScale"){qe=true}}}else if(s&&s.AxisScaling&&s.AxisScaling.EnumMember){var et=s.AxisScaling.EnumMember.substring(s.AxisScaling.EnumMember.lastIndexOf("/")+1,s.AxisScaling.EnumMember.length);switch(et){case"AdjustToDataIncluding0":S.plotArea.adjustScale=false;Xe=true;break;case"AdjustToData":S.plotArea.adjustScale=true;Xe=true;break;case"MinMaxValues":qe=true;break;default:break}}if(qe){var tt=[];if(s["MeasureAttributes"][0]&&s["MeasureAttributes"][0].DataPoint&&s["MeasureAttributes"][0].DataPoint.AnnotationPath){var rt=s["MeasureAttributes"][0].DataPoint.AnnotationPath;var at=rt.substring(rt.lastIndexOf("@")+1,rt.length);if(i&&i[at]){var it=i[at];if(it&&it.MaximumValue&&it.MaximumValue.Decimal&&it.MinimumValue&&it.MinimumValue.Decimal){tt.push({feed:"valueAxis",max:it.MaximumValue.Decimal,min:it.MinimumValue.Decimal});Xe=true}else{b.error(I.ERROR_MISSING_AXISSCALES)}}}if(s.ChartType.EnumMember!==_.LINE_CHARTTYPE&&s["MeasureAttributes"][1]&&s["MeasureAttributes"][1].DataPoint&&s["MeasureAttributes"][1].DataPoint.AnnotationPath){var rt=s["MeasureAttributes"][1].DataPoint.AnnotationPath;var at=rt.substring(rt.lastIndexOf("@")+1,rt.length);if(i&&i[at]){var it=i[at];if(it&&it.MaximumValue&&it.MaximumValue.Decimal&&it.MinimumValue&&it.MinimumValue.Decimal){tt.push({feed:"valueAxis2",max:it.MaximumValue.Decimal,min:it.MinimumValue.Decimal});Xe=true}else{b.error(I.ERROR_MISSING_AXISSCALES)}}}e.setVizScales(tt)}}M=E.slice();F=y.slice();var nt=0;var ot=0;var st;var lt;var ut=false;var ft=false;var ct;var vt=[];var pt=[],mt=[];if((m==="column"||m==="bar"||m==="vertical_bullet")&&h.feeds&&h.feeds.length>0){var gt;for(gt=0;gt<h.feeds.length;gt++){if(h.feeds[gt].uid==="color"){h.feeds.splice(gt,1);break}}for(gt=0;gt<h.feeds.length;gt++){if(h.feeds[gt].uid==="categoryAxis"){delete h.feeds[gt].role;break}}if(a.getProperty("/colorPalette")){for(gt=0;gt<h.feeds.length;gt++){if(h.feeds[gt].uid==="categoryAxis"){h.feeds[gt].role="Category";break}}h.feeds.push({uid:"color",min:1,type:"dimension",role:"Series"})}}g(h.feeds,function(t,r){var n=r.uid;var o=[];if(r.type){var s,l,v;if(r.type==="dimension"){s=E.length;l="Dimension";v="dimensions";O=M;U=K}else{s=y.length;l="Measure";v="measures";O=F;U=B}var p=0,A=s;if(r.min){p=p>r.min?p:r.min}if(r.max){A=A<r.max?A:r.max}if(!r.role){var d=O.length;for(var C=0;C<d&&o.length<A;++C){var T=O[C];O.splice(C,1);--d;--C;o.push(T);if(Ae[T[l].PropertyPath][_.UNIT_KEY_V4_ISOCurrency]){ct=Ae[T[l].PropertyPath][_.UNIT_KEY_V4_ISOCurrency].Path?Ae[T[l].PropertyPath][_.UNIT_KEY_V4_ISOCurrency].Path:undefined}else if(Ae[T[l].PropertyPath][_.UNIT_KEY_V4_Unit]){ct=Ae[T[l].PropertyPath][_.UNIT_KEY_V4_Unit].Path?Ae[T[l].PropertyPath][_.UNIT_KEY_V4_Unit].Path:undefined}else if(Ae[T[l].PropertyPath][_.UNIT_KEY]){ct=Ae[T[l].PropertyPath][_.UNIT_KEY]}if(ie(Ae,ct)){ut=true}else{ft=true}if(!ut){nt=re(nt,T,i);st=ae(st,T,i)}else{ot=re(ot,T,i);lt=ae(lt,T,i)}}}else{var N=r.role.split("|");g(N,function(e,t){if(o.length===A){return false}var r=O.length;for(var a=0;a<r&&o.length<A;++a){var n=O[a];if(n&&n.Role&&n.Role.EnumMember&&n.Role.EnumMember.split("/")&&n.Role.EnumMember.split("/")[1]){var s=n.Role.EnumMember.split("/")[1];if(s===t){O.splice(a,1);--r;--a;o.push(n);if(Ae[n[l].PropertyPath][_.UNIT_KEY_V4_ISOCurrency]){ct=Ae[n[l].PropertyPath][_.UNIT_KEY_V4_ISOCurrency].Path?Ae[n[l].PropertyPath][_.UNIT_KEY_V4_ISOCurrency].Path:undefined}else if(Ae[n[l].PropertyPath][_.UNIT_KEY_V4_Unit]){ct=Ae[n[l].PropertyPath][_.UNIT_KEY_V4_Unit].Path?Ae[n[l].PropertyPath][_.UNIT_KEY_V4_Unit].Path:undefined}else if(Ae[n[l].PropertyPath][_.UNIT_KEY]){ct=Ae[n[l].PropertyPath][_.UNIT_KEY]}if(ie(Ae,ct)){ut=true}else{ft=true}if(!ut){nt=re(nt,n,i);st=ae(st,n,i)}else{ot=re(ot,n,i);lt=ae(lt,n,i)}}}else if((U?Array.prototype.indexOf.call(U,n):-1)===-1){U.push(n)}}});if(o.length<A){g(U,function(e,t){var r;var a;if((r=h[v].defaultRole)&&(N?Array.prototype.indexOf.call(N,r):-1)!==-1&&(a=(O?Array.prototype.indexOf.call(O,t):-1)!==-1)){O.splice(a,1);o.push(t);if(Ae[t[l].PropertyPath][_.UNIT_KEY_V4_ISOCurrency]){ct=Ae[t[l].PropertyPath][_.UNIT_KEY_V4_ISOCurrency].Path?Ae[t[l].PropertyPath][_.UNIT_KEY_V4_ISOCurrency].Path:undefined}else if(Ae[t[l].PropertyPath][_.UNIT_KEY_V4_Unit]){ct=Ae[t[l].PropertyPath][_.UNIT_KEY_V4_Unit].Path?Ae[t[l].PropertyPath][_.UNIT_KEY_V4_Unit].Path:undefined}else if(Ae[t[l].PropertyPath][_.UNIT_KEY]){ct=Ae[t[l].PropertyPath][_.UNIT_KEY]}if(ie(Ae,ct)){ut=true}else{ft=true}if(!ut){nt=re(nt,t,i);st=ae(st,t,i)}else{ot=re(ot,t,i);lt=ae(lt,t,i)}if(o.length===A){return false}}})}if(o.length<p){b.error(I.CARD_ERROR+I.MIN_FEEDS+m+" "+I.FEEDS_OBTAINED+o.length+" "+I.FEEDS_REQUIRED+p+" "+I.FEEDS);return false}}if(o.length){var R=[];var L;if(!(L=e.getDataset())){b.error(I.NO_DATASET);return false}D=i;g(o,function(t,r){if(!r||!r[l]||!r[l].PropertyPath){b.error(I.INVALID_CHART_ANNO);return false}var i=r[l].PropertyPath;var o=i;var s=i;var c=null;if(Ae&&Ae[i]){if(Ae[i][_.LABEL_KEY_V4]){if(Ae[i][_.LABEL_KEY_V4].String){o=ce(Ae[i][_.LABEL_KEY_V4].String,e,Ae)}else if(Ae[i][_.LABEL_KEY_V4].Path){o=Ae[i][_.LABEL_KEY_V4].Path}else{o=i}}else if(Ae[i][_.LABEL_KEY]){o=Ae[i][_.LABEL_KEY]}else if(i){o=i}if(Ae[i][_.TEXT_KEY_V4]){s=Ae[i][_.TEXT_KEY_V4].String?Ae[i][_.TEXT_KEY_V4].String:Ae[i][_.TEXT_KEY_V4].Path}else if(Ae[i][_.TEXT_KEY]){s=Ae[i][_.TEXT_KEY]}else if(i){s=i}c=Ae[i][_.TYPE_KEY]||null}var v,p={};p[i]=s;if((c==="Edm.DateTime"||c==="Edm.DateTimeOffset")&&s===i){v="{path:'"+i+"', formatter: 'sap.ovp.cards.charts.VizAnnotationManager.returnDateFormat'}"}else{if(Ae[i]&&Ae[i][_.TEXT_KEY_V4]&&Ae[i][_.TEXT_KEY_V4][_.TEXT_ARRANGEMENT_ANNO]){var m,g;m=Ae[i][_.TEXT_ARRANGEMENT_ANNO];g=m&&m.EnumMember;if(!g){m=Ae[i][_.TEXT_KEY_V4][_.TEXT_ARRANGEMENT_ANNO];g=m&&m.EnumMember}if(!g){var A=D;m=A&&A[_.TEXT_ARRANGEMENT_ANNO];g=m&&m.EnumMember}switch(g){case"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst":v="{"+s+"}"+" "+"("+"{"+i+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast":v="{"+i+"}"+" "+"("+"{"+s+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly":v="{"+s+"}";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeperate":v="{"+i+"}"+" "+"("+"{"+s+"}"+")";break;default:v="{"+i+"}";p[i]=i;break}}else{v="{"+s+"}"}if(a&&a.getProperty("/bInsightEnabled")){P.setDimensionPath(a.getData().cardId,i,v)}}R.push(o);if(l==="Dimension"){if(n==="waterfallType"){var d=new u({name:o,value:"{"+i+"}"})}else{var d=new u({name:o,value:"{"+i+"}",displayValue:v})}var h=Ae[i][_.SEMANTICS_KEY];var E=Ae[i]["com.sap.vocabularies.Common.v1.IsCalendarYear"]&&Ae[i]["com.sap.vocabularies.Common.v1.IsCalendarYear"].Bool||Ae[i]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]&&Ae[i]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"].Bool||Ae[i]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]&&Ae[i]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"].Bool||Ae[i]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]&&Ae[i]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"].Bool;if(w&&(c==="Edm.DateTime"||E||c==="Edm.DateTimeOffset"||h&&h.lastIndexOf("year",0)===0)){d.setDataType("date")}L.addDimension(d);if((mt?Array.prototype.indexOf.call(mt,o):-1)===-1){mt.push(o)}}else{L.addMeasure(new f({name:o,value:"{"+i+"}"}));if((pt?Array.prototype.indexOf.call(pt,o):-1)===-1&&n!="bubbleWidth"){pt.push(o)}}});e.addFeed(new c({uid:n,type:l,values:R}));if(n==="categoryAxis"){S[n]={title:{visible:De?false:true,text:R.join(", ")},label:{formatString:ut?"CURR":"axisFormatter",truncatedLabelRatio:.15}}}else{S[n]={title:{visible:De?false:true,text:R.join(", ")},label:{formatString:ut?"CURR":"axisFormatter"}}}vt.push(S[n]);if(h.hasOwnProperty("vizProperties")){var V=0;var Y=h.vizProperties.length;var x;var k;for(;V<Y;V++){if(h.vizProperties[V].hasOwnProperty("value")){k=h.vizProperties[V].value}if(h.vizProperties[V].hasOwnProperty("path")){x=h.vizProperties[V].path.split(".");var z=x.length;var H,G;var j;for(var W=0,j=x[0],H=S,G=Ce;W<z;++W){if(W===z-1){if(G&&G.hasOwnProperty(j)){if(m==="donut"&&(G[j]==="value"||G[j]==="percentage")){k=G[j]}else if(m!="donut"){k=G[j]}}if(Xe&&j!="adjustScale"||!Xe&&j==="adjustScale"||!Xe&&j!="adjustScale"){H[j]=k}break}H[j]=H[j]||{};H=H[j];if(G){G[j]=G[j]||{};G=G[j]}j=x[W+1]}}}}if(r.hasOwnProperty("vizProperties")){var t=0;var X=r.vizProperties.length;var q;var Q;var Z;for(;t<X;t++){if(r.vizProperties[t].hasOwnProperty("method")){Q=r.vizProperties[t].method;switch(Q){case"count":q=R.length;if(r.vizProperties[t].hasOwnProperty("min")&&q<=r.vizProperties[t].min){q=r.vizProperties[t].min}else if(r.vizProperties[t].hasOwnProperty("max")&&q>=r.vizProperties[t].max){q=r.vizProperties[t].max}break;default:break}}else if(r.vizProperties[t].hasOwnProperty("value")){q=r.vizProperties[t].value}if(r.vizProperties[t].hasOwnProperty("path")){Z=r.vizProperties[t].path.split(".");var J=Z.length;for(var C=0,$=Z[0],ee=S;C<J;++C){if(C===J-1){ee[$]=q;break}ee[$]=ee[$]||{};ee=ee[$];$=Z[C+1]}}}}}}});var At=e.getFeeds();if(h.properties&&h.properties.semanticPattern===true&&x(At,m)){g(At,function(t,r){if(At[t].getType()==="Measure"&&(At[t].getUid()==="valueAxis"||At[t].getUid()==="actualValues")){var a;g(y,function(e,r){var n=Y(r.Measure.PropertyPath,Ae);if(n===At[t].getValues()[0]){a=L(r,i);return false}});if(a){var n=Y(a.Measure.PropertyPath,Ae);var o=i[a.DataPoint.AnnotationPath.substring(1)].ForecastValue.PropertyPath||i[a.DataPoint.AnnotationPath.substring(1)].ForecastValue.Path;var s=Y(o,Ae);var l=p.getText("ACTUAL",[n]);var u=p.getText("FORECAST",[s]);S.plotArea.dataPointStyle={rules:[{dataContext:{MeasureNamesDimension:n},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"line",lineColor:"sapUiChartPaletteSequentialHue1Light1"},displayName:l},{dataContext:{MeasureNamesDimension:s},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"dotted",lineColor:"sapUiChartPaletteSequentialHue1Light1",pattern:"diagonalLightStripe"},displayName:u}]};e.getDataset().addMeasure(new f({name:s,value:"{"+o+"}"}));var c=At[t].getValues();c.push(s);At[t].setValues(c)}return false}})}var dt=false;if(Fe&&Fe.dimensionSettings&&Object.keys(Fe.dimensionSettings).length>0){var ht=Object.keys(Fe.dimensionSettings);for(var Pt=0;Pt<ht.length;Pt++){var Et=ht[Pt];var Ct=Fe.dimensionSettings[Et];if(Object.keys(Ct).length>10){dt=true;break}}}if(xe&&R.indexOf(s.ChartType.EnumMember)>=0&&!dt){var yt=[];var _t=true;for(var Pt=0;Pt<E.length;Pt++){var It=E[Pt].Dimension.PropertyPath;yt.push(It)}for(var Pt=0;Pt<yt.length;Pt++){var Et=yt[Pt];if(ht.indexOf(Et)>-1){var Tt=Fe.dimensionSettings[Et];var Nt=Object.keys(Tt);var Rt=[];for(var Pt=0;Pt<Nt.length;Pt++){var Dt=Tt[Nt[Pt]];Rt.push(Dt)}_t=_t&&Rt.every(Te)}}if(_t){var bt=[];for(var Pt=0;Pt<yt.length;Pt++){var Et=yt[Pt];if(ht.indexOf(Et)>-1){var Tt=Fe.dimensionSettings[Et];var Nt=Object.keys(Tt);var Rt=[];for(var Pt=0;Pt<Nt.length;Pt++){var Dt=Tt[Nt[Pt]];Rt.push(Dt)}Ie(Rt);for(var St=0;St<Rt.length;St++){var Ot=Rt[St].dimensionValue;var Mt=Rt[St].color;var Dt={properties:{color:Mt}};Dt.dataContext={};var Lt=ue(Ae,e,Et);Dt.dataContext[Lt]=Ot;Dt.displayName=Ot;bt.push(Dt)}}}S.plotArea.dataPointStyle=S.plotArea.dataPointStyle||{};S.plotArea.dataPointStyle["rules"]=bt}else{var bt=[];for(var Pt=0;Pt<yt.length;Pt++){var Et=yt[Pt];if(ht.indexOf(Et)>-1){var Tt=Fe.dimensionSettings[Et];var Nt=Object.keys(Tt);var Rt=[];for(var Pt=0;Pt<Nt.length;Pt++){var Dt=Tt[Nt[Pt]];Rt.push(Dt)}Ie(Rt);var Vt=Rt.map(Ne)}}S.legend.order=function(e,t){var r=Vt.indexOf(e);var a=Vt.indexOf(t);return r>a?1:-1}}}if(h.properties&&h.properties.semanticPattern===true&&x(At,m)&&e.getVizType()==="vertical_bullet"){g(At,function(t,r){if(At[t].getType()==="Measure"&&(At[t].getUid()==="valueAxis"||At[t].getUid()==="actualValues")){var a;g(y,function(e,r){var n=Y(r.Measure.PropertyPath,Ae);if(n===At[t].getValues()[0]){a=V(r,i);return false}});if(a){var n=i[a.DataPoint.AnnotationPath.substring(1)].TargetValue.PropertyPath||i[a.DataPoint.AnnotationPath.substring(1)].TargetValue.Path;var o=Y(n,Ae);e.getDataset().addMeasure(new f({name:o,value:"{"+n+"}"}));e.addFeed(new c({uid:"targetValues",type:"Measure",values:[o]}))}return false}})}if(ut&&ft){b.warning(p.getText("Currency_non_currency_measure"))}g(At,function(e,t){var r=t.getProperty("type");if(r==="Measure"){var a=t.getProperty("values");var i=true;var n=s.MeasureAttributes.filter(function(e){return a.indexOf(Ae[e[r]["PropertyPath"]][_.LABEL_KEY])>=0||a.indexOf(Ae[e[r]["PropertyPath"]][_.LABEL_KEY_V4])>=0});g(n,function(e,t){if(ne(Ae,t,r)||oe(Ae,t,r)){i=false}else{i=true;return false}});if(!i){S[t.getProperty("uid")]["label"]["allowDecimals"]=false}}});var Yt;if(lt===undefined){lt=""}if(st===undefined){st=""}if(ut){Yt=me(lt,ut)}else{Yt=me(st,ut)}if(t){t.setScale(Yt)}var xt=pe(pt,mt,de);var Ft="";g(At,function(e,t){var r="-1";var a=t.getProperty("type");if(a==="Measure"){var n=vt.filter(function(e){var r=e["title"]["text"].split(",").filter(function(e){if(t.getValues().indexOf(e.trim())>=0){return true}else{return false}});if(r.length>0){return true}else{return false}});if(n&&n.length){var o=t.getValues();if(o&&o.length){g(o,function(e,t){var n=t.trim();var o=y.filter(function(e){if(e["Measure"]&&e["Measure"]["PropertyPath"]){var t=e["Measure"]["PropertyPath"];if(Ae[t]&&Ae[t][_.LABEL_KEY]===n||Ae[t]&&Ae[t][_.LABEL_KEY_V4]===n){return true}else{return false}}});if(o&&o.length){var s=o[0];if(!ne(Ae,s,a)&&!oe(Ae,s,a)){var l="";if(s&&s["DataPoint"]&&s["DataPoint"]["AnnotationPath"]&&s["DataPoint"]["AnnotationPath"]){l=s["DataPoint"]["AnnotationPath"]&&s["DataPoint"]["AnnotationPath"].substring(1);if(l!=""){var u;u=i[l]&&i[l]["ValueFormat"]&&i[l]["ValueFormat"]["NumberOfFractionalDigits"]&&i[l]["ValueFormat"]["NumberOfFractionalDigits"]["Int"];r=u>r?u:r}}}else{r=r<"0"?"0":r}}})}}if(n&&n[0]&&n[0].label&&n[0].label.formatString){var s=n[0].label.formatString}Ft="";if(ut){if(s==="CURR"){Ft="CURR/"+r.toString()+"/"}else{Ft="axisFormatter/"+r.toString()+"/"}}else{Ft="axisFormatter/"+r.toString()+"/"}if(n&&n[0]){n[0].label.formatString=Ft}}});if(m==="vertical_bullet"){S["valueAxis"]={title:{visible:De?false:true},label:{formatString:Ft}}}var Ut="";var Kt="";if(ut){Ut=ot.toString();Kt="CURR/"+ot.toString()+"/"}else{Ut=nt.toString();Kt="axisFormatter/"+nt.toString()+"/"}if(m==="donut"||v){S.plotArea.dataLabel.formatString=Kt;if(S.plotArea.dataLabel.type==="percentage"){S.plotArea.dataLabel.formatString="0.0%/"+Ut+"/"}}W(M,h,"dimension");W(F,h,"measure");if(w){var Bt=E[0].Dimension.PropertyPath;if(Ae[Bt][_.SEMANTICS_KEY]==="yearmonth"||Ae[Bt]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){S.timeAxis.levels=["year","month"]}else if(Ae[Bt][_.SEMANTICS_KEY]==="yearquarter"||Ae[Bt]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){S.timeAxis.levels=["year","quarter"]}else if(Ae[Bt][_.SEMANTICS_KEY]==="yearweek"||Ae[Bt]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){S.timeAxis.levels=["year","week"]}else if(Ae[Bt][_.SEMANTICS_KEY]==="year"||Ae[Bt]["com.sap.vocabularies.Common.v1.IsCalendarYear"]){S.timeAxis.levels=["year"]}}S.title={text:de?de:xt,alignment:"left",layout:{respectPlotPosition:false},style:{fontFamily:"72, 72full, Arial, Helvetica, sans-serif !important",fontSize:".875rem",fontWeight:"normal"}};e.setVizProperties(S);if(a&&a.getProperty("/bInsightEnabled")){var wt=e&&e.getId();var kt=A({},S);if(je!==undefined){kt.plotArea.dataPointStyle=je}P.setVizPropertyMap(wt,kt)}}function le(e,t,r){var a="";var i=e&&e[t]&&e[t].Title;if(i){a=i.String;var n=r.getModel("@i18n")?r.getModel("@i18n"):r.getModel("i18n");if(a.match(/{[@]?i18n>.+}/gi)||a.match(/{[@]?i18n&gt;.+}/gi)){var o=n.getResourceBundle();var s=a.indexOf(">")>-1?a.indexOf(">"):a.indexOf("&gt;")+3;var l=a.substring(s+1,a.length-1);a=o.getText(l)}}return a}function ue(e,t,r){var a="";if(e&&e[r]){if(e[r][_.LABEL_KEY_V4]){a=ce(e[r][_.LABEL_KEY_V4].String?e[r][_.LABEL_KEY_V4].String:e[r][_.LABEL_KEY_V4].Path,t,e)}else if(e[r][_.LABEL_KEY]){a=e[r][_.LABEL_KEY]}else if(r){a=r}}return a}function fe(e,t){if(e&&(e.getVizType()==="bubble"||e.getVizType()==="scatter")){return}var r,a,i,n;var o;var s=_.UNIT_KEY;var l=_.UNIT_KEY_V4_ISOCurrency;var u=_.UNIT_KEY_V4_Unit;var f;var c=[];if(!(r=e.getModel("ovpCardProperties"))){b.error(I.CARD_ERROR+"in "+I.CARD_CONFIG+I.NO_CARD_MODEL);return}var v=e.getModel();var m=r.getProperty("/entitySet");if(!v||!m){return}a=r.getProperty("/entityType");if(!a){b.error(I.CARD_ANNO_ERROR+"in "+I.CARD_ANNO);return}var A=ve(v,m);i=r.getProperty("/chartAnnotationPath");if(!i||!(n=a[i])){b.error(I.CARD_ANNO_ERROR+"in "+I.CARD_ANNO);return}if(!(o=n.MeasureAttributes)||!o.length){b.error(I.CHART_ANNO_ERROR+"in "+I.CHART_ANNO+" "+I.MEASURES_MANDATORY);return}g(o,function(e,t){f=t.Measure.PropertyPath;if(t.DataPoint&&t.DataPoint.AnnotationPath){var r=a[t.DataPoint.AnnotationPath.substring(1)];if(r.ForecastValue&&(r.ForecastValue.PropertyPath||r.ForecastValue.Path)){c.push(r.ForecastValue.PropertyPath||r.ForecastValue.Path)}}c.push(f)});var d=t?t.results:null;var h="";var P=true;var E=[];var C=e.getFeeds();g(C,function(e,t){if(t.getType()==="Measure"){E=E.concat(t.getValues())}});if(d){g(c,function(t,r){var a=ue(A,e,r);if((E?Array.prototype.indexOf.call(E,a):-1)!=-1){if(A&&A[r]){var i;if(A[r][l]){i=A[r][l].Path?A[r][l].Path:A[r][l].String}else if(A[r][u]){i=A[r][u].Path?A[r][u].Path:A[r][u].String}else if(A[r][s]){i=A[r][s]}if(!i){P=false;return false}if(i&&A[i]){for(var t=0;t<d.length;t++){var n=d[t];if(P){if(h&&n[i]&&n[i]!=""&&h!=""&&h!=n[i]){P=false;break}}h=n[i];if(!h){P=false;break}}}}}})}var y="";if(P){if(h!=""){y=p.getText("IN_NO_SCALE",[h]);y=" "+y}var T=e.data("aria-label");if(T&&y&&T.indexOf(y)===-1){var N=T+y;e.data("aria-label",N,true)}var R=e.getVizProperties().title&&e.getVizProperties().title.text;if(R){var D=R.indexOf("|");if(D!==-1){var S=R.slice(D+2);if(S!==h){R=R.slice(0,D-1)}}var O={title:{visible:true,text:S===h?R:R+y,alignment:"left",layout:{respectPlotPosition:false},style:{fontFamily:"72, 72full, Arial, Helvetica, sans-serif !important",fontSize:".875rem",fontWeight:"normal"}}};e.setVizProperties(O)}}}function ce(e,t,r){var a;var i;var n;if(e&&e.indexOf("{")===0){e=e.slice(1,-1);if(e.indexOf(">")!=-1){n=e.split(">");a=n[0];i=n[1]}else if(e.indexOf("&gt;")!=-1){n=e.split("&gt;");a=n[0];i=n[1]}try{e=t.getModel(a).getProperty(i)}catch(t){e=r[e][_.LABEL_KEY_V4].String;b.error("Unable to read labels from resource file",t)}}return e}function ve(t,r){var a=e.cacheODataMetadata(t);if(!a){return undefined}return a[r]}function pe(e,t,r){var a="",i="",n="";if(r){a=r}if(e&&e.length>1){for(var o=0;o<e.length-1;o++){if(i!=""){i+=", "}i+=e[o]}i=p.getText("MEAS_DIM_TITLE",[i,e[o]])}else if(e){i=e[0]}if(t&&t.length>1){for(var o=0;o<t.length-1;o++){if(n!=""){n+=", "}n+=t[o]}n=p.getText("MEAS_DIM_TITLE",[n,t[o]])}else if(t){n=t[0]}if(a===""){r=p.getText("NO_CHART_TITLE",[i,n])}return r}function me(e,t){var r=1;var i;if(t){var n=a.getCurrencyInstance({style:"short",currencyCode:false,shortRefNumber:e});i=n.format(Number(r))}else{var o=a.getFloatInstance({style:"short",shortRefNumber:e});i=o.format(Number(r))}var s=i.slice(-1);return s}function ge(e,t){e.attachSelectData(function(a){var n=m.bCRTLPressed?m.constants.explace:m.constants.inplace;m.bCRTLPressed=false;var o=e.getModel("ovpCardProperties");var u=e.getModel();var f=o.getProperty("/entitySet");var c=ve(u,f);var v=[],p=[];var A={},d={};var h=e.getDataset().getDimensions();var P;for(var C=0;C<h.length;C++){v.push(h[C].getName())}var y=e.getDataset().getBinding("data").getCurrentContexts().map(function(e){return e.getObject()});if(a.getParameter("data")&&a.getParameter("data")[0]&&a.getParameter("data")[0].data){p=Object.keys(a.getParameter("data")[0].data);P=a.getParameter("data")[0].data._context_row_number;var I=e.getDataset().getBinding("data").getContexts()[P];var T=E.getEntityNavigationEntries(I,u,t.getEntityType(),t.getCardPropertiesModel())[0];if(y[P].$isOthers&&y[P].$isOthers===true){var N={},R=[];for(var D=0;D<v.length;D++){for(var b=0;b<p.length;b++){if(v[D]===p[b]){for(var S in c){if(c.hasOwnProperty(S)){var O=c[S][_.LABEL_KEY]||c[S][_.NAME_KEY]||c[S][_.NAME_CAP_KEY];if(O===p[b]){R.push(S)}}}}}}for(var C=0;C<R.length;C++){N[R[C]]=[];for(var D=0;D<y.length-1;D++){if(D!=P){N[R[C]].push(y[D][R[C]])}}}var M={$isOthers:true};var L={getObject:function(){return M},getOtherNavigationDimensions:function(){return N}};if(l.checkIfAPIIsUsed(t)){if(t.checkAPINavigation()){s.onContentClicked(L)}}else{if(T){t.doNavigation(L,T,n)}}}else{for(var D=0;D<v.length;D++){for(var b=0;b<p.length;b++){if(v[D]===p[b]){for(var S in c){if(c.hasOwnProperty(S)){var O=c[S][_.LABEL_KEY_V4]&&c[S][_.LABEL_KEY_V4].String||c[S][_.LABEL_KEY]||c[S][_.NAME_KEY]||c[S][_.NAME_CAP_KEY];if(O.match(/{@i18n>.+}/gi)){var V=this.getModel("@i18n").getResourceBundle();O=V.getText(O.substring(O.indexOf(">")+1,O.length-1))}if(O===p[b]){A[S]=y[P][S]}}}}for(var S in y[P]){if(c.hasOwnProperty(S)){d[S]=y[P][S]}}}}if(A){g(Object.keys(A),function(e,t){if(c[t]["type"]==="Edm.String"){if(c[t]["sap:semantics"]==="yearmonth"||c[t]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){A[t]=A[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYMM"}).format(A[t]):A[t]}else if(c[t]["sap:semantics"]==="yearquarter"||c[t]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){A[t]=A[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYQ"}).format(A[t]):A[t]}else if(c[t]["sap:semantics"]==="yearweek"||c[t]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){A[t]=A[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYww"}).format(A[t]):A[t]}else if(c[t]["com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"]&&c[t]["com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"].Bool){var r=A[t];if(r.includes(".")){A[t]=r.split(".").reverse().join("")}else if(r.includes("/")){A[t]=r.split("/").reverse().join("")}}}})}if(d){g(Object.keys(d),function(e,t){if(c[t]["type"]==="Edm.String"){if(c[t]["sap:semantics"]==="yearmonth"||c[t]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){d[t]=d[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYMM"}).format(d[t]):d[t]}else if(c[t]["sap:semantics"]==="yearquarter"||c[t]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){d[t]=d[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYQ"}).format(d[t]):d[t]}else if(c[t]["sap:semantics"]==="yearweek"||c[t]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){d[t]=d[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYww"}).format(d[t]):d[t]}else if(c[t]["com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"]&&c[t]["com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"].Bool){var r=d[t];if(r.includes(".")){d[t]=r.split(".").reverse().join("")}else if(r.includes("/")){d[t]=r.split("/").reverse().join("")}}}})}var Y=o.getProperty("/entityType"),x=Y[o.getProperty("/presentationAnnotationPath")];if(Y){var F=r.getRequestFields(x);if(F&&F.length>0){g(F,function(e,t){if(!A.hasOwnProperty(t)){A[t]=y[P][t]}})}}var L={getObject:function(){return A},getAllData:function(){return d}};if(l.checkIfAPIIsUsed(t)){if(t.checkAPINavigation()){s.onContentClicked(L)}}else{if(T){t.doNavigation(L,T,n)}}}}})}function Ae(e){if(e.EnumMember.endsWith("Bubble")){return true}else{return false}}function de(e){var t=false;if(!e||e.constructor!=Array||e.length<1||e[0].constructor!=Object||!e[0].Dimension||!e[0].Dimension.PropertyPath){b.error(I.CHART_ANNO_ERROR+"in "+I.CHART_ANNO+" "+I.DIMENSIONS_MANDATORY);return t}t=true;return t}function he(e){var t=false;if(!e||e.constructor!=Array||e.length<1||e[0].constructor!=Object||!e[0].Measure||!e[0].Measure.PropertyPath){b.error(I.CHART_ANNO_ERROR+"in "+I.CHART_ANNO+" "+I.MEASURES_MANDATORY);return t}t=true;return t}function Pe(e){return e.name}function Ee(e){if(e&&e.indexOf("#")!=-1){var t=e.split("#");if(t.length>1){return t[1]}}return""}function Ce(e,t){var r=t.getModel("ovpCardProperties");var a=ye(t);var i=+a.itemsLength;var n=+r.getProperty("/dataStep");if(i&&n){var o=e.colSpan-1;if(o>=0){i+=n*o;_e(t,i)}}}function ye(e){var t=e.getModel("ovpCardProperties");var r=t.getProperty("/entityType");var a=t.getProperty("/presentationAnnotationPath");var i=r.hasOwnProperty(a)&&r[a];var n=i&&i.MaxItems;if(n){var o=n.Int32?n.Int32:n.Int;return{itemsLength:+o,dataStep:+t.getProperty("/dataStep")}}}function _e(e,t){var r,a={},i=[];var n=e.getVizType();var o=e.getModel("ovpCardProperties");var s=o.getProperty("/entityType");var l=o.getProperty("/chartAnnotationPath");var u=s[l];var f=e.getParent();var c=f.getBinding("data");a.path=c.getPath();a.parameters={};if(c.mParameters&&c.mParameters.select){a.parameters.select=c.mParameters.select}a.parameters.custom=a.parameters.custom||{};a.parameters.custom._requestFrom="ovp_internal";a.filters=c.aApplicationFilters;a.sorter=c.aSorters;a.length=n==="donut"?t+1:t;a.template=new v;f.bindAggregation("data",a);if(n==="donut"){g(u.MeasureAttributes,function(e,t){i.push(t.Measure.PropertyPath)});r={};r.path=c.getPath();r.parameters={};r.parameters.select=i.join(",");r.filters=c.aApplicationFilters;r.sorter=c.aSorters;r.length=1;r.template=new v;f.bindAggregation("aggregateData",r)}f.updateBindingContext()}function Ie(e){e.sort(function(e,t){if(e.index<t.index){return-1}if(e.index>t.index){return 1}return 0})}function Te(e){return e.color!==undefined}function Ne(e){return e.dimensionValue}return{constants:_,errorMessages:I,formatItems:S,formatByType:F,returnDateFormat:U,formatChartAxes:K,hideDateTimeAxis:B,checkExists:w,validateCardConfiguration:k,checkNoData:z,getConfig:H,hasTimeSemantics:G,getChartType:j,getPrimitiveValue:X,formThePathForCriticalityStateCalculation:Z,checkFlag:ee,buildVizAttributes:se,setChartUoMTitle:fe,getMetadata:ve,getSelectedDataPoint:ge,checkBubbleChart:Ae,dimensionAttrCheck:de,measureAttrCheck:he,getEntitySet:Pe,getAnnotationQualifier:Ee,reprioritizeContent:Ce,getMaxItems:ye,getLabelFromAnnotationPath:ce,getChartTitle:le}},true);
//# sourceMappingURL=VizAnnotationManager.js.map