// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/base/util/uid","sap/base/util/UriParameters","sap/ui/Device","sap/ui/thirdparty/jquery","sap/ui/thirdparty/URI","sap/ushell/utils/clone","sap/ushell/utils/UrlParsing","sap/ushell/utils/objectOperations","sap/ushell/utils/type","sap/ui/core/Configuration"],function(e,t,r,n,i,jQuery,a,o,s,u,l,c){"use strict";var f={};f.isArray=l.isArray;f.isPlainObject=l.isPlainObject;f.isDefined=l.isDefined;f.clone=o;f.getMember=u.getMember;f.updateProperties=u.updateProperties;f.getNestedObjectProperty=u.getNestedObjectProperty;f.removeDuplicatedActions=function(e){if(Array.isArray(e)){var t=e.reduce(function(e,t){if(e.indexOf(t)<0){e.push(t)}return e},[]);return t}return e};f.storeSapSystemData=function(t,r){var n,i,a,o=[t.id];if(arguments.length>1){o.unshift(r)}try{a=JSON.stringify(t)}catch(t){e.error("Cannot stringify and store expanded system data: "+t)}if(a){i=f.getLocalStorage();n=f.generateLocalStorageKey("sap-system-data",o);i.setItem(n,a)}};f.getLocalSystemInSidFormat=function(){var e=sap.ushell.Container.getLogonSystem(),t=e.getName(),r=e.getClient();return"sid("+t+"."+r+")"};f.matchesLocalSid=function(e){return f.getLocalSystemInSidFormat().toLowerCase()===e.toLowerCase()};f.storeSapSystemToLocalStorage=function(e){var t=(e||{}).params;if(!t||!t.hasOwnProperty("sap-system")){return}if(f.isPlainObject(t["sap-system"])){var r=t["sap-system"],n=t["sap-system-src"];if(typeof n==="string"){f.storeSapSystemData(r,n);t["sap-system-src"]=n}else{f.storeSapSystemData(r)}t["sap-system"]=r.id}else if(f.matchesLocalSid(t["sap-system"])){delete t["sap-system"]}};f.setPerformanceMark=function(e,t){if(performance&&performance.mark){if(!t){t={}}if(t.bUseUniqueMark){if(t.bUseLastMark){performance.clearMarks(e)}else if(performance.getEntriesByName(e,"mark").length>0){return}}performance.mark(e)}};f.setPerformanceMeasure=function(e,t,r){if(performance&&performance.measure&&t&&r){performance.measure(e,t,r)}};f.Error=function(t,r){this.name="sap.ushell.utils.Error";this.message=t;e.error(t,null,r)};f.Error.prototype=new Error;f.localStorageSetItem=function(t,r,n){var i;try{localStorage.setItem(t,r);if(n){i=document.createEvent("StorageEvent");i.initStorageEvent("storage",false,false,t,"",r,"",localStorage);dispatchEvent(i)}}catch(t){e.warning("Error calling localStorage.setItem(): "+t,null,"sap.ushell.utils")}};f.getLocalStorage=function(){return window.localStorage};f.getLocalStorageItem=function(e){return window.localStorage.getItem(e)};f.generateUniqueId=function(e){var t,r,n;if(Array.isArray(e)){r=e;n=function(e){return r.indexOf(e)===-1}}else{n=e}do{t=f._getUid()}while(!n(t));return t};f._getUid=function(){return r()};f.reload=function(){location.reload()};f.calculateOrigin=function(e){var t;if(e.origin){return e.origin}if(e.protocol&&e.hostname){return e.protocol+"//"+e.hostname+(e.port?":"+e.port:"")}if(e.href){t=new a(e.href);return t.protocol()+"://"+t.hostname()+(t.port()?":"+t.port():"")}return undefined};f.getPrivateEpcm=function(){if(window.external&&window.external&&typeof window.external.getPrivateEpcm!=="undefined"){return window.external.getPrivateEpcm()}return undefined};f.hasNativeNavigationCapability=function(){return f.isFeatureBitEnabled(1)};f.getShellType=function(){return f.isFeatureBitEnabled(1)?"NWBC":"FLP"};f.hasNativeLogoutCapability=function(){return f.isFeatureBitEnabled(2)};f.hasNavigationModeCapability=function(){return f.isFeatureBitEnabled(4)};f.hasFLPReadyNotificationCapability=function(){return f.isFeatureBitEnabled(8)};f.hasFLPReady2NotificationCapability=function(){return f.isFeatureBitEnabled(16)};f.isFeatureBitEnabled=function(t){var r="0",n;n=f.getPrivateEpcm();if(n){try{r=n.getNwbcFeatureBits();e.debug("Detected epcm getNwbcFeatureBits returned feature bits: "+r)}catch(t){e.error("failed to get feature bit vector via call getNwbcFeatureBits on private epcm object",t.stack,"sap.ushell.utils")}}return(parseInt(r,16)&t)>0};f.isApplicationTypeEmbeddedInIframe=function(e){return e==="NWBC"||e==="TR"||e==="WCF"};f.appendSapShellParam=function(e,t){var r=t==="TR"?"":"-NWBC",n=f.getUi5Version();if(n){e+=e.indexOf("?")>=0?"&":"?";e+="sap-shell="+encodeURIComponent("FLP"+n+r)}return e};function p(e){var t=/\d+\.\d+\.\d+/.exec(e);if(t&&t[0]){return t[0]}return undefined}f.getUi5VersionAsync=function(){return new Promise(function(t,r){sap.ui.require(["sap/ui/VersionInfo"],function(r){r.load().then(function(e){t(p(e.version))}).catch(function(){e.error("sap ui version could not be determined, using Configuration.getVersion() (core version) as fallback");t(p(c.getVersion()))})})})};f.getUi5Version=function(){var t;try{t=sap.ui.getVersionInfo().version}catch(r){e.error("sap ui version could not be determined, using Configuration.getVersion() (core version) as fallback "+r);t=c.getVersion()}return p(t)};f.isNativeWebGuiNavigation=function(e){var r=t.get("applicationType",e);var n=t.get("appCapabilities.nativeNWBCNavigation",e);if(this.hasNativeNavigationCapability()&&(r==="TR"||n)){return true}return false};f.Map=function(){this.entries={}};f.Map.prototype.put=function(e,t){var r=this.get(e);this.entries[e]=t;return r};f.Map.prototype.containsKey=function(e){if(typeof e!=="string"){throw new f.Error("Not a string key: "+e,"sap.ushell.utils.Map")}return Object.prototype.hasOwnProperty.call(this.entries,e)};f.Map.prototype.get=function(e){if(this.containsKey(e)){return this.entries[e]}};f.Map.prototype.keys=function(){return Object.keys(this.entries)};f.Map.prototype.remove=function(e){delete this.entries[e]};f.Map.prototype.toString=function(){var e=["sap.ushell.utils.Map("];e.push(JSON.stringify(this.entries));e.push(")");return e.join("")};f.getParameterValueBoolean=function(e,t){var r=n.fromQuery(t||window.location.search),i=r.getAll(e),a=["true","x"],o=["false",""],s;if(!i||i.length===0){return undefined}s=i[0].toLowerCase();if(a.indexOf(s)>=0){return true}if(o.indexOf(s)>=0){return false}return undefined};f.call=function(t,r,n){var i;if(n){setTimeout(function(){f.call(t,r,false)},0);return}try{t()}catch(t){i=t.message||t.toString();e.error("Call to success handler failed: "+i,t.stack,"sap.ushell.utils");if(r){r(i)}}};f.handleTilesVisibility=function(){f.getVisibleTiles()};f.refreshTiles=function(){sap.ui.getCore().getEventBus().publish("launchpad","refreshTiles")};f.setTilesNoVisibility=function(){sap.ui.getCore().getEventBus().publish("launchpad","setTilesNoVisibility")};f.getBasicHash=function(t){if(!f.validHash(t)){e.debug("Utils ; getBasicHash ; Got invalid hash");return false}var r=s.parseShellHash(t);return r?r.semanticObject+"-"+r.action:t};f.validHash=function(e){return e&&e.constructor===String&&e.trim()!==""};f.getFormFactor=function(){var e=i.system;if(e.desktop){return e.SYSTEMTYPE.DESKTOP}if(e.tablet){return e.SYSTEMTYPE.TABLET}if(e.phone){return e.SYSTEMTYPE.PHONE}return undefined};f.getVisibleTiles=function(){var e=document.body.clientHeight;var t=sap.ui.getCore().byId("dashboardGroups");var r=sap.ui.getCore().byId("viewPortContainer");var n=0;var i=[];var a=[];var o=sap.ui.getCore().getEventBus();var s,u,l,c,p,d,g,h,m,y,v,b,w,S,E,C,T;if(window.document.hidden){o.publish("launchpad","onHiddenTab")}if(t&&t.getGroups()&&r){b=jQuery(t.getDomRef());w=b?b.is(":visible"):false;S=t.getGroups();for(s=0;s<S.length;s=s+1){c=S[s];p=c.getTiles();d=c.getLinks();E=[p,d];for(l=0;l<E.length;l++){C=E[l];if(C){for(u=0;u<C.length;u++){g=C[u];if(!w||window.document.hidden){i.push(g)}else{h=jQuery(g.getDomRef());m=h.offset();if(m){y=h.offset().top;v=y+h.height();T=c.getVisible()&&v>n-300&&y<e+300;if(T){a.push({oTile:f.getTileModel(g),iGroup:s,bIsExtanded:!(v>n)||!(y<e)})}else if(a.length>0){o.publish("launchpad","visibleTilesChanged",a);return i}i.push(g)}}}}}}}if(a.length>0){o.publish("launchpad","visibleTilesChanged",a)}return i};f.getTileModel=function(e){var t;if(e.isA("sap.ui.integration.widgets.Card")){t=e.getBindingContext("ushellCardModel")}else{t=e.getBindingContext()}return t.getObject()?t.getObject():null};f.getTileObject=function(e){var t;if(e.isA("sap.ui.integration.widgets.Card")){t=e.getBindingContext("ushellCardModel")}else{t=e.getBindingContext()}return t.getObject()?t.getObject().object:null};f.recalculateBottomSpace=function(){var e=jQuery("#dashboardGroups").find(".sapUshellTileContainer:visible"),t=e.last(),r=jQuery(".sapUshellShellHead > header").height(),n=t.parent().height(),i=parseInt(t.find(".sapUshellContainerTitle").css("margin-top"),10),a=parseInt(jQuery(".sapUshellDashboardGroupsContainer").css("padding-bottom"),10),o;if(e.length===1){o=0}else{o=jQuery(window).height()-r-n-i-a;o=o<0?0:o}jQuery(".sapUshellDashboardGroupsContainer").css("margin-bottom",o+"px")};f.calcVisibilityModes=function(e,t){var r=true,n=true,a=e.pendingLinks&&e.pendingLinks.length?e.pendingLinks:e.links,o=f.groupHasVisibleTiles(e.tiles,a);if(!o&&(!t||e.isGroupLocked||e.isDefaultGroup||i.system.phone||i.system.tablet&&!i.system.desktop)){r=false}if(!o&&!t){n=false}return[r,n]};f.groupHasVisibleTiles=function(e,t){var r=false,n,i,a=!e?[]:e,o=!t?[]:t;a=a.concat(o);if(!a.length){return false}for(n=0;n<a.length;n=n+1){i=a[n];if(i.isTileIntentSupported){r=true;break}}return r};f.invokeUnfoldingArrayArguments=function(t,r){var n=this,i,a,o,s,u;if(!Array.isArray(r[0])){return t.apply(this,r)}i=r[0];if(i.length===0){return(new jQuery.Deferred).resolve([]).promise()}a=new jQuery.Deferred;o=[];s=[];u=(new jQuery.Deferred).resolve();i.forEach(function(r,i){if(!Array.isArray(r)){var a="Expected Array as nTh Argument of multivalue invocation: "+"first Argument must be array of array of arguments: single valued f(p1,p2), f(p1_2,p2_2), f(p1_3,p2_3) : "+"multivalued : f([[p1,p2],[p1_2,p2_2],[p1_3,p2_3]]";e.error(a);throw new Error(a)}var l=t.apply(n,r),c=new jQuery.Deferred;l.done(function(){var e=Array.prototype.slice.call(arguments);s[i]=e;c.resolve()}).fail(c.reject.bind(c));o.push(c.promise());u=jQuery.when(u,c)});jQuery.when.apply(jQuery,o).done(function(){a.resolve(s)}).fail(function(){a.reject("failure")});return a.promise()};f._getCurrentDate=function(){return new Date};f._convertToUTC=function(e){return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())};f.formatDate=function(e){var t,r,n,i,a,o;var s=sap.ui.require("sap/ushell/resources");if(!s){throw new Error("sap/ushell/resources was not required before utils.formatDate usage!")}t=f._convertToUTC(new Date(e));r=f._convertToUTC(f._getCurrentDate());n=r-t;i=parseInt(n/(1e3*60*60*24),10);if(i>0){if(i===1){return s.i18n.getText("time_day",i)}return s.i18n.getText("time_days",i)}a=parseInt(n/(1e3*60*60),10);if(a>0){if(a===1){return s.i18n.getText("time_hour",a)}return s.i18n.getText("time_hours",a)}o=parseInt(n/(1e3*60),10);if(o>0){if(o===1){return s.i18n.getText("time_minute",o)}return s.i18n.getText("time_minutes",o)}return s.i18n.getText("just_now")};f.toExternalWithParameters=function(e,t,r){return Promise.all([sap.ushell.Container.getServiceAsync("URLParsing"),sap.ushell.Container.getServiceAsync("CrossApplicationNavigation")]).then(function(n){var i=n[0];var a=n[1];var o={};var s=t.split("&/");if(s.length>1){o.appSpecificRoute="&/"+s[1]}o.target={semanticObject:e,action:s[0]};if(r&&r.length>0){o.params={};r.forEach(function(e){o.params[e.Key]=e.Value})}return a.toExternal({target:{shellHash:i.constructShellHash(o)}})})};f.moveElementInsideOfArray=function(e,t,r){if(!f.isArray(e)||t===undefined||r===undefined){throw new Error("Incorrect input parameters passed")}if(t>=e.length||r>=e.length||r<0||t<0){throw new Error("Index out of bounds")}var n=e.splice(t,1)[0];e.splice(r,0,n);return e};f.shallowMergeObject=function(e){return Array.prototype.slice.call(arguments,1,arguments.length).map(function(e){return{sourceObject:e,properties:Object.keys(e)}}).reduce(function(e,t){t.properties.forEach(function(r){e[r]=t.sourceObject[r]});return e},e)};f.getLocationHref=function(){return window.location.href};f.getLocationSearch=function(){return window.location.search};f.windowLocationReload=function(){window.location.reload(true)};f.windowLocationAssign=function(e){window.location.assign(e)};f.generateLocalStorageKey=function(e,t){var r=t.length;if(r===0){throw new Error("At least one id should be provided when generating the local storage key")}var n="$";if(r===2){n="#"}else if(r>2){n="@"+r+"@"}return e+n+t.join(":")};f.urlParametersToString=function(e,t,r){return s.privparamsToString(e,t,r)};f.isRootIntent=function(e){if(typeof e!=="string"){throw new Error("The given intent must be a string")}var r="renderers.fiori2.componentData.config.rootIntent";var n=t.get(r,window["sap-ushell-config"])||"#Shell-home";var i=n.replace("#","");var a=e.replace("#","");return a===""||a===i};f.isFlpHomeIntent=function(e){if(!e){e=window.location.hash;if(!e){e=t.get("renderers.fiori2.componentData.config.rootIntent",window["sap-ushell-config"])||"Shell-home"}}else if(typeof e!=="string"){throw new Error("The given intent must be a string")}var r=e.replace("#","");return r.indexOf("Shell-home")===0||r.indexOf("Launchpad-openFLPPage")===0||r.indexOf("Launchpad-openWorkPage")===0};f.generateRandomKey=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";var t="";var r=new window.Uint32Array(40);window.crypto.getRandomValues(r);var n=function(t){var n=r[t]%e.length;return e[n]};while(t.length<40){t+=n(t.length)}return t};f.copyToClipboard=function(e){var t;var r=document.createElement("textarea");try{r.contentEditable=true;r.readonly=false;r.textContent=e;document.documentElement.appendChild(r);r.select();document.execCommand("copy");t=true}catch(e){t=false}finally{r.parentNode.removeChild(r)}return t};f._getUserSettingPersContainer=function(){return sap.ushell.Container.getServiceAsync("Personalization").then(function(e){var t={container:"sap.ushell.usersettings.personalization",item:"data"};var r={validity:"Infinity",keyCategory:e.constants.keyCategory.GENERATED_KEY,writeFrequency:e.constants.writeFrequency.HIGH,clientStorageAllowed:false};return e.getPersonalizer(t,r)})};f.getHideEmptySpacesEnabled=function(){return new Promise(function(e){sap.ui.require(["sap/ushell/Config"],function(t){e(t)})}).then(function(e){var t=e.last("/core/spaces/hideEmptySpaces/enabled");if(!t){return Promise.resolve(false)}return f._getUserSettingPersContainer().then(function(e){return new Promise(function(t,r){e.getPersData().done(t).fail(r)})}).then(function(t){var r=(t||{}).hideEmptySpaces!==false;if(e.last("/core/spaces/hideEmptySpaces/userEnabled")!==r){e.emit("/core/spaces/hideEmptySpaces/userEnabled",r)}return r})})};f.setHideEmptySpacesEnabled=function(e){return new Promise(function(e){sap.ui.require(["sap/ushell/Config"],function(t){e(t)})}).then(function(t){var r=t.last("/core/spaces/hideEmptySpaces/enabled");if(!r){return Promise.resolve()}return f._getUserSettingPersContainer().then(function(r){return new Promise(function(e,t){r.getPersData().done(e).fail(t)}).then(function(n){n=n||{};var i=n.hideEmptySpaces!==false;if(i===!!e){return Promise.resolve()}n.hideEmptySpaces=e;return new Promise(function(e,t){r.setPersData(n).done(e).fail(t)}).then(function(){t.emit("/core/spaces/hideEmptySpaces/userEnabled",e)})})})})};f.sanitizeTimeoutDelay=function(e){if(typeof e!=="number"){throw new Error("Invalid type! Expected type 'number'.")}var t=2147483647;return e>t?t:e};return f},false);
//# sourceMappingURL=utils.js.map