// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/util/deepExtend","sap/base/util/ObjectPath","sap/ui/thirdparty/URI","sap/ushell/_ApplicationType/systemAlias","sap/ushell/_ApplicationType/utils"],function(s,a,e,t,r){"use strict";function n(a,e){return new Promise(function(t,n){var i=s({},a);if(e.length>0){i["sap-ushell-defaultedParameterNames"]=[JSON.stringify(e)]}delete i["sap-system"];sap.ushell.Container.getServiceAsync("ShellNavigation").then(function(s){s.compactParams(i,["sap-xapp-state","sap-xapp-state-data","sap-ushell-defaultedParameterNames","sap-intent-params","sap-iframe-hint","sap-keep-alive","sap-wd-configId"],undefined,true).fail(function(s){n(s)}).done(function(s){var a=r.getURLParsing().paramsToString(s);t(a)})}).catch(function(s){n(s)})})}function i(s,a){var e=s.search();if(a){e=e+(e.indexOf("?")<0?"?":"&")+a}return s.search(e).toString()}function p(a,n,i,p,l){var m,c,f,d,y,v=s({},p);if(n){v["sap-wd-configId"]=n}if(v["sap-system"]){m=v["sap-system"][0];delete v["sap-system"]}if(v.hasOwnProperty("sap-system-src")){c=v["sap-system-src"][0];delete v["sap-system-src"]}y=r.getURLParsing().paramsToString(v);if(i){f=u(a,y)}else{f=o(a,y)}d=new e(f);return t.spliceSapSystemIntoURI(d,t.LOCAL_SYSTEM_ALIAS,m,c,"WDA",t.SYSTEM_ALIAS_SEMANTICS.apply,l)}function u(s,a){return"/ui2/nwbc/~canvas;window=app/wda/"+s+"/"+"?"+a}function o(s,a){var e=s.indexOf("/")!==0;if(e){s="sap/"+s}return"/webdynpro/"+s+"?"+a}function l(s,a,e,t){var n={"sap-system":e,url:a,text:s.title,applicationType:"NWBC"};if(typeof t==="string"){n["sap-system-src"]=t}r.setSystemAlias(n,s.resolutionResult);["additionalInformation","applicationDependencies"].forEach(function(a){if(s.resolutionResult.hasOwnProperty(a)){n[a]=s.resolutionResult[a]}});n.url=r.appendParametersToUrl("sap-iframe-hint="+(n.url.indexOf("/ui2/nwbc/")>=0?"NWBC":"WDA"),n.url);return n}function m(s,e,t){var r=a.get("inbound.resolutionResult",s);var u=s.mappedIntentParamsPlusSimpleDefaults||{};var o=r.systemAlias;if(u["sap-system"]){o=u["sap-system"][0]}var m;if(u["sap-system-src"]){m=u["sap-system-src"][0]}var c={"sap-system":[o]};if(typeof m==="string"){c["sap-system-src"]=[m]}var f=r["sap.wda"].compatibilityMode;if(f===undefined){f=true}return Promise.all([p(r["sap.wda"].applicationId,r["sap.wda"].configId,f,c,t),n(u,s.mappedDefaultedParamNames)]).then(function(a){var e=a[0];var t=a[1];var r=i(e,t);var n=u["sap-system"]&&u["sap-system"][0];var p=u["sap-system-src"]&&u["sap-system-src"][0];var o=l(s.inbound,r,n,p);return o})}function c(s,a,r){var p=s.inbound,u=p&&p.resolutionResult,o=s.mappedIntentParamsPlusSimpleDefaults;var m=new e(a);var c=o["sap-system"]&&o["sap-system"][0];var f=o["sap-system-src"]&&o["sap-system-src"][0];return Promise.all([t.spliceSapSystemIntoURI(m,u.systemAlias,c,f,"WDA",u.systemAliasSemantics||t.SYSTEM_ALIAS_SEMANTICS.applied,r),n(o,s.mappedDefaultedParamNames)]).then(function(s){var a=s[0];var e=s[1];var t=i(a,e);var r=l(p,t,c,f);return r},function(s){return Promise.reject(s)})}function f(s,e,t,n){var i=s.params["sap-ui2-wd-app-id"][0];var u=(a.get("params.sap-ui2-wd-conf-id",s)||[])[0];var o=Object.keys(s.params).reduce(function(a,e){if(e!=="sap-ui2-wd-app-id"&&e!=="sap-ui2-wd-conf-id"){a[e]=s.params[e]}return a},{});return p(i,u,n,o,t).then(function(a){var t=s.params.hasOwnProperty("sap-system-src")&&s.params["sap-system-src"][0];var n=s.params.hasOwnProperty("sap-system")&&s.params["sap-system"][0];var p={url:a.toString(),applicationType:"NWBC",text:i,additionalInformation:"","sap-system":n};if(typeof t==="string"){p["sap-system-src"]=t}if(e&&e.inbound&&e.inbound.resolutionResult&&e.inbound.resolutionResult["sap.platform.runtime"]){p["sap.platform.runtime"]=e.inbound.resolutionResult["sap.platform.runtime"]}p.url=r.appendParametersToUrl("sap-iframe-hint="+(p.url.indexOf("/ui2/nwbc/")>=0?"NWBC":"WDA"),p.url);return p})}return{resolveEasyAccessMenuIntentWDA:f,constructFullWDAResolutionResult:m,constructWDAResolutionResult:c}});
//# sourceMappingURL=wdaResolution.js.map