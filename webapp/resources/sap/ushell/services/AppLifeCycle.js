// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/base/EventProvider","sap/ui/core/Core","sap/ui/thirdparty/hasher","sap/ushell/AppInfoParameters","sap/ushell/EventHub","sap/ushell/TechnicalParameters","sap/ui/core/Component","sap/ushell/services/AppConfiguration","sap/ushell/utils/UrlParsing"],function(e,t,n,i,a,o,r,p,s,u){"use strict";var l="appLoaded";function f(u,f,c,h){var d,g,m;this.getCurrentApplication=function(){return d};this.attachAppLoaded=function(e,t,n){m.attachEvent(l,e,t,n)};this.detachAppLoaded=function(e,t){m.detachEvent(l,e,t)};this.prepareCurrentAppObject=function(e,t,n,i){y(e,t,n,i)};this.reloadCurrentApp=function(){o.emit("reloadCurrentApp",{sAppContainerId:g.getId(),sCurrentHash:i.getHash(),date:Date.now()})};this.setAppInfo=function(e,t){a.setCustomAttributes(e);sap.ushell.Container.getServiceAsync("MessageBroker").then(function(e){if(e.isEnabled()){d.getAllAppInfo(true).then(function(n){e.publish("flp-app-info","FLP",Date.now().toString(),t===true?"new-app-info":"app-info-update","*",n)})}})};function A(e,t,n,i,a){if(n==="flp-app-info"&&i==="get-current-app-info"&&d){d.getAllAppInfo(true).then(function(n){e.publish("flp-app-info","FLP",Date.now().toString(),i,[t],n)})}}if(window.QUnit===undefined&&sap.ushell.Container.inAppRuntime()===false){sap.ushell.Container.getServiceAsync("MessageBroker").then(function(e){if(e.isEnabled()){e.subscribe("FLP",[{channelId:"flp-app-info",version:"1.0"}],A.bind(undefined,e),function(){})}})}m=new t;if(sap.ushell.Container.inAppRuntime()===false){if(sap.ushell.Container.getRenderer()){C()}else{var v=function(){C();sap.ushell.Container.detachRendererCreatedEvent(v)};sap.ushell.Container.attachRendererCreatedEvent(v)}}function C(){var t=n.byId("viewPortContainer");if(!t||typeof t.attachAfterNavigate!=="function"){e.error("Error during instantiation of AppLifeCycle service","Could not attach to afterNavigate event","sap.ushell.services.AppLifeCycle");return}t.attachAfterNavigate(function(e){var t;var n;var i;var a;var o;var r=false;if(e.mParameters.toId.indexOf("applicationShellPage")===0){n=e.mParameters.to.getApp()}else if(e.mParameters.toId.indexOf("application")===0){n=e.mParameters.to}if(n&&typeof n.getComponentHandle==="function"&&n.getComponentHandle()){a=n.getComponentHandle().getInstance()}else if(n){t=n.getAggregation("child");if(t){a=t.getComponentInstance()}}else{a=p.get(e.mParameters.to.getComponent())}if(a){o=a.getId();r=o.indexOf("Shell-home-component")!==-1||o.indexOf("pages-component")!==-1||o.indexOf("workPageRuntime-component")!==-1||o.indexOf("Shell-appfinder-component")!==-1||o.indexOf("homeApp-component")!==-1||o.indexOf("runtimeSwitcher-component")!==-1}i=n&&typeof n.getApplicationType==="function"&&n.getApplicationType();if((!i||i==="URL")&&a){i="UI5"}y(i,a,r,n)})}function P(){var e=i.getHash();if(!e){return Promise.reject("Could not identify current application hash")}var t=sap.ushell.Container.getServiceAsync("URLParsing");return t.then(function(t){return t.parseShellHash(e)})}function I(){if(a.setCustomAttributes){a.setCustomAttributes()}}function y(e,t,n,i){I();g=i;d={applicationType:e,componentInstance:t,homePage:n,getTechnicalParameter:function(n){return r.getParameterValue(n,t,i,e)},getIntent:P,getInfo:function(e){return a.getInfo(e,d)},getAllAppInfo:function(n){return a.getAllAppInfo(n,d,t,i,e).then(function(e){if(n===true){e.applicationType=d.applicationType;e.homePage=d.homePage}else{e.applicationType={value:d.applicationType};e.homePage={value:d.homePage}}return e})},getSystemContext:function(){var e=s.getCurrentApplication()||{};var t=e.contentProviderId||"";return sap.ushell.Container.getServiceAsync("ClientSideTargetResolution").then(function(e){return e.getSystemContext(t)})},disableKeepAliveAppRouterRetrigger:function(e){P().then(function(t){o.emit("disableKeepAliveRestoreRouterRetrigger",{disable:e,intent:t,componentId:d.componentInstance.oContainer.sId,date:Date.now()})})}};setTimeout(function(){m.fireEvent(l,d);if(window.QUnit===undefined&&sap.ushell.Container.inAppRuntime()===false){sap.ushell.Container.getServiceAsync("MessageBroker").then(function(e){if(e.isEnabled()){d.getAllAppInfo(true).then(function(t){e.publish("flp-app-info","FLP",Date.now().toString(),"new-app-info","*",t)})}})}},0)}}f.hasNoAdapter=true;return f},true);
//# sourceMappingURL=AppLifeCycle.js.map