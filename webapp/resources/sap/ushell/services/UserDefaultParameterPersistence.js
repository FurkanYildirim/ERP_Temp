// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/deepExtend","sap/base/util/ObjectPath","sap/ui/thirdparty/jquery"],function(e,t,r,jQuery){"use strict";var n=["value","extendedValue","noEdit","alwaysAskPlugin","_shellData","pluginData"];function i(e){this._oAdapter=e;this._oData={}}i.prototype._cleanseValue=function(e){var r=t({},e);for(var i in r){if(r.hasOwnProperty(i)&&n.indexOf(i)<0){delete r[i]}}return r};i.prototype._getSystemContextPromise=function(t){if(!t){e.warning("UserDefaultParameterPersistence: The systemContext was not provided, using defaultSystemContext as fallback");return sap.ushell.Container.getServiceAsync("ClientSideTargetResolution").then(function(e){return e.getSystemContext()})}return Promise.resolve(t)};i.prototype.loadParameterValue=function(t,n){var i=new jQuery.Deferred;this._getSystemContextPromise(n).then(function(n){var s=r.get([n.id,t],this._oData);if(s!==undefined){i.resolve(s)}else{this._oAdapter.loadParameterValue(t,n).done(function(s){var a=this._cleanseValue(s);r.set([n.id,t],a,this._oData);e.debug('[UserDefaults] Fetched "'+t+'" for SystemContext='+n.id+" from Persistence",JSON.stringify(a,null,2));i.resolve(a)}.bind(this)).fail(i.reject.bind(this))}}.bind(this));return i.promise()};i.prototype.saveParameterValue=function(t,n,i){var s=new jQuery.Deferred;var a;this._getSystemContextPromise(i).then(function(i){if(!n){return this.deleteParameter(t,i).done(s.resolve).fail(s.reject)}a=this._cleanseValue(n);if(n&&n.noStore===true){e.debug('[UserDefaults] Skipped Save "'+t+'" for SystemContext='+i.id,"noStore=true");return s.resolve()}e.debug('[UserDefaults] Saving "'+t+'" for SystemContext='+i.id+" to Persistence",JSON.stringify(a,null,2));r.set([i.id,t],a,this._oData);return this._oAdapter.saveParameterValue(t,a,i).done(s.resolve).fail(s.reject)}.bind(this));return s.promise()};i.prototype.deleteParameter=function(t,r){var n=new jQuery.Deferred;this._getSystemContextPromise(r).then(function(r){if(this._oData[r.id]){e.debug('[UserDefaults] Deleting "'+t+'" for SystemContext='+r.id+" from Persistence");delete this._oData[r.id][t]}return this._oAdapter.deleteParameter(t,r).done(n.resolve).fail(n.reject)}.bind(this));return n.promise()};i.prototype.getStoredParameterNames=function(e){var t=new jQuery.Deferred;this._getSystemContextPromise(e).then(function(e){this._oAdapter.getStoredParameterNames(e).done(function(e){e.sort();t.resolve(e)}).fail(t.reject.bind(t))}.bind(this));return t.promise()};i.hasNoAdapter=false;return i},true);
//# sourceMappingURL=UserDefaultParameterPersistence.js.map