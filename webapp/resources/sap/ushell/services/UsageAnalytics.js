// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/core/Core","sap/ui/core/Configuration","sap/ui/Device","sap/ui/thirdparty/jquery"],function(e,t,s,i,jQuery){"use strict";function n(n,a,r){var o=r&&r.config||{},u=[],l=false,c=false,d,f;window.oCustomProperties={};this.setLegalText=function(e){d=e;if(f){this.init(f.usageAnalyticsTitle,f.iAgree,f.iDisagree,f.remindMeLater)}};this.getLegalText=function(){return d};this.setTrackUsageAnalytics=function(t){var s=jQuery.Deferred();var i=sap.ushell.Container.getUser();var n=i.getTrackUsageAnalytics();sap.ushell.Container.getServiceAsync("UserInfo").then(function(a){if(n!==t){i.setTrackUsageAnalytics(t);var r=a.updateUserPreferences(i);r.done(function(){i.resetChangedProperty("trackUsageAnalytics");if(!c&&t){this.start()}else if(c&&t===false){window.swa.disable()}else if(c&&t){window.swa.enable()}s.resolve()}.bind(this));r.fail(function(t){i.setTrackUsageAnalytics(n);i.resetChangedProperty("trackUsageAnalytics");e.error(t);s.reject(t)})}else{s.resolve()}}.bind(this)).catch(function(){e.error("Getting UserInfo service failed.");s.reject("Getting UserInfo service failed.")});return s.promise()};this.showLegalPopup=function(){sap.ui.require(["sap/m/Text","sap/m/Dialog","sap/m/Button","sap/m/library"],function(e,t,s,n){var a=n.ButtonType;var r=new t("agreementMessageBox",{title:f.usageAnalyticsTitle,type:"Message",stretch:i.system.phone,buttons:[new s("remindMeLaterButton",{text:f.remindMeLater,press:function(){r.close()}}),new s("iAgreeButton",{text:f.iAgree,type:a.Emphasized,press:function(){this.setTrackUsageAnalytics(true);r.close()}.bind(this)}),new s("iDisagreeButton",{text:f.iDisagree,press:function(){this.setTrackUsageAnalytics(false);r.close()}.bind(this)})],afterClose:function(){r.destroy()},content:new e({text:d})}).addStyleClass("sapUshellUsageAnalyticsPopUp").addStyleClass("sapContrastPlus");r.open()}.bind(this))};this.systemEnabled=function(){if(!o.enabled||!o.pubToken||this.isSetUsageAnalyticsPermitted()&&!d){if(!o.pubToken){e.warning("No valid pubToken was found in the service configuration")}if(!d){e.warning("No Legal text message found.")}return false}return true};this.userEnabled=function(){var e=sap.ushell.Container.getUser();if(!this.systemEnabled()){return false}return e.getTrackUsageAnalytics()};this.start=function(){t.getEventBus().publish("sap.ushell.services.UsageAnalytics","usageAnalyticsStarted");this._initUsageAnalyticsLogging();c=true;window.swa.custom2={ref:s.getLanguage()}};this.init=function(e,t,s,i){f={usageAnalyticsTitle:e,iAgree:t,iDisagree:s,remindMeLater:i};if(this.systemEnabled()&&!c){if(!this.isSetUsageAnalyticsPermitted()){this.start()}else if(d){if(this.userEnabled()===true){this.start()}else if(this.userEnabled()===null||this.userEnabled()===undefined){this.showLegalPopup()}}}};this.setCustomAttributes=function(e){var t,s="attribute",i,n="custom",a,r,o="customFunction";if(!this.userEnabled()&&this.isSetUsageAnalyticsPermitted()){return}for(t=1;t<6;t++){a=n.concat(t+4);if(window.swa[a]!==undefined){continue}i=s+t;if(e[i]===undefined){continue}if(jQuery.isFunction(e[i])){r=o+t;window[r]=e[i];window.swa[a]={ref:r}}else{window.swa[a]={ref:e[i]}}}};this.logCustomEvent=function(e,t,s){if(!this.userEnabled()&&this.isSetUsageAnalyticsPermitted()){return}if(!this._isAnalyticsScriptLoaded()){this._addDelayedEvent(e,t,s);return}if(s){s.unshift(t);s.unshift(e);window.swa.trackCustomEvent.apply(window.swa.trackCustomEvent,s)}else{window.swa.trackCustomEvent(e,t)}};window._trackingScriptsLoaded=function(){var e,t;l=true;for(e=0;e<u.length;e++){t=u[e];this.logCustomEvent(t.eventType,t.customEventValue,t.aAdditionalValues)}u=null};this._initUsageAnalyticsLogging=function(){if(window.swa===undefined){window.swa={}}window.swa.pubToken=o.pubToken;window.swa.baseUrl=o.baseUrl;window.swa.bannerEnabled=false;window.swa.loggingEnabled=true;window.swa.visitorCookieTimeout=63113852;window.swa.dntLevel=1;window.swa.trackerReadyCallback=window._trackingScriptsLoaded.bind(this);window.swa.clicksEnabled=o.logClickEvents!==false;window.swa.pageLoadEnabled=o.logPageLoadEvents!==false;this._handlingTrackingScripts()};this._handlingTrackingScripts=function(){var t=document,s=t.createElement("script"),i=t.getElementsByTagName("script")[0];s.onerror=function(){e.warning("SWA scripts not loaded!")};s.defer=true;s.async=true;s.src=window.swa.baseUrl+"js/privacy.js";i.parentNode.insertBefore(s,i)};this._isAnalyticsScriptLoaded=function(){return l};this.isSetUsageAnalyticsPermitted=function(){if(o.setUsageAnalyticsPermitted===undefined){return true}return o.setUsageAnalyticsPermitted};this._addDelayedEvent=function(e,t,s){var i={eventType:e,customEventValue:t,aAdditionalValues:s};u.push(i)}}n.hasNoAdapter=true;return n},true);
//# sourceMappingURL=UsageAnalytics.js.map