// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/utils/UrlParsing","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/Sorter"],function(t,e,r,i){"use strict";var n=function(t,e,r){};n.prototype.execSearch=function(e){return this.search({searchTerm:e}).then(function(e){var r=e.data.map(function(e){var r=t.parseShellHash(e.url);return{text:e.label,icon:e.icon,url:e.url,semanticObject:r&&r.semanticObject,semanticObjectAction:r&&r.action}});return{applications:r}})};n.prototype.search=function(t){return this._searchWithSearchableContentAndJsSearch(t)};n.prototype._searchWithSearchableContentAndJsSearch=function(t){return Promise.all([this._getNormalizedSearchableContentApps(),this._loadJsSearchModule()]).then(function(e){var r=e[0];var i=e[1];var n=new i({objects:r,fields:["text","title","keywords"],shouldNormalize:!String.prototype.normalize,algorithm:{id:"contains-ranked",options:[50,49,40,39,5,4,51]}});var a={searchFor:t&&t.searchTerm||"*",top:Number.MAX_SAFE_INTEGER,skip:0};var o=n.search(a);var s=o.results.map(function(t){return t.object});return this._getPaginatedResult(this._applyFiltersAndSorter(s,t.filter,t.sort),t.skip||0,t.top||10)}.bind(this))};n.prototype._getPaginatedResult=function(t,e,r){return{data:t.slice(e,e+r),count:t.length}};n.prototype._getSearchableContent=function(){return sap.ushell.Container.getServiceAsync("SearchableContent").then(function(t){return t.getApps()})};n.prototype._getNormalizedSearchableContentApps=function(){return this._getSearchableContent().then(function(t){return this._normalizeSearchableContentServiceResult(t)}.bind(this))};n.prototype._normalizeSearchableContentServiceResult=function(t){if(!Array.isArray(t)){t=[]}var e=[];t.forEach(function(t){t.visualizations.forEach(function(r){var i=r.title;if(r.subtitle){i=i+" - "+r.subtitle}e.push({title:r.vizConfig&&r.vizConfig["sap.app"]&&r.vizConfig["sap.app"].title||r.title||t.title,description:r.vizConfig&&r.vizConfig["sap.app"]&&r.vizConfig["sap.app"].subTitle||r.subtitle||t.subtitle,keywords:Array.isArray(r.keywords)?r.keywords.join(" "):"",icon:r.icon||"",label:i,visualization:r,url:r.targetURL,technicalAttributes:Array.isArray(t.technicalAttributes)?t.technicalAttributes.join(" "):""})})});return e};n.prototype._loadJsSearchModule=function(){this._loadJsSearchModulePromise=new Promise(function(t){sap.ui.getCore().loadLibrary("sap.esh.search.ui",{async:true}).then(function(){sap.ui.require(["sap/esh/search/ui/appsearch/JsSearch"],function(e){t(e)})})});return this._loadJsSearchModulePromise};n.prototype._createFilters=function(t){var e=null;if(t){if(typeof t==="object"){if(Array.isArray(t.filters)){t.filters=t.filters.map(function(t){return t instanceof r?t:new r(t)})}e=[t instanceof r?t:new r(t)]}}return e};n.prototype._createSorters=function(t){var e=null;if(t){if(typeof t==="object"&&!Array.isArray(t)){t=[t]}if(Array.isArray(t)){e=t.map(function(t){return t instanceof i?t:new i(t)})}}return e};n.prototype._applyFiltersAndSorter=function(t,r,i){if(!r&&!i){return t}var n=this._createFilters(r),a=this._createSorters(i),o=new e;o.setSizeLimit(Number.MAX_SAFE_INTEGER);o.setData(t);return o.bindList("/",null,a,n).getContexts().map(function(t){return t.getObject()})};return n},false);
//# sourceMappingURL=SearchCEPApplicationAdapter.js.map