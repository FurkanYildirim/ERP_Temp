// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["./History","sap/base/Log","sap/base/util/extend","sap/base/util/isPlainObject","sap/m/InstanceManager","sap/ui/core/Component","sap/ui/core/Configuration","sap/ui/core/Core","sap/ui/core/library","sap/ui/core/mvc/Controller","sap/ui/core/routing/HashChanger","sap/ui/core/routing/History","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ui/performance/Measurement","sap/ui/thirdparty/hasher","sap/ui/thirdparty/jquery","sap/ui/util/Storage","sap/ushell/ApplicationType","sap/ushell/bootstrap/SchedulingAgent","sap/ushell/components/_HeaderManager/ControlManager","sap/ushell/components/applicationIntegration/AppLifeCycle","sap/ushell/components/applicationIntegration/relatedServices/RelatedServices","sap/ushell/components/HeaderManager","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/library","sap/ushell/performance/FesrEnhancer","sap/ushell/renderers/fiori2/LogonFrameProvider","sap/ushell/resources","sap/ushell/services/AppConfiguration","sap/ushell/UserActivityLog","sap/ushell/utils","sap/ushell/utils/WindowUtils","sap/ushell/renderers/fiori2/ShellLayout"],function(e,t,n,i,a,o,r,s,l,h,c,d,p,u,g,f,jQuery,v,m,C,y,b,S,w,_,A,F,P,D,I,E,H,N,k,T){"use strict";var U=T.LAYOUT_MAPPING;var R=l.routing.HistoryDirection;var L=F.AppType;var M=true;var B=false;var x;var O=b.getElementsModel();var W;var V={embedded:0,newWindowThenEmbedded:1,newWindow:1,replace:0};var z={embedded:"embedded",newWindowThenEmbedded:"newWindowThenEmbedded",newWindow:"newWindow",replace:"replace"};var j={};P.init();return h.extend("sap.ushell.renderers.fiori2.Shell",{_aDoables:[],addDoable:function(e){this._aDoables.push(e)},_aDanglingControls:[],addDanglingControl:function(e){this._aDanglingControls.push(e)},_aDanglingBindings:[],addDanglingBinding:function(e){this._aDanglingBindings.push(e)},removeDanglingBinding:function(e){var t=this._aDanglingBindings.findIndex(function(t){return t===e});if(t>-1){this._aDanglingBindings.splice(t,1)}},_aPendingInitializations:[],addPendingInitialization:function(e){this._aPendingInitializations.push(e);return e},awaitPendingInitializations:function(){var e=this._aPendingInitializations.length;return Promise.allSettled(this._aPendingInitializations).then(function(){var t=this._aPendingInitializations.length;if(e<t){return this.awaitPendingInitializations()}}.bind(this))},onComponentTargetDisplay:function(e){var t=e.getParameters();var n=t.control;var i=t.object;if(this.bRestorePreviousHash){this.bRestorePreviousHash=false}n.navTo("centerViewPort",i.getId(),"show")},onInit:function(){var t=this;var n=o.getOwnerComponentFor(this.getView()).getRouter();n.getTarget("home").attachDisplay(this.onComponentTargetDisplay,this);n.getTarget("appfinder").attachDisplay(this.onComponentTargetDisplay,this);n.getTarget("pages").attachDisplay(this.onComponentTargetDisplay,this);n.getTarget("workpages").attachDisplay(this.onComponentTargetDisplay,this);n.getTarget("runtimeSwitcher").attachDisplay(this.onComponentTargetDisplay,this);n.getTarget("wzsearch").attachDisplay(this.onComponentTargetDisplay,this);if(_.last("/core/homeApp/enabled")){n.getTarget("homeapp").attachDisplay(this.onComponentTargetDisplay,this)}n.oHashChanger=c.getInstance();n.initialize(true);this.bEnableHashChange=true;M=true;var i=this.getView();var a=i.getViewData()||{};var r=window.matchMedia("(min-width: 600px)");var l=a.config||{};b.parseStatefulContainerConfiguration(l.statefulApplicationContainer);var h=b.shellElements().model();w.init(l,h);i.setModel(a.helperModel,"helper");i.setModel(a.shellModel);this.initShellModel(l,h);var d=function(e){_.emit("/core/shell/model/isPhoneWidth",!e.matches)};if(r.addListener){r.addListener(d);d(r)}i.setModel(I.i18nModel,"i18n");s.getEventBus().subscribe("externalSearch",this.externalSearchTriggered,this);s.getEventBus().subscribe("sap.ushell","appOpened",this.onAppOpened,this);s.getEventBus().subscribe("ESHSearchFinished",this._logSearchActivity,this);this._setConfigurationToModel();this._registerAndCreateEventHubDoables();x.addHeaderEndItem(["userActionsMenuHeaderButton"],false,["home","app","minimal","standalone","embedded","embedded-home","lean"],true);var u=[];if(l&&!l.moveContactSupportActionToShellHeader){u.push("ContactSupportBtn")}this.history=new e;this.oViewPortContainer=s.byId("viewPortContainer");b.init(l.appState,this.oViewPortContainer,l.rootIntent,l.disableHomeAppCache,{ownerComponent:this.getOwnerComponent()},u,l.cacheConfiguration);var g=function(e,i){this.oShellNavigation=e;this.oShellNavigation.registerPrivateFilters(i);this.oShellNavigation.registerExtraRouter(n);this.oShellNavigation.registerNavigationFilter(this._handleEmptyHash.bind(this));this.oShellNavigation.init(this.doHashChange.bind(this));this.oShellNavigation.registerNavigationFilter(this._disableSourceAppRouter.bind(this));this.oShellNavigation.registerNavigationFilter(this.handleDataLoss.bind(this));this.oShellNavigation.hashChanger.attachEvent("hashChanged",function(e){if(window.hasher.disableBlueBoxHashChangeTrigger===true){return}if(e.mParameters&&t.oShellNavigation.hashChanger.isInnerAppNavigation(e.mParameters.newHash,e.mParameters.oldHash)){b.postMessageToIframeApp("sap.ushell.appRuntime","innerAppRouteChange",{oHash:e.mParameters})}b.postMessageToIframeApp("sap.ushell.appRuntime","hashChange",{sHash:e.mParameters.fullHash})});A.emit("ShellNavigationInitialized")}.bind(this);Promise.all([sap.ushell.Container.getServiceAsync("URLParsing"),sap.ushell.Container.getServiceAsync("ShellNavigation"),sap.ushell.Container.getServiceAsync("AppLifeCycle")]).then(function(e){this.oURLParsing=e[0];var t=e[1];this._oAppLifeCycleService=e[2];g(t,this._oAppLifeCycleService)}.bind(this));sap.ushell.Container.setLogonFrameProvider(this._getLogonFrameProvider());if(p.system.desktop){sap.ui.require(["sap/ushell/renderers/fiori2/AccessKeysHandler"],function(e){e.init(W)})}window.onbeforeunload=function(){if(sap.ushell.Container&&sap.ushell.Container.getDirtyFlag()&&!(p.browser.name===p.browser.BROWSER.INTERNET_EXPLORER&&b.getCurrentApplication().container.getApplicationType()===m.NWBC.type)){if(!I.browserI18n){I.browserI18n=I.getTranslationModel(window.navigator.language).getResourceBundle()}return I.browserI18n.getText("dataLossExternalMessage")}return undefined};if(_.last("/core/shell/model/contentDensity")){b.getAppMeta()._applyContentDensityClass()}this.initShellUIService();if(!l.disableSignOut&&(l.sessionTimeoutTileStopRefreshIntervalInMinutes>0||l.sessionTimeoutReminderInMinutes>0)){this._createSessionHandler(l)}if(p.system.desktop){sap.ui.require(["sap/ushell/renderers/fiori2/AccessKeysHandler"],function(e){i.waitForShellLayout().then(function(){var t=document.getElementById(U.NavigationBar);t.addEventListener("focusin",function(){e.bFocusOnShell=false;e.bFocusPassedToExternalHandlerFirstTime=false});t.addEventListener("focusout",function(){e.bFocusOnShell=true;e.bFocusPassedToExternalHandlerFirstTime=true});var n=document.getElementById(U.RendererRootView);n.addEventListener("focusin",function(){e.bFocusOnShell=false;e.bFocusPassedToExternalHandlerFirstTime=false});n.addEventListener("focusout",function(){e.bFocusOnShell=true;e.bFocusPassedToExternalHandlerFirstTime=true})})})}},shellUpdateAggItem:function(e,t){return s.byId(t.getObject())},getViewPortContainer:function(){return s.byId("viewPortContainer")},_registerAndCreateEventHubDoables:function(){[A.once("CenterViewPointContentRendered").do(this._loadCoreExt.bind(this)),A.once("PagesRuntimeRendered").do(this._loadCoreExt.bind(this)),A.once("AppRendered").do(this._loadCoreExtNonUI5.bind(this)),A.on("toggleContentDensity").do(this.toggleContentDensity.bind(this)),A.on("ShellFloatingContainerUndockOnResize").do(this._handleFloatingContainerUndockOnResize.bind(this)),A.on("ShellFloatingContainerDockedIsResized").do(this._emitFloatingContainerResizeEvent.bind(this)),A.on("LaunchpadCustomRouterRouteMatched").do(this._centerViewPort.bind(this)),A.once("CoreResourcesComplementLoaded").do(this._onCoreResourcesComplementLoaded.bind(this)),A.once("loadRendererExtensions").do(this._loadRendererExtensionPlugins.bind(this)),A.once("loadUsageAnalytics").do(this._loadUsageAnalytics.bind(this)),A.once("loadWarmupPlugins").do(this._loadWarmupPlugins.bind(this)),A.once("loadTrackingActivitiesSetting").do(this._loadTrackingActivitiesSetting.bind(this)),A.on("centerViewPort").do(this._centerViewPort.bind(this))].forEach(function(e){this.addDoable(e)}.bind(this))},initShellModel:function(e,t){x=O;x.init(e,t);W=this.getView().getViewData().shellModel;_.emit("/core/shell/model/personalization",_.last("/core/shell/enablePersonalization"))},initShellUIService:function(){b.initShellUIService({fnOnBackNavigationChange:this.onBackNavigationChange.bind(this)});if(j.enableOnlineStatus){sap.ui.require(["sap/ushell/ui5service/UserStatus"],function(e){this.oUserStatus=new e({scopeObject:this.getOwnerComponent(),scopeType:"component"})}.bind(this))}},onBackNavigationChange:function(e){b.setBackNavigationChanged(true);var t=e.getParameters().data;var n=_.last("/core/shell/model/currentState");if(t){b.service().setNavigateBack(t);if(n.stateName==="minimal"||n.stateName==="standalone"||n.stateName==="embedded"){sap.ushell.Container.getRenderer("fiori2").showHeaderItem("backBtn",true)}}else{b.service().resetNavigateBack()}},toggleContentDensity:function(e){var t=e.contentDensity==="compact";b.getAppMeta()._applyContentDensityByPriority(t,true)},_handleEmptyHash:function(e){e=typeof e==="string"?e:"";e=e.split("?")[0];if(e.length===0){var t=this.getView()?this.getView().getViewData():{};j=t.config||{};if(j.migrationConfig){return this.oShellNavigation.NavigationFilterStatus.Continue}if(j.rootIntent){window.setTimeout(function(){window.hasher.setHash(j.rootIntent)},0);return this.oShellNavigation.NavigationFilterStatus.Abandon}}return this.oShellNavigation.NavigationFilterStatus.Continue},_setConfigurationToModel:function(){var e=this.getView().getViewData();if(e){j=e.config||{}}if(j){if(j.states){O.extendStates(j.states);w.extendStates(j.states)}if(j.enableSetTheme!==undefined){W.setProperty("/setTheme",j.enableSetTheme)}W.setProperty("/contentDensity",j.enableContentDensity===undefined?true:j.enableContentDensity);if(j.migrationConfig!==undefined){W.setProperty("/migrationConfig",j.migrationConfig)}if(j.enableUserDefaultParameters!==undefined){W.setProperty("/userDefaultParameters",j.enableUserDefaultParameters)}if(j.disableHomeAppCache!==undefined){W.setProperty("/disableHomeAppCache",j.disableHomeAppCache)}W.setProperty("/enableHelp",_.last("/core/extension/enableHelp"));W.setProperty("/searchAvailable",j.enableSearch!==false)}},_loadTrackingActivitiesSetting:function(e){this._getPersData({container:"flp.settings.FlpSettings",item:"userActivitesTracking"}).then(function(t){if(t===undefined){t=true}W.setProperty("/enableTrackingActivity",t);A.emit("StepDone",e.stepName)}).catch(function(n){A.emit("StepFailed",e.stepName);t.error("Failed to load tracking activities state from the personalization",n,"sap.ushell.components.flp.settings.FlpSettings")})},_getPreviousPageDirty:function(){return B},_setPreviousPageDirty:function(e){B=e},getModelConfiguration:function(){var e=this.getView().getViewData();var t;if(e){var i=e.config||{};t=n({},i)}delete t.applications;return t},_getLogonFrameProvider:function(){return D},onExit:function(){this._aDoables.forEach(function(e){e.off()});this._aDoables=[];this._aDanglingControls.forEach(function(e){e.destroy()});this._aDanglingControls=[];this._aDanglingBindings.forEach(function(e){e.destroy()});this._aDanglingBindings=[];s.getEventBus().unsubscribe("externalSearch",this.externalSearchTriggered,this);s.getEventBus().unsubscribe("ESHSearchFinished",this._logSearchActivity,this);s.getEventBus().unsubscribe("sap.ushell","appOpened",this.onAppOpened,this);if(this.oShellNavigation){this.oShellNavigation.hashChanger.destroy()}w.destroy();y.destroy();H.deactivate();x.destroy();b.shellElements().clean();b.destroy();x=undefined},_getCurrentAppRouter:function(){var e=this._oAppLifeCycleService;var t=e&&e.getCurrentApplication&&e.getCurrentApplication();var n=t&&t.componentInstance;if(n){return n.getRouter()}return null},_disableSourceAppRouter:function(e,t){if(!this.bEnableHashChange||this.bRestorePreviousHash){return this.oShellNavigation.NavigationFilterStatus.Continue}var n=this.oShellNavigation.hashChanger.isInnerAppNavigation(e,t);if(!n){var i=this._getCurrentAppRouter();if(i){i.stop()}}return this.oShellNavigation.NavigationFilterStatus.Continue},_resumeAppRouterIgnoringCurrentHash:function(){var e=this._getCurrentAppRouter();if(e){e.initialize(true)}},handleDataLoss:function(e,t){var n=this.oShellNavigation.hashChanger;var i=n.getReloadApplication();if(this.bReloadApplication!==null&&this.bReloadApplication!==undefined){n.setReloadApplication(this.bReloadApplication);this.bReloadApplication=null}if(t===""||f.disableBlueBoxHashChangeTrigger===true){return this.oShellNavigation.NavigationFilterStatus.Continue}if(!this.bEnableHashChange&&!this.bRedoNavigation){this.bEnableHashChange=true;return this.oShellNavigation.NavigationFilterStatus.Custom}if(this.bRestorePreviousHash){return this.oShellNavigation.NavigationFilterStatus.Continue}if(this.bRedoNavigation){this.bRedoNavigation=false;this.bEnableHashChange=true;this.bExplaceNavigation=false;return this.oShellNavigation.NavigationFilterStatus.Continue}var a=this.oURLParsing.parseShellHash(e);var o=sap.ushell.Container.getRenderer()._isBuiltInIntent(a);var r=a.params["sap-ushell-navmode"];var s=r&&r[0];if(!o&&(this.bExplaceNavigation||s==="explace"||s==="frameless")){this.bExplaceNavigation=false;return this.oShellNavigation.NavigationFilterStatus.Continue}var l=sap.ushell.Container.getDirtyFlag();var h=sap.ushell.Container.isAsyncDirtyStateProviderSet();if(!h&&!l){B=l;return this.oShellNavigation.NavigationFilterStatus.Continue}var c=d.getInstance().getHistoryStateOffset()<0;Promise.all([this._waitForHash(t),sap.ushell.Container.getServiceAsync("NavTargetResolution"),sap.ushell.Container.getDirtyFlagsAsync()]).then(function(t){var n=t[1];var a=t[2];B=a;if(!a){this.bRedoNavigation=true;this._restoreHashUsingAction(e,"redo");return}if(o){if(this._handleDirtyStateUserConfirm()){this.bRedoNavigation=true;this._restoreHashUsingAction(e,"redo")}}else{var r="#"+e;n.resolveHashFragment(r).then(function(t){var n=t.targetNavigationMode==="explace"||t.targetNavigationMode==="frameless";var a=c&&t.navigationMode===z.newWindowThenEmbedded;if(n&&!a){this.bExplaceNavigation=true;this.bRedoNavigation=true;this._restoreHashUsingAction(e,"redo")}else if(this._handleDirtyStateUserConfirm()){this.bRedoNavigation=true;this.bReloadApplication=i;this._restoreHashUsingAction(e,"redo")}}.bind(this)).catch(function(){this.bRedoNavigation=true;this._restoreHashUsingAction(e,"redo")}.bind(this))}}.bind(this));return this._restoreHashUsingAction(t,"undo")},_waitForHash:function(e){var t="#"+e;return new Promise(function(e){var n=function(){var i=t===decodeURIComponent(window.location.hash);if(i){window.removeEventListener("hashchange",n);e()}};window.addEventListener("hashchange",n)})},_handleDirtyStateUserConfirm:function(){if(window.confirm(I.i18n.getText("dataLossInternalMessage"))){sap.ushell.Container.setDirtyFlag(false);b.postMessageToIframeApp("sap.ushell.appRuntime","setDirtyFlag",{bIsDirty:false});if(S.isBackNavigation()===true){S.resetBackNavigationFlag()}B=true;return true}return false},_restoreHashUsingAction:function(e,t){var n=this.oShellNavigation.wasHistoryEntryReplaced();var i=this._getRestoreHashStrategy(n,t);this._resumeAppRouterIgnoringCurrentHash();return this._restoreHash(i,e)},_getRestoreHashStrategy:function(e,t){if(e){return{strategy:"replaceHash",stepCount:0}}var n;var i=d.getInstance().getHistoryStateOffset();if(i===undefined||i>=0){i=1}else if(i<0){i=-1}if(t==="undo"){if(i<0){n="historyForward"}else{n="historyBack"}this.sLastUndoStrategy=n}else{switch(this.sLastUndoStrategy){case"historyBack":n="historyForward";break;case"historyForward":n="historyBack";break;default:n="replaceHash"}}return{strategy:n,stepCount:1}},_restoreHash:function(e,t){var n={status:this.oShellNavigation.NavigationFilterStatus.Custom,hash:""};switch(e.strategy){case"historyBack":this.bEnableHashChange=false;this._windowHistoryBack(e.stepCount);break;case"historyForward":this.bEnableHashChange=false;this._windowHistoryForward(e.stepCount);break;case"replaceHash":this.bEnableHashChange=false;f.replaceHash(t);break;default:throw new Error("Cannot execute unknown navigation strategy")}return n},_isColdStart:function(){var e=sap.ushell.Container.getRenderer("fiori2");var t=!e||!e.getCurrentCoreView();if(this.history.getHistoryLength()<=1&&t){return true}this._isColdStart=function(){return false};return false},_setEnableHashChange:function(e){this.bEnableHashChange=e},_logRecentActivity:function(e){if(!this.oInitialEnableTrackingPromise){if(_.last("/core/shell/model/enableTrackingActivity")!==undefined){this.oInitialEnableTrackingPromise=Promise.resolve()}else{this.oInitialEnableTrackingPromise=new Promise(function(e,t){_.once("/core/shell/model/enableTrackingActivity").do(e)})}}return this.oInitialEnableTrackingPromise.then(function(){if(_.last("/core/shell/model/enableTrackingActivity")){return new Promise(function(t,n){E.addActivity(e).done(t).fail(n)})}t.warning("Tracking is not enabled",null,"sap.ushell.renderers.fiori2.Shell.controller");return undefined})},_logApplicationUsage:function(e){if(sap.ushell.Container){sap.ushell.Container.getServiceAsync("UserRecents").then(function(t){t.addAppUsage(e)})}},doHashChange:function(e,t,n,i,a){g.start("FLP:ShellController.doHashChange","doHashChange","FLP");N.setPerformanceMark("FLP-ShellController-doHashChange-begin");A.emit("trackHashChange",e);var o=s.byId("sapUshellDashboardPage");if(o){o.setBlocked(true);o.setBusy(true)}return this._doHashChange(this,e,t,n,i,a).then(function(){g.end("FLP:ShellController.doHashChange")},function(e){g.end("FLP:ShellController.doHashChange");A.emit("doHashChangeError",Date.now());if(o){o.setBlocked(false);o.setBusy(false)}})},_doHashChange:function(e,t,n,i,o,r){this._wasHistoryEntryReplaced=this.oShellNavigation.wasHistoryEntryReplaced();this.oShellNavigation.resetHistoryEntryReplaced();var l;if(!this.bEnableHashChange){this.bEnableHashChange=true;return jQuery.when()}if(this.bRestorePreviousHash){this.bRestorePreviousHash=false;return jQuery.when()}if(r){e.hashChangeFailure(e.history.getHistoryLength(),r.message,null,"sap.ushell.renderers.fiori2.Shell.controller",false);return jQuery.when()}var h=new jQuery.Deferred;if(a&&M){a.closeAllDialogs();a.closeAllPopovers()}M=true;var c=e.history.getHistoryLength();var d=e.fixShellHash(t);var p=e.fixShellHash(i);e.history.hashChange(d,i);e.currentAppBeforeNav=E.getCurrentApplication();e._resolveHashFragment(d).then(function(t,a){var r=a?a.semanticObject+"-"+a.action:"";var u=e._getConfig();var f=!!(t&&t.componentHandle);var v=t&&t.ui5ComponentName;t=e._calculateNavigationMode(a,t);e._handleEarlyNavigation(d,n,t).then(function(m){if(m!==true){if(u&&u.applications&&u.applications[r]){t.applicationConfiguration=u.applications[r]}l=b.getInMemoryInstance(r,d,n,i);if(l.isInstanceSupported){e._initiateApplication(t,d,a,c,n,p,o);h.resolve();return}if(f||!v){var C=new jQuery.Deferred;if((t.applicationType==="URL"||t.applicationType==="GUI"||t.applicationType==="TR"||t.applicationType==="NWBC"||t.applicationType==="WDA"||t.applicationType==="WCF")&&l.isInstanceSupported===false&&l.appId){b.destroy(l.appId,l.container,C)}else{C.resolve()}C.done(function(){e._initiateApplication(t,d,a,c,n,p,o);h.resolve()});return}b.destroy(l.appId,l.container);b.removeApplication(r);E.setApplicationInInitMode();s.getEventBus().publish("ApplicationContainer","_prior.newUI5ComponentInstantion",{name:v});g.start("FLP:ShellController.UI5createComponent","UI5 createComponent","FLP");sap.ushell.Container.getServiceAsync("Ui5ComponentLoader").then(function(){b.createComponent(t,a).done(function(){g.end("FLP:ShellController.UI5createComponent");e._initiateApplication(t,d,a,c,n,p,o)}).fail(function(t){var n=I.i18n.getText("cannot_load_ui5_component_details",[d]);var i="Failed to load UI5 component for navigation intent "+d;E.setCurrentApplication(e.currentAppBeforeNav);e.hashChangeFailure(c,{title:I.i18n.getText("error"),message:I.i18n.getText("failed_to_open_ui5_component"),technicalMessage:i},{info:n,technicalMessage:t.message+"\n"+t.stack},"sap.ushell.renderers.fiori2.Shell.controller",false)})})}h.resolve()})},function(t){var n=I.i18n.getText("cannot_resolve_navigation_target_details",[d]);var i="Failed to resolve navigation target: "+d+". This is most likely caused by an incorrect SAP Fiori launchpad content configuration or by missing role assignment.";e.hashChangeFailure(c,{title:I.i18n.getText("error"),message:I.i18n.getText("failed_to_open_app_missing_configuration_or_role_assignment"),technicalMessage:i},{info:n,fixedShellHash:d,technicalMessage:t},"sap.ushell.renderers.fiori2.Shell.controller",false);h.reject(i)});return h.promise()},_handleEarlyNavigation:function(e,t,n){var i=this;var a;return new Promise(function(o){i._openAppViaNWBC(n).then(function(r){if(r===true){n.sFixedShellHash=e;i.logOpenAppAction(n,t);a=s.byId("sapUshellDashboardPage");if(a){a.setBlocked(false);a.setBusy(false)}o(true);return}var l=n&&n.navigationMode===z.newWindow;if(l){n.sFixedShellHash=e;i.logOpenAppAction(n,t);sap.ui.require(["sap/ushell/components/container/ApplicationContainer"],function(e){n.url=e.prototype._checkNwbcUrlAdjustment(undefined,n.applicationType,n.url,true);i._openAppInNewWindowAndRestore(n);a=s.byId("sapUshellDashboardPage");if(a){a.setBlocked(false);a.setBusy(false)}o(true)});return}if(_.last("/core/shell/model/migrationConfig")){j.migrationConfig=false;i.getModel().setProperty("/migrationConfig",false);if(n&&e==="#"){j.rootIntent=""}else if(e==="#"){window.setTimeout(function(){window.hasher.setHash(j.rootIntent)},0);o(true);return}}o(false);return})})},_initiateApplication:function(e,n,i,a,o,r,s){g.start("FLP:ShellController._initiateApplication","_initiateApplication","FLP");var l=E.getMetadata(e);var h=_.last("/core/extension/SupportTicket");var c;if(l.title){window.document.title=l.title}else{t.debug("Shell controller._initiateApplication: the title of the window is not changed because most probably the application was resolved with undefined")}if(h){window.setTimeout(function(){H.activate()},0)}try{c=this.oShellNavigation.isInitialNavigation();this.navigate(i,n,l,e,r)}catch(e){if(e.stack){t.error("Application initialization (Intent: \n"+n+"\n failed due to an Exception:\n"+e.stack)}this.oShellNavigation.setIsInitialNavigation(c);this.hashChangeFailure(a,e.name,e.message,l?l.title:"",false)}g.end("FLP:ShellController._initiateApplication")},_resolveHashFragment:function(e){g.start("FLP:ShellController._resolveHashFragment","_resolveHashFragment","FLP");var t=this.oURLParsing.parseShellHash(e);var n=new jQuery.Deferred;var i=this._getConfig();if(window["sap-ushell-async-libs-promise-directstart"]){window["sap-ushell-async-libs-promise-directstart"].then(function(e){n.resolve(e.resolvedHashFragment,t);delete window["sap-ushell-async-libs-promise-directstart"]},function(e){n.reject(e);delete window["sap-ushell-async-libs-promise-directstart"]});return n.promise()}sap.ushell.Container.getServiceAsync("NavTargetResolution").then(function(a){a.resolveHashFragment(e).done(function(e){E.setCurrentApplication(e);if(t&&t.semanticObject+"-"+t.action===i.rootIntent){e.navigationMode="embedded"}g.end("FLP:ShellController._resolveHashFragment");N.setPerformanceMark("FLP-ShellController-resolveHashFragment-end");n.resolve(e,t)}).fail(function(e){n.reject(e)})});return n.promise()},_calculateNavigationMode:function(e,t){if(!t){return undefined}var n=t.navigationMode;if(n===z.newWindowThenEmbedded){if(this._isColdStart()||d.getInstance().getDirection()===R.Backwards){t.navigationMode=z.embedded}else{t.navigationMode=z.newWindow;if(!N.isNativeWebGuiNavigation(t)){t.url=this._getCurrentLocationHash()}}return t}if(n===z.newWindow&&this._isColdStart()){if(this._hasAppCapabilitiesNavigationMode(t)&&t.appCapabilities.navigationMode===z.embedded){t.navigationMode=z.embedded;return t}t.navigationMode=z.replace;return t}if(n===z.newWindow&&this._hasAppCapabilitiesNavigationMode(t)&&t.appCapabilities.navigationMode===z.embedded){t.url=this._getCurrentLocationHash()}return t},_hasAppCapabilitiesNavigationMode:function(e){return N.isPlainObject(e.appCapabilities)&&e.appCapabilities.hasOwnProperty("navigationMode")},_usesNavigationRedirect:function(e){if(!e){return(new jQuery.Deferred).reject().promise()}var n=this;var i=e.getInstance({});if(i&&typeof i.navigationRedirect==="function"){var a=new jQuery.Deferred;var o=i.navigationRedirect();if(o&&typeof o.then==="function"){o.then(function(e){t.warning("Performing navigation redirect to hash "+e);i.destroy();n.history.pop();sap.ushell.Container.getServiceAsync("ShellNavigation").then(function(t){t.toExternal({target:{shellHash:e}},undefined,false);a.resolve(true)})},function(){a.reject()});return a.promise()}}return(new jQuery.Deferred).reject().promise()},navigate:function(e,t,n,a,o){g.start("FLP:ShellController.navigate","navigate","FLP");var r=i(a)?a.navigationMode:null;var s=this;if(r===null){if(this._isColdStart()){window.hasher.setHash("");return}this.bEnableHashChange=false;this.history.pop();this._windowHistoryBack(1);return Promise.resolve()}a=this._calculateNavigationMode(e,a);r=i(a)?a.navigationMode:null;if(r===z.embedded){if(!this._isColdStart()&&!this._wasHistoryEntryReplaced){this.oShellNavigation.setIsInitialNavigation(false)}var l=this._usesNavigationRedirect(a.componentHandle);var h=new Promise(function(i,r){l.then(null,function(){s._handleEmbeddedNavMode(t,e,n,a,o).then(function(){A.emit("CloseFesrRecord",{date:Date.now(),technicalName:n.technicalName});i()})});g.end("FLP:ShellController.navigate")});return h}if(r===z.replace){this.oShellNavigation.setIsInitialNavigation(false);this.bEnableHashChange=false;this._changeWindowLocation(a.url);return Promise.resolve()}if(r===z.newWindow){this._openAppInNewWindowAndRestore(a);return Promise.resolve()}this.hashChangeFailure(this.history.getHistoryLength(),"Navigation mode is not recognized",null,"sap.ushell.renderers.fiori2.Shell.controller",false);return Promise.resolve()},_openAppViaNWBC:function(e){var n=this;return new Promise(function(i){var a;if(e&&(N.isNativeWebGuiNavigation(e)||e.nativeNWBCNavigation)){a=true}else{a=false}if(a===false){i(false);return}var o=N.getPrivateEpcm();var r=V[e.navigationMode];var l;var h;if(N.hasNavigationModeCapability()){h=r||V[z.embedded]}var c=n._appendUserIdToUrl("sap-user",e.url).then(function(t){l=N.appendSapShellParam(t);return new Promise(function(t){try{var n=e.applicationType;var i=e.appCapabilities&&e.appCapabilities.appFrameworkId;var a={};var o=[];var r;var s=function(){a["sap-flp-url"]=sap.ushell.Container.getFLPUrl(true);a["system-alias"]=e.systemAlias;return[{name:"sap-flp-params",value:JSON.stringify(a)}]};var h=function e(t,n){var i=[];var a=function(e,a){if(t.indexOf(e+"=")>0){var o=new RegExp("(?:"+e+"=)([^&/]+)").exec(t);if(o&&o.length===2){i.push([o[1]]);n.push(a)}}};a("sap-iapp-state","sap-iapp-state-data");a("sap-xapp-state","sap-xapp-state-data");a("sap-xapp-state-data","sap-xapp-state-data");a("sap-intent-param","sap-intent-param-data");return i};if(n==="GUI"||n==="TR"||n==="NWBC"||n==="WDA"||n==="WCF"||i==="GUI"||i==="WDA"||i==="NWBC"||i==="WCF"){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(e){r=h(l,o);if(r.length>0){e.getAppStateData(r).then(function(e){o.forEach(function(t,n){if(e[n][0]){a[t]=e[n][0]}});t(s())},function(e){t()})}else{t(s())}})}else{t()}}catch(e){t()}})});c.then(function(a){try{s.getEventBus().publish("launchpad","appOpening",e);if(!o.doNavigate(l,h,undefined,undefined,undefined,undefined,undefined,a)){i(false);return}s.getEventBus().publish("sap.ushell","appOpened",e);n._restoreAfterNwbcNavigation(e).then(function(){if(n._oAppLifeCycleService.getCurrentApplication()&&n._oAppLifeCycleService.getCurrentApplication().homePage){n._setMenuVisible(true)}i(true)})}catch(a){if(a.stack){t.error("Application initialization failed due to an Exception:\n"+a.stack)}n.hashChangeFailure(n.history.getHistoryLength(),a.name,a.message,e.text,false);i(false)}})})},_restoreAfterNwbcNavigation:function(e){if(this.history.getHistoryLength()===1&&!this._oAppLifeCycleService.getCurrentApplication()){return sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(e){e.toExternal({target:{shellHash:"#"},writeHistory:false})})}this._restorePreviousHashAfterOpenNewWindow(e);return Promise.resolve()},_appendUserIdToUrl:function(e,t){return sap.ushell.Container.getServiceAsync("UserInfo").then(function(n){var i=n.getUser().getId();var a=t.indexOf("?")>=0?"&":"?";return t+a+e+"="+i})},_restorePreviousHashAfterOpenNewWindow:function(e){this.history.pop();var t=e.componentHandle&&e.componentHandle.getInstance&&e.componentHandle.getInstance({});if(t){t.destroy()}this._resumeAppRouterIgnoringCurrentHash();this.bRestorePreviousHash=true;this._windowHistoryBack(1);E.setCurrentApplication(this.currentAppBeforeNav);A.emit("openedAppInNewWindow",Date.now())},_openAppInNewWindowAndRestore:function(e){s.getEventBus().publish("launchpad","appOpening",e);this._openAppNewWindow(e.url);s.getEventBus().publish("sap.ushell","appOpened",e);this._restorePreviousHashAfterOpenNewWindow(e)},_handleEmbeddedNavMode:function(e,t,n,i,a){g.start("FLP:ShellController._handleEmbeddedNavMode","_handleEmbeddedNavMode","FLP");var o=this._getConfig();this.resetShellUIServiceHandlers();b.getAppMeta().setAppIcons(n);var r="-"+t.semanticObject+"-"+t.action;var s=e==="#"||o.rootIntent&&N.getBasicHash(o.rootIntent)===t.semanticObject+"-"+t.action;var l=t?t.semanticObject+"-"+t.action:"";b.switchViewState(b.shellElements().calculateElementsState(s?"home":"app",i.applicationType,o.appState,i.explicitNavMode),undefined,r);if(s){b.getShellUIService().setBackNavigation()}var h=b.handleControl(l,r,t,i,this.getWrappedApplicationWithMoreStrictnessInIntention.bind(this),e,a);if(this.currentAppBeforeNav){var c;c=b.getWebGuiV1StatefulContainer(this.currentAppBeforeNav.url);if(c){c.onApplicationOpened(i.applicationType)}}g.end("FLP:ShellController._handleEmbeddedNavMode");return h},_centerViewPort:function(){this.oViewPortContainer.switchState("Center")},_isShellHomeIntent:function(e){return e==="#"||e===j.rootIntent},getWrappedApplicationWithMoreStrictnessInIntention:function(e,n,i,a,o,r,l){var h=this;if(p.system.desktop){sap.ui.require(["sap/ushell/renderers/fiori2/AccessKeysHandler"],function(e){var t=s.byId("shellAppTitle");if(t&&_.last("/core/shell/model/currentState/stateName")==="app"){var n=t.getFocusDomRef();if(n){e.sendFocusBackToShell(n.getAttribute("id"))}}})}window.setTimeout(function(){window.setTimeout(function(){h.readNavigationEnd()},600);s.getEventBus().publish("launchpad","appOpening",a);t.info("app is being opened")},0);if(j.applications){a.applicationConfiguration=j.applications[e]}var c=b.getAppContainer(o,a,this._isColdStart(),i,l);a.sFixedShellHash=l;b.publishNavigationStateEvents(c,a,this.onAppAfterRendering.bind(this,a));var d=c.getApplicationType();var u=c.getFrameworkId();if(d==="GUI"||d==="TR"||d==="WDA"||d==="NWBC"||d==="WCF"||u==="GUI"||u==="WDA"||u==="NWBC"||u==="WCF"){c.addStyleClass("sapUShellApplicationContainerShiftedIframe")}if(!r){c.addStyleClass("sapUShellApplicationContainerLimitedWidth")}if(this._isFloatingContainerDocked()&&window.matchMedia("(min-width: 106.4rem)").matches){c.addStyleClass("sapUShellDockingContainer");c.removeStyleClass("sapUShellApplicationContainerLimitedWidth")}else if(this._isFloatingContainerDocked()){c.removeStyleClass("sapUShellApplicationContainerLimitedWidth")}c.toggleStyleClass("sapUshellDefaultBackground",!n.hideLightBackground);b.getAppMeta()._applyContentDensityByPriority();b.addControl(c);N.setPerformanceMark("FLP - addAppContainer");g.end("FLP:ShellController.getWrappedApplication");return c},resetShellUIServiceHandlers:function(){b.getAppMeta().resetShellUIServiceHandlers();b.setBackNavigationChanged(false)},onAppAfterRendering:function(e){var n=b.getShellUIService();window.setTimeout(function(){s.getEventBus().publish("sap.ushell","appOpened",e);t.info("app was opened")},0);var i=b._publicEventDataFromResolutionResult(e);A.emit("AppRendered",i,true);sap.ushell.renderers.fiori2.utils.publishExternalEvent("appOpened",i);N.setPerformanceMark("FLP.appOpened");if(n){b.initAppMetaParams()}x.updateStateProperty("application/icon",b.getAppMeta().getAppIcon(),true)},_saveHomePageComponent:function(){if(this.oHomeApp){return}var e=this;var t="sap.ushell";var n=function(i,a,o){e.oHomeApp=o.component;s.getEventBus().unsubscribe(t,"appComponentLoaded",n)};s.getEventBus().subscribe(t,"appComponentLoaded",n)},hashChangeFailure:function(e,t,n,i,a){var o=s.byId("sapUshellDashboardPage");if(o){o.setBlocked(false);o.setBusy(false)}if(N.isPlainObject(t)){this.reportError(t.technicalMessage,n.technicalMessage,i);sap.ushell.Container.getServiceAsync("Message").then(function(e){e.show(e.Type.ERROR,t.message,{title:t.title,details:n})})}else{this.reportError(t,n,i);this.delayedMessageError(I.i18n.getText("fail_to_start_app_try_later"))}M=false;this._resumeAppRouterIgnoringCurrentHash();if(e===0){window.hasher.setHash("")}else if(new URLSearchParams(window.location.search).get("bFallbackToShellHome")){window.hasher.setHash("")}else{this.bEnableHashChange=a;sap.ushell.Container.setDirtyFlag(B);b.postMessageToIframeApp("sap.ushell.appRuntime","setDirtyFlag",{bIsDirty:B});this._windowHistoryBack(1)}},reportError:function(e,n,i){t.error(e,n,i)},delayedMessageError:function(e){window.setTimeout(function(){if(sap.ushell.Container!==undefined){sap.ushell.Container.getServiceAsync("Message").then(function(t){t.error(e)})}},0)},fixShellHash:function(e){if(!e){e="#"}else if(e.charAt(0)!=="#"){e="#"+e}return e},_openAppNewWindow:function(e){var t=k.openURL(e);if(!t&&!this._checkWindowLocationSearch("workzone-mobile-app=true")){var n=I.i18n.getText("fail_to_start_app_popup_blocker",[window.location.hostname]);this.delayedMessageError(n)}},_checkWindowLocationSearch:function(e){return window.location.search.indexOf(e)>-1},_windowHistoryBack:function(e){window.history.go(-1*e)},_windowHistoryForward:function(e){window.history.go(e)},_changeWindowLocation:function(e){window.location.href=e},_setMenuVisible:function(e){var t=document.getElementById(U.NavigationBar);if(!t){return}e=e||_.last("/core/menu/enabled")&&_.last("/core/menu/visibleInAllStates");t.classList.toggle("sapUshellShellHidden",!e)},onAppOpened:function(e,t,n){if(n.targetNavigationMode!=="explace"&&n.targetNavigationMode!=="frameless"){this._setMenuVisible(false)}var i=this.oShellNavigation.hashChanger.getAppHash();var a=i?"&/"+i:null;this.logOpenAppAction(n,a)},externalSearchTriggered:function(e,t,n){_.emit("/core/shell/model/searchTerm",n.searchTerm);n.query=n.searchTerm},onBeforeNavigate:function(e){var t=e.getParameter("to");var n=this.getOwnerComponent();var i=t===n.byId("Shell-home-component-container");var a=t===n.byId("pages-component-container");var o=t===n.byId("homeApp-component-container");var r=t===n.byId("workPageRuntime-component-container");var s=t===n.byId("runtimeSwitcher-component-container");var l=i||a||o||r||s;b.onBeforeNavigate(e.getParameter("fromId"),e.getParameter("from"),e.getParameter("toId"),e.getParameter("to"));this._setMenuVisible(l)},onAfterNavigate:function(e){var t=e.mParameters?e.mParameters.toId:undefined;var n=s.byId("sapUshellDashboardPage");if(n){n.setBlocked(false);n.setBusy(false)}b.onAfterNavigate(e.getParameter("fromId"),e.getParameter("from"),t,e.getParameter("to"));s.getEventBus().publish("sap.ushell","navigated",{})},logOpenAppAction:function(e,t){var n=_.last("/core/shell/enableRecentActivity")&&_.last("/core/shell/enableRecentActivityLogging");if(!n){return}var i={};var a=E.getMetadata(e);var o=e.sFixedShellHash;var r=o;if(t){r+=t}i.title=a.title;i.appType=L.APP;i.url=r;var s=this.oURLParsing.parseShellHash(o);if(s){i.appId="#"+this.oURLParsing.constructShellHash({semanticObject:s.semanticObject,action:s.action})}else{i.appId=o}if(o&&o.indexOf("#Action-search")===-1){window.setTimeout(function(){this._logRecentActivity(i)}.bind(this),1500)}},_logSearchActivity:function(){if(_.last("/core/shell/enableRecentActivity")&&_.last("/core/shell/enableRecentActivityLogging")){var e="";try{e=s.byId("searchFieldInShell-input").getModel().getLastSearchTerm()}catch(e){t.error("Shell: last search term is not available to log a recent activity")}this._logRecentActivity({appId:"#Action-search",appType:L.SEARCH,title:e,url:"#"+window.hasher.getHash()})}},readNavigationEnd:function(){var e=document.getElementById("sapUshellLoadingAccessibilityHelper-loadingComplete");if(e){e.setAttribute("aria-live","polite");e.innerHTML=I.i18n.getText("loadingComplete");window.setTimeout(function(){e.setAttribute("aria-live","off");e.innerHTML=""},0)}},_loadCoreExtNonUI5:function(e){if(e&&e.applicationType!=="SAPUI5"){this._loadCoreExt()}},_loadUsageAnalytics:function(e){sap.ushell.Container.getServiceAsync("UsageAnalytics").then(function(t){t.init(I.i18n.getText("usageAnalytics"),I.i18n.getText("i_agree"),I.i18n.getText("i_disagree"),I.i18n.getText("remind_me_later"));A.emit("StepDone",e.stepName)},function(){A.emit("StepFailed",e.stepName)})},_onCoreResourcesComplementLoaded:function(){N.setPerformanceMark("SchedulingAgent-StartOfFlow");var e=this.getView();if(e){e.createPostCoreExtControls()}C._initialize();A.emit("startScheduler")},_loadRendererExtensionPlugins:function(e){var t=new URLSearchParams(window.location.search);var n=t.get("sap-ushell-xx-pluginmode")==="delayed";function i(t){function i(){A.emit("StepDone",e.stepName)}function a(){t.loadPlugins("RendererExtensions").always(i)}if(n){window.setTimeout(a,5e3)}else{a()}}sap.ushell.Container.getServiceAsync("PluginManager").then(i.bind(this))},_loadWarmupPlugins:function(e){sap.ushell.Container.getServiceAsync("PluginManager").then(function(n){n.loadPlugins("AppWarmup").always(function(){t.debug("WARMUP plugins loaded",null,"sap.ushell.renderers.fiori2.Shell");A.emit("StepDone",e.stepName);N.setPerformanceMark("SchedulingAgent-EndOfFlow");N.setPerformanceMeasure("SchedulingAgentTotalTime","SchedulingAgent-StartOfFlow","SchedulingAgent-EndOfFlow")})})},_loadCoreExt:function(){g.end("FLP:Container.InitLoading");sap.ushell.Container.getServiceAsync("Ui5ComponentLoader").then(function(){A.emit("loadCoreResourcesComplement")})},getCurrentViewportState:function(){return _.last("/core/shell/model/currentViewPortState")},_activateFloatingUIActions:function(e){if(e<417){this.oFloatingUIActions.disable()}else{this.oFloatingUIActions.enable()}},setFloatingContainerDragSelector:function(e){if(!this._oFloatingContainerPromise){this._oFloatingContainerPromise=this.getView().createFloatingContainer()}this._oFloatingContainerPromise.then(function(){var n=document.querySelector(e);if(n){n.classList.add("sapUshellFloatingContainerSelector")}else{t.error("setFloatingContainerDragSelector could not find the element","sap.ushell.renderers.fiori2.Shell.controller")}sap.ui.require(["sap/ushell/UIActions"],function(n){if(!this.oFloatingUIActions){this.oFloatingUIActions=new n({containerSelector:".sapUiBody",wrapperSelector:".sapUshellFloatingContainerWrapper",draggableSelector:".sapUshellFloatingContainerWrapper",rootSelector:".sapUiBody",cloneClass:"sapUshellFloatingContainer-clone",dragCallback:this._handleFloatingContainerDrag.bind(this),endCallback:this._handleFloatingContainerDrop.bind(this),moveTolerance:3,onDragStartUIHandler:this._onFloatingContainerDragStart.bind(this),onDragEndUIHandler:this._onFloatingContainerDragEnd.bind(this),dragAndScrollCallback:this._onFloatingContainerDrag.bind(this),switchModeDelay:1e3,isLayoutEngine:false,isTouch:false,elementToCapture:e,defaultMouseMoveHandler:function(){},debug:t.getLevel()>=t.Level.DEBUG})}else{this.oFloatingUIActions.elementsToCapture=jQuery(e)}this._activateFloatingUIActions(jQuery(window).width());var i;jQuery(window).bind("resize",function(){clearTimeout(i);i=window.setTimeout(this._activateFloatingUIActions(jQuery(window).width()),300)}.bind(this))}.bind(this))}.bind(this))},_onFloatingContainerDrag:function(e){g.start("FLP:Shell.controller._doDock","dragging co-pilot element","FLP");if(!this._isFloatingContainerDockSupported()){g.end("FLP:Shell.controller._doDock");return}var t=jQuery(window).width();if(e){e.docked={};var n=e.docked;if(e.moveX>=t-64){n.dockPos="right";n.setIsDockingAreaOpen=true;this._handleDockingPreview(e)}else if(e.moveX<64){n.dockPos="left";n.setIsDockingAreaOpen=true;this._handleDockingPreview(e)}else{if(this._isDockingAreaOpen()){this._handleDockingPreview(false)}if(this._isFloatingContainerDocked()){this._handleDockingPreview(false);this._undockFloatingContainer()}}}g.end("FLP:Shell.controller._doDock")},_isFloatingContainerDockSupported:function(){var e=p.media.getCurrentRange(p.media.RANGESETS.SAP_STANDARD);return e.name==="Desktop"},_finishDoDock:function(e){this._handleDockingPreview(false);this._saveFloatingContainerState("docked:"+e.dockPos);this._moveFloatingContainerIntoDock(e);s.getEventBus().publish("launchpad","shellFloatingContainerIsDocked")},_expandFloatingContainerToDock:function(){var e=document.getElementById(U.FloatingContainer);e.style.height="100%";s.byId("shell-floatingContainer").addStyleClass("sapUshellShellFloatingContainerFullHeight")},_shrinkFloatingContainerToDragUI:function(){var e=document.getElementById(U.FloatingContainer);e.classList.remove("sapUshellContainerDocked");s.byId("shell-floatingContainer").removeStyleClass("sapUshellShellFloatingContainerFullHeight");jQuery(".sapUshellShellFloatingContainerFullHeight").removeClass("sapUshellShellFloatingContainerFullHeight")},_emitFloatingContainerResizeEvent:function(){var e=s.byId("viewPortContainer");if(e){e._handleSizeChange()}window.setTimeout(function(){s.getEventBus().publish("launchpad","appFinderWithDocking")},300)},_undockFloatingContainer:function(){if(this._isFloatingContainerDocked()){this._saveFloatingContainerState("floating");this._shrinkFloatingContainerToDragUI();this._removeFloatingContainerFromDock();this._startFloatingContainerAnimation(false)}},_handleFloatingContainerUndockOnResize:function(){this._undockFloatingContainer();s.getEventBus().publish("launchpad","shellFloatingContainerIsUnDockedOnResize")},_onFloatingContainerDragStart:function(){g.start("FLP:Shell.controller._onDragStartUI","start drag","FLP");this._undockFloatingContainer();s.getEventBus().publish("launchpad","shellFloatingContainerIsUnDocked");g.end("FLP:Shell.controller._onDragStartUI")},_startFloatingContainerAnimation:function(e){return new Promise(function(t,n){this._clearFloatingContainerAnimation();var i=Array.from(document.getElementsByClassName("sapUshellFloatingContainerWrapper"));i.forEach(function(n){if(e){n.classList.add("sapUshellContainerDockedExtendCoPilot");this._emitFloatingContainerResizeEvent()}else{return}["webkitAnimationEnd","onanimationend","msAnimationEnd","animationend"].forEach(function(e){n.addEventListener(e,function(){this._clearFloatingContainerAnimation();t()}.bind(this),{once:true})}.bind(this))}.bind(this))}.bind(this))},_clearFloatingContainerAnimation:function(){var e=Array.from(document.getElementsByClassName("sapUshellFloatingContainerWrapper"));e.forEach(function(e){e.classList.remove("sapUshellContainerDockedExtendCoPilot");e.classList.remove("sapUshellContainerDockedMinimizeCoPilot")})},_handleDockingPreview:function(e){var t=e?e.docked:false;var n=t?t.setIsDockingAreaOpen:false;if(n&&jQuery("#DockingAreaDiv").length===0){var i=r.getRTL();if(t.dockPos==="right"&&e.clone&&!i||t.dockPos==="left"&&e.clone&&i){jQuery('<div id="DockingAreaDiv" class="sapUshellShellDisplayDockingAreaRight">').appendTo(e.clone.parentElement)}else if(t.dockPos==="left"&&e.clone&&!i||t.dockPos==="right"&&e.clone&&i){jQuery('<div id="DockingAreaDiv" class="sapUshellShellDisplayDockingAreaLeft">').appendTo(e.clone.parentElement)}e.clone.oDockedProp={};e.clone.oDockedProp.dockPos=t.dockPos}else if(!n){window.setTimeout(function(){jQuery(".sapUshellShellDisplayDockingAreaRight").remove();jQuery(".sapUshellShellDisplayDockingAreaLeft").remove()},150)}},_isFloatingContainerDocked:function(){return document.getElementsByClassName("sapUshellContainerDocked").length!==0},_isDockingAreaOpen:function(){return document.getElementsByClassName("sapUshellShellDisplayDockingAreaRight").length!==0||document.getElementsByClassName("sapUshellShellDisplayDockingAreaLeft").length!==0},_moveFloatingContainerIntoDock:function(e){var t=r.getRTL();var n=document.getElementById(U.FloatingContainer);n.classList.add("sapUshellContainerDocked");var i;if(e.dockPos==="left"&&!t||e.dockPos==="right"&&t){i=U.FloatingContainerDockStart}else{i=U.FloatingContainerDockEnd}if(e.dockPos==="left"){n.classList.add("sapUshellContainerDockedStart");n.classList.remove("sapUshellContainerDockedEnd")}else{n.classList.remove("sapUshellContainerDockedStart");n.classList.add("sapUshellContainerDockedEnd")}var a=document.getElementById(i);a.appendChild(n);this._expandFloatingContainerToDock();this._emitFloatingContainerResizeEvent()},_removeFloatingContainerFromDock:function(){var e=document.getElementById(U.FloatingContainer);document.body.appendChild(e);e.classList.remove("sapUshellContainerDocked");e.classList.remove("sapUshellContainerDockedStart");e.classList.remove("sapUshellContainerDockedEnd");this._emitFloatingContainerResizeEvent()},_onFloatingContainerDragEnd:function(e){var t=jQuery(window).width();if(this._isFloatingContainerDocked()){if(e&&(e.clientX>=t-64||e.clientX<64)){this._startFloatingContainerAnimation(false)}}else{}},_handleFloatingContainerDrop:function(e,t,n){g.start("FLP:Shell.controller._handleFloatingContainerDrop","drop floating container","FLP");var i=t.firstChild?s.byId(t.firstChild.id):undefined;var a=new v(v.Type.local,"com.sap.ushell.adapters.local.FloatingContainer");var o=jQuery(window).width();var r=jQuery(window).height();var l=n.deltaX/o;var h=-n.deltaY/r;var c=t.style.visibility;var d=t.style.display;var p=parseFloat(t.style.left.replace("%",""));var u=parseFloat(t.style.top.replace("%",""));if(typeof p==="number"){l=p+100*n.deltaX/o}if(typeof u==="number"){h=u+100*n.deltaY/r}if(this._isDockingAreaOpen()){h=0}t.style.left=l+"%";t.style.top=h+"%";t.style.position="absolute";t.style.display="block";t.visibility=c;t.display=d;a.put("floatingContainerStyle",t.style.cssText);if(i){i.handleDrop();if(n.clone.oDockedProp&&this._isDockingAreaOpen()){this._finishDoDock(n.clone.oDockedProp)}}g.end("FLP:Shell.controller.handleFloatingContainerDrop")},_handleFloatingContainerDrag:function(e,t){g.start("FLP:Shell.controller._handleFloatingContainerUIStart","starts dragging floating container","FLP");var n=t;n.style.display="none";if(window.getSelection){var i=window.getSelection();try{i.removeAllRanges()}catch(e){}}g.end("FLP:Shell.controller._handleFloatingContainerUIStart")},getFloatingContainerState:function(){var e=new v(v.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");var t="floating";if(e!==null){t=e.get("lastState");if(t===null){t="floating"}}return t},_saveFloatingContainerState:function(e){var t=new v(v.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");t.put("lastState",e)},setFloatingContainerVisibility:function(e){if(!this._oFloatingContainerPromise){this._oFloatingContainerPromise=this.getView().createFloatingContainer()}this.getView().getModel("helper").setProperty("/shell/floatingContainerVisible",e);return this._oFloatingContainerPromise.then(function(){var t=this.getFloatingContainerState()||"";if(t==="floating"){}else if(t.indexOf("docked")!==-1){if(e){if(this._isFloatingContainerDockSupported()){var n=t.indexOf("right")!==-1?"right":"left";this._moveFloatingContainerIntoDock({dockPos:n});this._startFloatingContainerAnimation(true)}else{this._saveFloatingContainerState("floating")}}else{this._startFloatingContainerAnimation(false)}this._emitFloatingContainerResizeEvent()}}.bind(this))},getFloatingContainerVisibility:function(){return this.getView().getModel("helper").getProperty("/shell/floatingContainerVisible")},setFloatingContainerContent:function(e,t,n,i){x.setFloatingContainerContent(e,t,n,i)},getRightFloatingContainerVisibility:function(){var e=this.getView().getRightFloatingContainer();var t=e&&e.getVisible();return t},setHeaderTitle:function(e){w.updateStates({propertyName:"title",value:e||"",aStates:["home","app"],bCurrentState:false,bDoNotPropagate:false})},setNavigationBar:function(e){e.placeAt(U.NavigationBar,"only");this.addDanglingControl(e)},setShellShapes:function(e){if(e.placeAt){e.placeAt(U.ShellShapes,"only");this.addDanglingControl(e)}else if(e instanceof Node){document.getElementById(U.ShellShapes).appendChild(e)}},setFooter:function(e){var n=this.getView();var i=n.getModel("helper");if(typeof e!=="object"||!e.getId){throw new Error("oFooter value is invalid")}var a=i.getProperty("/shell/footerContent");if(a){t.warning("You can only set one footer. Replacing existing footer: "+a+", with the new footer: "+e.getId()+".")}i.setProperty("/shell/footerContent",e.getId());e.placeAt(U.Footer,"only");this.addDanglingControl(e);if(e._applyContextClassFor){e._applyContextClassFor("footer")}},removeFooter:function(){var e=this.getView();var t=e.getModel("helper");var n=t.getProperty("/shell/footerContent");if(n){var i=s.byId(n);if(i&&i.destroy){i.destroy()}}t.setProperty("/shell/footerContent","")},addUserPreferencesEntry:function(e,t){this._validateUserPrefEntryConfiguration(e,t);this._updateUserPrefModel(e,t)},addUserProfilingEntry:function(e){this._validateUserPrefEntryConfiguration(e);this._updateProfilingModel(e)},_validateUserPrefEntryConfiguration:function(e,t){if(!e||typeof e!=="object"){throw new Error("object oConfig was not provided")}if(!e.title){throw new Error("title was not provided")}if(!e.value){throw new Error("value was not provided")}if(typeof e.entryHelpID!=="undefined"){if(typeof e.entryHelpID!=="string"){throw new Error("entryHelpID type is invalid")}else if(e.entryHelpID===""){throw new Error("entryHelpID should not be an empty string")}}if(e.title&&typeof e.title!=="string"){throw new Error("title type is invalid")}if(typeof e.value!=="function"&&typeof e.value!=="string"&&typeof e.value!=="number"){throw new Error("value type is invalid")}["onSave","content","onCancel"].forEach(function(t){if(e[t]&&typeof e[t]!=="function"){throw new Error(t+" type is  "+typeof e[t]+" but should be a function")}});if(t){[{name:"groupingId",type:"string"},{name:"groupingTabTitle",type:"string"},{name:"groupingTabHelpId",type:"string"}].forEach(function(t){if(!e[t.name]){throw new Error(t.name+" is missing")}else if(typeof e[t.name]!==t.type){throw new Error(t.name+" type is "+typeof e[t.name]+" but should be a "+t.type)}})}},_createSessionHandler:function(e){var t=this;var n=2e4;sap.ui.require(["sap/ushell/SessionHandler"],function(i){t.oSessionHandler=new i(b);t.oSessionHandler.initLogout();window.setTimeout(function(){t.oSessionHandler.init({sessionTimeoutReminderInMinutes:e.sessionTimeoutReminderInMinutes,sessionTimeoutIntervalInMinutes:e.sessionTimeoutIntervalInMinutes,sessionTimeoutTileStopRefreshIntervalInMinutes:e.sessionTimeoutTileStopRefreshIntervalInMinutes,enableAutomaticSignout:e.enableAutomaticSignout})},n)})},_getSessionHandler:function(){return this.oSessionHandler},_navBack:function(){this.setUserActionsMenuSelected(false);b.service().navigateBack()},_updateUserPrefModel:function(e,t){var n=this._getModelEntryFromEntryObject(e);var i=_.last("/core/userPreferences/entries")||[];if(t){n.groupingEnablement=true;n.groupingId=e.groupingId;n.groupingTabTitle=e.groupingTabTitle;n.groupingTabHelpId=e.groupingTabHelpId}i.push(n);i=this._reorderUserPrefEntries(i);_.emit("/core/userPreferences/entries",i)},_updateProfilingModel:function(e){var t=this._getModelEntryFromEntryObject(e);var n=_.last("/core/userPreferences/profiling")||[];n.push(t);_.emit("/core/userPreferences/profiling",n)},_getModelEntryFromEntryObject:function(e){return{id:N._getUid(),entryHelpID:e.entryHelpID,title:e.title,valueArgument:e.value,valueResult:null,onSave:e.onSave,onCancel:e.onCancel,contentFunc:e.content,contentResult:null,icon:e.icon,provideEmptyWrapper:e.provideEmptyWrapper}},_reorderUserPrefEntries:function(e){var t=[];var n=["userAccountEntry","themes","homepageEntry","spacesEntry","userActivitiesEntry","userProfiling","language","notificationsEntry","userDefaultEntry"];var i={};for(var a=e.length-1;a>=0;a--){if(n.indexOf(e[a].id)!==-1){var o=e.splice(a,1)[0];i[o.id]=o}}n.forEach(function(e){var n=i[e];if(n){t.push(n)}});return t.concat(e)},getModel:function(){return W},_getConfig:function(){return j||{}},_getPersData:function(e){var t=o.getOwnerComponentFor(this.getView());return new Promise(function(n,i){sap.ushell.Container.getServiceAsync("Personalization").then(function(a){var o={keyCategory:a.constants.keyCategory.FIXED_KEY,writeFrequency:a.constants.writeFrequency.LOW,clientStorageAllowed:true};var r=a.getPersonalizer(e,o,t);r.getPersData().then(n).fail(i)})})},_getCurrentLocationHash:function(){return window.location.hash},setUserActionsMenuSelected:function(e){A.emit("showUserActionsMenu",e)},getUserActionsMenuSelected:function(){return _.last("/core/shell/model/currentViewPortState")==="LeftCenter"},setNotificationsSelected:function(e){A.emit("showNotifications",e)},getNotificationsSelected:function(){return _.last("/core/shell/model/currentViewPortState")==="RightCenter"}})});
//# sourceMappingURL=Shell.controller.js.map