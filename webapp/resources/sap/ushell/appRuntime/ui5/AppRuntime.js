// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
prepareModules();sap.ui.define(["sap/ui/core/Core","sap/base/Log","sap/base/util/ObjectPath","sap/base/util/deepExtend","sap/base/util/isEmptyObject","sap/m/library","sap/ui/core/BusyIndicator","sap/ui/core/ComponentContainer","sap/ui/core/Popup","sap/ui/core/routing/History","sap/ui/thirdparty/hasher","sap/ui/thirdparty/jquery","sap/ui/thirdparty/URI","sap/ushell/appRuntime/ui5/AppCommunicationMgr","sap/ushell/appRuntime/ui5/AppRuntimePostMessageAPI","sap/ushell/appRuntime/ui5/AppRuntimeService","sap/ushell/appRuntime/ui5/performance/FesrEnhancer","sap/ushell/appRuntime/ui5/renderers/fiori2/AccessKeysAgent","sap/ushell/appRuntime/ui5/services/AppConfiguration","sap/ushell/appRuntime/ui5/services/AppLifeCycleAgent","sap/ushell/appRuntime/ui5/services/ShellUIService","sap/ushell/appRuntime/ui5/SessionHandlerAgent","sap/ushell/EventHub","sap/ushell/iconfonts","sap/ushell/UI5ComponentType","sap/ushell/ui5service/UserStatus","sap/ushell/utils/UrlParsing","sap/ushell/utils/WindowUtils","sap/ushell/appRuntime/ui5/AppRuntimeContext","sap/ui/core/Configuration"],function(e,t,i,n,a,s,r,p,u,o,l,jQuery,c,h,d,f,m,g,v,y,C,A,S,R,b,I,P,w,U,M){"use strict";var F=s.URLHelper;m.init();var H,D=(new c).search(true),L,O=false,T,k=false,B=false,E=false,N=false,x=false,_;function W(){this.main=function(){var e,i=Promise.resolve(),n=Promise.resolve(),a=Promise.resolve(),s=H._getURI();jQuery("body").css("height","100%").css("width","100%");h.init(true);f.sendMessageToOuterShell("sap.ushell.appRuntime.iframeIsBusy",{bValue:true});this.getPageConfig(s);H.setModulePaths();e=H.loadAdditionalLibs();if(s.hasOwnProperty("sap-remote-intent")){i=f.sendMessageToOuterShell("sap.ushell.services.UserInfo.getLocaleData",undefined,undefined,3e3,{})}U.setAppLifeCycleAgent(y);y.expandSapIntentParams(H._getURI()).then(function(s){var r,p;if(s.hasOwnProperty("sap-remote-intent")===true){U.setIsScube(true);p=s["sap-remote-intent"];if(p===undefined){t.error("Application cannot be opened. 'sAppIntent' is undefined")}U.setRemoteSystemId(s["sap-remote-system"]);H.adjustIframeURL()}else{r=s["sap-ui-app-id"]}H.init();var u=new Promise(function(e){sap.ui.require(["sap/ushell/appRuntime/ui5/services/UserInfo"],e)});if(U.getIsScube()===true){a=H.initServicesContainer()}else{n=H.initServicesContainer()}e.push(a);Promise.all(e).then(function(){if(U.getIsScube()===true){sap.ushell.Container.getServiceAsync("CommonDataModel")}Promise.all([n,H.getAppInfo(r,p),u,i]).then(function(e){var t=e[1].oResolvedHashFragment,i=e[1].oParsedHash,n=e[3]||{};H._setUI5LocaleAttributes(n);A.init();g.init();H._setInitialAppRoute();H.createApplication(r,s,t,p,i).then(function(e){H.renderApplication(e);f.sendMessageToOuterShell("sap.ushell.appRuntime.iframeIsBusy",{bValue:false})})})})})};this._setUI5LocaleAttributes=function(e){if(Object.keys(e).length>0){var t=M.getFormatSettings();if(e.dateFormatShort){t.setDatePattern("short",e.dateFormatShort)}if(e.dateFormatMedium){t.setDatePattern("medium",e.dateFormatMedium)}if(e.numberFormatGroup){t.setNumberSymbol("group",e.numberFormatGroup)}if(e.numberFormatDecimal){t.setNumberSymbol("decimal",e.numberFormatDecimal)}if(e.timeFormatShort){t.setTimePattern("short",e.timeFormatShort)}if(e.timeFormatMedium){t.setTimePattern("medium",e.timeFormatMedium)}if(e.calendarMapping){t.setLegacyDateCalendarCustomizing(e.calendarMapping)}if(e.timeZone){M.setTimezone(e.timeZone)}if(e.currencyFormats){t.setCustomCurrencies(e.currencyFormats)}}};this._setInitialAppRoute=function(){var e=P.parseShellHash(l.getHash());if(e&&e.appSpecificRoute&&e.appSpecificRoute.length>0){f.sendMessageToOuterShell("sap.ushell.services.CrossApplicationNavigation.setInnerAppRoute",{appSpecificRoute:decodeURIComponent(e.appSpecificRoute)})}};this._getURI=function(){return(new c).query(true)};this.init=function(){R.registerFiori2IconFont();x=this._getURIParams()["sap-manifest-width"];v.setFullWidthFromManifest(x);d.registerCommHandlers({"sap.ushell.appRuntime":{oServiceCalls:{hashChange:{executeServiceCallFn:function(e){var t=e.oMessageData.body.sHash;if(typeof t==="string"){var i=P.parseShellHash(t),n=P.parseShellHash(l.getHash());if(i&&n&&i.semanticObject===n.semanticObject&&i.action===n.action){l.replaceHash(t)}}return(new jQuery.Deferred).resolve().promise()}},setDirtyFlag:{executeServiceCallFn:function(e){var t=e.oMessageData.body.bIsDirty;if(t!==sap.ushell.Container.getDirtyFlag()){sap.ushell.Container.setDirtyFlag(t)}return(new jQuery.Deferred).resolve().promise()}},getDirtyFlag:{executeServiceCallFn:function(e){return(new jQuery.Deferred).resolve(sap.ushell.Container.getDirtyFlag()).promise()}},themeChange:{executeServiceCallFn:function(e){var t=e.oMessageData.body.currentThemeId;sap.ushell.Container.getUser().setTheme(t);return(new jQuery.Deferred).resolve().promise()}},buttonClick:{executeServiceCallFn:function(e){sap.ushell.renderers.fiori2.Renderer.handleHeaderButtonClick(e.oMessageData.body.buttonId);return(new jQuery.Deferred).resolve().promise()}},uiDensityChange:{executeServiceCallFn:function(e){var t=e.oMessageData.body.isTouch;jQuery("body").toggleClass("sapUiSizeCompact",t==="0").toggleClass("sapUiSizeCozy",t==="1");return(new jQuery.Deferred).resolve().promise()}},handleDirtyStateProvider:{executeServiceCallFn:function(e){return(new jQuery.Deferred).resolve(sap.ushell.Container.handleDirtyStateProvider(e.oMessageData.body.oNavigationContext)).promise()}}}},"sap.ushell.services.MessageBroker":{oServiceCalls:{_execute:{executeServiceCallFn:function(e){return sap.ushell.Container.getServiceAsync("MessageBroker").then(function(t){return t.handleMessage(e.oMessageData.body)})}}}}})};this.handleLinkElementOpen=function(e,t){try{if(t.isDefaultPrevented&&t.isDefaultPrevented()===true){return}var i=t.target;if(i&&i.tagName==="A"&&i.href&&i.href.indexOf("#")>0){if(i.target==="_blank"){var n=H.rebuildNewAppUrl(i.href,e);if(n!==i.href){w.openURL(n);t.preventDefault()}}else if(i.target===undefined||i.target===""){var a=i.href.split("#"),s=document.URL.split("#");if(a[0]===s[0]){var r=a[1]&&a[1].split("&/"),p=s[1]&&s[1].split("&/");if(typeof r[0]==="string"&&typeof p[0]==="string"&&r[0]!==p[0]){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(e){e.toExternal({target:{shellHash:a[1]}})});t.preventDefault()}}}}}catch(e){}};this.rebuildNewAppUrl=function(e,t){var i=e.split("#");if(i[0].length===0||i[0]===document.URL.split("#")[0]){return t+"#"+i[1]}return e};this.getPageConfig=function(e){var t,i={};N=D["sap-spaces"]==="true";t=jQuery("meta[name='sap.ushellConfig.ui5appruntime']")[0];if(t!==undefined){i=JSON.parse(t.content);if(N===true){i.ushell=i.ushell||{};i.ushell.spaces={enabled:true}}}window["sap-ushell-config"]=n({},j(),i);if(e.hasOwnProperty("sap-remote-intent")){var a=window["sap-ushell-config"].bootstrapPlugins;if(a&&a.hasOwnProperty("WAPluginAgent")&&a["WAPluginAgent"].hasOwnProperty("config")){delete a["WAPluginAgent"].config["sap-plugin-agent"]}}};this.setModulePaths=function(){if(window["sap-ushell-config"].modulePaths){var e=Object.keys(window["sap-ushell-config"].modulePaths),t;for(var i in e){t=e[i];(function(e){var t={};t[e.replace(/\./g,"/")]=window["sap-ushell-config"].modulePaths[e];sap.ui.loader.config({paths:t})})(t)}}};this.loadAdditionalLibs=function(){var t=i.get("ui5.libs",window["sap-ushell-config"])||{},n=[];Object.keys(t).forEach(function(i){if(t[i]===true){n.push(e.loadLibrary(i,{async:true}))}});return n};this.adjustIframeURL=function(){};this.initServicesContainer=function(){return new Promise(function(e){sap.ui.require(["sap/ushell/appRuntime/ui5/services/Container"],function(t){t.bootstrap("apprt",{apprt:"sap.ushell.appRuntime.ui5.services.adapters"}).then(function(){sap.ushell.Container.getFLPUrlAsync().then(function(e){jQuery(document).on("click.appruntime",H.handleLinkElementOpen.bind(H,e));jQuery(document).on("keydown.appruntime",function(t){if(t.code==="Enter"){return H.handleLinkElementOpen(e,t)}})});sap.ushell.Container.getServiceAsync("ShellNavigation").then(function(t){_=t;_.init(function(){});y.setShellNavigationService(_);H._enableHistoryEntryReplacedDetection();e()})})})})};this._enableHistoryEntryReplacedDetection=function(){this._fnOriginalSetHash=l.setHash;this._fnOriginalReplaceHash=l.replaceHash;l.setHash=function(){if(l.disableCFLPUpdate===true){return this._fnOriginalSetHash.apply(l,arguments)}if(U.checkDataLossAndContinue()){return this._fnOriginalSetHash.apply(l,arguments)}}.bind(this);l.replaceHash=function(){if(l.disableCFLPUpdate===true){return this._fnOriginalReplaceHash.apply(l,arguments)}if(U.checkDataLossAndContinue()){return this._fnOriginalReplaceHash.apply(l,arguments)}}.bind(this)};this._getURIParams=function(){return D};this.getAppInfo=function(e,t){var i,n,s;if(e){i=window["sap-ushell-config"].ui5appruntime.config.appIndex.data;n=window["sap-ushell-config"].ui5appruntime.config.appIndex.module;s=window["sap-ushell-config"].ui5appruntime.config.appIndex.enableCache}return new Promise(function(r){if(e&&i&&!a(i)){y.init(n,H.createApplication.bind(H),H.renderApplication.bind(H),s,e,i);r({oResolvedHashFragment:i})}else{y.init(n,H.createApplication.bind(H),H.renderApplication.bind(H),s);y.getAppInfo(e,document.URL,t).then(r)}})};this.setHashChangedCallback=function(){if(B===true){return}function e(e,t){if(l.disableCFLPUpdate===true){return}if(e&&typeof e==="string"&&e.length>0){if(t&&typeof t==="string"&&t.length>0){var i=e.split("&/"),n=t.split("&/");if(i[0]!==n[0]){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(t){t.toExternal({target:{shellHash:e}})});return}}f.sendMessageToOuterShell("sap.ushell.appRuntime.hashChange",{newHash:e,direction:o.getInstance().getDirection()})}}l.changed.add(e.bind(this),this);B=true};this.createApplication=function(e,i,n,a,s){var r=P.getHash(window.location.href);return new Promise(function(o){var l="";if(i.hasOwnProperty("sap-history-dir")){l=i["sap-history-dir"];_.hashChanger.fireEvent("hashReplaced",{hash:_.hashChanger.getHash(),direction:l});t.debug("AppRuntime.createApplication :: Informed by the FLP, to change the History direction "+"property in the Iframe to: "+l)}L=new p({id:(U.getIsScube()===true?a:e)+"-content",width:"100%",height:"100%"});L.addStyleClass("sapAppRuntimeBaseStyle");var c="0";if(D.hasOwnProperty("sap-touch")){c=D["sap-touch"];if(c!=="0"&&c!=="1"){c="0"}}jQuery("body").toggleClass("sapUiSizeCompact",c==="0").toggleClass("sapUiSizeCozy",c==="1");if(E===false){var h=new C({scopeObject:L,scopeType:"component"});h.setBackNavigation();new I({scopeObject:L,scopeType:"component"});y.setShellUIService(h);sap.ushell.renderers.fiori2.utils.init();if(u.attachBlockLayerStateChange){u.attachBlockLayerStateChange(function(e){f.sendMessageToOuterShell("sap.ushell.services.ShellUIService.showShellUIBlocker",{bShow:e.getParameters().visible})})}E=true}(U.getIsScube()?Promise.resolve(""):y.getApplicationParameters(i)).then(function(t){n.url+=t;H.setHashChangedCallback();Promise.all([sap.ushell.Container.getServiceAsync("Ui5ComponentLoader"),sap.ushell.Container.getServiceAsync("AppLifeCycle")]).then(function(t){var i=t[0];var p=t[1];if(n.asyncHints&&Array.isArray(n.asyncHints.libs)){n.asyncHints.libs=n.asyncHints.libs.filter(function(e){return e.name!=="sap.ushell"})}var u,l;if(U.getIsScube()===true){u=n;l=s}else{u={ui5ComponentName:e,applicationDependencies:n,url:n.url};l=P.parseShellHash(r)}i.createComponent(u,l,[],b.Application).then(function(e){var t;if(U.getIsScube()===true){try{if(r&&r.indexOf("Shell-startIntent")===0){t=e.componentHandle.getMetadata().getManifestEntry("/sap.app/title");if(typeof t==="string"){f.sendMessageToOuterShell("sap.ushell.services.ShellUIService.setTitle",{sTitle:t})}}}catch(e){}}L.setComponent(e.componentHandle.getInstance());y.setCurrentApp(L,a||"",u.ui5ComponentName);m.setAppShortId(e.componentHandle);p.prepareCurrentAppObject("UI5",e.componentHandle.getInstance(),false,undefined);var i=p.getCurrentApplication();i.getInfo(["appFrameworkVersion","appSupportInfo","appId","appVersion"]).then(function(e){for(var i in e){if(e[i]===undefined||e[i]===""){delete e[i]}}e.appFrameworkId="UI5";e.technicalAppComponentId=u.ui5ComponentName;if(typeof t==="string"){e.appTitle=t}y.setCurrentAppAttributes(e);setTimeout(function(){f.sendMessageToOuterShell("sap.ushell.services.AppLifeCycle.setNewAppInfo",{info:e})},500)});H.considerChangingTheDefaultFullWidthVal(e);H.overrideUrlHelperFuncs();o(e)})})})})};this.considerChangingTheDefaultFullWidthVal=function(e){if(x===true||x==="true"){S.emit("appWidthChange",false);var t=e.componentHandle.getInstance();var i=t.getMetadata();var n;if(i){n=t.getMetadata().getManifestEntry("/sap.ui/fullWidth");if(n===true||n==="true"){S.emit("appWidthChange",true)}else if(n===undefined){n=t.getMetadata().getManifestEntry("/sap.ui5/config/fullWidth");if(n===true||n==="true"){S.emit("appWidthChange",true)}}}}};this.overrideUrlHelperFuncs=function(){if(O===true){return}O=true;if(F){F.triggerEmail=function(e,t,i,n,a){f.sendMessageToOuterShell("sap.ushell.services.ShellUIService.sendEmail",{sTo:e,sSubject:t,sBody:i,sCc:n,sBcc:a,sIFrameURL:document.URL,bSetAppStateToPublic:true})};T=F.redirect;F.redirect=function(e,t){if(e&&t===true&&e.indexOf("#")>=0){sap.ushell.Container.getFLPUrlAsync().then(function(i){var n=H.rebuildNewAppUrl(e,i);T.call(F,n,t)})}else{T.call(F,e,t)}}}};this.loadPlugins=function(){if(k===true){return}k=true;sap.ushell.Container.getServiceAsync("PluginManager").then(function(e){s(e);if(U.getIsScube()===false){W(e)}e.loadPlugins("RendererExtensions")})};function s(e){e.registerPlugins({RTAPluginAgent:{component:"sap.ushell.appRuntime.ui5.plugins.rtaAgent",url:sap.ui.require.toUrl("sap/ushell/appRuntime/ui5/plugins/rtaAgent"),config:{"sap-plugin-agent":true}}})}function W(e){e.registerPlugins({WAPluginAgent:{component:"sap.ushell.appRuntime.ui5.plugins.scriptAgent",url:sap.ui.require.toUrl("sap/ushell/appRuntime/ui5/plugins/scriptAgent"),config:{"sap-plugin-agent":true,scube:false}}})}this.renderApplication=function(e){L.placeAt("content");r.hide();setTimeout(function(){if(e.componentHandle.getInstance().active){e.componentHandle.getInstance().active()}H.loadPlugins()},0)}}function j(){return{services:{CrossApplicationNavigation:{module:"sap.ushell.appRuntime.ui5.services.CrossApplicationNavigation",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},NavTargetResolution:{module:"sap.ushell.appRuntime.ui5.services.NavTargetResolution",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},ShellNavigation:{module:"sap.ushell.appRuntime.ui5.services.ShellNavigation",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},AppConfiguration:{module:"sap.ushell.appRuntime.ui5.services.AppConfiguration"},Bookmark:{module:"sap.ushell.appRuntime.ui5.services.Bookmark",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},LaunchPage:{module:"sap.ushell.appRuntime.ui5.services.LaunchPage",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},UserInfo:{module:"sap.ushell.appRuntime.ui5.services.UserInfo",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},AppState:{module:"sap.ushell.appRuntime.ui5.services.AppState",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},PluginManager:{config:{isBlueBox:true}},Menu:{module:"sap.ushell.appRuntime.ui5.services.Menu",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},CommonDataModel:{module:"sap.ushell.appRuntime.ui5.services.CommonDataModel",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},ReferenceResolver:{module:"sap.ushell.appRuntime.ui5.services.ReferenceResolver"},MessageBroker:{module:"sap.ushell.appRuntime.ui5.services.MessageBroker"},Ui5ComponentLoader:{config:{loadDefaultDependencies:false}}},ushell:{customPreload:{enabled:false}}}}var z=new W;H=z;z.main();return z});function prepareModules(){"use strict";sap.ui.require(["sap/ui/core/BusyIndicator"],function(e){try{if(apprtBIdiv){document.body.classList.remove("apprtBIbg");apprtBIdiv.parentNode.removeChild(apprtBIdiv);apprtBIstyle.parentNode.removeChild(apprtBIstyle)}e.show(0)}catch(t){e.show(0)}});if(document.URL.indexOf("ui5appruntime")>0){sap.ui.define("sap/ushell/URLTemplateProcessor",[],function(){return{}});sap.ui.define("sap/ushell/_ApplicationType/wdaResolution",[],function(){return{}});sap.ui.define("sap/ushell/_ApplicationType/guiResolution",[],function(){return{}});if(document.URL.indexOf("sap-ui-app-id=")>0){sap.ui.define("sap/ushell/ApplicationType",[],function(){return{URL:{type:"URL"},WDA:{type:"WDA"},TR:{type:"TR"},NWBC:{type:"NWBC"},WCF:{type:"WCF"},SAPUI5:{type:"SAPUI5"}}})}sap.ui.define("sap/ushell/components/applicationIntegration/AppLifeCycle",[],function(){return{}});sap.ui.define("sap/ushell/services/_AppState/WindowAdapter",[],function(){return function(){}});sap.ui.define("sap/ushell/services/_AppState/SequentializingAdapter",[],function(){return function(){}});sap.ui.define("sap/ushell/services/_AppState/Sequentializer",[],function(){return function(){}});sap.ui.define("sap/ushell/services/Configuration",[],function(){function e(){this.attachSizeBehaviorUpdate=function(){};this.hasNoAdapter=true}e.hasNoAdapter=true;return e});sap.ui.define("sap/ushell/services/_PluginManager/Extensions",[],function(){return function(){}});sap.ui.define("sap/ushell/services/_MessageBroker/MessageBrokerEngine",[],function(){return function(){}});sap.ui.define("sap/ushell/bootstrap/common/common.load.core-min",[],function(){return{loaded:false,load:function(e){}}})}}
//# sourceMappingURL=AppRuntime.js.map