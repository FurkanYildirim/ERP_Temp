// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["./ContentFinderDialog.controller","../model/formatter","sap/base/Log","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,i,r,s){"use strict";return e.extend("sap.ushell.components.contentFinder.controller.AppSearch",{formatter:t,filters:{search:"searchFilter",select:"selectFilter"},onInit:function(){this._oActiveFilters={};this.oModel=this.getOwnerComponent().getModel();this.oResourceBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();this.getOwnerComponent().getNavContainer().then(function(e){e.attachNavigate(function(){var e=this.oModel.getProperty("/activeNavigationTarget");if(e===this.oModel.getProperty("/navigationTargets/appSearchTiles")||e===this.oModel.getProperty("/navigationTargets/appSearchCards")){this._resetFilters()}}.bind(this))}.bind(this))},onSearch:function(e){var t=e.getParameter("query")||"";this.oModel.setProperty("/appSearch/originalVisualizations/tiles",[]);this.oModel.setProperty("/appSearch/originalVisualizations/cards",[]);this.oModel.setProperty("/appSearch/visualizations/tiles",[]);this.oModel.setProperty("/appSearch/visualizations/cards",[]);this.getOwnerComponent().queryVisualizations(0,t)},onAppSearch:function(e){var t=e.getParameter("newValue");if(t){this._oActiveFilters[this.filters.search]=new r({filters:[new r("appId",s.Contains,t),new r("title",s.Contains,t),new r("subtitle",s.Contains,t),new r("systemInfo",s.Contains,t)],and:false});this._applyFilters()}else{this._resetFilters([this.filters.search])}},onAppBoxSelected:function(){this.oModel.setProperty("/appSearch/selectedAppCount",this.getOwnerComponent().getSelectedAppBoxes(false).length)},onAppBoxSelectedAndClose:function(e){e.getParameter("listItem").setSelected(true);this.getOwnerComponent().addVisualizations();this.getOwnerComponent().getRootControl().byId("contentFinderDialog").close()},onUpdateStarted:function(e){if(e.getParameter("reason")==="Growing"){var t=this.oModel.getProperty("/appSearch/searchTerm");var i=e.getParameter("actual");this.getOwnerComponent().queryVisualizations(i,t)}},onShowSelectedPressed:function(e){if(e.getParameter("pressed")){this.byId("appSearchField").clear();this._oActiveFilters[this.filters.select]=new r("selected",s.EQ,true);this._applyFilters()}else{this._resetFilters([this.filters.search,this.filters.select]);this.byId("appSearchField").clear()}},formatAppBoxAccDescription:function(e,t,i){var r=[];if(e){r.push(e)}if(t){r.push(t)}if(i){r.push(this.oResourceBundle.getText("ContentFinder.AppSearch.Message.AlreadyUsed"))}return r.join(" . ")},_applyFilters:function(){var e=this._getGridList();var t=e.getBinding("items");t.filter(new r({filters:Object.values(this._oActiveFilters),and:true}),"Control");this.oModel.setProperty("/appSearch/filteredAppCount",t.getLength())},_resetFilters:function(e){if(!e){e=Object.keys(this._oActiveFilters)}e.forEach(function(e){if(!Object.values(this.filters).includes(e)){i.error("Invalid filter provided. Skipping.",null,this.getOwnerComponent().logComponent);return}delete this._oActiveFilters[e]}.bind(this));this._applyFilters()},_getGridList:function(){var e=this.oModel.getProperty("/navigationTargets/appSearchTiles");var t=this.oModel.getProperty("/navigationTargets/appSearchCards");var r=this.oModel.getProperty("/activeNavigationTarget");if(r===e){return this.byId("tilesGridList")}else if(r===t){return this.byId("cardsGridList")}i.error("Invalid navigation target provided. Could not determine GridList.",null,this.getOwnerComponent().logComponent);return null}})});
//# sourceMappingURL=AppSearch.controller.js.map