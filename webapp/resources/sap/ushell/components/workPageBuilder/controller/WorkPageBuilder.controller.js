//Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/base/util/deepExtend","sap/f/GridContainerItemLayoutData","sap/m/library","sap/ui/core/Component","sap/ui/core/Core","sap/ui/core/Fragment","sap/ui/core/InvisibleMessage","sap/ui/core/library","sap/ui/core/mvc/Controller","sap/ui/core/theming/Parameters","sap/ui/integration/ActionDefinition","sap/ushell/components/workPageBuilder/controller/WorkPageHost","sap/ui/integration/designtime/editor/CardEditor","sap/ui/integration/widgets/Card","sap/ui/model/json/JSONModel","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/adapters/cdm/v3/_LaunchPage/readUtils","sap/ushell/adapters/cdm/v3/_LaunchPage/readVisualizations","sap/ushell/adapters/cdm/v3/utilsCdm","sap/ushell/resources","sap/ushell/services/_VisualizationInstantiation/VizInstanceCdm","sap/ushell/utils","sap/ushell/components/workPageBuilder/controller/WorkPageBuilder.accessibility"],function(e,t,i,r,n,o,a,s,d,g,l,u,c,h,p,f,v,C,m,P,w,_,D,y,W,S){"use strict";var z=["PR","CO","PG"];var M=6;var E=24;var T=2;var V=4;var b=n.LoadState;var R=g.InvisibleMessageMode;return l.extend("sap.ushell.components.workPageBuilder.controller.WorkPageBuilder",{onInit:function(){this._fnDeleteRowHandler=this.deleteRow.bind(this);this._fnSaveCardConfiguration=this._onSaveCardEditor.bind(this);this.oModel=new v({maxColumns:V,editMode:false,loaded:false,navigationDisabled:false,showFooter:false,data:{WorkPage:null,Visualizations:[],UsedVisualizations:[]}});this.oModel.setSizeLimit(Infinity);this._saveHost();this._oViewSettingsModel=new v({gridContainerGap:{},gridContainerRowSize:{}});this.getView().setModel(this._oViewSettingsModel,"viewSettings");var e=this._setGridContainerSizes.bind(this);C.on("/core/home/sizeBehavior").do(e);m.on("themeChanged").do(e);this._setGridContainerSizes();this.byId("sapCepWorkPage").bindElement({path:"/data/WorkPage"});this.oWorkPageBuilderAccessibility=new S;return this.getOwnerComponent().getVizInstantiationPromise().then(function(e){this._oVizInstantiationService=e;this.getView().setModel(this.oModel)}.bind(this))},onGridContainerBorderReached:function(e){var t=this.byId("sapCepWorkPage");this.oWorkPageBuilderAccessibility._handleBorderReached(e,t)},onAddColumn:function(e){var t=this.getView().getModel();var i=e.getSource();var r=i.getParent();var n=r.indexOfAggregation("columns",i);var o=r.getBindingContext().getPath();var a=o+"/Columns/";var s=i.getBindingContext().getPath()+"/Descriptor/columnWidth";var d=t.getProperty(a);var g=d.length;var l=e.getParameter("left");if(g>=V){return}var u=i.getProperty("columnWidth");var c=Math.floor(u/2)>=M?Math.floor(u/2):M;var h=c%2;t.setProperty(s,c+h);var p=r.indexOfAggregation("columns",i)+(l===true?0:1);var f=this._createEmptyColumn(c-h);var v=[d.slice(0,p),f,d.slice(p)].flat();var C=v.reduce(function(e,t){return e+this._getColumnWidth(t)}.bind(this),0);if(C>E){this._calculateColWidths(v,n,C)}t.setProperty(a,v);this.getOwnerComponent().fireEvent("workPageEdited")},setEditMode:function(e){this.oModel.setProperty("/editMode",!!e)},getEditMode:function(){return this.oModel.getProperty("/editMode")},setShowFooter:function(e){this.oModel.setProperty("/showFooter",!!e)},setPageData:function(e){var i={};var r=t.get("WorkPage.UsedVisualizations.nodes",e);var n=t.get("WorkPage.Contents",e);if(r&&r.length>0){i=r.reduce(function(e,t){e[t.Id]=t;return e},{})}this.oModel.setProperty("/data/UsedVisualizations",i);this.oModel.setProperty("/data/WorkPage",n);this.oModel.setProperty("/loaded",true)},getPageData:function(){var e=this.oModel.getProperty("/data/UsedVisualizations")||{};return{WorkPage:{Contents:this.oModel.getProperty("/data/WorkPage"),UsedVisualizations:{nodes:Object.values(e)}}}},setVisualizationData:function(e){return this.oContentFinderPromise.then(function(t){t.setVisualizationData(e)})},setVisualizationDataPaginated:function(e){return this.oContentFinderPromise.then(function(t){t.setVisualizationDataPaginated(e)})},onGridColumnsChange:function(e){var t=e.getParameter("columns");var i=e.getSource();i.getWidgets().filter(function(e){return e.isA("sap.ui.integration.widgets.Card")}).forEach(function(e){e.setLayoutData(new r({columns:t,minRows:1}))})},onDeleteColumn:function(e){var t=this.getView().getModel();var i=e.getSource();var r=i.getColumnWidth();var n=i.getParent();var o=n.indexOfAggregation("columns",i);var a=n.getBindingContext().getPath();var s=a+"/Columns/";var d=t.getProperty(s);var g=d.filter(function(e,t){return t!==o});var l=r/2;var u=o-1<0?o:o-1;while(l>0){var c=g[u];this._setColumnWidth(c,this._getColumnWidth(c)+T);u=++u>=g.length?0:u++;l--}t.setProperty(s,g);this.getOwnerComponent().fireEvent("workPageEdited")},onAddFirstRow:function(){var e="/data/WorkPage/Rows/";this.getView().getModel().setProperty(e,[this._createEmptyRow()]);this.getOwnerComponent().fireEvent("workPageEdited")},onAddRow:function(e){var t=this.getView().getModel();var i=e.getSource();var r=this.byId("sapCepWorkPage");var n="/data/WorkPage/Rows/";var o=t.getProperty(n);var a=this._createEmptyRow();var s=r.indexOfAggregation("rows",i)+(e.getParameter("bottom")===true?1:0);var d=[o.slice(0,s),a,o.slice(s)].flat();t.setProperty(n,d);this.getOwnerComponent().fireEvent("workPageEdited")},onResize:function(e){var t=e.getParameter("posXDiff");var i=e.getSource();var r=i.getParent();var n=r.getSingleColumnWidth();var o,a,s,d,g,l,u,c;if(n===0){return}o=t/n;if(o>-1&&o<1){return}a=o<0?Math.floor(t/n):Math.ceil(t/n);s=a>=0?"right":"left";d=r.indexOfAggregation("columns",i);g=d-1;l=this._getCurrentColumnWidth(r,g);u=this._getCurrentColumnWidth(r,d);c=this._doColumnResizeStep(r,g,d,l,u,s);if(c){this._updateModelWithColumnWidths(r,g,d,c.newLeftColumnWidth,c.newRightColumnWidth)}},onResizeCompleted:function(){this.getOwnerComponent().fireEvent("workPageEdited")},onDeleteCell:function(e){var t=e.getSource().getParent().getParent();var i=this.getView().getModel();var r=t.getParent();var n=r.indexOfAggregation("cells",t);var o=r.getBindingContext().getPath()+"/Cells";var a=i.getProperty(o);var s=a.filter(function(e,t){return t!==n});i.setProperty(o,s);this.getOwnerComponent().fireEvent("workPageEdited")},_deleteVisualization:function(e){var t=e.getParent().getParent();var i=e.getBindingContext();var r=i.getPath();var n=this.getView().getModel();var o=r.substring(0,r.lastIndexOf("/"));var a=t.indexOfAggregation("widgets",e);var s=n.getProperty(o);var d=s.filter(function(e,t){return t!==a});n.setProperty(o,d);this.getOwnerComponent().fireEvent("workPageEdited")},onEditTitle:function(){this.getOwnerComponent().fireEvent("workPageEdited")},onWidgetAdded:function(){this.getOwnerComponent().fireEvent("workPageEdited")},_getWidgetGroups:function(){var e=this.getView().getModel("i18n").getResourceBundle();var t=[{id:"applicationWidgets",title:e.getText("ContentFinder.Categories.Applications.Title"),widgets:[{id:"widgets-tiles",title:e.getText("ContentFinder.Widgets.Tiles.Title"),description:e.getText("ContentFinder.Widgets.Tiles.Description"),icon:"sap-icon://header",target:"appSearch_tiles"},{id:"widgets-cards",title:e.getText("ContentFinder.Widgets.Cards.Title"),description:e.getText("ContentFinder.Widgets.Cards.Description"),icon:"sap-icon://card",target:"appSearch_cards"}]}];return t},createContentFinderComponent:function(){this.oContentFinderPromise=o.create({name:"sap.ushell.components.contentFinder"});return this.oContentFinderPromise},openWidgetGallery:function(e){var t=e.getSource();if(!this.oContentFinderPromise){this.oContentFinderPromise=this.createContentFinderComponent()}return this.oContentFinderPromise.then(function(e){e.setWidgetGroups(this._getWidgetGroups());e.attachVisualizationsAdded(t,this._onAddVisualization,this);e.attachVisualizationFilterApplied(t,function(e){this.getOwnerComponent().fireEvent("visualizationFilterApplied",e.getParameters())},this);e.show("widgetGallery")}.bind(this))},openTilesAppSearch:function(e){var t=e.getSource().getParent().getParent();if(!this.oContentFinderPromise){this.oContentFinderPromise=this.createContentFinderComponent()}return this.oContentFinderPromise.then(function(e){e.setContextData({restrictedVisualizations:this._getRestrictedVisualizationIds(t)});e.setRestrictedMode(true);e.attachVisualizationsAdded(t,this._onAddVisualization,this);e.attachVisualizationFilterApplied(t,function(e){this.getOwnerComponent().fireEvent("visualizationFilterApplied",e.getParameters())},this);e.show("appSearch_tiles")}.bind(this))},_getRestrictedVisualizationIds:function(e){return e.getWidgets().map(function(e){if(e.isA("sap.ushell.ui.launchpad.VizInstanceCdm")){return e.getProperty("vizRefId")}})},_onAddVisualization:function(e,t){var i=e.getParameter("visualizations");if(i.length>0){i.forEach(function(e){var t="/data/UsedVisualizations/"+e.id;if(!this.oModel.getProperty(t)){this.oModel.setProperty(t,e.vizData)}}.bind(this));var r=this._instantiateWidgetData(i);if(t.isA("sap.ushell.components.workPageBuilder.controls.WorkPageCell")){this._setCellData(t,r)}if(t.isA("sap.ushell.components.workPageBuilder.controls.WorkPageColumn")){this._setColumnData(t,r)}}},_instantiateWidgetData:function(e){var t=[];var i;return e.map(function(e){i=this._generateUniqueId(t);t=t.concat([i]);return{Id:i,DescriptorSchemaVersion:"3.2.0",Descriptor:{},Visualization:{Id:e.vizData.Id,Type:e.type}}}.bind(this))},_setCellData:function(e,t){var i=e.getBindingContext().getPath();var r=Object.assign({},this.oModel.getProperty(i));r.Widgets=r.Widgets.concat(t);this.oModel.setProperty(i,r);this.onWidgetAdded()},_setColumnData:function(e,t){var i=e.getBindingContext().getPath();var r=Object.assign({},this.oModel.getProperty(i));if(!r.Cells){r.Cells=[]}r.Cells=r.Cells.concat([{Id:this._generateUniqueId(),DescriptorSchemaVersion:"3.2.0",Descriptor:{},Widgets:t.concat([])}]);this.oModel.setProperty(i,r);this.onWidgetAdded()},onDeleteRow:function(e){var t=this.getOwnerComponent().getRootControl();var i=e.getSource().getBindingContext();if(!this.oLoadDeleteDialog){this.oLoadDeleteDialog=s.load({id:t.createId("rowDeleteDialog"),name:"sap.ushell.components.workPageBuilder.view.WorkPageRowDeleteDialog",controller:this}).then(function(e){e.setModel(this.getView().getModel("i18n"),"i18n");return e}.bind(this))}return this.oLoadDeleteDialog.then(function(e){e.getBeginButton().detachEvent("press",this._fnDeleteRowHandler);e.getBeginButton().attachEvent("press",{rowContext:i},this._fnDeleteRowHandler);e.open()}.bind(this))},deleteRow:function(e,t){var i=this.getView().getModel();var r=t.rowContext;var n=i.getProperty("/data/WorkPage/Rows");var o=r.getObject();var a=n.filter(function(e){return e.Id!==o.Id});i.setProperty("/data/WorkPage/Rows",a);this.getOwnerComponent().fireEvent("workPageEdited");return this.oLoadDeleteDialog.then(function(e){e.close()})},onRowDeleteCancel:function(){return this.oLoadDeleteDialog.then(function(e){e.close()})},_createErrorTile:function(){return new y({state:b.Failed}).attachPress(this.onVisualizationPress,this).bindEditable("/editMode").setLayoutData(new r({columns:2,rows:2}))},widgetFactory:function(t,i){var r=i.getProperty("Visualization/Id");if(!r){e.error("No vizId found in widget context.");return this._createErrorTile()}var n=this.getView().getModel().getProperty("/data/UsedVisualizations/"+r);if(!n||!n.Type){e.error("No viz or vizType found for vizId "+r);return this._createErrorTile()}var o=i.getProperty("Configurations")||[];var a=n.Configurations||[];var s=this._getMergedAndSortedConfigurations(o,a);var d=i.getPath();switch(n.Type){case"sap.card":return this._createCard(n,s,d);case"sap.ushell.StaticAppLauncher":case"sap.ushell.DynamicAppLauncher":return this._createVizInstance(n);default:e.error("Unknown type for widget "+n.Type);return this._createErrorTile()}},_getMergedAndSortedConfigurations:function(e,t){if(e.length===0&&t.length===0){return[]}var r=z.reduce(function(r,n){var o=e.find(function(e){return e.Level===n});var a=t.find(function(e){return e.Level===n});var s=i({},a,o);if(Object.keys(s).length>0){r[n]=s}return r},{});return this._sortConfigurations(Object.values(r))},_sortConfigurations:function(e){var t=e.sort(function(e,t){return z.indexOf(e.Level)-z.indexOf(t.Level)});return t.map(function(e){return e.Settings})},_createVizInstance:function(i){var n=t.get(["Descriptor","sap.flp","indicatorDataSource"],i);var o=t.get(["Descriptor","sap.flp","target","appId"],i);var a=this.getOwnerComponent().getSiteApplication(o);var s=t.get(["sap.app","dataSources"],a);var d=this.getOwnerComponent().getSiteVizType(i.Type);var g={};g[o]=a;var l={id:i.Id,title:t.get(["Descriptor","sap.app","title"],i),subtitle:t.get(["Descriptor","sap.app","subTitle"],i),info:t.get(["Descriptor","sap.app","info"],i),icon:t.get(["Descriptor","sap.ui","icons","icon"],i),keywords:t.get(["Descriptor","sap.app","tags","keywords"],i)||[],_instantiationData:{platform:"CDM",vizType:d},indicatorDataSource:n,vizType:t.get("Type",i),dataSource:this._getDataSource(s,n),contentProviderId:t.get(["sap.app","contentProviderId"],a),vizConfig:t.get(["Descriptor"],i),supportedDisplayFormats:t.get(["Descriptor","sap.flp","vizOptions","displayFormats","supported"],i),displayFormatHint:t.get(["Descriptor","sap.flp","vizOptions","displayFormats","default"],i),numberUnit:t.get(["Descriptor","sap.flp","numberUnit"],i),vizId:i.Id,preview:false};if(!this.oModel.getProperty("/navigationDisabled")){l.target=P.harmonizeTarget(w.getTarget(l)||{});l.targetURL=_.toHashFromVizData(l,g)}var u=this._oVizInstantiationService.instantiateVisualization(l);if(!u){e.error("No VizInstance was created.");return this._createErrorTile()}return u.setActive(true).attachPress(this.onVisualizationPress,this).bindEditable("/editMode").bindClickable({path:"/navigationDisabled",formatter:function(e){return!e}}).setLayoutData(new r(u.getLayout()))},_getDataSource:function(e,t){if(!t||!e){return}return e[t.dataSource]},onVisualizationPress:function(e){var t=e.getParameter("scope");var i=e.getParameter("action");if(t==="Actions"&&i==="Remove"){this._deleteVisualization(e.getSource())}},_createCard:function(i,n,o){var a={};var s=i.Descriptor&&i.Descriptor["sap.card"];var d=i.DescriptorResources&&(i.DescriptorResources.BaseUrl||i.DescriptorResources.DescriptorPath);var g;if(!s&&!d){e.error("No Descriptor or DescriptorResources for Card");return(new f).setLayoutData(new r({columns:2,rows:2}))}if(s){a.manifest=i.Descriptor;g=t.get(["Descriptor","sap.card","configuration"],i);if(d){a.baseUrl=i.DescriptorResources.BaseUrl+i.DescriptorResources.DescriptorPath}}else if(d){a.manifest=i.DescriptorResources.BaseUrl+i.DescriptorResources.DescriptorPath+"/manifest.json"}if(a.baseUrl&&a.baseUrl.substr(-1)!=="/"){a.baseUrl+="/"}var l=new f(a);if(g){var u=this._createCardConfigurationActionDefinition(l,o,this._openCardConfigurationEditor.bind(this));l.addActionDefinition(u)}return l.setManifestChanges(n).addStyleClass("sapCepWidget").setHost(this.oHost).setLayoutData(new r({columns:16,minRows:1}))},_createCardConfigurationActionDefinition:function(e,t,i){var r=this.getView().getModel("i18n").getResourceBundle().getText("WorkPage.Card.ActionDefinition.Configure");var n=new c({type:"Custom",visible:"{/editMode}",buttonType:"Transparent",icon:"sap-icon://wrench",text:r});n.setModel(this.oModel);n.attachPress({card:e,widgetContextPath:t},i);return n},_openCardConfigurationEditor:function(e,t){if(!this.oCardEditorDialogPromise){this.oCardEditorDialogPromise=this._createCardEditorDialog(t.card)}var i=this._createCardEditor(t.card);return this.oCardEditorDialogPromise.then(function(e){this.oCardEditorDialog=e;this.oCardEditorDialog.removeAllContent();this.oCardEditorDialog.getBeginButton().detachPress(this._fnSaveCardConfiguration).attachPress(t.widgetContextPath,this._fnSaveCardConfiguration);this._setCardDialogTitle(this.oCardEditorDialog,t.card);this.oCardEditorDialog.addContent(i);this.oCardEditorDialog.open()}.bind(this))},_setCardDialogTitle:function(e,t){var i=this.getView().getModel("i18n").getResourceBundle();var r=this._getCardTitle(t)?i.getText("WorkPage.CardEditor.Title",[this._getCardTitle(t)]):i.getText("WorkPage.CardEditor.Title.NoCardTitle");e.setTitle(r)},_createCardEditor:function(e){return new p({previewPosition:"right",card:e,mode:"content"})},_createCardEditorDialog:function(e){var t=this.getView().getModel("i18n").getResourceBundle();var i=t.getText("WorkPage.CardEditor.Save");var r=t.getText("WorkPage.CardEditor.Cancel");return new Promise(function(e,t){sap.ui.require(["sap/m/Dialog","sap/m/Button","sap/m/ButtonType"],function(t,n,o){var a=new t({contentWidth:"40rem",beginButton:new n({text:i,type:o.Emphasized}),endButton:new n({text:r,press:function(){a.close()}})});e(a)},t)})},_getCardTitle:function(e){if(e.getCardHeader()&&e.getCardHeader().getTitle()){return e.getCardHeader().getTitle()}},_onSaveCardEditor:function(e,t){var r=e.getSource().getParent();var n=r.getContent()[0];var o=n.getCard();var a=t+"/Configurations";var s=n.getCurrentSettings();var d=this.oModel.getProperty(a)||[];var g=d.find(function(e){return e.Level==="PG"});if(!g){g={};g.Id=this._generateUniqueId();g.Level="PG";g.Settings=s;g.SettingsSchemaVersion="3.2";d.push(g)}else{d=d.map(function(e){if(e.Level==="PG"){e.Settings=i({},e.Settings,s)}return e})}this.oModel.setProperty(a,d);o.setManifestChanges([s]);this.getOwnerComponent().fireEvent("workPageEdited");r.close()},executeNavigation:function(e){var t=e.getParameter("parameters");if(e.getParameter("type")!=="Navigation"||this.oModel.getProperty("/navigationDisabled")||t&&t.hasOwnProperty("url")){return Promise.resolve()}e.preventDefault(true);return this.getOwnerComponent().getUshellContainer().getServiceAsync("CrossApplicationNavigation").then(function(e){return e.toExternal({target:{semanticObject:t.ibnTarget.semanticObject,action:t.ibnTarget.action},params:t.ibnParams})})},saveEditChanges:function(){this.getOwnerComponent().fireEvent("closeEditMode",{saveChanges:true})},cancelEditChanges:function(){this.getOwnerComponent().fireEvent("closeEditMode",{saveChanges:false})},onCellDrop:function(e){var t=e.getParameter("draggedControl");var i=t.getParent().getParent();var r=e.getParameter("droppedControl");var n=i.indexOfAggregation("widgets",t);var o=r.getBindingContext().getProperty("Widgets").length;this._moveVisualization(i,r,n,o)},onCellDragEnter:function(e){var t=e.getParameter("target");if(!this.tileMode(t.getBindingContext().getProperty("Widgets"))){e.preventDefault()}},onGridDrop:function(e){var t=e.getSource();var i=e.getParameter("draggedControl");var r=e.getParameter("droppedControl");var n=e.getParameter("dropPosition");var o=i.getParent().getParent();var a=o.indexOfAggregation("widgets",i);var s=t.indexOfAggregation("widgets",r);var d=t.getId()===o.getId();if(n==="After"){s++}if(d){if(a<s){s--}if(a===s){return}}this._moveVisualization(o,t,a,s)},_moveVisualization:function(e,t,i,r){var n=this.getView().getModel();var o=e.getBindingContext().getPath()+"/Widgets";var a=t.getBindingContext().getPath()+"/Widgets";var s=o===a;var g=n.getProperty(o);var l=n.getProperty(a);var u=g[i];var c=g.filter(function(e,t){return t!==i});if(s){l=c}var h=[l.slice(0,r),u,l.slice(r)].flat();n.setProperty(o,c);n.setProperty(a,h);d.getInstance().announce(this.getView().getModel("i18n").getResourceBundle().getText("WorkPage.Message.WidgetMoved"),R.Assertive);this.getOwnerComponent().fireEvent("workPageEdited")},tileMode:function(e){var i=this.getView().getModel();var r;return!!e&&!e.some(function(e){r=i.getProperty("/data/UsedVisualizations/"+t.get("Visualization.Id",e));return t.get("Type",r)==="sap.card"})},showAppSearchButton:function(e,t){return this.tileMode(e)&&t},_updateModelWithColumnWidths:function(e,t,i,r,n){var o=this.getView().getModel();var a=e.getBindingContext();var s=a.getPath();var d=s+"/Columns/"+t+"/Descriptor/columnWidth";var g=s+"/Columns/"+i+"/Descriptor/columnWidth";o.setProperty(d,r);o.setProperty(g,n)},_updateColumnWidthClass:function(e,t,i){e.$().find(".sapCepWorkPageColumn").eq(t).removeClass(function(e,t){return(t.match(/sapCepColumnWidth.*/g)||[]).join(" ")}).addClass("sapCepColumnWidth"+i)},_doColumnResizeStep:function(t,i,r,n,o,s){var d=a.getConfiguration().getRTL();var g;if(!d){g=s==="right"?T:-T}else{g=s==="right"?-T:T}var l=n+g;var u=o-g;if(l<M||u<M){e.debug("new column value too small",l,u);return null}this._updateColumnWidthClass(t,i,l);this._updateColumnWidthClass(t,r,u);return{newLeftColumnWidth:l,newRightColumnWidth:u}},_getCurrentColumnWidth:function(e,t){var i=e.getBindingContext().getPath();var r=i+"/Columns/"+t+"/Descriptor/columnWidth";return this.getView().getModel().getProperty(r)},_getColumnWidth:function(e){return t.get("Descriptor.columnWidth",e)||E},_setColumnWidth:function(e,i){t.set("Descriptor.columnWidth",i,e)},_calculateColWidths:function(e,t,i){var r=e[t];if(this._getColumnWidth(r)-T>=M){this._setColumnWidth(r,this._getColumnWidth(r)-T);i=i-T}if(i>E){var n=t-1>=0?t-1:e.length-1;this._calculateColWidths(e,n,i)}return e},_createEmptyColumn:function(e){return{Id:this._generateUniqueId(),DescriptorSchemaVersion:"3.2.0",Descriptor:{columnWidth:e},Configurations:[],Cells:[]}},_createEmptyRow:function(){return{Id:this._generateUniqueId(),DescriptorSchemaVersion:"3.2.0",Descriptor:{title:"",description:"this is not yet rendered",fillRowHeight:false,fullWidth:false},Columns:[this._createEmptyColumn(E)]}},_saveHost:function(){this.oHost=a.byId("sap.shell.host.environment");if(!this.oHost){this.oHost=new h("sap.shell.host.environment",{action:this.executeNavigation.bind(this)});this.oHost.setModel(this.getView().getModel("i18n"),"i18n")}},getNavigationDisabled:function(){return this.oModel.getProperty("/navigationDisabled")},setNavigationDisabled:function(e){this.oModel.setProperty("/navigationDisabled",e)},_setGridContainerSizes:function(){var e=C.last("/core/home/sizeBehavior");var t=this.getView().getModel("viewSettings");var i=e==="Small"?"_sap_ushell_Tile_SpacingXS":"_sap_ushell_Tile_Spacing";var r=e==="Small"?"_sap_ushell_Tile_SpacingXS":"_sap_ushell_Tile_SpacingS";t.setProperty("/gridContainerGap/gridContainerGap",this._getNumericThemeParam(i));t.setProperty("/gridContainerGap/gridContainerGapXS",this._getNumericThemeParam("_sap_ushell_Tile_SpacingXS"));t.setProperty("/gridContainerGap/gridContainerGapS",this._getNumericThemeParam(r));t.setProperty("/gridContainerGap/gridContainerGapM",this._getNumericThemeParam(i));t.setProperty("/gridContainerGap/gridContainerGapL",this._getNumericThemeParam(i));t.setProperty("/gridContainerGap/gridContainerGapXL",this._getNumericThemeParam(i));var n=e==="Small"?"_sap_ushell_Tile_WidthXS":"_sap_ushell_Tile_Width";var o=e==="Small"?"_sap_ushell_Tile_WidthXS":"_sap_ushell_Tile_WidthS";t.setProperty("/gridContainerRowSize/gridContainerRowSize",this._getNumericThemeParam(n));t.setProperty("/gridContainerRowSize/gridContainerRowSizeXS",this._getNumericThemeParam("_sap_ushell_Tile_WidthXS"));t.setProperty("/gridContainerRowSize/gridContainerRowSizeS",this._getNumericThemeParam(o));t.setProperty("/gridContainerRowSize/gridContainerRowSizeM",this._getNumericThemeParam(n));t.setProperty("/gridContainerRowSize/gridContainerRowSizeL",this._getNumericThemeParam(n));t.setProperty("/gridContainerRowSize/gridContainerRowSizeXL",this._getNumericThemeParam(n))},_getNumericThemeParam:function(e){var t=u.get(e);if(t&&t.indexOf(".")===0){t="0"+t}return t},_generateUniqueId:function(e){var t=(e||[]).concat([]);var i=this.oModel.getProperty("/data/WorkPage");t.push(i.Id);(i.Rows||[]).forEach(function(e){t.push(e.Id);(e.Columns||[]).forEach(function(e){t.push(e.Id);(e.Cells||[]).forEach(function(e){t.push(e.Id);(e.Widgets||[]).forEach(function(e){t.push(e.Id)})})})});return W.generateUniqueId(t)}})});
//# sourceMappingURL=WorkPageBuilder.controller.js.map