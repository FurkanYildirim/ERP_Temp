// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/Fragment","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","sap/ushell/utils/WindowUtils"],function(e,t,n,i,a,r){"use strict";return e.extend("sap.ushell.components.shell.NavigationBarMenu.controller.NavigationBarMenu",{onInit:function(){this.oResourceBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();this.pMenuServicePromise=sap.ushell.Container.getServiceAsync("Menu")},_onPinnedSpacesUpdateFinished:function(e){this.byId("PinnedSpacesTreeTitle").setText(this.oResourceBundle.getText("NavigationBarMenu.PinnedSpaces.Title",[e.getParameter("total")||0]))},openNavigationBarMenuPopover:function(e){var n=e.getSource();if(!this._pPopoverPromise){this._pPopoverPromise=t.load({type:"XML",id:this.getView().getId(),controller:this,name:"sap.ushell.components.shell.NavigationBarMenu.view.NavigationBarMenuPopover"}).then(function(e){this.oModel=this.getOwnerComponent().oPropagatedProperties.oModels.menu;e.setModel(this.oModel,"spaces");this.getView().addDependent(e);return e}.bind(this))}this._pPopoverPromise.then(function(e){this._bindPinnedSpaces();e.openBy(n)}.bind(this))},closeNavigationBarMenuPopover:function(){this._pPopoverPromise.then(function(e){e.close()})},handlePinButtonPress:function(e){var t=e.getSource().getBindingContext("spaces").getPath();var n=this.oModel.getProperty(t+"/pinned");if(!n){this._pinSpace(t)}else{this._unpinSpace(t,true)}},unpinAllSpaces:function(){var e=this.byId("PinnedSpaces");var t=e.getItems();e.unbindItems();t.forEach(function(e){this._unpinSpace(e.getBindingContextPath("spaces"),false)}.bind(this));this._savePinnedSpaces();this._bindPinnedSpaces()},rearrangePinnedSpaces:function(e){var t=e.getParameter("draggedControl").getBindingContext("spaces");var n=this.oModel.getProperty(t.getPath()).pinnedSortOrder;var i=e.getParameter("droppedControl").getBindingContext("spaces");var a=this.oModel.getProperty(i.getPath()).pinnedSortOrder;var r=e.getParameter("dropPosition");var o=a+(r==="After"?1:0);this.pMenuServicePromise.then(function(e){e.moveMenuEntry(n,o);this._savePinnedSpaces()}.bind(this))},_bindPinnedSpaces:function(){var e=this.byId("PinnedSpaces");t.load({type:"XML",async:true,controller:this,name:"sap.ushell.components.shell.NavigationBarMenu.view.CustomTreeItem"}).then(function(t){e.bindItems({path:"spaces>/",filters:[new n({path:"pinned",operator:i.EQ,value1:true}),new n({path:"type",operator:i.NE,value1:"separator"}),new n({path:"isHomeEntry",operator:i.EQ,value1:false})],sorter:[new a({path:"pinnedSortOrder",descending:false})],parameters:{arrayNames:["menuEntries"]},template:t,templateShareable:false})})},allSpacesFactory:function(e,t){var n=t.getModel().getProperty(t.sPath);var i=this.byId("AllSpaces").getDependents()[0].clone(e);var a=t.getModel().getProperty(t.sPath).menuEntries||[];i.setType("Active");i.attachPress(this.onMenuItemSelection,this);if(a.length<1){i.addStyleClass("sapMTreeItemBaseLeaf")}if(n.type==="separator"||n.isHomeEntry){i.setVisible(false)}return i},_unpinSpace:function(e,t){var n=this.byId("NavigationBarMenuPopover");n.focus();this.oModel.setProperty(e+"/pinned",false);this.oModel.setProperty(e+"/pinnedSortOrder","-1");if(t){this._savePinnedSpaces()}},_pinSpace:function(e){var t=this.byId("PinnedSpaces").getItems().length;var n=2;if(t>0){var i=this.byId("PinnedSpaces").getItems()[t-1];var a=i.getBindingContextPath("spaces");n=this.oModel.getProperty(a+"/pinnedSortOrder")+1}this.oModel.setProperty(e+"/pinnedSortOrder",n);this.oModel.setProperty(e+"/pinned",true);this._savePinnedSpaces()},_performCrossApplicationNavigation:function(e){return sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(t){var n={};e.parameters.forEach(function(e){if(e.name&&e.value){n[e.name]=[e.value]}});return t.toExternal({target:{semanticObject:e.semanticObject,action:e.action},params:n})})},_openURL:function(e){r.openURL(e.url,"_blank")},onMenuItemSelection:function(e){var t=e.getSource().getParent();var n=e.getSource();var i=n.getBindingContextPath("spaces");var a=this.oModel.getProperty(i);var r=e.getParameter("id").includes("AllSpaces");if(!r){return}if(!n.isLeaf()){if(n.getExpanded()){t.collapse(t.indexOfItem(n))}else{t.expand(t.indexOfItem(n))}}else{if(a.type==="IBN"){this._performCrossApplicationNavigation(a.target).then(this.closeNavigationBarMenuPopover.bind(this))}if(a.type==="URL"){this._openURL(a.target);this.closeNavigationBarMenuPopover()}return}this._savePinnedSpaces()},_savePinnedSpaces:function(){this.pMenuServicePromise.then(function(e){this.oModel.refresh(true);return e.savePersonalization()}.bind(this))}})});
//# sourceMappingURL=NavigationBarMenu.controller.js.map