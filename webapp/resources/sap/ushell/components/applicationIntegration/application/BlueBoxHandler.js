// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/components/applicationIntegration/application/BlueBoxesCache","sap/ushell/components/applicationIntegration/application/Application","sap/ushell/components/container/ApplicationContainer","sap/ui/thirdparty/jquery","sap/base/util/deepExtend","sap/ui/core/Core","sap/ui/thirdparty/hasher"],function(e,t,i,jQuery,s,a,p){"use strict";function n(){var n=this,r,u={isStateful:{handler:function(e,t){if(e&&(e.enabled===true||e===true)){return true}return false}},isGUI:{handler:function(e,t){if(e&&e.protocol==="GUI"){return true}return false}},isGUIStateful:{handler:function(e,t){return n.isCapUT(t,"isGUI")&&n.isCapUT(t,"isStateful")}},isFLP:{handler:function(e,t){return!n.isCapUT(t,"isGUI")&&n.isCapUT(t,"isStateful")}}},l={},o={},f={setup:function(e,t){},create:function(e,s,n,r,u){var o=new jQuery.Deferred,f,c;function h(){if(f){f["sap-flp-url"]=sap.ushell.Container.getFLPUrl(true);f["system-alias"]=e.getSystemAlias();c["sap-flp-params"]=f}a.getEventBus().publish("launchpad","appOpening",r);t.postMessageToIframeApp(e,"sap.ushell.services.appLifeCycle","create",c,true).then(function(t){l[e].currentAppTarget=r;sap.ushell.Container.getServiceAsync("AppLifeCycle").then(function(i){if(u===true){i.prepareCurrentAppObject("URL",undefined,false,e)}a.getEventBus().publish("sap.ushell","appOpened",r);o.resolve(t&&t.body&&t.body.result)})})}s=i.prototype._checkNwbcUrlAdjustment(e,r.applicationType,s);c={sCacheId:n,sUrl:s,sHash:p.getHash()};if(s.indexOf("sap-iframe-hint=GUI")>0||s.indexOf("sap-iframe-hint=WDA")>0||s.indexOf("sap-iframe-hint=WCF")>0){var d=[];var C=i.prototype._getParamKeys(s,d);if(C.length>0){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(e){e.getAppStateData(C).then(function(e){f={};d.forEach(function(t,i){if(e[i][0]){f[t]=e[i][0]}});h()},function(){h()})})}else{f={};h()}}else{h()}return o.promise()},destroy:function(e,i){var s;sap.ushell.Container.setAsyncDirtyStateProvider(undefined);s=t.postMessageToIframeApp(e,"sap.ushell.services.appLifeCycle","destroy",{sCacheId:i},true);s.then(function(){a.getEventBus().publish("sap.ushell","appClosed",l[e].currentAppTarget);l[e].currentAppTarget=undefined});return s},store:function(e,i){var s;sap.ushell.Container.setAsyncDirtyStateProvider(undefined);s=t.postMessageToIframeApp(e,"sap.ushell.services.appLifeCycle","store",{sCacheId:i},true);s.then(function(){a.getEventBus().publish("sap.ushell","appClosed",l[e].currentAppTarget);l[e].currentAppTarget=undefined});return s},restore:function(e,i,s,n){return new Promise(function(r){a.getEventBus().publish("launchpad","appOpening",s);t.postMessageToIframeApp(e,"sap.ushell.services.appLifeCycle","restore",{sCacheId:i,sUrl:s.url,sHash:p.getHash()},true).then(function(){l[e].currentAppTarget=s;sap.ushell.Container.getServiceAsync("AppLifeCycle").then(function(t){if(n===true){t.prepareCurrentAppObject("URL",undefined,false,e)}a.getEventBus().publish("sap.ushell","appOpened",s);r()})})})}},c=[{service:"sap.ushell.services.appLifeCycle",action:"create"},{service:"sap.ushell.services.appLifeCycle",action:"destroy"}];this.init=function(i,a,p){e.init();t.init(this);r=p;if(a){s(o,a.supportedTypes)}};this.isStatefulContainerSupported=function(e){var t=this.isCapabilitySupported(e,"sap.ushell.services.appLifeCycle","create")&&this.isCapabilitySupported(e,"sap.ushell.services.appLifeCycle","destroy");return t};this.isKeepAliveSupported=function(e){var t=this.isCapabilitySupported(e,"sap.ushell.services.appLifeCycle","store")&&this.isCapabilitySupported(e,"sap.ushell.services.appLifeCycle","restore");return t};this.isIframeIsValidSupported=function(e){return this.isCapabilitySupported(e,"sap.ushell.appRuntime","iframeIsValid")};this.isIframeBusySupported=function(e){return this.isCapabilitySupported(e,"sap.ushell.appRuntime","iframeIsBusy")};this.mapCapabilities=function(e,t){this.setCapabilities(e,t)};this.getCapabilities=function(e){return l[e].oCapMap};this.isCapabilitySupported=function(e,t,i){if(l[e]&&l[e].oCapMap&&l[e].oCapMap[t]){return!!l[e].oCapMap[t][i]}return false};this.setCapabilities=function(e,t){var i;if(!l[e]){this.initBlueBoxBD(e)}if(!l[e].oCapMap){l[e].oCapMap={}}i=l[e].oCapMap;Object.keys(t).forEach(function(e){var s=t[e],a;if(!i[s.service]){i[s.service]={}}a=i[s.service];a[s.action]=true});if(!e.getIsStateful()&&this.isStatefulContainerSupported(e)){e.setIsStateful(true)}};this.removeCapabilities=function(e){if(l[e]){l[e].oCapMap={};e.setIsStateful(false)}};this.hasIFrame=function(e){if(e&&e._getIFrame){return true}return false};this.initBlueBoxBD=function(e){l[e]={BlueBox:e}};this.setAppCapabilities=function(e,t){if(!l[e]){this.initBlueBoxBD(e)}l[e].currentAppTarget=t;l[e].appCapabilities=t.appCapabilities;if(t.appCapabilities&&t.appCapabilities.statefulContainer===true){this.setCapabilities(e,c)}};this.forEach=function(e){var t;for(t in l){if(l.hasOwnProperty(t)){e(l[t].BlueBox)}}};this.isCapByTarget=function(e,t){if(e.appCapabilities===undefined){return false}if(u[t]&&e&&e.appCapabilities){return u[t].handler(e.appCapabilities)}return e.appCapabilities[t]||false};this.isCapUT=function(e,t){var i=l[e];if(i===undefined||i.appCapabilities===undefined){return false}if(u[t]&&i){return u[t].handler(i.appCapabilities,e)}return i.appCapabilities[t]||false};this.setStorageKey=function(e,t){if(!l[e]){this.initBlueBoxBD(e)}l[e].sStorageKey=t};this.getStorageKey=function(e){if(!l[e]){return undefined}return l[e].sStorageKey};this.getHandler=function(){return f};this._getBlueBoxCacheKey=function(t){return e.getBlueBoxCacheKeyValues(t).sKey};this.deleteStateFul=function(e){return this.delete(e)};this.getStateFul=function(t){return e.get(t)};this.destroyApp=function(e){r.postMessageToIframeApp("sap.ushell.services.appLifeCycle","destroy",{appId:e})};this.openApp=function(e){r.postMessageToIframeApp("sap.ushell.services.appLifeCycle","create",{appId:e,sHash:p.getHash()})};this.storeApp=function(e){r.postMessageToIframeApp("sap.ushell.services.appLifeCycle","store",{appId:e,sHash:p.getHash()})};this.restoreApp=function(e){r.postMessageToIframeApp("sap.ushell.services.appLifeCycle","restore",{appId:e,sHash:p.getHash()})};this.delete=function(t){e.remove(t)};this.get=function(t){return e.get(t)};this.getById=function(t){return e.getById(t)};this.set=function(t,i){e.add(t,i)}}return new n},true);
//# sourceMappingURL=BlueBoxHandler.js.map