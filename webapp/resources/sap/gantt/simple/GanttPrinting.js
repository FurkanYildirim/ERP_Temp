/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/gantt/library","sap/ui/thirdparty/jquery","sap/ui/core/Element","sap/ui/core/Core","sap/ui/core/format/NumberFormat","sap/m/Label","sap/m/Text","sap/m/Title","sap/m/Dialog","sap/m/ProgressIndicator","sap/m/Button","sap/m/Input","sap/m/FlexBox","sap/m/library","sap/m/FlexItemData","sap/m/ScrollContainer","sap/m/ComboBox","sap/m/RadioButton","sap/m/RadioButtonGroup","sap/m/CheckBox","sap/m/Slider","sap/m/ResponsiveScale","sap/m/StepInput","sap/m/DatePicker","sap/m/BusyDialog","sap/m/MessageStrip","sap/m/Switch","sap/m/Panel","sap/m/TextArea","sap/gantt/misc/Format","sap/gantt/simple/GanttChartContainer","sap/gantt/config/TimeHorizon","sap/gantt/axistime/FullScreenStrategy","sap/ui/core/Item","sap/ui/core/HTML","sap/ui/layout/VerticalLayout","sap/ui/layout/HorizontalLayout","sap/ui/layout/GridData","sap/ui/layout/form/SimpleForm","sap/ui/model/json/JSONModel","sap/ui/core/theming/Parameters","sap/ui/core/ResizeHandler","sap/gantt/thirdparty/jspdf","sap/gantt/thirdparty/html2canvas","sap/gantt/thirdparty/svg2pdf","./RenderUtils","sap/m/PDFViewer","sap/ui/Device","sap/gantt/simple/GanttRowSettings","sap/gantt/simple/AggregationUtils","../simple/GanttUtils"],function(t,e,i,a,n,o,r,s,h,l,g,p,d,_,u,c,f,C,P,m,v,y,T,b,x,w,G,S,M,R,D,N,E,B,I,A,H,O,F,L,k,V,W,z,U,j,K,X,J,$,q){"use strict";var Q=_.FlexDirection,Y=t.simple.GanttChartWithTableDisplayType;z=window.html2canvas;W=window.jsPDF;U=window.svg2pdf;var Z=i.extend("sap.gantt.simple.GanttPrinting",{metadata:{library:"sap.gantt",associations:{ganttChart:{type:"sap.gantt.simple.GanttChartWithTable",multiple:false}}}});Z._oPaperSizes={A5:{width:rt(148),height:rt(210)},A4:{width:rt(210),height:rt(297)},A3:{width:rt(297),height:rt(420)},A2:{width:rt(420),height:rt(594)},A1:{width:rt(594),height:rt(841)},A0:{width:rt(841),height:rt(1189)},Letter:{width:ht(8.5),height:ht(11)},Legal:{width:ht(8.5),height:ht(14)},Tabloid:{width:ht(11),height:ht(17)},Custom:{width:undefined,height:undefined}};var tt="9px Arial, Helvetica, sans-serif";var et="12px Arial, Helvetica, sans-serif";var it="16384";var at=190;var nt=1.85;var ot=.57;Z.prototype.init=function(){this._oRb=a.getLibraryResourceBundle("sap.gantt");var t={multiplePage:true,qualityWarning:false,showOrientationMessage:false,orientationMessage:this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_LANDSCAPE"),portrait:true,paperSize:"A4",paperWidth:Z._oPaperSizes.A4.width,paperHeight:Z._oPaperSizes.A4.height,unit:"mm",repeatSelectionPanel:false,scale:100,duration:"all",startDate:new Date,endDate:new Date,showPageNumber:false,showHeaderText:false,headerText:"",showFooterText:false,footerText:"",exportAll:true,exportRange:"",exportAsJPEG:true,compressionQuality:75,previewPageNumber:1,lastPageNumber:undefined,marginType:"default",marginLocked:false,marginTop:rt(5),marginRight:rt(5),marginBottom:rt(5),marginLeft:rt(5),cropMarks:false,cropMarksWeight:.25,cropMarksOffset:rt(3)};this._oModel=new L(t);this._oGanttCanvas=undefined;this._iHeaderAndFooterHeight=rt(8);this._ganttChartContainer=new D;this.sFont=null;this._oPdfPreview=null};Z.prototype.export=function(){this._savePdf()};Z.prototype.exportSinglePage=function(){var t=new Date;this.oSinglePagePdf.save("GanttChartExport-"+t.toISOString()+".pdf")};Z.prototype.renderGanttClone=function(t){if(a.getConfiguration().getRTL()&&!t){return Promise.resolve()}return new Promise(function(t){this._ganttChartClone.getTable().attachEventOnce("_rowsUpdated",t,this);this._ganttChartClone.invalidate()}.bind(this))};Z.prototype.mergeCanvases=function(t){var e=document.createElement("canvas"),i=e.getContext("2d"),a=t[0].width,n=[],o=t.reduce(function(t,e,i,a){n.push({cnv:e,y:t});t+=a[i].height;return t},0);e.width=a;e.height=o;n.forEach(function(t){i.beginPath();i.drawImage(t.cnv,0,t.y,a,t.cnv.height)});if(e.width>it||e.height>it){this._oClonedGanttDiv.style.height=e.height+"px";this._oClonedGanttDiv.style.width=e.width+"px";return undefined}return e};Z.prototype.generateCanvasAsync=function(t){var e=0;var i=this._getOriginalGanttChart().getTable()._getTotalRowCount()/this.iThreshold;this.bLast=i>1?false:true;var n=this;var o=[];var r=0;var s=25/Math.ceil(i);function h(){if(n._bMultipleBatches){r+=s;n._oProgressIndicator.setPercentValue(r)}}function l(t){if(n._bCancel){return Promise.reject()}n._oClonedGanttDiv.style.height=it+"px";var o=t*n.iThreshold;var r=n._getOriginalGanttChart().getTable()._getTotalRowCount();n.iThreshold=Math.min(n.iThreshold,r-o);n.bLast=e+1>=i?true:false;n._ganttChartClone.getTable().setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);n._ganttChartClone.getTable().setVisibleRowCount(n.iThreshold);n.bFirst=t===0?true:false;n._ganttChartClone.getTable().setFirstVisibleRow(o);if(a.getConfiguration().getRTL()){n._ganttChartClone._bRenderGanttClone=true}return n._ganttChartClone.getInnerGantt().resolveWhenReady(n._originalHasRenderedShapes)}function g(t){h();return l(t).then(function(){h();n._bExpandCollapse=true;return n._expandAndCollapse()}).then(function(){n._ganttChartClone._bExpandRows=true;h();return n._expandRowSettings()}).then(function(){n._ganttChartClone._bExpandRows=false;n._setCloneDivHeight();document.getElementById(n._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=n._iContentHeight;document.getElementById(n._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=n._iContentHeight;if(!n.bLast){h()}return n._createGanttCanvas()}).then(function(t){return o.push(t)}).then(function(){if(t===0){n._ganttChartClone.setShowGanttHeader(false)}e=e+1;if(e<i){g(e)}else if(!n._bCancel){n._oGanttCanvas=n.mergeCanvases(o);n._updateDialogPreview();n._oDialog.getContent()[0].setBusy(false);n._oFlexBoxPreview.setBusy(false);n._oButtonExport.setEnabled(true);if(n._bMultipleBatches){n._oProgressIndicator.setPercentValue(100);setTimeout(function(){n._closeProgressIndicator(true)},500)}}else{return Promise.reject()}}).catch(function(){})}return g(t)};Z.prototype.generatePdfAsync=function(t){var e=0;var i=this._getOriginalGanttChart().getTable()._getTotalRowCount()/this.iThreshold;this.bLast=i>1?false:true;var n=this;var o=0;var r=25/Math.ceil(i);function s(){if(n._bMultipleBatches){o+=r;n._oProgressIndicator.setPercentValue(o)}}function h(t){if(n._bCancel){return Promise.reject()}n._oClonedGanttDiv.style.height=it+"px";var o=t*n.iThreshold;var r=n._getOriginalGanttChart().getTable()._getTotalRowCount();n.iThreshold=Math.min(n.iThreshold,r-o);n.bLast=e+1>=i?true:false;n._ganttChartClone.getTable().setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);n._ganttChartClone.getTable().setVisibleRowCount(n.iThreshold);n.bFirst=t===0?true:false;n._ganttChartClone.getTable().setFirstVisibleRow(o);if(a.getConfiguration().getRTL()){n._ganttChartClone._bRenderGanttClone=true}return n._ganttChartClone.getInnerGantt().resolveWhenReady(n._originalHasRenderedShapes)}function l(t){s();return h(t).then(function(){s();n._bExpandCollapse=true;return n._expandAndCollapse()}).then(function(){n._ganttChartClone._bExpandRows=true;s();return n._expandRowSettings()}).then(function(){n._ganttChartClone._bExpandRows=false;n._setCloneDivHeight();document.getElementById(n._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=n._iContentHeight;document.getElementById(n._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=n._iContentHeight;if(!n.bLast){s()}return n._createBatchList()}).then(function(t){return n._oDomToPrint.push(t)}).then(function(){if(t===0){n._ganttChartClone.setShowGanttHeader(false)}e=e+1;if(e<i){l(e)}else if(!n._bCancel){if(n._bMultipleBatches){n._oProgressIndicator.setPercentValue(100);setTimeout(function(){n._closeProgressIndicator(true)},500)}return n._generateSvgToPdf()}else{return Promise.reject()}}).catch(function(){})}return l(t)};Z.prototype.open=function(t){if(!this.getGanttChart()||!this._getOriginalGanttChart().isA("sap.gantt.simple.GanttChartWithTable")){throw new Error("Association 'ganttChart' of type 'sap.gantt.simple.GanttChartWithTable' is not set")}var e=this;if(t){t(this._ganttChartClone.getTable())}this._createAndOpenDialog();this._oDialog.getContent()[0].setBusy(true);this._oButtonExport.setEnabled(false);if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.setShowGanttHeader(true);return this._drawClonedGantt(false).then(function(){if(e._bMultipleBatches){e._openProgressDialog()}return e.generateCanvasAsync(0)}).catch(function(t){if(t&&t.bMaxCanvasSizeExceeded){e._updateDialogPreviewCanvas();e._oDialog.getContent()[0].setBusy(false)}})}else{if(a.getConfiguration().getRTL()){e._ganttChartClone._bRenderGanttClone=true}return this._drawClonedGantt(false).then(function(){e._bExpandCollapse=true;return e._expandAndCollapse()}).then(function(){e._ganttChartClone._bExpandRows=true;return e._expandRowSettings()}).then(function(){e._ganttChartClone._bExpandRows=false;e._setCloneDivHeightNonOptimised();document.getElementById(e._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=e._iContentHeight;document.getElementById(e._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=e._iContentHeight;return e._createGanttCanvas()}).then(function(t){e._oGanttCanvas=t;e._updateDialogPreview();e._oDialog.getContent()[0].setBusy(false);e._oButtonExport.setEnabled(true)}).catch(function(t){if(t&&t.bMaxCanvasSizeExceeded){e._updateDialogPreviewCanvas();e._oDialog.getContent()[0].setBusy(false)}})}};Z.prototype.openPdfPreview=function(t){if(!this.getGanttChart()||!this._getOriginalGanttChart().isA("sap.gantt.simple.GanttChartWithTable")){throw new Error("Association 'ganttChart' of type 'sap.gantt.simple.GanttChartWithTable' is not set")}this._oDomToPrint=[];this._oDomToPrintHeight=0;this._oDomToPrintWidth=0;var e=this;if(t){t(this._ganttChartClone.getTable())}this._createAndOpenDialog(true);this._oDialog.getContent()[0].setBusy(true);this._oButtonExport.setEnabled(false);this._ganttChartClone.setShowGanttHeader(true);return this._drawClonedGantt(true).then(function(){if(e._bMultipleBatches){e._openProgressDialog()}return e.generatePdfAsync(0)}).catch(function(t){if(t){e._oDialog.getContent()[0].setBusy(false)}})};Z.prototype.close=function(){var t=this._getOriginalGanttChart();if(this._initialDisplayType===Y.Table){t.setSelectionPanelSize(this._initialSelectionPanelSize);t.setDisplayType(this._initialDisplayType);if(t.getParent()&&t.getParent().isA("sap.gantt.simple.GanttChartContainer")&&t.getParent().getToolbar()){t.getParent().getToolbar()._oDisplayTypeSegmentedButton.setSelectedKey(Y.Table)}}this._ganttChartClone.destroy();this._ganttChartClone=null;this._ganttChartContainer.destroy();this._ganttChartContainer=null;document.body.removeChild(this._oClonedGanttDiv);V.deregister(this._sResizeHandlerId);if(this._oPdfPreview){this._oPdfPreview.destroy()}this._oDialog.close();this._oDialog.destroy();if(X.browser.safari){t.getInnerGantt().invalidate()}};Z.prototype._closeProgressIndicator=function(t){this._oProgressDialog.close();this._oProgressDialog.destroy();this._bCancel=true;if(!this._bUpdateGanttCanvas&&!t){this.close()}};Z.prototype.setGanttChart=function(t){this.setAssociation("ganttChart",t);this._initialDisplayType=t.getDisplayType();this._initialSelectionPanelSize=t._iLastTableAreaSize?t._iLastTableAreaSize:t.getSelectionPanelSize();var e=this._initialDisplayType===Y.Table?true:false;if(e){t.setSelectionPanelSize("100%");t.setDisplayType(Y.Both)}this._ganttChartClone=t.clone();this._ganttChartClone._enableOptimisation=t.getPrintingBatchSize()>0?true:false;this._bUpdateGanttCanvas=false;this._bCancel=false;this._ganttChartClone.setEnableChartOverflowToolbar(false);this.canvasScale=2;if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.getTable().destroyExtension();var i=e?1:Math.max(t.getAxisTimeStrategy().getZoomLevel(),1);this.iThreshold=Math.min(Math.round(t.getPrintingBatchSize()/i),t.getTable()._getTotalRowCount());this._bMultipleBatches=t.getTable()._getTotalRowCount()>this.iThreshold;this.bFirst=true;this._ganttChartClone.getTable().setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);this._ganttChartClone.getTable().setVisibleRowCount(this.iThreshold);this._ganttChartClone.getTable().setThreshold(this.iThreshold);this._ganttChartClone.setParent(this._getOriginalGanttChart(),"originalGanttChart",true)}else{this._ganttChartContainer.setParent(this._getOriginalGanttChart(),"originalGanttChart",true)}this._addBackOriginalGanttRowBinding(this._ganttChartClone,t);this._originalHasRenderedShapes=t.getInnerGantt().hasRenderedShapes();this._ganttChartClone.mEventRegistry={};this._ganttChartClone.setHeight("100%");var a=t._oSplitter._calculatedSizes[0];if(this._initialDisplayType===Y.Chart){this._ganttChartClone.setProperty("selectionPanelSize","1px",true)}else{this._ganttChartClone.setProperty("selectionPanelSize",a.toString()+"px",true)}var n=t.getAxisTimeStrategy();if(!n.isA("sap.gantt.axistime.FullScreenStrategy")&&!e){t.isPrint=true;t._getScrollExtension()._updateVisibleHorizonForce();var o=this._ganttChartClone.getAxisTimeStrategy();o.setTotalHorizon(n.getTotalHorizon());o.setVisibleHorizon(n.getTotalHorizon())}var r=n.getVisibleHorizon();var s=this._getHorizonDates(r);var h=this._horizonWidthInSec(s);this._fPixelsBySec=t.getVisibleWidth()/h;this._ganttChartClone.isPrint=true;this._ganttChartClone._bClonedGantt=true;if(!this._ganttChartClone._enableOptimisation){this._ganttChartContainer.addGanttChart(this._ganttChartClone)}return this};Z.prototype._expandAndCollapse=function(){var t=this;return this._expandAndCollapseRow().then(function(){if(t._bExpandCollapse){return t._expandAndCollapse()}else{return Promise.resolve()}})};Z.prototype._expandAndCollapseRow=function(){if(this._bCancel){this._bExpandCollapse=false;return Promise.reject()}var t=this._getOriginalGanttChart().getTable();if(!t.isA("sap.ui.table.TreeTable")){this._bExpandCollapse=false;return this._ganttChartClone.getInnerGantt().resolveWhenReady(this._originalHasRenderedShapes)}var e=t.getBinding("rows"),i=this._ganttChartClone.getTable().getBinding("rows");for(var a=0;a<e.getLength();a++){if(i.findNode(a)!==undefined&&e.isExpanded(a)&&!i.isExpanded(a)){i.expand(a);return this.renderGanttClone(true)}else if(i.findNode(a)!==undefined&&!e.isExpanded(a)&&i.isExpanded(a)){i.collapse(a);return this.renderGanttClone(true)}}this._bExpandCollapse=false;return Promise.resolve()};Z.prototype._expandRowSettings=function(){if(this._bCancel){return Promise.reject()}var t=this._ganttChartClone.getUseParentShapeOnExpand();var e=this._ganttChartClone.getShapeSchemes().find(function(e){return t?e.getPrimary():!e.getPrimary()});var i=this._getOriginalGanttChart();var a=i.oOverlapShapeIds;var n=i._aExpandedIndices,o=[];var r=this._ganttChartClone.getEnablePseudoShapes();if(r){for(var s in a){if(a[s].length>0){o.push(parseInt(s,10))}}if(o.length>0){n=n.filter(function(t){return o.indexOf(t)==-1})}}if(n){var h;var l=0,g=Object.keys(i._oExpandModel.mExpanded);var p=g.length;while(!h&&l!=p){var d=g[l];if(!i._oExpandModel.mExpanded[d][1].expandSchemeShape){h=i._oExpandModel.mExpanded[d]}l++}h=h?h:[];var _=[];h.forEach(function(t){_.push(t.scheme)})}var u=_&&_.length?_:e&&e.getKey();if(u){if(!this._ganttChartClone._aExpandedIndices||this._ganttChartClone._aExpandedIndices.length===0){this._ganttChartClone.expand(u,n)}}if(r&&!this._ganttChartClone.oOverlapShapeIds){o.forEach(function(t){this._oPseudoShape=null;this._expandPseudoShapeInRow(t)}.bind(this))}return this._ganttChartClone.getInnerGantt().resolveWhenReady(this._originalHasRenderedShapes)};Z.prototype._expandPseudoShapeInRow=function(t){if(this._bCancel){return Promise.reject()}var e=this._ganttChartClone.getTable();var i=e.getRows()[t];var a=i?i.getAggregation("_settings"):null;var n=this._getOriginalGanttChart().oOverlapShapeIds[t];if(a){var o=$.getAllNonLazyAggregations(a);var r=Object.keys(o).filter(function(t){return t.indexOf("calendars")===-1&&t!=="relationships"}).map(function(t){return a.getAggregation(t)||[]});r.forEach(function(t){if(t&&t.length>0&&!this._oPseudoShape){var e=0;while(e<t.length&&!this._oPseudoShape){var i=t[e];if(i.isPseudoShape){var a=i.aShapeIds;if(n.indexOf(a[0])!==-1){this._oPseudoShape=i;i.onclick()}}e++}}}.bind(this))}};Z.prototype._onResize=function(){var t=this._oHTMLDialogPreview.getDomRef();t.style.overflow="hidden";this._resizePrintingPreviewPage();t.style.overflow="visible"};function rt(t){return t*3.78}function st(t){return t/3.78}function ht(t){return t/.01042}function lt(t){return t*.01042}Z.prototype._convertUnitToPx=function(t){var e=this._oModel.getProperty("/unit");if(!e){return undefined}switch(e){case"mm":return rt(t);case"cm":return rt(t)*10;case"in":return ht(t);default:return undefined}};Z.prototype._convertPxToUnit=function(t){var e=this._oModel.getProperty("/unit");if(!e){return undefined}switch(e){case"mm":return st(t);case"cm":return st(t)/10;case"in":return lt(t);default:return undefined}};Z.prototype._onChangeUnitComboBox=function(){this._updatePaperSizeInputs();this._updateMarginInputs()};Z.prototype._updatePaperSizeInputs=function(){var t=this._oModel.getProperty("/paperWidth"),e=this._oModel.getProperty("/paperHeight");this._setPaperSizeInputs(t,e)};Z.prototype._setPaperSizeInputs=function(t,e){if(this._oInputPaperWidth){this._oInputPaperWidth.setValue(this._convertPxToUnit(t))}if(this._oInputPaperHeight){this._oInputPaperHeight.setValue(this._convertPxToUnit(e))}};Z.prototype._setPaperSizesToModel=function(t,e){this._oModel.setProperty("/paperWidth",t);this._oModel.setProperty("/paperHeight",e)};Z.prototype._updatePaperSizeValues=function(t,e){var i=this._oModel.getProperty("/paperSize"),a=this._oModel.getProperty("/portrait"),n,o;if(!i||i==="Custom"){return}var r=Z._oPaperSizes[i];if(a){n=r.width;o=r.height}else{n=r.height;o=r.width}this._setPaperSizeInputs(n,o);this._setPaperSizesToModel(n,o);if(i==="Letter"||i==="Legal"||i==="Tabloid"){this._oComboBoxUnit.setSelectedKey("in")}else{this._oComboBoxUnit.setSelectedKey("mm")}this._onChangeUnitComboBox();if(t){this._generateSvgToPdf()}else{this._updateDialogPreview()}};Z.prototype._updatePaperOrientation=function(t){var e=this._oModel.getProperty("/paperWidth"),i=this._oModel.getProperty("/paperHeight");if(i>e){this._oModel.setProperty("/portrait",true);this._radioGroupOrientation.setSelectedIndex(0)}else{this._oModel.setProperty("/portrait",false);this._radioGroupOrientation.setSelectedIndex(1)}};Z.prototype._onChangePaperSizeInput=function(t,e){var i=e.getSource();var a=this._convertUnitToPx(n.getFloatInstance().parse(i.getValue()));if(i===this._oInputPaperWidth){this._oModel.setProperty("/paperWidth",a)}else{this._oModel.setProperty("/paperHeight",a)}this._oComboBoxPaperSizes.setSelectedKey("Custom");this._updatePaperOrientation();if(t){this._generateSvgToPdf()}else{this._updateDialogPreview()}};Z.prototype._onChangeCompressionSlider=function(t){var e=t.getSource();var i=e.getValue();this._setCompressionComboBoxItem(i)};Z.prototype._setCompressionComboBoxItem=function(t){if(t===100){this._oComboBoxCompression.setSelectedKey("maximum")}else if(t>=75){this._oComboBoxCompression.setSelectedKey("high")}else if(t>=50){this._oComboBoxCompression.setSelectedKey("medium")}else{this._oComboBoxCompression.setSelectedKey("low")}};Z.prototype._onChangeCompressionComboBox=function(t){var e=t.getSource().getSelectedKey();var i={maximum:100,high:75,medium:50,low:25};this._oModel.setProperty("/compressionQuality",i[e])};Z.prototype._onChangeOrientation=function(t,e){var i=this._oModel.getProperty("/paperWidth"),a=this._oModel.getProperty("/paperHeight");this._setPaperSizeInputs(a,i);this._setPaperSizesToModel(a,i);if(t){this._generateSvgToPdf()}else{this._updateDialogPreview()}};Z.prototype._onChangeExportTypes=function(){this._updateDialogPreview()};Z.prototype._setMarginInputs=function(t,e,i,a){this._oInputMarginTop.setValue(this._convertPxToUnit(t));this._oInputMarginRight.setValue(this._convertPxToUnit(e));this._oInputMarginBottom.setValue(this._convertPxToUnit(i));this._oInputMarginLeft.setValue(this._convertPxToUnit(a))};Z.prototype._setMarginsToModel=function(t,e,i,a){if(t!==undefined){this._oModel.setProperty("/marginTop",t)}if(e!==undefined){this._oModel.setProperty("/marginRight",e)}if(i!==undefined){this._oModel.setProperty("/marginBottom",i)}if(a!==undefined){this._oModel.setProperty("/marginLeft",a)}};Z.prototype._onChangeMarginComboBox=function(t,e){var i=e.getSource().getSelectedKey();var a=rt(5);if(i==="none"){a=0}this._setMarginsToModel(a,a,a,a);this._setMarginInputs(a,a,a,a);if(t){this._generateSvgToPdf()}else{this._updateDialogPreview()}};Z.prototype._updateModelFromMarginInputs=function(){var t,e,i,a;if(this._oInputMarginTop.getValueState()!=="Error"){t=this._convertUnitToPx(this._oInputMarginTop.getValue())}if(this._oInputMarginRight.getValueState()!=="Error"){e=this._convertUnitToPx(this._oInputMarginRight.getValue())}if(this._oInputMarginBottom.getValueState()!=="Error"){i=this._convertUnitToPx(this._oInputMarginBottom.getValue())}if(this._oInputMarginLeft.getValueState()!=="Error"){a=this._convertUnitToPx(this._oInputMarginLeft.getValue())}this._setMarginsToModel(t,e,i,a)};Z.prototype._updateMarginInputs=function(){var t=this._oModel.getProperty("/marginTop");var e=this._oModel.getProperty("/marginRight");var i=this._oModel.getProperty("/marginBottom");var a=this._oModel.getProperty("/marginLeft");this._setMarginInputs(t,e,i,a)};Z.prototype._updateCropMarksOffsetInput=function(){var t=this._oModel.getProperty("/cropMarksOffset");this._oInputCropMarksOffset.setValue(this._convertPxToUnit(t))};Z.prototype._onChangeMarginInput=function(t,e){var i=e.getSource();if(i.getValueState()==="Error"){return}if(this._oModel.getProperty("/marginLocked")){var a=this._convertUnitToPx(i.getValue());this._setMarginInputs(a,a,a,a);this._setMarginsToModel(a,a,a,a)}else{this._updateModelFromMarginInputs()}if(t){this._generateSvgToPdf()}else{this._updateDialogPreview()}};Z.prototype._onChangeCropMarksInput=function(t){var e=t.getSource();var i=this._convertUnitToPx(e.getValue());this._oInputCropMarksOffset.setValue(this._convertPxToUnit(i));this._oModel.setProperty("/cropMarksOffset",i)};Z.prototype._allRange=function(){this._oModel.setProperty("/startDate",this._oDatePickerFrom.getMinDate());this._oModel.setProperty("/endDate",this._oDatePickerTo.getMaxDate())};Z.prototype._getFirstDayOfNextWeek=function(t){var e=this._getOriginalGanttChart().getAxisTimeStrategy().getFirstDayOfWeek();var i=(e+7-t.getDay())%7;return new Date(t.getFullYear(),t.getMonth(),t.getDate()+(i===0?7:i))};Z.prototype._nextWeekRange=function(){var t=new Date;var e=this._getFirstDayOfNextWeek(t);this._oModel.setProperty("/startDate",this._validateDate(e));this._oModel.setProperty("/endDate",this._validateDate(new Date(e.getFullYear(),e.getMonth(),e.getDate()+7)))};Z.prototype._getFirstDayOfNextMonth=function(t){return new Date(t.getFullYear(),t.getMonth()+1,1)};Z.prototype._nextMonthRange=function(){var t=new Date;this._oModel.setProperty("/startDate",this._validateDate(this._getFirstDayOfNextMonth(t)));this._oModel.setProperty("/endDate",this._validateDate(new Date(t.getFullYear(),t.getMonth()+2,1)))};Z.prototype._validateDate=function(t){var e=this._oDatePickerTo.getMaxDate(),i=this._oDatePickerFrom.getMinDate();if(t.getTime()>e.getTime()){return e}if(t.getTime()<i.getTime()){return i}return t};Z.prototype._onChangeDurationComboBox=function(t){var e=this._oModel.getProperty("/duration");switch(e){case"all":{this._allRange()}break;case"week":{this._nextWeekRange()}break;case"month":{this._nextMonthRange()}break;case"custom":default:return}if(t){this._updateGanttPdf()}else{this._updateGanttCanvas()}};Z.prototype._onChangeDurationDatePicker=function(t){this._oComboBoxDuration.setSelectedKey("custom");if(this._oDatePickerFrom.isValidValue()&&this._oDatePickerTo.isValidValue()){if(this._oDatePickerFrom.getDateValue().getTime()<=this._oDatePickerTo.getDateValue().getTime()){this._oDatePickerFrom.setValueState(sap.ui.core.ValueState.None);this._oDatePickerTo.setValueState(sap.ui.core.ValueState.None);if(t){this._updateGanttPdf()}else{this._updateGanttCanvas()}}else{this._oDatePickerFrom.setValueState(sap.ui.core.ValueState.Error);this._oDatePickerTo.setValueState(sap.ui.core.ValueState.Error)}}else{var e=this._oDatePickerFrom.isValidValue()?sap.ui.core.ValueState.None:sap.ui.core.ValueState.Error;var i=this._oDatePickerTo.isValidValue()?sap.ui.core.ValueState.None:sap.ui.core.ValueState.Error;this._oDatePickerFrom.setValueState(e);this._oDatePickerTo.setValueState(i)}};Z.prototype._setEnabledPreviousButtons=function(t){this._oButtonFirst.setEnabled(t);this._oButtonPrevious.setEnabled(t)};Z.prototype._setEnabledNextButtons=function(t){this._oButtonNext.setEnabled(t);this._oButtonLast.setEnabled(t)};Z.prototype._updatePageNumberButtons=function(){if(!this._oGanttCanvas){this._setEnabledNextButtons(false);this._setEnabledPreviousButtons(false);return}var t=this._oModel.getProperty("/previewPageNumber"),e=this._oModel.getProperty("/lastPageNumber");if(!e){e=Number.MAX_SAFE_INTEGER}if(t<=1){this._setEnabledPreviousButtons(false)}if(t>=e){this._setEnabledNextButtons(false)}if(t>1){this._setEnabledPreviousButtons(true)}if(t<e){this._setEnabledNextButtons(true)}};Z.prototype._getHeaderHeight=function(){var t=this._oModel.getProperty("/showHeaderText");if(t){return this._iHeaderAndFooterHeight}return 0};Z.prototype._isFooterMultiline=function(){if(!this._oModel.getProperty("/multiplePage")){return false}var t=this._oModel.getProperty("/showPageNumber"),e=this._oModel.getProperty("/showFooterText");if(!e||!t){return false}var i=this._oModel.getProperty("/footerText"),n=this._oModel.getProperty("/paperWidth"),o;var r=a.getConfiguration().getRTL();if(r){o=this._oModel.getProperty("/marginRight")}else{o=this._oModel.getProperty("/marginLeft")}var s=7;var h=this._oGanttCanvas.getContext("2d");h.font=tt;var l=h.measureText(i).width;if(n/2>o+rt(4)+l+rt(10)+s){return false}else{return true}};Z.prototype._getFooterHeight=function(){var t=this._oModel.getProperty("/showPageNumber"),e=this._oModel.getProperty("/showFooterText");if(e&&t){return this._isFooterMultiline()?2*this._iHeaderAndFooterHeight:this._iHeaderAndFooterHeight}if(e||t){return this._iHeaderAndFooterHeight}return 0};Z.prototype._isShrinkableToOnePageByWidth=function(){var t=this._getPaperContentWidth()/this._getPaperContentHeight(),e=this._oGanttCanvas.width/this._oGanttCanvas.height;return t<=e};Z.prototype._isDomShrinkableToOnePageByWidth=function(t,e){var i=this._getPaperContentWidth()/this._getPaperContentHeight(),a=e/t;return i<=a};Z.prototype._getPaperContentWidth=function(){var t=this._oModel.getProperty("/paperWidth"),e=this._oModel.getProperty("/marginLeft"),i=this._oModel.getProperty("/marginRight");return t-e-i};Z.prototype._getPaperContentHeight=function(){var t=this._oModel.getProperty("/paperHeight"),e=this._oModel.getProperty("/marginTop"),i=this._oModel.getProperty("/marginBottom");return t-e-this._getHeaderHeight()-i-this._getFooterHeight()};Z.prototype._getScale=function(){return 100/this._oModel.getProperty("/scale")*2};Z.prototype._getCroppingWidth=function(){return this._getScale()*this._getPaperContentWidth()};Z.prototype._getCroppingHeight=function(){return this._getScale()*this._getPaperContentHeight()};Z.prototype._getPagesInARow=function(){return Math.ceil(this._oGanttCanvas.width/this._getCroppingWidth())};Z.prototype._getPagesInAColumn=function(){return Math.ceil(this._oGanttCanvas.height/this._getCroppingHeight())};Z.prototype._updateLastPageNumber=function(){if(!this._oGanttCanvas){return}var t=this._getPagesInARow()*this._getPagesInAColumn();this._oModel.setProperty("/lastPageNumber",t);var e=this._oModel.getProperty("/previewPageNumber");if(e>t){this._oModel.setProperty("/previewPageNumber",t)}};Z.prototype._onPressButtonFirst=function(){this._oModel.setProperty("/previewPageNumber",1);this._updatePageNumberButtons();this._updateDialogPreviewCanvas()};Z.prototype._onPressButtonPrevious=function(){var t=this._oModel.getProperty("/previewPageNumber");this._oModel.setProperty("/previewPageNumber",t-1);this._updatePageNumberButtons();this._updateDialogPreviewCanvas()};Z.prototype._onPressButtonNext=function(){var t=this._oModel.getProperty("/previewPageNumber");this._oModel.setProperty("/previewPageNumber",t+1);this._updatePageNumberButtons();this._updateDialogPreviewCanvas()};Z.prototype._onPressButtonLast=function(){var t=this._oModel.getProperty("/lastPageNumber");if(!t){return}this._oModel.setProperty("/previewPageNumber",t);this._updatePageNumberButtons();this._updateDialogPreviewCanvas()};Z.prototype._getOriginalGanttChart=function(){return sap.ui.getCore().byId(this.getAssociation("ganttChart"))};Z.prototype._getGanttCloneDivWidth=function(t){var e=this._getOriginalGanttChart(),i=this._getHorizonDates(t),a=this._horizonWidthInSec(i),n=Math.ceil(this._fPixelsBySec*a);var o=e.getDisplayType()===Y.Both?e.getTable().getDomRef().offsetWidth:0;return o+n+10};Z.prototype._setGanttCloneDivWidth=function(t){this._oClonedGanttDiv.style.width=this._getGanttCloneDivWidth(t).toString()+"px"};Z.prototype._setGanttCloneDivHeight=function(){this._oClonedGanttDiv.style.height=this._getGanttCloneDivHeight().toString()+"px"};Z.prototype._getGanttCloneDivHeight=function(){var t=this._getOriginalGanttChart().getTable();var e=t._getTotalRowCount(),i=t._aRowHeights;var a=i.reduce(function(t,e){return t+e});var n=Math.ceil(a/i.length*e);this._iGanttHeight=n+102;return this._iGanttHeight};Z.prototype._setCloneDivHeight=function(){var t=this.bFirst?document.getElementById(this._ganttChartClone.getId()+"-header-svg").height.baseVal.value:0;var e=this._ganttChartClone.getTable().getVisibleRowCount();var i=0;var a=this.bLast?3:0;var n=this._ganttChartClone.getTable().getRows()[0].getIndex();var o=this._ganttChartClone.getTable().getFirstVisibleRow();var r=Math.abs(n-o);var s=this._ganttChartClone.getTable()._aRowHeights;for(var h=r;h<e+r;h++){i=i+s[h]}this._iContentHeight=i+"px";this._oClonedGanttDiv.style.height=(i+t+a).toString()+"px"};Z.prototype._setCloneDivHeightNonOptimised=function(){var t=document.getElementById(this._ganttChartClone.getId()+"-header-svg").height.baseVal.value;var e=this._ganttChartClone.getTable()._getTotalRowCount();var i=1;var a=this._ganttChartClone.getTable()._aRowHeights;for(var n=0;n<e;n++){var o=a[n]?a[n]:0;i=i+o}this._iContentHeight=i.toString()+"px";this._oClonedGanttDiv.style.height=(i+t).toString()+"px"};Z.prototype._createImgElementsFromSvgImages=function(){var t=this._ganttChartClone.$().find("svg.sapGanttChartSvg");if(!t.length){return}var e=this._ganttChartClone.$().find(".sapGanttChartCnt")[0];if(!e){return}e.style.position="relative";var i=t.find("image");for(var a=0;a<i.length;a++){var n=i[a];var o=document.createElement("img");o.src=n.getAttribute("href");o.style.position="absolute";o.style.top=n.getAttribute("y")+"px";o.style.left=n.getAttribute("x")+"px";o.style.width=n.getAttribute("width")+"px";o.style.height=n.getAttribute("height")+"px";e.appendChild(o)}};Z.prototype._createGanttCanvas=function(){if(this._bCancel){return Promise.reject()}this._setStyleToGanttChartSvg(this._ganttChartClone);this._createImgElementsFromSvgImages();return z(this._oClonedGanttDiv,{allowTaint:true,scale:this.canvasScale,logging:false})};Z.prototype._createBatchList=function(){if(this._bCancel){return Promise.reject()}this._setStyleToGanttChartSvg(this._ganttChartClone);this._oDomToPrintHeight+=Number(this._oClonedGanttDiv.style.height.slice(0,-2));this._oDomToPrintWidth=Number(this._oClonedGanttDiv.style.width.slice(0,-2));return this._oClonedGanttDiv.cloneNode(true)};Z.prototype._updateGanttPdf=function(){if(this._initialDisplayType===Y.Table){return}var t=this._oModel;var e=this._ganttChartClone.getAxisTimeStrategy();var i=e.getVisibleHorizon().clone();var a=e.getTotalHorizon().clone();i.setStartTime(t.getProperty("/startDate"));i.setEndTime(t.getProperty("/endDate"));a.setStartTime(t.getProperty("/startDate"));a.setEndTime(t.getProperty("/endDate"));this._bCancel=false;this._oDomToPrint=[];this._oDomToPrintHeight=0;this._oDomToPrintWidth=0;if(!this._bMultipleBatches){this._oFlexBoxPreview.setBusy(true);this._oButtonExport.setEnabled(false)}this._setGanttCloneDivWidth(a);this._setGanttCloneDivHeight();e.setTotalHorizon(a);e.setVisibleHorizon(i);if(!this._ganttChartClone._enableOptimisation){this._ganttChartClone.invalidate()}this._ganttChartClone._bRenderGanttClone=true;var n=this._getOriginalGanttChart();var o=Math.max(n.getAxisTimeStrategy().getZoomLevel(),1);this.iThreshold=Math.min(Math.round(n.getPrintingBatchSize()/o),n.getTable()._getTotalRowCount());this._ganttChartClone.setShowGanttHeader(true);if(this._bMultipleBatches){this._openProgressDialog()}this._ganttChartClone._bRenderGanttClone=false;return this.generatePdfAsync(0)};Z.prototype._updateGanttCanvas=function(){if(this._initialDisplayType===Y.Table){return}var t=this._oModel;var e=this._ganttChartClone.getAxisTimeStrategy();var i=e.getVisibleHorizon().clone();var a=e.getTotalHorizon().clone();i.setStartTime(t.getProperty("/startDate"));i.setEndTime(t.getProperty("/endDate"));a.setStartTime(t.getProperty("/startDate"));a.setEndTime(t.getProperty("/endDate"));var n=this._getGanttCloneDivHeight();var o=this._getGanttCloneDivWidth(a);if(o*this.canvasScale>it||n*this.canvasScale>it){this._oClonedGanttDiv.error=true;this._oGanttCanvas=undefined;this._updateDialogPreviewCanvas();this._oFlexBoxPreview.setBusy(false);return undefined}this._bUpdateGanttCanvas=true;this._bCancel=false;if(!this._bMultipleBatches){this._oFlexBoxPreview.setBusy(true);this._oButtonExport.setEnabled(false)}var r;if(!this._oClonedGanttDiv.id){this._oClonedGanttDiv.id="clonedGanttDiv";r=true;if(this._getOriginalGanttChart().$().closest(".sapUiSizeCompact").length>0){this._oClonedGanttDiv.classList.add("sapUiSizeCompact")}this._oClonedGanttDiv.style.position="absolute";this._oClonedGanttDiv.style.top="-17000px";this._oClonedGanttDiv.style.left="-17000px";if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.placeAt("clonedGanttDiv")}else{this._ganttChartContainer.placeAt("clonedGanttDiv")}}this._setGanttCloneDivWidth(a);this._setGanttCloneDivHeight();if(r){r=false;this._addBackOriginalGanttRowBinding(this._ganttChartClone,this._getOriginalGanttChart())}e.setTotalHorizon(a);e.setVisibleHorizon(i);if(!this._ganttChartClone._enableOptimisation){this._ganttChartClone.invalidate()}this._ganttChartClone._bRenderGanttClone=true;if(this._ganttChartClone._enableOptimisation){var s=this._getOriginalGanttChart();var h=Math.max(s.getAxisTimeStrategy().getZoomLevel(),1);this.iThreshold=Math.min(Math.round(s.getPrintingBatchSize()/h),s.getTable()._getTotalRowCount());this._ganttChartClone.setShowGanttHeader(true);if(this._bMultipleBatches){this._openProgressDialog()}this._ganttChartClone._bRenderGanttClone=false;return this.generateCanvasAsync(0)}else{this._oClonedGanttDiv.style.height=this._iGanttHeight*2+"px";return this._ganttChartClone.getInnerGantt().resolveWhenReady(this._originalHasRenderedShapes).then(function(){this._ganttChartClone._bRenderGanttClone=false;return this.renderGanttClone().then(function(){this._setCloneDivHeightNonOptimised();document.getElementById(this._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=this._iContentHeight;document.getElementById(this._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=this._iContentHeight;this._createGanttCanvas().then(function(t){this._oGanttCanvas=t;this._updateDialogPreview();this._oFlexBoxPreview.setBusy(false)}.bind(this)).catch(function(){this._oFlexBoxPreview.setBusy(false)}.bind(this))}.bind(this))}.bind(this)).catch(function(){this._oFlexBoxPreview.setBusy(false)}.bind(this))}};Z.prototype._drawClonedGantt=function(t){if(this._oClonedGanttDiv){return Promise.reject()}this._oClonedGanttDiv=document.createElement("div");document.body.appendChild(this._oClonedGanttDiv);var e=this._getGanttCloneDivHeight();var i=this._getGanttCloneDivWidth(this._ganttChartClone.getAxisTimeStrategy().getTotalHorizon());if(!t&&(i*this.canvasScale>it||e*this.canvasScale>it)){this._oClonedGanttDiv.error=true;return Promise.reject({bMaxCanvasSizeExceeded:true})}this._oClonedGanttDiv.id="clonedGanttDiv";if(this._getOriginalGanttChart().$().closest(".sapUiSizeCompact").length>0){this._oClonedGanttDiv.classList.add("sapUiSizeCompact")}this._oClonedGanttDiv.style.position="absolute";this._oClonedGanttDiv.style.top="-17000px";this._oClonedGanttDiv.style.left="-17000px";this._setGanttCloneDivWidth(this._ganttChartClone.getAxisTimeStrategy().getTotalHorizon());this._setGanttCloneDivHeight();var a=this._oModel;var n=this._ganttChartClone.getAxisTimeStrategy();n.getVisibleHorizon().setStartTime(a.getProperty("/startDate"));n.getVisibleHorizon().setEndTime(a.getProperty("/endDate"));if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.placeAt("clonedGanttDiv")}else{this._ganttChartContainer.placeAt("clonedGanttDiv")}this._addBackOriginalGanttRowBinding(this._ganttChartClone,this._getOriginalGanttChart());if(this._ganttChartClone._enableOptimisation){return Promise.resolve()}else{this._oClonedGanttDiv.style.height=this._iGanttHeight*2+"px";return this._ganttChartClone.getInnerGantt().resolveWhenReady(this._originalHasRenderedShapes)}};Z.prototype._addBackOriginalGanttRowBinding=function(t,e){var i=t.getTable();if(i.getBindingInfo("rows").binding==null){t.oPropagatedProperties=e._getPropertiesToPropagate();t.propagateProperties(true)}if(t.getEnablePseudoShapes()){var a=i.getRowSettingsTemplate();if(a&&!a.getBindingInfo("tasks")){var n=J.prototype.clone.call(e.getTable().getRowSettingsTemplate());a.bindAggregation("tasks",n.getBindingInfo("tasks"))}}if(this._ganttChartClone._enableOptimisation){i.setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);i.setVisibleRowCount(this.iThreshold);i.setThreshold(this.iThreshold)}var o=e.getTable().getBinding("rows"),r=i.getBinding("rows");if(o){if(o.sCustomParams){r.sCustomParams=o.sCustomParams}if(o.aFilters&&o.aFilters.length>0){r.filter(o.aFilters)}if(o.aApplicationFilters&&o.aApplicationFilters.length>0){r.filter(o.aApplicationFilters,sap.ui.model.FilterType.Application)}if(o.aSorters&&o.aSorters.length>0){r.sort(o.aSorters)}}};Z.prototype._resizePrintingPreviewPage=function(){var t=this._oHTMLDialogPreview.getDomRef(),e=this._oHTMLDialogPreview.$().find(".sapGanttPrintingPreviewPageDiv")[0],i=t.offsetHeight,a=this._oModel.getProperty("/paperHeight"),n=this._oModel.getProperty("/paperWidth"),o=this._oModel.getProperty("/portrait"),r,s;if(o){r=i/a;s=n*r}else{r=i/n;s=i;i=a*r}e.style.width=s.toString()+"px";e.style.height=i.toString()+"px"};Z.prototype._updateSinglePageMessages=function(t,e){if(e>t){this._oModel.setProperty("/orientationMessage",this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_PORTRAIT"))}else{this._oModel.setProperty("/orientationMessage",this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_LANDSCAPE"))}if(this._getPagesInARow()>3||this._getPagesInAColumn()>3){this._oModel.setProperty("/qualityWarning",true)}else{this._oModel.setProperty("/qualityWarning",false)}if(e>=t&&this._oModel.getProperty("/portrait")||e<=t&&!this._oModel.getProperty("/portrait")){this._oModel.setProperty("/showOrientationMessage",false)}else{this._oModel.setProperty("/showOrientationMessage",true)}};Z.prototype._getCanvasOfPageN=function(t,e){var i=this._oModel.getProperty("/lastPageNumber");if(t>i){return null}var n=document.createElement("canvas");var o=n.getContext("2d");o.imageSmoothingEnabled=false;var r=this._getCroppingWidth(),s=this._getCroppingHeight();var h=this._getPagesInARow();var l=this._oModel.getProperty("/paperWidth"),g=this._oModel.getProperty("/paperHeight");var p=this._oModel.getProperty("/marginTop"),d=this._oModel.getProperty("/marginBottom"),_=this._oModel.getProperty("/marginLeft");var u=(t-1)%h,c=Math.floor((t-1)/h);n.width=l;n.height=g;if(!e){n.style.height="100%";n.style.width="auto"}o.fillStyle="white";o.fillRect(0,0,n.width,n.height);o.fillStyle=k.get("sapUiBaseText");o.textBaseline="middle";o.font=tt;var f;var C=a.getConfiguration().getRTL();if(C){o.textAlign="right";f=l-rt(4)}else{o.textAlign="left";f=rt(4)}var P=o.measureText("...").width;var m=l-rt(4)-P;var v,y,T,b;if(this._oModel.getProperty("/showHeaderText")){v=this._oModel.getProperty("/headerText");var x=o.measureText(v).width;if(x>l-rt(4)){T=q.geNumberOfTruncatedCharacters(x,m,v,o,o.measureText,true);if(C){b=v.length-T;v="..."+v.slice(b,v.length).trim()}else{v=v.slice(0,T).trim()+"..."}}o.fillText(v,f,this._iHeaderAndFooterHeight/2)}if(this._oModel.getProperty("/showFooterText")){y=this._oModel.getProperty("/footerText");var w=o.measureText(y).width;if(w>l-rt(4)){T=q.geNumberOfTruncatedCharacters(w,m,y,o,o.measureText,true);if(C){b=y.length-T;y="..."+y.slice(b,y.length).trim()}else{y=y.slice(0,T).trim()+"..."}}o.fillText(y,f,g-this._iHeaderAndFooterHeight/2-(this._isFooterMultiline()?this._iHeaderAndFooterHeight:0))}this._mHeaderFooterInfo={headerText:v,footerText:y,position:f};var G=this._oModel.getProperty("/showPageNumber"),S=this._oModel.getProperty("/multiplePage"),M;if(S&&G){o.font=et;o.textAlign="center";o.fillText(t.toString(),l/2,g-d-this._iHeaderAndFooterHeight/2)}if(S){var R=u*r,D=c*s,N=0,E=0;var B=false;if(R+r>this._oGanttCanvas.width){B=true;r=this._oGanttCanvas.width-R;E=r/this._getScale()}var I=false;if(D+s>this._oGanttCanvas.height){I=true;s=this._oGanttCanvas.height-D;N=s/this._getScale()}M=(B?E:this._getPaperContentWidth())/r;if(M<.5&&e){var A=document.createElement("canvas");A.width=r;A.height=s;var H=A.getContext("2d");H.drawImage(this._oGanttCanvas,R,D,r,s,0,0,r,s);this._downScaleCanvas(A,o,M,0,0,A.width,A.height,_,p+this._getHeaderHeight())}else{o.drawImage(this._oGanttCanvas,R,D,r,s,_,p+this._getHeaderHeight(),B?E:this._getPaperContentWidth(),I?N:this._getPaperContentHeight())}}else{var O=this._getPaperContentWidth(),F=this._getPaperContentHeight();var L=this._isShrinkableToOnePageByWidth();var V;if(L){V=O/this._oGanttCanvas.width;F=this._oGanttCanvas.height*V}else{V=F/this._oGanttCanvas.height;O=this._oGanttCanvas.width*V}this._updateSinglePageMessages(O,F);M=O/this._oGanttCanvas.width;if(M<1&&e){this._downScaleCanvas(this._oGanttCanvas,o,M,0,0,this._oGanttCanvas.width,this._oGanttCanvas.height,_,p+this._getHeaderHeight())}else{o.drawImage(this._oGanttCanvas,0,0,this._oGanttCanvas.width,this._oGanttCanvas.height,_,p+this._getHeaderHeight(),O,F)}}return n};Z.prototype._getFXTextPosition=function(){var t;var e=this._oModel.getProperty("/paperWidth");var i=a.getConfiguration().getRTL();if(i){t=e-rt(4)}else{t=rt(4)}return t/(i?Math.trunc(nt*10)/10:nt)};Z.prototype._downScaleCanvas=function(t,e,i,a,n,o,r,s,h){var l=document.createElement("canvas");l.width=o;l.height=r;var g=l.getContext("2d");g.drawImage(t,a,n,o,r,0,0,o,r);var p=i*i;var d=Math.floor(o*i);var _=Math.floor(r*i);var u=0,c=0,f=0;var C=0,P=0,m=0,v=0;var y=0,T=0;var b=0,x=0,w=0;var G=0,S=0,M=0;var R=false,D=false;var N=l.getContext("2d").getImageData(0,0,o,r).data;var E=new Float32Array(3*d*_);var B=0,I=0,A=0;for(c=0;c<r;c++){P=c*i;T=0|P;m=3*T*d;D=T!==(0|P+i);if(D){w=T+1-P;M=P+i-T-1}for(u=0;u<o;u++,f+=4){C=u*i;y=0|C;v=m+y*3;R=y!==(0|C+i);if(R){x=y+1-C;S=C+i-y-1}B=N[f];I=N[f+1];A=N[f+2];if(!R&&!D){E[v]+=B*p;E[v+1]+=I*p;E[v+2]+=A*p}else if(!R&&D){b=w*i;E[v]+=B*b;E[v+1]+=I*b;E[v+2]+=A*b;G=M*i;E[v+3*d]+=B*G;E[v+3*d+1]+=I*G;E[v+3*d+2]+=A*G}else if(R&&!D){b=x*i;E[v]+=B*b;E[v+1]+=I*b;E[v+2]+=A*b;G=S*i;E[v+3]+=B*G;E[v+4]+=I*G;E[v+5]+=A*G}else{b=x*w;E[v]+=B*b;E[v+1]+=I*b;E[v+2]+=A*b;G=S*w;E[v+3]+=B*G;E[v+4]+=I*G;E[v+5]+=A*G;G=x*M;E[v+3*d]+=B*G;E[v+3*d+1]+=I*G;E[v+3*d+2]+=A*G;G=S*M;E[v+3*d+3]+=B*G;E[v+3*d+4]+=I*G;E[v+3*d+5]+=A*G}}}var H=document.createElement("canvas");H.width=d;H.height=_;var O=H.getContext("2d");var F=O.getImageData(0,0,d,_);var L=F.data;var k=0;for(f=0,v=0;k<d*_;f+=3,v+=4,k++){L[v]=0|E[f];L[v+1]=0|E[f+1];L[v+2]=0|E[f+2];L[v+3]=255}e.putImageData(F,s,h);return};function gt(t){while(t.firstChild){t.removeChild(t.firstChild)}}Z.prototype._createPreviewErrorMessageStrip=function(t){return new w({text:this._oRb.getText(t?"GNT_PRNTG_ERROR_TOOHIGHCHART":"GNT_PRNTG_ERROR_BIGCHART"),showIcon:true,type:"Error"})};Z.prototype._updateDialogPreviewCanvas=function(){var t=this._oHTMLDialogPreview.$().find(".sapGanttPrintingPreviewPageDiv");var e=t[0];if(this._oGanttCanvas){this._oButtonExport.setEnabled(true);var i=this._oModel.getProperty("/multiplePage");if(i){this._oModel.setProperty("/qualityWarning",false);this._oModel.setProperty("/showOrientationMessage",false)}var a=this._getCanvasOfPageN(i?this._oModel.getProperty("/previewPageNumber"):1,false);gt(e);this._resizePrintingPreviewPage();e.appendChild(a)}else if(!this._oGanttCanvas&&(this._oClonedGanttDiv.offsetWidth>it||this._oClonedGanttDiv.offsetHeight>it||this._oClonedGanttDiv.error)){this._oClonedGanttDiv.error=false;this._resizePrintingPreviewPage();this._oModel.setProperty("/qualityWarning",false);this._oModel.setProperty("/showOrientationMessage",false);if(!this._oHTMLDialogPreview.$().find("#"+this.getId()+"-previewErrorMessageStrip").length){gt(e);if(!this._oPreviewErrorMessageStrip){this._oPreviewErrorMessageStrip=this._createPreviewErrorMessageStrip(this._oClonedGanttDiv.offsetHeight>it)}var n=document.createElement("div");n.id=this.getId()+"-previewErrorMessageStrip";n.style.width="80%";e.appendChild(n);this._oPreviewErrorMessageStrip.placeAt(this.getId()+"-previewErrorMessageStrip")}}else{throw new Error("Gantt chart canvas does not exist.")}t.addClass("sapGanttPrintingPreviewPageDivBorder")};Z.prototype._updateDialogPreview=function(){this._updateLastPageNumber();this._updatePageNumberButtons();this._updateDialogPreviewCanvas()};Z.prototype._setStylesToDom=function(t){function e(t){var e=getComputedStyle(t);var i,a,n,o;var r=["height","width","min-height","min-width"];var s="";for(i=0,a=e.length;i<a;i++){n=e[i];if(!(t instanceof SVGElement&&r.indexOf(n)>=0)){o=e.getPropertyValue(n);s+=n+":"+o+";"}}t.style=s}function i(t){e(t);i(t);function i(t){if(t&&t.hasChildNodes()){var a=t.firstChild;while(a){if(a.nodeType===1&&a.nodeName!="SCRIPT"){e(a);i(a)}a=a.nextSibling}}}}i(t)};Z.prototype._setStyleToGanttChartSvg=function(t){var e=t.$().find("svg.sapGanttChartSvg")[0];var i=t.$().find("svg.sapGanttChartHeaderSvg")[0];if(e){this._setStylesToDom(e)}if(i){this._setStylesToDom(i)}};Z.prototype._setStyleToGanttChartTable=function(t){var e=t.getElementsByClassName("sapUiTable")[0];if(e){this._setStylesToDom(e)}};Z.prototype._getHorizonDates=function(t){var e=t.getStartTime();var i=t.getEndTime();return{startTime:new Date(R.abapTimestampToDate(e)),endTime:new Date(R.abapTimestampToDate(i))}};Z.prototype._horizonWidthInSec=function(t){if(t&&t.startTime&&t.endTime){return t.endTime.getTime()-t.startTime.getTime()}return 0};Z.prototype._pageToBeExported=function(){if(!this._oModel.getProperty("/multiplePage")){return[1]}var t=this._oModel.getProperty("/lastPageNumber"),e=this._oModel.getProperty("/exportAll"),i=[];if(e){for(var a=1;a<=t;a++){i.push(a)}return i}else{var o=this._oModel.getProperty("/exportRange");o=o.replace(/\s/g,"");var r=n.getIntegerInstance();var s=o.split(",");s.forEach(function(t){if(t.indexOf("-")!==-1){var e=t.split("-");var a=r.parse(e[0]);var n=r.parse(e[1]);for(var o=a;o<=n;o++){i.push(o)}}else{i.push(r.parse(t))}});return i}};Z.prototype._validateFields=function(){var t=true;t&=this._validateExportRangeInput();t&=this._oInputMarginTop.getValueState()!=="Error";t&=this._oInputMarginRight.getValueState()!=="Error";t&=this._oInputMarginBottom.getValueState()!=="Error";t&=this._oInputMarginLeft.getValueState()!=="Error";return t};Z.prototype._setStyleToPath=function(t){var e=["fill","fillOpacity","stroke","strokeWidth","strokeDasharray","strokeOpacity","opacity","transform"];var i=[];e.forEach(function(e){i.push(t.style[e])});t.removeAttribute("style");e.forEach(function(e,a){t.style[e]=i[a]})};Z.prototype._updatePdfPreview=function(t){if(!this._oPdfPreview){var e=this._oPdfDialogPreview.getParent().getDomRef().offsetHeight-100;this._oPdfPreview=new K({source:t,width:"94%",height:e.toString()+"px",showDownloadButton:false});jQuery.sap.addUrlWhitelist("blob");this._oPdfPreview.placeAt("sapGanttPdfPreviewDiv")}else{this._oPdfPreview.setSource(t)}this._oDialog.getContent()[0].setBusy(false);this._oFlexBoxPreview.setBusy(false);this._oButtonExport.setEnabled(true)};Z.prototype._generateSvgToPdf=function(){if(!this._validateFields()){return}this._oDialog.getContent()[0].setBusy(true);this._oFlexBoxPreview.setBusy(true);this._oButtonExport.setEnabled(false);var t=this;var e=this._oModel.getProperty("/portrait")?"p":"l",i=this._oModel.getProperty("/paperWidth"),n=this._oModel.getProperty("/paperHeight"),o=this._oModel.getProperty("/marginTop"),r=this._oModel.getProperty("/marginRight"),s=this._oModel.getProperty("/marginBottom"),h=this._oModel.getProperty("/marginLeft"),l=this._oModel.getProperty("/paperSize");var g=this._ganttChartClone;var p=g.getDisplayType()===Y.Both?g.getTable().getDomRef().offsetWidth:0;var d=new W({orientation:e,unit:"px",format:l==="Custom"?[i*ot,n*ot]:l.toLowerCase()});function _(){var e=document.createElement("svg");e.setAttribute("id","mergedSvg");var i=Number(this._oDomToPrint[0].style.width.slice(0,-2))-32;if(u===0){var a=this._oDomToPrint[u].getElementsByClassName("sapGanttChartHeaderSvg")[0].cloneNode(true);a.children[0].setAttribute("style","fill: "+k.get("sapUiListHeaderBackground")+";width: "+i);var n=a.height.baseVal.value}var o=this._oDomToPrint[u].getElementsByClassName("sapGanttChartSvg")[0].cloneNode(true);var r=this._oDomToPrint[u].getElementsByClassName("sapGanttChartSvgDefs")[0].cloneNode(true);if(u===0&&o.getElementsByClassName("sapGanttChartVerticalLine")&&o.getElementsByClassName("sapGanttChartVerticalLine").length){var s=this._generateVerticalLines(this._ganttChartClone);if(s){o.getElementsByClassName("sapGanttChartVerticalLine")[0].setAttribute("d",s);o.getElementsByClassName("sapGanttChartVerticalLine")[0].removeAttribute("style")}else{return}}o.removeAttribute("style");if(u===0){Array.prototype.slice.call(a.getElementsByTagName("path")).forEach(function(e){t._setStyleToPath(e)})}Array.prototype.slice.call(o.getElementsByClassName("sapGanttChartShapes")[0].getElementsByTagName("path")).forEach(function(e){t._setStyleToPath(e)});Array.prototype.slice.call(o.getElementsByClassName("sapGanttChartRls")[0].getElementsByTagName("path")).forEach(function(e){t._setStyleToPath(e)});if(o.getElementsByClassName("sapGanttBackgroundSVGRowBorder").length){Array.prototype.slice.call(o.getElementsByClassName("sapGanttBackgroundSVGRowBorder")).forEach(function(t){t.setAttribute("x2",i);t.setAttribute("y1",t.getAttribute("y1"));t.setAttribute("y2",t.getAttribute("y2"))})}if(o.getElementsByClassName("sapGanttBackgroundSVGRow").length){Array.prototype.slice.call(o.getElementsByClassName("sapGanttBackgroundSVGRow")).forEach(function(t){t.setAttribute("style","fill: "+k.get("sapUiListBackground")+";width: "+i)})}if(u===0){this._setLinesHeight(o);this._setCalenderDefsPosition(r,R,p);e.appendChild(a);o.setAttribute("y",n)}else{o.setAttribute("y",0)}e.appendChild(o);e.appendChild(r);var l=document.createElement("div");var g=this._oDomToPrint[u].getElementsByTagName("section")[0].cloneNode(true);l.appendChild(g);if(u===0){var c=this._oDomToPrint[u].getElementsByClassName("sapUiLoSplitterBar")[0].cloneNode(true);c.setAttribute("style","color: #346187;background-color: #c9d8e7;width: 1rem;display: inline-block; height: "+this._iGanttHeight+"px");c.style.transform="translate("+p+"px, -"+this._oDomToPrint[u].style.height+")";l.appendChild(c)}d.html(l,{callback:function(i){U(e,i,{xOffset:(p+16)*R+h,yOffset:D,scale:R});u++;if(u>=t._oDomToPrint.length){t.oSinglePagePdf=i;t._updatePdfPreview(i.output("bloburl"))}else{D=D+Number(t._oDomToPrint[u-1].style.height.slice(0,-2))*R;_.call(t)}},html2canvas:{scale:R,allowTaint:true},x:h,y:D})}var u=0;var c=0;var f=this._oDomToPrintHeight*2;var C=this._oDomToPrintWidth*2;d.setFontSize(6.5);var P=d.getTextWidth("...")*nt;var m=i-rt(4)-P;var v,y,T,b;var x=a.getConfiguration().getRTL();var w=x?"right":"left";if(this._oModel.getProperty("/showHeaderText")){v=this._oModel.getProperty("/headerText");c=c+this._iHeaderAndFooterHeight;var G=d.getTextWidth(v)*nt;if(G>i-rt(4)){T=q.geNumberOfTruncatedCharacters(G,m,v,d,d.getTextWidth,false,nt);if(x){b=v.length-T;v="..."+v.slice(b,v.length).trim()}else{v=v.slice(0,T).trim()+"..."}}d.text(v,this._getFXTextPosition(),this._iHeaderAndFooterHeight/(2*nt),w)}if(this._oModel.getProperty("/showFooterText")){y=this._oModel.getProperty("/footerText");c=c+this._iHeaderAndFooterHeight;var S=d.getTextWidth(y)*nt;if(S>i-rt(4)){T=q.geNumberOfTruncatedCharacters(S,m,y,d,d.getTextWidth,false,nt);if(x){b=y.length-T;y="..."+y.slice(b,y.length).trim()}else{y=y.slice(0,T).trim()+"..."}}d.text(y,this._getFXTextPosition(),d.getPageHeight()-this._iHeaderAndFooterHeight/(2*nt)-(this._isFooterMultiline()?this._iHeaderAndFooterHeight/nt:0),w)}this._mHeaderFooterInfo={oPdf:d,headerText:v,footerText:y,position:this._getFXTextPosition()};var M=this._isDomShrinkableToOnePageByWidth(f,C);var R=M?(i-r-h)/C:(n-o-s-c)/f;var D=o+t._getHeaderHeight();if(this.sFont){d.addFileToVFS("SAP-icons.ttf",this.sFont);d.addFont("SAP-icons.ttf","SAP-icons","normal");d.setFont("SAP-icons");d.setFontSize(9);_.call(this)}else{var N=a.getConfiguration().getTheme(),E="base";if(N.indexOf("sap_horizon")>-1){E=N}var B=sap.ui.require.toUrl("sap/ui/core/themes/"+E+"/fonts/SAP-icons.ttf");this._fetchFontAndGeneratePdf(B,d,_)}};Z.prototype._fetchFontAndGeneratePdf=function(t,e,i){var a=this;fetch(t).then(function(t){return t.blob()}).then(function(t){var n=new FileReader;n.onload=function(){if(n.readyState===n.DONE){a.sFont=n.result;e.addFileToVFS("SAP-icons.ttf",a.sFont);e.addFont("SAP-icons.ttf","SAP-icons","normal");e.setFont("SAP-icons");e.setFontSize(9);i.call(a)}};n.readAsBinaryString(t)}).catch(function(t){})};Z.prototype._setLinesHeight=function(t){var e=this;if(t.getElementsByClassName("sapGanttNowLineBodySvgLine").length){t.getElementsByClassName("sapGanttNowLineBodySvgLine")[0].getElementsByTagName("line")[0].setAttribute("y2",this._oDomToPrintHeight)}if(t.getElementsByClassName("sapGanttChartAdhocLine").length){Array.prototype.slice.call(t.getElementsByClassName("sapGanttChartAdhocLine")[0].getElementsByTagName("line")).forEach(function(t){t.setAttribute("y2",e._oDomToPrintHeight)})}if(t.getElementsByClassName("sapGanttChartDeltaLine").length){Array.prototype.slice.call(t.getElementsByClassName("sapGanttChartDeltaLine")[0].getElementsByTagName("line")).forEach(function(t){t.setAttribute("y2",e._oDomToPrintHeight)})}if(t.getElementsByClassName("sapGanttChartAreaDeltaLine").length){Array.prototype.slice.call(t.getElementsByClassName("sapGanttChartAreaDeltaLine")[0].getElementsByTagName("rect")).forEach(function(t){t.setAttribute("height",e._oDomToPrintHeight)})}};Z.prototype._setCalenderDefsPosition=function(t,e,i){var a=this._oModel.getProperty("/marginRight"),n=this._oModel.getProperty("/marginLeft");Array.prototype.slice.call(t.getElementsByTagName("rect")).forEach(function(t){t.setAttribute("x",(Number(t.getAttribute("x"))+i)*e+(a+n)+32);t.setAttribute("width",Number(t.getAttribute("width"))*e)})};Z.prototype._savePdf=function(){if(!this._validateFields()){return}var t=this._oModel.getProperty("/portrait")?"p":"l",e=this._oModel.getProperty("/paperWidth"),i=this._oModel.getProperty("/paperHeight"),a=this._oModel.getProperty("/exportAsJPEG"),n=this._oModel.getProperty("/compressionQuality")/100,o=this._oModel.getProperty("/paperSize");var r=new W({orientation:t,unit:"px",format:o==="Custom"?[e*ot,i*ot]:o.toLowerCase()});var s=this._pageToBeExported();for(var h=0;h<s.length;h++){var l=this._getCanvasOfPageN(s[h],true);if(!l){continue}if(h!==0){r.addPage()}if(a){r.addImage(l.toDataURL("image/jpeg",n),"JPEG",0,0)}else{r.addImage(l.toDataURL("image/png"),"PNG",0,0)}}var g=new Date;r.save("GanttChartExport-"+g.toISOString()+".pdf")};Z.prototype._generateVerticalLines=function(t){var e=Number(this._oDomToPrint[0].style.width.slice(0,-2)),i=t.getAxisTime();var a="";if(i){var n=i.getZoomStrategy();var o=i.getTickTimeIntervalLabel(n.getTimeLineOption(),null,[0,e]);var r=o[1];for(var s=0;s<r.length;s++){a+=" M"+" "+(r[s].value-1/2)+" 0"+" v "+this._oDomToPrintHeight}}return a};Z.prototype._createPaperComboBox=function(t){this._oComboBoxPaperSizes=new f({selectedKey:"{setting>/paperSize}",change:this._updatePaperSizeValues.bind(this,t),items:[new B({key:"A5",text:"A5"}),new B({key:"A4",text:"A4"}),new B({key:"A3",text:"A3"}),new B({key:"A2",text:"A2"}),new B({key:"A1",text:"A1"}),new B({key:"A0",text:"A0"}),new B({key:"Letter",text:"Letter"}),new B({key:"Legal",text:"Legal"}),new B({key:"Tabloid",text:"Tabloid"}),new B({key:"Custom",text:"Custom"})]});return this._oComboBoxPaperSizes};Z.prototype._createPaperSizeFields=function(t){this._oInputPaperWidth=new p({width:"20%",type:"Number",change:this._onChangePaperSizeInput.bind(this,t)});this._oInputPaperHeight=new p({width:"20%",type:"Number",change:this._onChangePaperSizeInput.bind(this,t)});this._updatePaperSizeInputs();return new d({renderType:"Bare",alignItems:"Center",justifyContent:"SpaceBetween",items:[this._oInputPaperWidth,new r({text:"×"}),this._oInputPaperHeight,this._oComboBoxUnit=new f({width:"50%",selectedKey:"{setting>/unit}",change:this._onChangeUnitComboBox.bind(this),items:[new B({key:"mm",text:this._oRb.getText("GNT_PRNTG_MILLIMETERS")}),new B({key:"cm",text:this._oRb.getText("GNT_PRNTG_CENTIMETERS")}),new B({key:"in",text:this._oRb.getText("GNT_PRNTG_INCHES")})]})]})};Z.prototype._createDurationComboBox=function(t){var e=this._getOriginalGanttChart().getAxisTimeStrategy(),i=e.getTotalHorizon(),a=new Date(R.abapTimestampToDate(i.getEndTime())),n=new Date;this._oComboBoxDuration=new f({selectedKey:"{setting>/duration}",change:this._onChangeDurationComboBox.bind(this,t),items:[new B({key:"all",text:this._oRb.getText("GNT_PRNTG_DURATION_ALL")}),new B({key:"week",enabled:this._getFirstDayOfNextWeek(n).getTime()<a.getTime(),text:this._oRb.getText("GNT_PRNTG_DURATION_NEXT_WEEK")}),new B({key:"month",enabled:this._getFirstDayOfNextMonth(n).getTime()<a.getTime(),text:this._oRb.getText("GNT_PRNTG_DURATION_NEXT_MONTH")}),new B({key:"custom",text:this._oRb.getText("GNT_PRNTG_DURATION_CUSTOM")})]});return this._oComboBoxDuration};Z.prototype._createDatePicker=function(t){var e=this._getOriginalGanttChart().getAxisTimeStrategy();var i=e.getTotalHorizon();var a=new Date(R.abapTimestampToDate(i.getStartTime()));var n=new Date(R.abapTimestampToDate(i.getEndTime()));this._oModel.setProperty("/startDate",a);this._oModel.setProperty("/endDate",n);this._oDatePickerFrom=new b({width:"47%",minDate:a,maxDate:n,dateValue:"{setting>/startDate}",change:this._onChangeDurationDatePicker.bind(this,t),enabled:true});this._oDatePickerTo=new b({width:"47%",minDate:a,maxDate:n,dateValue:"{setting>/endDate}",change:this._onChangeDurationDatePicker.bind(this,t),enabled:true});return new d({renderType:"Bare",alignItems:"Center",justifyContent:"SpaceBetween",items:[this._oDatePickerFrom,new r({text:"~"}),this._oDatePickerTo]})};Z.prototype._createScale=function(){return new v({min:50,max:200,step:1,width:"25rem",value:"{setting>/scale}",visible:"{setting>/multiplePage}",liveChange:this._updateDialogPreview.bind(this),showAdvancedTooltip:true,inputsAsTooltips:true})};Z.prototype._validateExportRangeInput=function(){if(this._oModel.getProperty("/exportAll")){return true}var t=this._oModel.getProperty("/exportRange").replace(/\s/g,"");if(/^((\d+),|(\d+-\d+),)*((\d+)|(\d+-\d+))+$/.test(t)){this._oInputRange.setValueState("None");return true}this._oInputRange.setValueState("Error");this._oInputRange.setValueStateText(this._oRb.getText("GNT_PRNTG_PAGE_RANGE_ERROR"));return false};Z.prototype._createPageRange=function(){var t=function(t){var e=t.getSource().getSelectedIndex();if(e===0){this._oButtonExport.setEnabled(true);this._oInputRange.setValueState("None")}};return new d({renderType:"Bare",alignItems:"Center",visible:"{setting>/multiplePage}",justifyContent:"SpaceBetween",items:[new P({layoutData:new u({shrinkFactor:0,growFactor:1}),selectedIndex:this._oModel.getProperty("/exportAll")?0:1,columns:2,select:t.bind(this),buttons:[new C({id:"all",text:this._oRb.getText("GNT_PRNTG_PAGE_RANGE_ALL"),selected:"{setting>/exportAll}"}),new C({id:"range",text:this._oRb.getText("GNT_PRNTG_PAGE_RANGE_RANGE")+" "})]}),this._oInputRange=new p({layoutData:new u({growFactor:1}),value:"{setting>/exportRange}",change:this._validateExportRangeInput.bind(this),enabled:{path:"setting>/exportAll",formatter:function(t){return!t}}}).addStyleClass("sapGanttPrintingPageRangeInput")]})};Z.prototype._createLabelWithSwitch=function(t,e){return new d({renderType:"Bare",visible:"{setting>/multiplePage}",alignItems:"Center",items:[new o({text:t}),new G({state:e,change:this._updateDialogPreview.bind(this)}).addStyleClass("sapGanttPrintingSwitchPadding")]})};Z.prototype._createCheckBoxWithInput=function(t,e,i,a){var n=a?this._generateSvgToPdf:this._updateDialogPreview;var o=this._onLiveChange.bind(this);var r=new p({width:"65%",value:i,enabled:e,valueLiveUpdate:true,valueStateText:this._oRb.getText("GNT_PRNTG_HEADER_FOOTER_TEXT_ERROR"),liveChange:function(){o(a,r,false)}});r.onsapfocusleave=function(){o(a,r,true)};return new d({renderType:"Bare",alignItems:"Start",justifyContent:"SpaceBetween",items:[new m({selected:e,text:t,select:n.bind(this)}),r]})};Z.prototype._onLiveChange=function(t,e,i){if(e.getValue().length>at){e.setValue(e.getValue().slice(0,at));e.setValueState("Error")}else{e.setValueState("None")}if(i){if(t){this._generateSvgToPdf()}else{this._updateDialogPreview()}}return};Z.prototype._createPanel=function(t,e){return new S({expandable:true,expanded:false,headerText:t,content:[new d({renderType:"Bare",direction:Q.Column,items:[e]})]})};Z.prototype._createCompressionSlider=function(){return new v({min:1,max:100,step:1,change:this._onChangeCompressionSlider.bind(this),value:{path:"setting>/compressionQuality",type:"sap.ui.model.type.Integer"},visible:"{setting>/exportAsJPEG}",showAdvancedTooltip:true,inputsAsTooltips:true})};Z.prototype._createCompressionComboBox=function(){this._oComboBoxCompression=new f({visible:"{setting>/exportAsJPEG}",change:this._onChangeCompressionComboBox.bind(this),items:[new B({key:"maximum",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_MAXIMUM")}),new B({key:"high",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_HIGH")}),new B({key:"medium",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_MEDIUM")}),new B({key:"low",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_LOW")})]});var t=this._oModel.getProperty("/compressionQuality");this._setCompressionComboBoxItem(t);return this._oComboBoxCompression};Z.prototype._updateInputsStep=function(t){var e=.1;if(t==="mm"){e=1}return e};Z.prototype._createMargin=function(t){function e(t){return Math.round(this._convertPxToUnit(t/3))}return[new o({text:this._oRb.getText("GNT_PRNTG_MARGIN")+":"}),new f({change:this._onChangeMarginComboBox.bind(this,t),selectedKey:"{setting>/marginType}",items:[new B({key:"default",text:this._oRb.getText("GNT_PRNTG_MARGIN_DEFAULT")}),new B({key:"none",text:this._oRb.getText("GNT_PRNTG_MARGIN_NONE")}),new B({key:"custom",text:this._oRb.getText("GNT_PRNTG_MARGIN_CUSTOM")})]}),new d({renderType:"Bare",alignItems:"Center",visible:{path:"setting>/marginType",formatter:function(t){return t==="custom"}},items:[new d({direction:Q.Column,layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new o({text:this._oRb.getText("GNT_PRNTG_MARGIN_TOP")}),this._oInputMarginTop=new T({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this,t),value:this._convertPxToUnit(this._oModel.getProperty("/marginTop")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_HEIGHT_ERROR"),max:{parts:[{path:"setting>/paperHeight"},{path:"setting>/unit"}],formatter:e.bind(this)},description:"{setting>/unit}"}).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_MARGIN_LEFT")}),this._oInputMarginLeft=new T({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this,t),value:this._convertPxToUnit(this._oModel.getProperty("/marginLeft")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_WIDTH_ERROR"),max:{parts:[{path:"setting>/paperWidth"},{path:"setting>/unit"}],formatter:e.bind(this)},description:"{setting>/unit}"})]}),new d({direction:Q.Column,layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new o({text:this._oRb.getText("GNT_PRNTG_MARGIN_BOTTOM")}),this._oInputMarginBottom=new T({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this,t),value:this._convertPxToUnit(this._oModel.getProperty("/marginBottom")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_HEIGHT_ERROR"),max:{parts:[{path:"setting>/paperHeight"},{path:"setting>/unit"}],formatter:e.bind(this)},description:"{setting>/unit}"}).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_MARGIN_RIGHT")}),this._oInputMarginRight=new T({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this,t),value:this._convertPxToUnit(this._oModel.getProperty("/marginRight")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_WIDTH_ERROR"),max:{parts:[{path:"setting>/paperWidth"},{path:"setting>/unit"}],formatter:e.bind(this)},description:"{setting>/unit}"})]}).addStyleClass("sapGanttPrintingLeftMargin"),new g({icon:{path:"setting>/marginLocked",formatter:function(t){if(t){return"sap-icon://chain-link"}return"sap-icon://broken-link"}},press:function(){var t=this._oModel.getProperty("/marginLocked");this._oModel.setProperty("/marginLocked",!t)}.bind(this),type:"Transparent"}).addStyleClass("sapGanttPrintingLockButton sapGanttPrintingLeftMargin")]}).addStyleClass("sapGanttPrintingTopMargin sapGanttPrintingTopMargin")]};Z.prototype._createCropMarks=function(){return[new G({state:"{setting>/cropMarks}"}),new d({renderType:"Bare",visible:"{setting>/cropMarks}",items:[new d({direction:Q.Column,layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new o({text:"Weight:"}),new T({min:0,step:.05,displayValuePrecision:2,value:"{setting>/cropMarksWeight}",fieldWidth:"7rem",description:"pt"})]}),new d({direction:Q.Column,layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new o({text:"Offset:"}),this._oInputCropMarksOffset=new T({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeCropMarksInput.bind(this),value:this._convertPxToUnit(this._oModel.getProperty("/cropMarksOffset")),fieldWidth:"7rem",description:"{setting>/unit}"})]}).addStyleClass("sapGanttPrintingLeftMargin")]}).addStyleClass("sapGanttPrintingTopMargin")]};Z.prototype._createCompression=function(){var t=this._oModel.getProperty("/exportAsJPEG");return[new o({text:this._oRb.getText("GNT_PRNTG_EXPORT_TYPES")}),new P({columns:2,selectedIndex:t?0:1,buttons:[new C({id:"jpeg",text:"JPEG",selected:"{setting>/exportAsJPEG}"}),new C({id:"png",text:"PNG"})]}).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_COMPRESSION_QUALITY"),visible:"{setting>/exportAsJPEG}"}),this._createCompressionComboBox(),this._createCompressionSlider().addStyleClass("sapGanttPrintingTopMargin sapGanttPrintingBottomMargin"),new w({text:this._oRb.getText("GNT_PRNTG_COMPRESSION_PNG_WARNING"),showIcon:true,type:"Warning",visible:{path:"setting>/exportAsJPEG",type:"sap.ui.model.type.Boolean",formatter:function(t){return!t}}}).addStyleClass("sapGanttPrintingBottomMargin")]};Z.prototype._createOptionsForm=function(){return new d({renderType:"Bare",direction:Q.Column,items:[new o({text:this._oRb.getText("GNT_PRNTG_EXPORT_TYPES")}),this._radioGroupPage=new P({columns:2,selectedIndex:this._oModel.getProperty("/multiplePage")?0:1,select:this._onChangeExportTypes.bind(this),buttons:[new C({id:"Multiple",text:this._oRb.getText("GNT_PRNTG_MULTIPLE_PAGE"),selected:"{setting>/multiplePage}"}),new C({id:"Single",text:this._oRb.getText("GNT_PRNTG_SINGLE_PAGE")})]}).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_ORIENTATION")}),this._radioGroupOrientation=new P({columns:2,selectedIndex:this._oModel.getProperty("/portrait")?0:1,select:this._onChangeOrientation.bind(this,false),buttons:[new C({id:"Portrait",text:this._oRb.getText("GNT_PRNTG_PORTRAIT"),selected:"{setting>/portrait}"}),new C({id:"Landscape",text:this._oRb.getText("GNT_PRNTG_LANDSCAPE")})]}).addStyleClass("sapGanttPrintingBottomMargin"),new w({text:"{setting>/orientationMessage}",type:"Information",showIcon:true,visible:"{setting>/showOrientationMessage}"}).addStyleClass("sapGanttPrintingSinglePageMessage"),new o({text:this._oRb.getText("GNT_PRNTG_PAPER_SIZE")}),this._createPaperComboBox(false),this._createPaperSizeFields(false).addStyleClass("sapGanttPrintingBottomMargin"),new w({text:this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_QUALITY"),type:"Information",showIcon:true,visible:"{setting>/qualityWarning}"}).addStyleClass("sapGanttPrintingSinglePageMessage"),new o({text:this._oRb.getText("GNT_PRNTG_DURATION")}),this._createDurationComboBox(false),this._createDatePicker(false).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_SCALE"),visible:"{setting>/multiplePage}"}),this._createScale().addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_PAGE_RANGE"),visible:"{setting>/multiplePage}"}),this._createPageRange().addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_HEADER_AND_FOOTER")}),this._createCheckBoxWithInput(this._oRb.getText("GNT_PRNTG_HEADER"),"{setting>/showHeaderText}","{setting>/headerText}"),this._createCheckBoxWithInput(this._oRb.getText("GNT_PRNTG_FOOTER"),"{setting>/showFooterText}","{setting>/footerText}").addStyleClass("sapGanttPrintingBottomMargin"),this._createLabelWithSwitch(this._oRb.getText("GNT_PRNTG_SHOW_PAGE_NUMBER"),"{setting>/showPageNumber}").addStyleClass("sapGanttPrintingBottomMargin"),this._createPanel(this._oRb.getText("GNT_PRNTG_MARGIN"),this._createMargin(false)),this._createPanel(this._oRb.getText("GNT_PRNTG_COMPRESSION"),this._createCompression())]})};Z.prototype._createSinglePageForm=function(){return new d({renderType:"Bare",direction:Q.Column,items:[new o({text:this._oRb.getText("GNT_PRNTG_ORIENTATION")}),this._radioGroupOrientation=new P({columns:2,selectedIndex:this._oModel.getProperty("/portrait")?0:1,select:this._onChangeOrientation.bind(this,true),buttons:[new C({id:"Portrait",text:this._oRb.getText("GNT_PRNTG_PORTRAIT"),selected:"{setting>/portrait}"}),new C({id:"Landscape",text:this._oRb.getText("GNT_PRNTG_LANDSCAPE")})]}).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_PAPER_SIZE")}),this._createPaperComboBox(true),this._createPaperSizeFields(true).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_DURATION")}),this._createDurationComboBox(true),this._createDatePicker(true).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_HEADER_AND_FOOTER")}),this._createCheckBoxWithInput(this._oRb.getText("GNT_PRNTG_HEADER"),"{setting>/showHeaderText}","{setting>/headerText}",true),this._createCheckBoxWithInput(this._oRb.getText("GNT_PRNTG_FOOTER"),"{setting>/showFooterText}","{setting>/footerText}",true).addStyleClass("sapGanttPrintingBottomMargin"),this._createPanel(this._oRb.getText("GNT_PRNTG_MARGIN"),this._createMargin(true))]})};Z.prototype._createDialogContent=function(t){var e;if(t){e=new d({renderType:"Bare",fitContainer:true,items:[this._oFlexBoxPreview=new d({renderType:"Bare",layoutData:new u({shrinkFactor:1,growFactor:1,baseSize:"auto"}),direction:Q.Column,items:[new d({renderType:"Bare",layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"3.5rem"})}),this._oPdfDialogPreview=new I({content:'<div class="sapGanttPdfPreviewContentDiv"><div id="sapGanttPdfPreviewDiv"class="sapGanttPdfPreviewPageDiv"></div></div>'})]}).addStyleClass("sapGanttPrintingPreviewContent"),new c({horizontal:false,vertical:true,layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"27rem"}),content:[this._createSinglePageForm().addStyleClass("sapGanttPrintingDialogSettings")]})]})}else{e=new d({renderType:"Bare",fitContainer:true,items:[this._oFlexBoxPreview=new d({renderType:"Bare",layoutData:new u({shrinkFactor:1,growFactor:1,baseSize:"auto"}),direction:Q.Column,items:[new d({renderType:"Bare",layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"3.5rem"})}),this._oHTMLDialogPreview=new I({content:'<div class="sapGanttPrintingPreviewContentDiv"><div class="sapGanttPrintingPreviewPageDiv"></div></div>'}),new d({renderType:"Bare",justifyContent:"Center",alignItems:"Center",layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"6rem"}),items:[this._oButtonFirst=new g({icon:"sap-icon://close-command-field",visible:"{setting>/multiplePage}",press:this._onPressButtonFirst.bind(this),type:"Transparent"}).addStyleClass("sapGanttPrintingPreviewIconMarginRight"),this._oButtonPrevious=new g({icon:"sap-icon://navigation-left-arrow",visible:"{setting>/multiplePage}",press:this._onPressButtonPrevious.bind(this),type:"Transparent"}),new r({textAlign:"Center",visible:"{setting>/multiplePage}",width:"7.25rem",text:{parts:[{path:"setting>/previewPageNumber"},{path:"setting>/lastPageNumber"}],formatter:function(t,e){return e?this._oRb.getText("GNT_PRNTG_OF",[t,e]):t.toString()}.bind(this)}}).addStyleClass("sapGanttPrintingPreviewText"),this._oButtonNext=new g({icon:"sap-icon://navigation-right-arrow",visible:"{setting>/multiplePage}",press:this._onPressButtonNext.bind(this),type:"Transparent"}).addStyleClass("sapGanttPrintingPreviewIconMarginRight"),this._oButtonLast=new g({icon:"sap-icon://open-command-field",visible:"{setting>/multiplePage}",press:this._onPressButtonLast.bind(this),type:"Transparent"})]}).addStyleClass("sapGanttPrintingPreviewFooter")]}).addStyleClass("sapGanttPrintingPreviewContent"),new c({horizontal:false,vertical:true,layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"27rem"}),content:[this._createOptionsForm().addStyleClass("sapGanttPrintingDialogSettings")]})]});this._updatePageNumberButtons()}return e};Z.prototype._createAndOpenDialog=function(t){var e=t?this.exportSinglePage:this.export;this._oDialog=new h({title:this._oRb.getText("GNT_PRNTG_PDF_EXPORT_TITLE"),contentWidth:"100%",contentHeight:"100%",horizontalScrolling:false,verticalScrolling:false,content:[this._createDialogContent(t)],buttons:[this._oButtonExport=new g({text:this._oRb.getText("GNT_PRNTG_EXPORT"),type:_.ButtonType.Emphasized,press:e.bind(this)}),this._oButtonClose=new g({text:this._oRb.getText("GNT_PRNTG_CANCEL"),press:function(){this.close()}.bind(this)})]}).addStyleClass("sapGanttPrintingDialog");this._oDialog.onsapescape=function(t){this.close();t.preventDefault();t.stopPropagation()}.bind(this);this._oDialog.setModel(this._oModel,"setting");this._oDialog.open();this._sResizeHandlerId=V.register(this._oDialog,this._onResize.bind(this))};Z.prototype._openProgressDialog=function(){this._oProgressIndicator=new l({state:"Information",percentValue:0});this._oProgressText=new r({text:this._oRb.getText("GNT_PRNTG_PDF_PREVIEW"),textAlign:"Center"}).addStyleClass("sapGanttPrintingProgressText");this._oProgressIndicatorBox=new d(this.getId()+"-progressFlexBox",{direction:"Column",alignItems:"Center",items:[this._oProgressText,this._oProgressIndicator],renderType:"Bare"}).addStyleClass("sapGanttPrintingProgressBox");this._oProgressDialog=new h(this.getId()+"-progressDialog",{contentWidth:"25%",showHeader:false,content:[this._oProgressIndicatorBox],buttons:[new g({text:this._oRb.getText("GNT_PRNTG_CANCEL"),press:function(){this._closeProgressIndicator()}.bind(this)})]});this._oProgressDialog.open()};return Z});
//# sourceMappingURL=GanttPrinting.js.map