/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/core/Core","sap/ui/Device","./RenderUtils","../misc/Utility","sap/gantt/misc/Format","sap/ui/core/theming/Parameters","./BaseRectangle","./AdhocLineRenderer","./GanttUtils","./DeltaLineRenderer","./BaseLine","sap/gantt/simple/GanttExtension"],function(e,t,a,r,i,n,o,l,g,s,h,d,p){"use strict";var f=e.extend("sap.gantt.simple.GanttHeader",{metadata:{library:"sap.gantt",properties:{iHeaderMinheight:{type:"int",defaultValue:33},_iHeaderHeight:{type:"int",defaultValue:0},_iHeaderHeightInitial:{type:"int",defaultValue:0}},aggregations:{_overflowToolbar:{type:"sap.m.Toolbar",multiple:false}},renderer:{apiVersion:2}}});f.prototype._setIHeaderHeight=function(e){this.setProperty("_iHeaderHeight",Math.floor(e),true)};f.prototype._getIHeaderHeight=function(){return this.getProperty("_iHeaderHeight")};f.prototype._setIHeaderHeightInitial=function(e){this.setProperty("_iHeaderHeightInitial",Math.floor(e),true)};f.prototype._getIHeaderHeightInitial=function(){return this.getProperty("_iHeaderHeightInitial")};var v=0;f.prototype.renderElement=function(){performance.mark("GanttHeader.renderElement--start");var e=t.createRenderManager(),a=this.getParent(),i;if(!a.getShowGanttHeader()){return}var d=a.getId();var f=jQuery("div.sapGanttChartWithTableHeader[data-sap-ui-related="+d.replace(/([:.\[\],=@])/g,"\\$1")+"]");var H=this.getParent().getTable(),c=H.getAggregation("extension");i=c.filter(function(e){if(e instanceof sap.m.OverflowToolbar){return e}});this.iOverflowToolbarHeight=0;if(a.getEnableChartOverflowToolbar()){this.renderOverflowToolbar(e,a);var u=t.byId(d+"-ganttHeaderOverflowToolbar").getDomRef();if(i[0]){var b=t.byId(i[0].sId).getDomRef();if(b){this.iOverflowToolbarHeight=b.clientHeight}}else if(u){this.iOverflowToolbarHeight=u.clientHeight}}if(f&&f.length>0){v=f[0].offsetHeight;if(this.iOverflowToolbarHeight&&a.getEnableChartOverflowToolbar()){v-=this.iOverflowToolbarHeight}}this._setIHeaderHeight(v);var m=r.getGanttRenderWidth(a);var T=0;var w=a.getSimpleAdhocLines().filter(function(e){return e.MarkerType!=sap.gantt.simple.MarkerType.None});var L=a.getDeltaLines().filter(function(e){return e.getVisible()});var y,E,I;y=this._getIHeaderHeight()/4;E=this._getIHeaderHeight()/5*2;I=this._getIHeaderHeight()/5*4;if(w.length>0&&a.getEnableAdhocLine()===true||L.length>0&&a.getEnableDeltaLine()===true){L=L.filter(function(e){return e.getVisible()});w=w.filter(function(e){return e});var S=0;var _=0;var O;if(w.length>0&&a.getEnableAdhocLine()===true&&(L.length>0&&a.getEnableDeltaLine()===true)){O=s.calculateLevelForShapes(L.concat(w),"timeStamp","endTimeStamp",true);_=Math.max.apply(Math,O.adhocLines.map(function(e){return e.mProperties._level}));S=Math.max.apply(Math,O.deltaLines.map(function(e){return e.mProperties._level}));if(_>=S){T=S*4+(_-S)*8+S*3+3}else{T=S*4+S*3}}else if(w.length>0&&a.getEnableAdhocLine()===true){O=s.calculateLevelForShapes(w,"timeStamp","endTimeStamp",true);_=Math.max.apply(Math,O.adhocLines.map(function(e){return e.mProperties._level}));T=_*8}else if(L.length>0&&a.getEnableDeltaLine()===true){O=s.calculateLevelForShapes(L,"timeStamp","endTimeStamp",true);S=Math.max.apply(Math,O.deltaLines.map(function(e){return e.mProperties._level}));T=S*4+(S+1)*3}if(this.iOverflowToolbarHeight&&!!i[0]&&a.getEnableChartOverflowToolbar()){a.getTable().setColumnHeaderHeight(this.getIHeaderMinheight()+T)}else if(this.iOverflowToolbarHeight&&(!i[0]||a.getEnableChartOverflowToolbar())){a.getTable().setColumnHeaderHeight(this.getIHeaderMinheight()+T+this.iOverflowToolbarHeight)}else{a.getTable().setColumnHeaderHeight(this.getIHeaderMinheight()+T)}y=(this._getIHeaderHeight()-T)/4;E=(this._getIHeaderHeight()-T)/5*2;I=(this._getIHeaderHeight()-T)/5*4}else{if(this.iOverflowToolbarHeight&&!!i[0]&&a.getEnableChartOverflowToolbar()){a.getTable().setColumnHeaderHeight(this.getIHeaderMinheight())}else if(this.iOverflowToolbarHeight&&(!i[0]||a.getEnableChartOverflowToolbar())){a.getTable().setColumnHeaderHeight(this.getIHeaderMinheight()+this.iOverflowToolbarHeight)}else{a.getTable().setColumnHeaderHeight(this.getIHeaderMinheight())}}var M=a.getAxisTimeStrategy(),x=M.getTimeLineOption(),C=a.getAxisTime();var A=C.getTickTimeIntervalLabel(x,null,[0,m]);e.openStart("svg",d+"-header-svg");e.class("sapGanttChartHeaderSvg");e.attr("height",this._getIHeaderHeight()+"px");e.attr("width",m);if(this.iOverflowToolbarHeight&&a.getEnableChartOverflowToolbar()){e.style("transform","translate(0,"+this.iOverflowToolbarHeight+"px)")}e.openEnd();e.openStart("rect");e.attr("height","100%");e.attr("width","100%");e.attr("fill","transparent");e.openEnd();e.close("rect");e.openStart("g").openEnd();this.renderHeaderLabel(e,A[0],{y:E,className:"sapGanttTimeHeaderSvgText"});this.renderHeaderLabel(e,A[1],{y:I,className:"sapGanttTimeHeaderSvgTextMedium"});if(C.largeIntervalLabel&&!C.largeIntervalPath){for(var G=0;G<A[0].length;G++){if(A[0][G].value===C.firstTickPosition){A[0].splice(G,1);break}}}this.renderIntervalLine(e,A[0],{start:0,end:y,className:"sapGanttTimeHeaderLargeIntervalSvgPath"});this.renderIntervalLine(e,A[1],{start:I,end:this._getIHeaderHeight(),className:"sapGanttTimeHeaderSvgPath"});e.close("g");if(a.getEnableAdhocLine()===true&&w.length>0||a.getEnableDeltaLine()===true&&L.length>0){e.openStart("svg","inner-header-svg").openEnd();e.openStart("g","inner-header-g");e.style("height",T);e.openEnd();var N=new l({x:0,y:this._getIHeaderHeight()-T,height:"1px",width:"100%",fill:o.get("sapUiListVerticalBorderColor")});var P=this;N.renderElement(e,N);var D=a.getRenderedTimeRange(),k=D[0],R=D[1];w=w.filter(function(e){var t=n.abapTimestampToDate(e.getTimeStamp());return t>=k&&t<=R&&e.getVisible()&&e.getMarkerType()===sap.gantt.simple.MarkerType.Diamond});if(w.length>0){w.forEach(function(t){g.renderMarker(e,t,a,P._getIHeaderHeight(),T)})}if(L.length!==0){L.forEach(function(t){h.renderDeltaLineHeader(e,t,a,P._getIHeaderHeight(),T)})}e.close("g");e.close("svg")}var V=C.getNowLabel(a.getNowLineInUTC())[0].value;this.renderNowLineHeader(e,a,{headerHeight:this._getIHeaderHeight(),nowLineX:V,iMarkerArea:T});e.openStart("g");e.class("sapGanttChartHeaderSelection");e.openEnd().close("g");e.close("svg");e.flush(f.get(0));e.destroy();p.attachEvents(a);performance.mark("GanttHeader.renderElement--end")};f.prototype.renderHeaderLabel=function(e,r,n){var o=t.getConfiguration().getRTL();var l=a.browser.edge&&o;r.forEach(function(t){e.openStart("text");e.class(n.className);e.attr("text-anchor","start");e.attr("x",t.value+(o?-5:5));e.attr("y",n.y);if(l){var a=i.calculateStringLength(t.label)*(n.fontSize/2);e.attr("transform","translate("+-a+")")}e.openEnd();e.text(t.label);if(n.className==="sapGanttTimeHeaderSvgTextMedium"&&t.largeLabel){e.openStart("title").openEnd();e.text(t.largeLabel);e.close("title")}e.close("text")})};f.prototype.renderIntervalLine=function(e,t,a){var r="";for(var i=0;i<t.length;i++){var n=t[i];if(n){r+=" M"+" "+(n.value-1/2)+" "+a.start+" L"+" "+(n.value-1/2)+" "+a.end}}e.openStart("path");e.attr("d",r);e.class(a.className);e.openEnd();e.close("path")};f.prototype.renderNowLineHeader=function(e,t,a){var r=t.getAdhocLines();var i=t.getDeltaLines();var n=a.headerHeight;var o=a.iMarkerArea;var l=n;if(t.getEnableAdhocLine()===true&&r.length>0||t.getEnableDeltaLine()===true&&i.length>0){l=n-o}var g=l,s=a.nowLineX;if(t.getEnableNowLine()===false||isNaN(s)){return}var h=8;var p=h/2,f=Math.sqrt(h*h-p*p);var v=[[s,g],[s-p,g-f],[s+p,g-f],[s,g]].reduce(function(e,t,a){var r=t.join(",");return a===0?"M"+r:e+"L"+r},"");e.openStart("g");e.class("sapGanttNowLineHeaderSvgPath");e.openEnd();e.openStart("path");e.attr("d",v);e.openEnd();e.close("path");e.close("g");if(t.getEnableAdhocLine()===true&&r.length>0||t.getEnableDeltaLine()===true&&i.length>0){e.openStart("g");e.class("sapGanttNowLineBodySvgLine");e.openEnd();var H=new d({x1:s,y1:l,x2:s,y2:"100%",strokeWidth:1}).setProperty("childElement",true);H.renderElement(e,H);e.close("g")}};f.prototype.renderOverflowToolbar=function(e,t){var a=t.getId();if(!this._oOverflowToolbar){this.setAggregation("_overflowToolbar",new sap.m.OverflowToolbar(a+"-ganttHeaderOverflowToolbar",{design:"Solid"}).addStyleClass("sapGanttHeaderOverflowToolbar"));this.getAggregation("_overflowToolbar").addContent(new sap.m.ToolbarSpacer);this._oOverflowToolbar=true}var r=t.getOverflowToolbarItems();if(r.length>0){r.forEach(function(e){this.getAggregation("_overflowToolbar").addContent(e)}.bind(this))}this.getAggregation("_overflowToolbar").setWidth("100%");e.openStart("div",a+"-ganttHeaderOverflowToolbarContainer");e.style("width","100%");e.style("position","absolute");e.openEnd();e.renderControl(this.getAggregation("_overflowToolbar"));e.close("div")};f.prototype.exit=function(){if(this._oOverflowToolbar){this._oOverflowToolbar=false}};return f},true);
//# sourceMappingURL=GanttHeader.js.map