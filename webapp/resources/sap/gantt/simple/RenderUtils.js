/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["./AggregationUtils","./GanttUtils","sap/ui/core/Core","../library","sap/ui/Device","../misc/Utility","sap/ui/core/theming/Parameters","../misc/Format"],function(e,t,i,a,n,r,o,l){"use strict";var s=13;var g=a.simple.horizontalTextAlignment;var p={apiVersion:2,RENDER_EXTEND_FACTOR:.382,getGanttRenderWidth:function(e){var t=jQuery(document.getElementById(e.getId()+"-gantt")).width();return e.getHorizontalLazyLoadingEnabled()&&!e._isAllDataLoadedPromiseResolved?t:t*(1+2*p.RENDER_EXTEND_FACTOR)},renderAttributes:function(e,t,i){var a=i.map(function(e){var i=e.split("-").reduce(function(e,t){return e+t.charAt(0).toUpperCase()+t.slice(1)},"get");return{name:e,value:t[i]()}});a.forEach(function(t){if(t.value||t.value===0){if(t.name==="style"){var i=t.value.split(";");i.forEach(function(t){t=t.trim();if(t!=""){var i=t.split(/:(.*)/);if(i[0]==="fill"&&i[1].indexOf(" ")!=-1){i[1]=encodeURI(i[1])}e.style(i[0],i[1])}})}else{e.attr(t.name,t.value)}}})},renderTooltip:function(e,t){if(t.getTooltip()){e.openStart("title").openEnd();e.text(t.getTooltip());e.close("title")}},updateShapeSelections:function(e,i,a){if(e._getResizeExtension==null){return}var n=e._getResizeExtension();var r=e.getId();t.getShapesWithUid(r,a).forEach(function(t){if(t){this._bShapeSelectionProperties=false;this._hasShapeSelectionProperties(t,e);if(this._bShapeSelectionProperties){this._updateShapeStyle(t,false,e,0)}if(t.isA("sap.gantt.simple.shapes.Shape")){t.setSelected(false)}else if(t.getParent().isA("sap.gantt.simple.BaseConditionalShape")){t.getParent().setProperty("selected",false,true)}else{t.setProperty("selected",false,true)}}}.bind(this));n.clearAllOutline(r);t.getShapesWithUid(r,i).forEach(function(t){if(t){if(t.getProperty("selectable")){this._bShapeSelectionProperties=false;this._hasShapeSelectionProperties(t,e);if(this._bShapeSelectionProperties){this._updateShapeStyle(t,true,e,0)}if(t.isA("sap.gantt.simple.shapes.Shape")){t.setSelected(true)}else if(t.getParent().isA("sap.gantt.simple.BaseConditionalShape")){t.getParent().setProperty("selected",true,true);n.toggleOutline(t)}else{t.setProperty("selected",true,true);n.toggleOutline(t)}}e.getSelection().updateProperties(t.getShapeUid(),{draggable:t.getDraggable(),time:t.getTime(),endTime:t.getEndTime()})}}.bind(this))},_hasShapeSelectionProperties:function(e,t){if(!e||e.isA("sap.gantt.simple.Relationship")){return}if(e.isA("sap.gantt.simple.BaseConditionalShape")){e=e._getActiveShapeElement()}if(e&&(e.getSelectedFill()||e.getSelectedTitleColor())){this._bShapeSelectionProperties=true}else if(e instanceof sap.gantt.simple.BaseGroup){if(t.getSelectOnlyGraphicalShape()){e._eachChildOfGroup(e,function(e,i){i.forEach(function(e){if(!this._bShapeSelectionProperties){this._hasShapeSelectionProperties(e,t)}}.bind(this))}.bind(this))}else{e._eachChildOfGroup(e,function(e){if(!this._bShapeSelectionProperties){this._hasShapeSelectionProperties(e,t)}}.bind(this))}}},_updateShapeStyle:function(e,t,i,a,n,r){if(!e||e.isA("sap.gantt.simple.Relationship")||!e.getVisible()){return}if(e.isA("sap.gantt.simple.BaseConditionalShape")&&e._getActiveShapeElement()){this._updateShapeStyle(e._getActiveShapeElement(),t,i,a,n,r)}else if(e.isA("sap.gantt.simple.BaseGroup")){if(i.getSelectOnlyGraphicalShape()){e._eachChildOfGroup(e,function(e,o){o.forEach(function(e){var o=this._updateGroupShapeStyle(e,t,i,a,n,r);a=o}.bind(this))}.bind(this))}else{e._eachChildOfGroup(e,function(e){var o=this._updateGroupShapeStyle(e,t,i,a,n,r);a=o}.bind(this))}}else{this._updateShapeSelectionStyle(e,t,n,r)}},_updateGroupShapeStyle:function(e,t,i,a,n,r){if(!e||e.isA("sap.gantt.simple.Relationship")||!e.getVisible()){return a}r=r||{};var o=e.getParent();var l=o.getFill()||r.fill;var s=o.getTitleColor()||r.titleColor;var g=o.getSelectedFill()||r.selectedFill;var p=o.getSelectedTitleColor()||r.selectedTitleColor;var h=o.getDomRef("nonLabelGroup")?o.getDomRef("nonLabelGroup"):o.getDomRef()||n;if(h){var d=h.children||h.childNodes;while(a<d.length&&d[a].tagName==="title"){a+=1}this._bUpdatedTitle=false;var f=e.isA("sap.gantt.simple.BaseGroup")||e.isA("sap.gantt.simple.BaseConditionalShape")&&e._getActiveShapeElement()&&e._getActiveShapeElement().isA("sap.gantt.simple.BaseGroup");var c=f?0:a;var S={fill:l,titleColor:s,selectedFill:g,selectedTitleColor:p};this._updateShapeStyle(e,t,i,c,h.children[a],S);var u=this._bUpdatedTitle&&!f?2:1;a+=u}return a},_updateShapeSelectionStyle:function(e,t,i,a){a=a||{};var n=e.getFill()||a.fill;var r=e.getTitleColor()||a.titleColor;var l=t?e.getSelectedFill()||a.selectedFill||n:n;var s=o.get("sapUiBaseText");var g=e.isA("sap.gantt.simple.BaseText")?r||n||s:r||s;var p=e.isA("sap.gantt.simple.BaseText")?e.getSelectedFill()||a.selectedFill:null;var h=t?e.getSelectedTitleColor()||a.selectedTitleColor||p||g:g;var d=i?i:document.getElementById(e.getId());if(d){d.style.fill=e.isA("sap.gantt.simple.BaseText")?h:l;var f=d.nextSibling;if(f&&f.tagName==="text"&&e.getShowTitle()&&e.getTitle()){f.style.fill=h;this._bUpdatedTitle=true}}},updateShapeHighlights:function(e,i,a){if(e._getResizeExtension==null){return}var n=e._getResizeExtension();var r=e.getId();t.getShapesWithUid(r,a).forEach(function(e){if(e){if(e.isA("sap.gantt.simple.shapes.Shape")){e.setHighlighted(false)}else if(e.getParent().isA("sap.gantt.simple.BaseConditionalShape")){e.getParent().setProperty("highlighted",false,true)}else{e.setProperty("highlighted",false,true)}}});n.clearAllHighlight(r);t.getShapesWithUid(r,i).forEach(function(t){if(t){if(t.getProperty("highlightable")){if(t.isA("sap.gantt.simple.shapes.Shape")){t.setHighlighted(true)}else if(t.getParent().isA("sap.gantt.simple.BaseConditionalShape")){t.getParent().setProperty("highlighted",true,true);n.toggleHighlight(t)}else{t.setProperty("highlighted",true,true);n.toggleHighlight(t)}}e.getHighlight().updateProperties(t.getShapeUid(),{time:t.getTime(),endTime:t.getEndTime()})}})},updateShapeSelectionByShapeID:function(e,t){if(e._getResizeExtension==null){return}var i=e.getSelection().getSelectedShapeIDS();var a=e.getSelection().getDeSelectedShapeIDS();var n=e.getSelection().getSelectedRowIDS();var r=e.getSelection().getDeSelectedRowIDS();if(i&&i.length>0){this._updateShapeSelection(e,i,true)}if(n&&n.length>0){this._updateRowSelection(e,n,true)}if(a&&a.length>0){this._updateShapeSelection(e,a,false)}if(r&&r.length>0){this._updateRowSelection(e,r,false,t)}},_updateShapeSelection:function(e,i,a){var n=e.getId();if(!a){i.forEach(function(t){e.oSelection.mSelected.deSelectShapeId[t]={selected:a}})}t.getShapeByShapeId(n,i).forEach(function(t){this._updateShapes(t,a,e)}.bind(this))},_updateRowSelection:function(e,i,a,n){var r=e.getId();var o=e.searchTxt;if(!a){o=e.deSelectTxt}if(n){t.getShapesInRowsById(r,i).forEach(function(t){if(t&&(!a||t.getProperty("selectable"))){if(t.mProperties.shapeId){e.getSelection().updateShapeId(t.getShapeId(),a)}this._updateShapes(t,a,e)}}.bind(this))}else if(o!==null&&o!==undefined){t.getShapesInRowsById(r,i).forEach(function(t){if(t){var i=this._selectShapeBySearchText(e,t,a);if(i&&(!a||t.getProperty("selectable"))){if(t.mProperties.shapeId){e.getSelection().updateShapeId(t.getShapeId(),a)}this._updateShapes(t,a,e);if(!a){e.getSelection().clearSelectionByUid(t.getShapeUid())}}}}.bind(this))}},_updateShapes:function(e,t,i){e.setProperty("selected",t,true);if(t){i.getSelection().updateProperties(e.getShapeUid(),{draggable:e.getDraggable(),time:e.getTime(),endTime:e.getEndTime()},true)}else{i.getSelection().clearSelectionByUid(e.getShapeUid())}},updateShapeHighlightByShapeID:function(e,t){if(e._getResizeExtension==null){return}var i=e.getHighlight().getHighlightedShapeID();var a=e.getHighlight().getDeEmphasizedShapeID();if(i&&i.length>0){this._updateShapeHighlight(e,i,true)}if(a&&a.length>0){this._updateShapeHighlight(e,a,false)}},_updateShapeHighlight:function(e,i,a){var n=e.getId();t.getShapeByShapeId(n,i).forEach(function(t){this._updateShapeAttributes(t,a,e)}.bind(this))},_updateShapeAttributes:function(e,t,i){e.setProperty("highlighted",t,true);if(t){i.getHighlight().updateProperties(e.getShapeUid(),{time:e.getTime(),endTime:e.getEndTime()},true)}else{i.getHighlight().clearHighlightByUid(e.getShapeUid())}},_selectShapeBySearchText:function(e,t,i){var a=false;var n=e.getTable().getBindingInfo("rows").model;var r=e.searchProperty;if(!i){r=e.deSelectProperty}function o(t){if(i){e.searchTxt.forEach(function(e){if(t!==undefined&&t!==null&&t.toString().toLowerCase().indexOf(e.toString().toLowerCase())!==-1){a=true}})}else{if(t!==undefined&&t!==null&&t.toString().toLowerCase().indexOf(e.deSelectTxt.toString().toLowerCase())!==-1){a=true}}}if(Array.isArray(r)&&r.length>0){r.forEach(function(e){if(a){return}var i=t.getBindingContext(n).getProperty(e);o(i)})}else if(typeof r==="string"){var l=t.getBindingContext(n).getProperty(r);o(l)}else{var s=t.getBindingContext(n).getObject();if(s){Object.keys(s).forEach(function(e){if(a){return}o(s[e])})}}return a},getShapeElementByTarget:function(e){return jQuery(this.getDraggableDOMElement(e)).control(0,true)},getDraggableDOMElement:function(e){return jQuery(e).closest("["+t.SHAPE_ID_DATASET_KEY+"]").get(0)},addTitleSpacing:function(e,t){if(e.titleSpacing){e.x=t?e.x-e.titleSpacing:e.x+e.titleSpacing}},renderElementTitle:function(e,t,a){if(t.getShowTitle==null||!t.getShowTitle()){return}var n=t.getTitle();if(n){var l=0,p=0,h=0;if(t.getWidth){p=t.getWidth();h=t.getWidth()}if(t.getHeadWidth){l=t.getHeadWidth();p-=l}if(t.getTailWidth){p-=t.getTailWidth()}var d=2+l+2;var f={text:n,fill:t.getTitleColor()||o.get("sapUiBaseText"),showEllipsis:true,truncateWidth:p-t.getTitleSpacing(),textAnchor:t.getHorizontalTextAlignment().toLowerCase(),verticalTextAlignment:t.getVerticalTextAlignment(),fontWeight:t.getFontWeight(),fontFamily:t.getFontFamily(),fontSize:t.getFontSize()||s};var c=i.getConfiguration().getRTL();if(t.getTitleSpacing()){if(f.textAnchor===g.End.toLowerCase()){f.titleSpacing=-t.getTitleSpacing()}else{f.titleSpacing=t.getTitleSpacing()}}var S=t.getGanttChartBase();var u=t.getParent(),x;var m=S&&S.getEnablePseudoShapes()&&u&&u.isPseudoShape;if(m){x=t.getParent().getButton()[0].getHeight()}f.x=this._calculateX(t,f.textAnchor,t.getX(),t.getWidth(),d,undefined,f,x,m);this.setVerticalAlignment(t,f);var v=r.getShapeBias(t);f.x=f.x+v.x;f.y=f.y+v.y;this.addTitleSpacing(f,c);var T=a(f).addStyleClass("sapGanttTextNoPointerEvents");T.setProperty("childElement",true,true);T.bPseudoShape=m;T.oTextElement=t;T.iIconHeight=x;var y=T._truncateText(T.getText(),m,x);var E,P=T.getTruncateWidth();if(u&&u.getAggregation("task")){u.getAggregation("task").truncatedTextWidth=P}if(m){if(y.ellipsis){E=T.measureTextWidth(y.truncatedText+"...")}else{E=T.measureTextWidth(y.truncatedText)}}var w=E+(2+x);if(!(w<=P)&&m){if(f.textAnchor===g.Dynamic.toLowerCase()){if(!c){T.setProperty("x",f.x-(2+x),true)}else{T.setProperty("x",f.x+(2+x+4),true)}}else if(f.textAnchor===g.Start.toLowerCase()){if(!c){T.setProperty("x",f.x-(2+x+4),true)}else{T.setProperty("x",f.x+(2+x+4),true)}}else if(f.textAnchor===g.Middle.toLowerCase()){if(!c){T.setProperty("x",f.x-(2+x)/2,true)}else{T.setProperty("x",f.x+(2+x)/2,true)}}else if(f.textAnchor===g.End.toLowerCase()){if(!c){T.setProperty("x",f.x+4,true)}else{T.setProperty("x",f.x-4,true)}}}T.renderElement(e,T)}},_calculateX:function(e,t,a,n,r,o,l,s,p){var h=i.getConfiguration().getRTL(),d,f;if(t===g.Start.toLowerCase()){d=p?a+r+(2+s):a+r;f=p?a+n-r-(2+s):a+n-r;a=h?f:d}else if(t===g.End.toLowerCase()){d=o?a+n-r-(2+s)-o:a+n-r;f=o?a+r+o+(2+s):a+r;a=h?f:d}else if(t===g.Middle.toLowerCase()){if(!o&&!p){a=a+n/2}else{d=o?a+n/2-(o+(2+s))/2:a+n/2+(2+s)/2;f=o?a+n/2+(o+(2+s))/2:a+n/2-(2+s)/2;a=h?f:d}}else if(t===g.Dynamic.toLowerCase()){if(o){this.renderDynamicText(e,l,r,null,a)}else{this.renderDynamicText(e,l,r)}if(p){if(h){l.x=l.x-r-(2+s)}else{l.x=l.x+(2+s)}a=l.x}else if(o){if(h){a=a+n-r}a=l.x?l.x:a}else{a=l.x}}return a},renderCalenderTitle:function(e,t,a,n){var r=t.title;var l=t.baseCalender;if(r){var p=0,h=0;if(a.width){p=a.width;h=a.width}var d={text:r,fill:l.getTitleColor()||o.get("sapUiBaseText"),showEllipsis:true,truncateWidth:p-l.getTitleSpacing(),textAnchor:l.getHorizontalTextAlignment(),verticalTextAlignment:l.getVerticalTextAlignment(),fontWeight:l.getFontWeight(),fontSize:l.getFontSize()||s,fontFamily:l.getFontFamily()};var f=i.getConfiguration().getRTL();if(l.getTitleSpacing()){if(d.textAnchor.toLowerCase()===g.End.toLowerCase()){d.titleSpacing=-l.getTitleSpacing()}else{d.titleSpacing=l.getTitleSpacing()}}if(d.textAnchor.toLowerCase()===g.Start.toLowerCase()){d.x=f?a.x+a.width:a.x}else if(d.textAnchor.toLowerCase()===g.End.toLowerCase()){d.x=f?a.x:a.x+a.width}else if(d.textAnchor.toLowerCase()===g.Middle.toLowerCase()){d.x=a.x+a.width/2}else if(d.textAnchor.toLowerCase()===g.Dynamic.toLowerCase()){this.renderDynamicText(l,d,0,a)}if(d.verticalTextAlignment==="Top"){d.y=a.height/2-1}else if(d.verticalTextAlignment==="Bottom"){d.y=a.height/2+d.fontSize-1}else{d.y=a.height/2+d.fontSize/2-1}this.addTitleSpacing(d,f);var c=n(d).addStyleClass("sapGanttTextNoPointerEvents");c.setProperty("childElement",true,true);c.renderElement(e,c)}},setVerticalAlignment:function(e,t){if(t.verticalTextAlignment==="Top"){t.y=e.getY()+t.fontSize-1}else if(t.verticalTextAlignment==="Bottom"){t.y=e.getY()+parseInt(e.getHeight(),10)-1}else{t.y=e.getY()+parseInt(e.getHeight()/2,10)+t.fontSize/2.5}},renderDynamicText:function(e,t,a,n,r){var o=i.getConfiguration().getRTL();var s=l.abapTimestampToDate(e.getAxisTime()._oZoomStrategy.getVisibleHorizon().getStartTime());var g;if(n){t.x=o?n.x+n.width-a:n.x+a;g=t.x;if(n.x<e.getAxisTime().timeToView(s)&&n.x+n.width>e.getAxisTime().timeToView(s)){t.x=o?e.getAxisTime().timeToView(s)-a:e.getAxisTime().timeToView(s)+a;t._shapeCropped=true;t._xBiassed=t.x-g}}else{if(!r){t.x=o?e.getX()+e.getWidth()-a:e.getX()+a;g=t.x}else{g=r}if(e.getTime()<s&&e.getEndTime()>s){t.x=o?e.getAxisTime().timeToView(s)-a:e.getAxisTime().timeToView(s)+a;t._shapeCropped=true;t._xBiassed=t.x-g;if(o&&r){t.x=t.x-2}}else if(r&&!o){t.x=g+a}}},renderInlineShapes:function(e,i,a){var n=i.getId()+"-top";var r=i.getId()+"-row";e.openStart("g",i);e.class(n);e.openEnd();e.openStart("g");e.attr(t.ROW_ID_DATASET_KEY,i.getRowId()||"");e.class(r);e.openEnd();this.renderMainRowAllShapes(e,i,a);e.close("g");e.close("g")},renderMainRowAllShapes:function(t,i,a){var n=a.getSyncedControl().getRowStates();var r=this.calcRowDomPosition(i,n),o=r.rowYCenter,l=r.rowHeight;var s=a&&a._aShapeRenderOrder?a._aShapeRenderOrder:Object.keys(e.getAllNonLazyAggregations(i));var g=s.filter(function(e){return e.indexOf("calendars")===-1&&e!=="relationships"}).map(function(e){return i.getAggregation(e)||[]}.bind(i));var h=i.getRowUid(),d=a.oSelection,f=a.oHighlight,c=a._oExpandModel,S=a.getAxisTime(),u=c.isRowExpanded(h),x=i.getParent().getIndex(),m=a.oOverlapShapeIds&&a.oOverlapShapeIds[x]&&a.oOverlapShapeIds[x].length>0;var v,T=[],y;var E=a._oExpandModel.mExpanded[h];if(E&&E[E.length-1]){for(var P=1;P<E.length;P++){T.push(E[P].scheme)}}v=T&&a.getShapeSchemes().filter(function(e){return T.indexOf(e.getKey())>-1});g.forEach(function(e,n){Array.isArray(e)&&e.forEach(function(e){if(a.isShapeVisible(e)&&!e.isPartOfExpandedPseudoShape){if(a.getEnablePseudoShapes()){var n;if(e.isPseudoShape){n=e.aShapeIds.some(function(e){return a.oOverlapShapeIds&&a.oOverlapShapeIds[x]&&a.oOverlapShapeIds[x].includes(e)})}else{n=a.oOverlapShapeIds&&a.oOverlapShapeIds[x]&&a.oOverlapShapeIds[x].length>0?false:u}}p.renderMainRowShape(t,e,{expandModel:c,selectionModel:d,highlightModel:f,axisTime:S,rowSetting:i,rowUid:h,aExpandScheme:v,rowExpanded:a.getEnablePseudoShapes()?n:u,mainRowYCenter:o,rowHeight:l},a.getShowParentRowOnExpand()&&!a.getUseParentShapeOnExpand()||a._aExpandedIndices.indexOf(x)>-1&&m)}})})},renderMainRowShape:function(e,t,i,a){this.setSpecialProperties(t,i);var n=t.getParentRowSettings().getParent().getParent(),r=n.getParent();var o=t.getParent().getParent(),l=o.getIndex(),s=r.oOverlapShapeIds&&r.oOverlapShapeIds[l]&&r.oOverlapShapeIds[l].length>0;if(Object.keys(i.expandModel.mExpanded).indexOf(i.rowUid)==-1&&!i.rowExpanded||a&&(t.getScheme()==""||r.getPrimaryShapeScheme().getKey()==t.getScheme())||r._aExpandedIndices.indexOf(l)>-1&&s){t.renderElement(e,t,null)}if(i.rowExpanded){this.renderExpandShapesIfNecessary(e,t,i,a)}},setSpecialProperties:function(t,i){var a=i.expandModel,n=i.rowUid,r=i.rowSetting.getShapeUid(t),o=t.getParentRowSettings().getParent().getParent(),l=o.getParent(),s=t.getParent().getParent().getIndex();if(!t._iBaseRowHeight){t._iBaseRowHeight=a.getBaseRowHeight();var g=e.getNonLazyAggregations(t);Object.keys(g).filter(function(e){var t=g[e];if(t.appData!==null){return t.appData.sapGanttOrder===1}}).map(function(e){if(e==="utilizationBar"||e==="utilizationLine"){t._iBaseRowHeight=t._iBaseRowHeight-1}})}t.mAxisTime=i.axisTime;t.setProperty("shapeUid",r,true);if(t.getProperty("selectable")){t.setProperty("selected",i.selectionModel.existed(r),true)}if(t.getProperty("highlightable")){t.setProperty("highlighted",i.highlightModel.existed(r),true)}var p=l.getUseParentShapeOnExpand()&&l.oOverlapShapeIds&&l.oOverlapShapeIds[s]&&l.oOverlapShapeIds[s].length>0?"":t.getScheme();t.setProperty("rowYCenter",a.getRowYCenterByUid(n,i.mainRowYCenter,p,0,l,s),true)},isValidD:function(e){return!!e&&e.indexOf("NaN")===-1&&e.indexOf("undefined")===-1&&e.indexOf("null")===-1},renderExpandShapesIfNecessary:function(i,a,n,r){var o;var l=a.getParentRowSettings().getParent().getParent(),s=l.getParent();var g=function(e){if(!e||e.length===0){return}var a=e;if(jQuery.isArray(e)===false){a=[e]}t.calculateLevelForShapes(a,"time","endTime");a.forEach(function(e,t){if(e._level){t=e._level-1}var a=r?n.expandModel.getRowYCenterByUid(n.rowUid,null,e.getScheme(),t,s):n.expandModel.getRowYCenterByUid(n.rowUid,null,e.getScheme(),t,s)-n.expandModel.getBaseRowHeight();e.setProperty("rowYCenter",a,true);e._iBaseRowHeight=n.expandModel.getExpandShapeHeightByUid(n.rowUid,e.getScheme(),n.iRowHeight);e.setProperty("shapeUid",n.rowSetting.getShapeUid(e),true);e.renderElement(i,e)})};a._isSubTasks=a.mBindingInfos.hasOwnProperty("subTasks")||typeof a.getSubTasks==="function"&&a.getSubTasks();var p=[];n.aExpandScheme.forEach(function(e){p.push(e.getKey())});var h=a.getParent().getParent().getIndex();if(s.oExpandedTableRowShapesMap&&s.oExpandedTableRowShapesMap[h]){s.oExpandedShapesMap[h]=s.oExpandedTableRowShapesMap[h]}else{s.oExpandedShapesMap[h]=s.oExpandedShapesMap[h]?s.oExpandedShapesMap[h]:[]}var d=a.getParent().getAllExpandableShapes(s);d.forEach(function(e,t){if(s.isShapeVisible(e)){o=t}});var f=d[o];if(!(s.oExpandedTableRowShapesMap&&s.oExpandedTableRowShapesMap[h]&&s.oExpandedTableRowShapesMap[h].length)){if(s.getUseParentShapeOnExpand()){if(!s.oOverlapShapeIds||s.oOverlapShapeIds&&s.oOverlapShapeIds[a.getParentRowSettings().getParent().getIndex()]&&s.oOverlapShapeIds[a.getParentRowSettings().getParent().getIndex()].length>0){var c=p.indexOf(a.getScheme())>-1?[a]:[];var S=a instanceof sap.gantt.simple.MultiActivityGroup?e.getNonLazyElementsByScheme(a,p):c;s.oExpandedShapesMap[h]=t._getExpandedChildArray(S,s,p,s.oExpandedShapesMap[h]);if(s.oExpandedShapesMap[h].length!==0){s.oExpandedShapesMap[h].forEach(function(e){e.setProperty("childElement",false,true)})}}}else if(a._isSubTasks){if(!s.oOverlapShapeIds||s.oOverlapShapeIds&&s.oOverlapShapeIds[a.getParentRowSettings().getParent().getIndex()]&&s.oOverlapShapeIds[a.getParentRowSettings().getParent().getIndex()].length>0){var c=p.indexOf(a.getScheme())>-1?[a]:[];var S=a instanceof sap.gantt.simple.MultiActivityGroup?e.getLazyElementsByScheme(a,p):c;s.oExpandedShapesMap[h]=t._getExpandedChildArray(S,s,p,s.oExpandedShapesMap[h])}}else if(!a._isSubTasks){if(a.getScheme()&&p.indexOf(a.getScheme())>-1){if(!s.oOverlapShapeIds||s.oOverlapShapeIds&&s.oOverlapShapeIds[a.getParentRowSettings().getParent().getIndex()]&&s.oOverlapShapeIds[a.getParentRowSettings().getParent().getIndex()].length>0){var S=[a];s.oExpandedShapesMap[h]=t._getExpandedChildArray(S,s,p,s.oExpandedShapesMap[h]);if(s.oExpandedShapesMap[h].length!==0){s.oExpandedShapesMap[h].forEach(function(e){e.setProperty("childElement",false,true)})}}}else{var u=e.getLazyAggregations(a);Object.keys(u).forEach(function(e){var t=a.getAggregation(e);g(t)})}}}if(a===f||s.oOverlapShapeIds&&s.oOverlapShapeIds[a.getParentRowSettings().getParent().getIndex()]&&s.oOverlapShapeIds[a.getParentRowSettings().getParent().getIndex()].length>0){g(s.oExpandedShapesMap[h])}},calcRowDomPosition:function(e,t){var i=e._getRow(),a=i.getParent(),n=a.indexOfRow(i);var r=t[n].height;var o=0;for(var l=0;l<=n;l++){o+=t[l].height}o-=r/2;return{rowYCenter:o,rowHeight:r}},pushOrUnshift:function(e,t,i){if(i===true){e.splice(0,0,t)}else{e.push(t)}},createOrderedListOfRenderFunctionsFromTemplate:function(e){var t=[];for(var i=0;i<e.length;i++){this.pushOrUnshift(t,e[i].fnCallback,e[i].bUnshift)}return t},renderElementAnimation:function(e,t){var i=t.getAnimationProperties(t.getAnimationSettings());if(i){e.openStart("animate");e.attr("attributeName","fill");e.attr("values",i.values);e.attr("dur",i.duration);e.attr("repeatCount",i.repeatCount);e.openEnd().close("animate")}}};return p},true);
//# sourceMappingURL=RenderUtils.js.map