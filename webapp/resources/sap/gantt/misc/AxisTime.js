/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/base/util/ObjectPath","sap/ui/core/Core","sap/gantt/misc/Utility","sap/gantt/misc/Format","sap/gantt/simple/GanttUtils","sap/gantt/misc/Memoizer"],function(e,t,i,a,o,s){"use strict";var n={};var r=function(e,t,o,n,r,f,l){this.scale=d3.time.scale().domain(e).range(t).clamp(false);this.timeRange=e;this.viewRange=t;this.zoomRate=i.assign(o,1);this.zoomOrigin=i.assign(n,0);this.viewOffset=i.assign(r,0);this.locale=f;this._shapeWidthValue=s.createCache();if(f&&f.getUtcdiff()){var h=a.getTimeStampFormatter();this.timeZoneOffset=Math.round((h.parse("20000101"+f.getUtcdiff()).getTime()-h.parse("20000101000000").getTime())/1e3);if(f.getUtcsign()==="-"){this.timeZoneOffset=-this.timeZoneOffset}}this._oZoomStrategy=l};r.prototype.CONSTANT={C_SEPARATOR:"_@@_",C_MESSAGE:{ARGUMENT_ERROR:"AxisOrdinal: Argument Error!"}};r.prototype.timeToView=function(e,i){if(t.getConfiguration().getRTL()!==true){return(this.scale(e)-this.zoomOrigin)*this.zoomRate-(i?0:this.viewOffset)}else{return this.viewRange[1]*this.zoomRate-((this.scale(e)+this.zoomOrigin)*this.zoomRate+(i?0:this.viewOffset))}};r.prototype.viewToTime=function(e,i){if(t.getConfiguration().getRTL()!==true){return this.scale.invert((e+(i?0:this.viewOffset))/this.zoomRate+this.zoomOrigin)}else{return this.scale.invert(this.viewRange[1]-(e+(i?0:this.viewOffset))/this.zoomRate-this.zoomOrigin)}};r.prototype.setTimeRange=function(e){if(this.timeRange[0].getTime()!=e[0].getTime()||this.timeRange[1].getTime()!=e[1].getTime()){this._shapeWidthValue.clearCache()}this.timeRange=e;this.scale.domain(e);return this};r.prototype.getTimeRange=function(){return this.scale.domain()};r.prototype.getTimeRangeSlice=function(e,i){var a=this.timeZoneOffset?d3.time.second.offset(this.viewToTime(e),this.timeZoneOffset):this.viewToTime(e);var o=this.timeZoneOffset?d3.time.second.offset(this.viewToTime(i),this.timeZoneOffset):this.viewToTime(i);if(t.getConfiguration().getRTL()!==true){return[a,o]}else{return[o,a]}};r.prototype.setViewRange=function(e){this.viewRange=e;this.scale.range(e);return this};r.prototype.getViewRange=function(){var e=this.scale.range();return[Math.round((e[0]-this.zoomOrigin)*this.zoomRate-this.viewOffset),Math.round((e[1]-this.zoomOrigin)*this.zoomRate-this.viewOffset)]};r.prototype.getZoomStrategy=function(){return this._oZoomStrategy};r.prototype.setZoomRate=function(e){this.zoomRate=i.assign(e,1);return this};r.prototype.getZoomRate=function(){return this.zoomRate};r.prototype.setZoomOrigin=function(e){if(this.zoomOrigin!=e){this._shapeWidthValue.clearCache()}this.zoomOrigin=i.assign(e,0);return this};r.prototype.getZoomOrigin=function(){return this.zoomOrigin};r.prototype.setViewOffset=function(e){this.viewOffset=i.assign(e,0);return this};r.prototype.getViewOffset=function(){return this.viewOffset};r.prototype.setLocale=function(e){this.locale=e;var t=this.timeZoneOffset;if(e&&e.getUtcdiff()){var i=a.getTimeStampFormatter();this.timeZoneOffset=Math.round((i.parse("20000101"+e.getUtcdiff()).getTime()-i.parse("20000101000000").getTime())/1e3);if(e.getUtcsign()==="-"){this.timeZoneOffset=-this.timeZoneOffset}}if(this.timeZoneOffset!=t){this._shapeWidthValue.clearCache()}return this};r.prototype.getLocale=function(){return this.locale};r.prototype.clone=function(){var e=new r([new Date(this.timeRange[0].valueOf()),new Date(this.timeRange[1].valueOf())],this.viewRange.slice(0),this.zoomRate,this.zoomOrigin,this.viewOffset,this.locale,this._oZoomStrategy);e._setEnableDateTimezoneFormatter(this._getEnableDateTimezoneFormatter());return e};r.prototype._get2dContext=function(e,t){if(!n.context){n.context=document.createElement("canvas").getContext("2d")}if(n.fontSize!==e||n.fontFamily!==t){n.context.font=e+"px "+t;n.fontSize=e;n.fontFamily=t}return n.context};r.prototype._getShapeTextWidth=function(e,t,i){return this._get2dContext(t,i).measureText(e).width};r.prototype.getCurrentTickTimeIntervalLevel=function(){var e=this._oZoomStrategy.getTimeLineOption(),t=this._oZoomStrategy.getTimeLineOptions(),i=0;for(var a in t){if(t[a]===e){return i}i++}};r.prototype.getCurrentTickTimeIntervalKey=function(){var e=this._oZoomStrategy.getTimeLineOption(),t=this._oZoomStrategy.getTimeLineOptions();for(var i in t){if(t[i]===e){return i}}};r.prototype.getNowLabel=function(e){var t=new Date;if(e===undefined||e){t=new Date(t.getTime()+t.getTimezoneOffset()*6e4)}else if(this._getEnableDateTimezoneFormatter()){t=o.getFormatedDateByTimeZone(t)}var i=this.timeToView(t);var a=d3.time.second.offset(t,this.timeZoneOffset);return[{date:a,value:Math.round(i)}]};r.prototype.getFirstSmallIntervalIndex=function(e,t){for(var i=0;i<e.length;i++){var o=a.dateToAbapTimestamp(e[i].date);if(o>=t){return i}}};r.prototype.getTickTimeIntervalLabel=function(o,s,n){var f,l,h,g=null;if(this.locale&&this.locale.getDstHorizons().length>0){g=this.locale.getDstHorizons()}var m=a.getTimeStampFormatter();var u=[];if(g){for(f=0;f<g.length;f++){u[f]={};l=g[f].getStartTime();h=g[f].getEndTime();u[f].startDate=m.parse(l);u[f].endDate=m.parse(h)}}var c=this.timeZoneOffset?[d3.time.second.offset(this.timeRange[0],this.timeZoneOffset),d3.time.second.offset(this.timeRange[1],this.timeZoneOffset)]:this.timeRange;var v=new r(c,this.viewRange,this.zoomRate,this.zoomOrigin,this.viewOffset,null,this._oZoomStrategy);var T=null;var d=null;var p=null;var w=null;var O=null;var y=null;var S=null;var R=[];var Z=[];var _=null;if(s){y=this.timeZoneOffset?d3.time.second.offset(s[0],this.timeZoneOffset):s[0];S=this.timeZoneOffset?d3.time.second.offset(s[1],this.timeZoneOffset):s[1];T=this.timeZoneOffset?[d3.time.second.offset(s[0],this.timeZoneOffset),d3.time.second.offset(s[1],this.timeZoneOffset)]:s;d=[this.timeToView(s[0]),this.timeToView(s[1])];if(u&&u.length){this._calculateTimeRange(u,y,S,R)}_=this._calculateScale(R,Z,T,d,false)}else if(n){y=this.timeZoneOffset?d3.time.second.offset(this.viewToTime(n[0]),this.timeZoneOffset):this.viewToTime(n[0]);S=this.timeZoneOffset?d3.time.second.offset(this.viewToTime(n[1]),this.timeZoneOffset):this.viewToTime(n[1]);T=[y,S];d=n;if(u.length){this._calculateTimeRange(u,y,S,R)}_=this._calculateScale(R,Z,T,d,false)}else{y=c[0];S=c[1];T=c;d=this.viewRange;if(u.length){this._calculateTimeRange(u,y,S,R)}_=this._calculateScale(R,Z,T,d,c)}Z=_.viewRangeSet;p=_.visibleScale;w=_.dstScale;O=_.normalScale;var z=[];var D,L,b,k;var F={unit:this._oZoomStrategy.getTimeLineOption().largeInterval.unit,span:this._oZoomStrategy.getTimeLineOption().largeInterval.span};var C={unit:this._oZoomStrategy.getTimeLineOption().smallInterval.unit,span:this._oZoomStrategy.getTimeLineOption().smallInterval.span};var I,V;var x=this._oZoomStrategy.getUpperRowFormatter(),P=this._oZoomStrategy.getLowerRowFormatter();if(F){var M=[];var E=[];var U=[];if(!(p instanceof Array)){M[0]=this._getTimeIntervalTicks(F,p)}else{for(I=0;I<w.length;I++){E[I]=w[I].ticks(e.get(F.unit).range,F.span);U[I]=O[I].ticks(e.get(F.unit).range,F.span)}for(I=0;I<p.length;I++){M[I]=p[I].ticks(e.get(F.unit).range,F.span)}}var A=[];if(M[0]!==null){for(I=0;I<M.length;I++){for(V=0;V<M[I].length;V++){D=M[I][V];b=v.timeToView(D);k=i.getLowerCaseLabel(i.getFormattedDate(x,D));A.push({date:D,value:Math.round(b),label:k})}}}if(E[0]!==null){for(I=0;I<E.length;I++){for(V=0;V<E[I].length;V++){D=E[I][V];L=U[I][V];b=v.timeToView(d3.time.second.offset(D.getTime(),-60*60));k=i.getLowerCaseLabel(i.getFormattedDate(x,D));A.push({date:D,value:Math.round(b),label:k})}}}z.push(A)}else{z.push([])}if(C){var H=[];var W=[];var G=[];if(!(p instanceof Array)){G[0]=this._getTimeIntervalTicks(C,p)}else{for(I=0;I<w.length;I++){H[I]=w[I].ticks(e.get(C.unit).range,C.span);W[I]=O[I].ticks(e.get(C.unit).range,C.span)}for(I=0;I<p.length;I++){G[I]=p[I].ticks(e.get(C.unit).range,C.span)}}var N=[];if(G[0]){for(I=0;I<G.length;I++){for(V=0;V<G[I].length;V++){D=G[I][V];var q;var j=false;if(u.length){for(var B=0;B<u.length;B++){if(D.getTime()===u[B].startDate.getTime()){q=d3.time.second.offset(D.getTime(),60*60);if(V===G[I].length-1&&this._oZoomStrategy.isLowerRowTickHourSensitive()){j=true}}if(V===G[I].length-1&&D.getTime()===d3.time.second.offset(u[B].endDate.getTime(),60*60).getTime()){q=d3.time.second.offset(D.getTime(),-60*60)}}}b=v.timeToView(D);var K;if(j){break}else if(q){K=i.getLowerCaseLabel(i.getFormattedDate(x,q));k=i.getLowerCaseLabel(i.getFormattedDate(P,q));q=null}else{K=i.getLowerCaseLabel(i.getFormattedDate(x,D));k=i.getLowerCaseLabel(i.getFormattedDate(P,D))}N.push({date:D,value:Math.round(b),label:k,largeLabel:K})}}}if(H[0]){for(I=0;I<H.length;I++){for(V=0;V<H[I].length;V++){D=H[I][V];L=W[I][V];var J;var Q=false;if(V===H[I].length-1&&this._oZoomStrategy.isLowerRowTickHourSensitive()){if(R.length>0){for(var X=0;X<R.length;X++){if(!R[X].haveDST&&L.getTime()===R[X].range[0].getTime()){Q=true}}}}if(u.length){for(var Y=0;Y<u.length;Y++){if(D.getTime()===u[Y].startDate.getTime()){J=d3.time.second.offset(D.getTime(),60*60)}if(V===H[I].length-1&&D.getTime()===d3.time.second.offset(u[Y].endDate.getTime(),60*60).getTime()){J=d3.time.second.offset(D.getTime(),-60*60)}}}if(!this._oZoomStrategy.isLowerRowTickHourSensitive()){b=v.timeToView(d3.time.second.offset(D.getTime(),-60*60))}else{b=v.timeToView(L)}if(Q){break}else if(J){k=i.getLowerCaseLabel(i.getFormattedDate(P,J));J=null}else{k=i.getLowerCaseLabel(i.getFormattedDate(P,D))}N.push({date:D,value:Math.round(b),label:k})}}}z.push(N)}else{z.push([])}var $=z[0];var ee=z[1];var te=this.getZoomStrategy().getVisibleHorizon().getStartTime();this.largeIntervalLabel=true;this.largeIntervalPath=false;var ie=this.getFirstSmallIntervalIndex(ee,te);var ae,oe,se=30;var ne,re,fe=0;var le=t.getConfiguration().getRTL();if(ee[ie]){var he=ee[ie].largeLabel;this.firstTickPosition=ee[ie].value;var ge=false;var me=document.querySelector(".sapGanttTimeHeaderSvgText")||document.querySelector(".sapGanttTimeHeaderSvgText0");if(me){var ue=getComputedStyle(me);ne=ue.fontSize;re=ue.fontFamily;fe=Math.ceil(this._getShapeTextWidth(he,ne,re))+se}ae=le?this.firstTickPosition-fe:this.firstTickPosition+fe;for(f=0;f<$.length;f++){fe=me?Math.ceil(this._getShapeTextWidth($[f].label,ne,re))+se:0;oe=le?$[f].value-fe:$[f].value+fe;var ce=le?$[f].value<this.firstTickPosition&&$[f].value>=ae:$[f].value>this.firstTickPosition&&$[f].value<=ae;var ve=le?this.firstTickPosition<$[f].value&&this.firstTickPosition>=oe:this.firstTickPosition>$[f].value&&this.firstTickPosition<=oe;var Te=$[f].label!==he;if(ce||ve&&Te){this.largeIntervalLabel=false;break}}if(this.largeIntervalLabel){for(f=0;f<$.length;f++){if($[f].label===he){if($[f].value===this.firstTickPosition){this.largeIntervalPath=true}$[f].value=this.firstTickPosition;ge=true;break}}if(!ge){var de={value:this.firstTickPosition,label:he};z[0].push(de)}}}return z};r.prototype._getTimeIntervalTicks=function(t,i){if(t.unit!==sap.gantt.config.TimeUnit.week){return i.ticks(e.get(t.unit).range,t.span)}var a=["d3.time.sunday","d3.time.monday","d3.time.tuesday","d3.time.wednesday","d3.time.thursday","d3.time.friday","d3.time.saturday"];return i.ticks(e.get(a[this.getZoomStrategy().getFirstDayOfWeek()]).range,t.span)};r.prototype._calculateScale=function(e,t,i,a,o){var s=null;var n=[];var f=[];if(e.length){s=[];var l=0;var h=0;for(var g=0;g<e.length;g++){t[g]=[this.timeToView(e[g].range[0]),this.timeToView(e[g].range[1])];if(e[g].haveDST){n[l]=new r(e[g].dstRange,t[g],this.zoomRate,this.zoomOrigin,this.viewOffset,null,this._oZoomStrategy).scale;f[l]=new r(e[g].range,t[g],this.zoomRate,this.zoomOrigin,this.viewOffset,null,this._oZoomStrategy).scale;l++}else{s[h]=new r(e[g].range,t[g],this.zoomRate,this.zoomOrigin,this.viewOffset,null,this._oZoomStrategy).scale;h++}}}else if(o){s=new r(o,this.viewRange,this.zoomRate,this.zoomOrigin,this.viewOffset,null).scale}else{s=new r(i,a,this.zoomRate,this.zoomOrigin,this.viewOffset,null,this._oZoomStrategy).scale}var m={viewRangeSet:t,visibleScale:s,dstScale:n,normalScale:f};return m};r.prototype._calculateTimeRange=function(e,t,i,a){if(e.length){var o=t;var s=i;var n=[];var r=[];var f,l;f=e[0].startDate;l=e[0].endDate;this._calculateRangeItem(f,l,o,s,n,r);if(e.length>1){for(var h=1;h<e.length;h++){if(n.length){var g=[];for(var m in n){g.push(n[m])}n=[];for(var u=0;u<g.length;u++){f=e[h].startDate;l=e[h].endDate;o=g[u].range[0];s=g[u].range[1];this._calculateRangeItem(f,l,o,s,n,r)}}}}for(var c in r){a.push(r[c])}for(var v in n){a.push(n[v])}}};r.prototype._calculateRangeItem=function(e,t,i,a,o,s){var n=null;if(i<e){if(a<t){if(a>e){n={};n.haveDST=false;n.range=[i,e];o.push(n);n={};n.haveDST=true;n.range=[e,a];n.dstRange=[d3.time.second.offset(e.getTime(),60*60),d3.time.second.offset(a,60*60)];s.push(n)}else{n={};n.haveDST=false;n.range=[i,a];o.push(n)}}else{n={};n.haveDST=false;n.range=[i,e];o.push(n);n={};n.haveDST=true;n.range=[e,t];n.dstRange=[d3.time.second.offset(e.getTime(),60*60),d3.time.second.offset(t.getTime(),60*60)];s.push(n);n={};n.haveDST=false;n.range=[t,a];o.push(n)}}else if(i>=e){if(i<t){if(a<=t){n={};n.haveDST=true;n.range=[i,a];n.dstRange=[d3.time.second.offset(i,60*60),d3.time.second.offset(a,60*60)];s.push(n)}else{n={};n.haveDST=true;n.range=[i,t];n.dstRange=[d3.time.second.offset(i,60*60),d3.time.second.offset(t.getTime(),60*60)];s.push(n);n={};n.haveDST=false;n.range=[t,a];o.push(n)}}else{n={};n.haveDST=false;n.range=[i,a];o.push(n)}}};r.prototype._getEnableDateTimezoneFormatter=function(){return this._enableDateTimezoneFormatter};r.prototype._setEnableDateTimezoneFormatter=function(e){this._enableDateTimezoneFormatter=e};return r},true);
//# sourceMappingURL=AxisTime.js.map